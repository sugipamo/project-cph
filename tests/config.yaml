# グステム全体の設定
system:
  browser: "chrome"
  editors:
    - "code"
    - "cursor"

# 言語設定
languages:
  default: rust
  # 言語の基本設定をアンカーとして定義
  _base: &lang_base
    compile: []
    run: []
    runner:
      compile_dir: "compile/{name}"
      require_files: []
      env_vars: []

    templates:
      patterns:
        solution: "solution.{extension}"
        generator: "generator.{extension}"
        tester: "tester.{extension}"
      directory: "{name}"

    contest_dir:
      active: "active_contest"
      storage: "contest_archive"
      template: "contest_template"
    
    active_contest_yaml: "active_contest.yaml"

    docker:
      timeout_seconds: 10
      memory_limit_mb: 256
      mount_point: "/compile"

    submit:
      wait: 5
      auto_yes: false
  
    test:
      dir: "test"

  rust:
    <<: *lang_base
    extension: "rs"
    runner:
      image: "rust:latest"
      compile: ["rustc", "main.rs"]
      run: ["./main"]
      require_files: ["Cargo.toml"]
      env_vars:
        - "RUST_BACKTRACE=1"
    site_ids:
      _source: "online_judge_tool"
      _fallback:
        atcoder: "5054"  # Rust (rustc 1.70.0)

    templates:
      patterns:
        solution: "src/solution.{extension}"
        generator: "src/generator.{extension}"
        tester: "src/tester.{extension}"

  python:
    <<: *lang_base
    extension: "py"
    runner:
      image: "python:3.11-slim"
      run: ["python", "main.py"]
    site_ids:
      _source: "online_judge_tool"
      _fallback:
        atcoder: "4047"  # Python (CPython 3.11.4)

  pypy:
    <<: *lang_base
    extension: "py"
    runner:
      image: "pypy:latest"
      run: ["pypy3", "main.py"]
    site_ids:
      _source: "online_judge_tool"
      _fallback:
        atcoder: "5078"  # Python (PyPy 3.10-v7.3.12)

  cpp:
    <<: *lang_base
    extension: "cpp"
    runner:
      image: "gcc:latest"
      compile: ["g++", "-std=c++17", "-O2", "main.cpp"]
      run: ["./a.out"]
      env_vars:
        - "CPLUS_INCLUDE_PATH=/usr/include/c++/9"
    site_ids:
      _source: "online_judge_tool"
      _fallback:
        atcoder: "5001"  # C++ (GCC 9.2.1)

# サイト設定
sites:
  # サイトの基本設定をアンカーとして定義
  _base: &site_base
    problem_url: ""
    submit_url: ""
    submit: 
      wait: 5
      auto_yes: false
    test:
      dir: "test"

  atcoder:
    <<: *site_base
    problem_url: "https://atcoder.jp/contests/{contest}/tasks/{contest}_{problem}"
    submit_url: "https://atcoder.jp/contests/{contest}/submit?taskScreenName={contest}_{problem}"
