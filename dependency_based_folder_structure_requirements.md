# 依存関係ベースフォルダ構造整理機能 要件定義

## 目的
インポート依存関係をフォルダ構造から視覚的に理解できるように、依存の深さに応じた階層構造でファイルを配置する。

## 基本原則

### 依存関係と階層の対応
- **依存度0**: `src/`直下に配置（誰にも依存しないファイル）
- **依存度1**: `src/`の1階層下に配置（依存度0のファイルにのみ依存）
- **依存度N**: `src/`のN階層下に配置

### 具体例：A→B→Cの場合

```
src/
├── C.py          # 依存度0（誰にも依存しない）
└── B/            # 依存度1（Cに依存）
    ├── __init__.py (空)
    ├── B.py
    └── A/        # 依存度2（BとCに依存）
        ├── __init__.py (空)
        └── A.py
```

## 技術仕様

### ファイル構成
- **1ファイル1モジュール**として扱う
- **__init__.py**は空ファイルとする
- 依存度1以上のファイルは専用フォルダ内に配置

### 依存関係の解析対象
- **src/以下のファイル**のみ対象
- **プロジェクト内モジュール間の依存**のみ対象
- **外部ライブラリ**への依存は無視（プロジェクトが外部ライブラリを使わない方針のため）

### 複数依存の扱い
- ファイルAが{B, C, D}に依存する場合
- **最も深い依存度を持つファイルの直下**に配置
- 例：BとCが依存度1、Dが依存度2の場合、AはDの直下に配置


## 実装検討事項

### 階層深度の決定アルゴリズム
1. プロジェクト内全ファイルの依存関係を解析
2. 依存グラフから各ファイルの最大依存深度を計算
3. 深度に応じてフォルダ階層を決定

### フォルダ命名規則
- **ファイル名ベースの命名**（例：`moduleA/`, `moduleB/`）
- **同一依存度のファイルは同階層**に個別フォルダで配置

### インポート解析対象
- **import文**と**from module import文**を対象
- **動的インポート**（`importlib`等）は除外（静的解析困難のため）

### ファイル名からフォルダ名への変換
- **`.py`拡張子を除去**してフォルダ名とする
- 例：`user_service.py` → `user_service/`

### インポートパスの更新
- ファイル移動後のインポート文自動更新
- 相対インポート vs 絶対インポートの選択

## 同階層複数ファイル例

```
src/
├── Z.py          # 依存度0
├── Y.py          # 依存度0  
├── X/            # 依存度1（ZとYに依存）
│   ├── __init__.py (空)
│   └── X.py
└── W/            # 依存度1（ZとYに依存）
    ├── __init__.py (空)
    └── W.py
```

## エッジケース対応

### `__init__.py`ファイル
- **普通のファイルと同等**に扱う（依存関係を解析し適切な階層に配置）

### 同名ファイル衝突
- **上位フォルダ名を引用**して名称変更
- 例：`services/user.py` → `services_user/`, `models/user.py` → `models_user/`

### 空ファイル・コメントのみファイル
- **削除対象**とする

### 設定ファイル
- **`src/config`で統一**し、依存度0として扱う

### 移動順序
- **トポロジカルソート**で決定（依存される側から先に移動）

## 実装方針

- 既存の`smart_organizer.py`の依存関係解析機能を拡張または新規実装
- `src/`以下のファイルのみ対象
- **dry-run**モードでの事前確認必須

