# Docker環境統合計画

## 概要
old_srcのDocker関連機能を現在のRustプロジェクトに統合し、競技プログラミング実行環境の隔離と再現性を実現する。

## 背景と目的
### old_srcの分析結果
- `infrastructure/drivers/docker_driver.py`: Dockerコンテナ操作の基本実装
- `context/oj.Dockerfile`: オンラインジャッジ環境の定義
- `utils/docker_utils.py`: Docker関連のユーティリティ機能
- Dockerを使用した実行環境の隔離により、安全な競技プログラミング環境を提供

### 現在のプロジェクトの状況
- `src/infrastructure/drivers/docker_driver.rs`: インターフェースのみ定義済み
- 実装は未着手の状態

## 実装方針

### 1. Docker Driver実装の完成
```rust
// src/infrastructure/drivers/docker_driver.rs
// 以下の機能を実装:
- コンテナの作成・起動・停止・削除
- イメージのビルド・管理
- ボリュームマウント機能
- 実行結果の取得
```

### 2. オンラインジャッジ環境の構築
- old_srcの`oj.Dockerfile`を参考に、Rust版のDockerfile定義
- 各種言語環境（C++, Python, Java等）のサポート
- 必要なツール（GCC, Python interpreter等）のインストール

### 3. Docker Utilityの実装
```rust
// src/infrastructure/utils/docker_utils.rs
- Dockerデーモンの接続確認
- コンテナリソース制限（メモリ、CPU）
- タイムアウト処理
- ログ収集機能
```

### 4. 安全性の確保
- ネットワーク隔離設定
- リソース制限によるDoS攻撃防止
- 一時ファイルシステムの使用
- 権限昇格の防止

## 実装優先順位
1. 基本的なDocker Driver実装（コンテナ作成・実行・削除）
2. オンラインジャッジ用Dockerfileの作成
3. リソース制限とタイムアウト機能
4. ログ収集とデバッグ機能

## 技術的考慮事項
- bollard crateを使用したDocker API操作
- 非同期処理（tokio）との統合
- エラーハンドリングの統一
- テスト環境でのDocker in Docker対応

## 期待される効果
- 実行環境の完全な隔離による安全性向上
- 異なる言語・バージョンの共存
- 再現可能な実行環境
- システムへの影響を最小化

## 参考実装
old_srcのDocker実装は、Pythonのdocker-pyライブラリを使用しており、以下のような機能を提供:
- コンテナライフサイクル管理
- 標準入出力のストリーミング
- 実行時間制限
- メモリ使用量制限

これらの機能をRustで再実装し、より高性能で安全な実行環境を構築する。