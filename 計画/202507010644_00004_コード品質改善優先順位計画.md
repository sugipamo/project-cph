# コード品質改善優先順位計画

## 概要
依存関係とCLAUDE.md違反の統合版に基づき、コード品質改善の優先順位と実施計画を策定する。

## 背景と現状
- 総違反数: 97箇所以上（デフォルト引数27ファイル、副作用36箇所、フォールバック8箇所、テスト不備21ファイル）
- 最重要課題: Infrastructure層以外での副作用処理（スコア100点）
- 推定修正期間: 18-24週間

## 優先順位（影響度×緊急度×修正容易度）

### 最優先（スコア75以上）
1. **Infrastructure層以外でのファイルI/O** (スコア: 100)
   - 影響度: 5, 緊急度: 5, 修正容易度: 4
   - 期限: 1週間

2. **Utils層でのsubprocess実行** (スコア: 75)
   - 影響度: 5, 緊急度: 5, 修正容易度: 3
   - 期限: 2週間

### 高優先（スコア50-74）
3. **Configuration層でのJSON操作副作用** (スコア: 64)
   - 影響度: 4, 緊急度: 4, 修正容易度: 4
   - 期限: 2週間

### 中優先（スコア25-49）
4. **SqliteManagerのデフォルト引数** (スコア: 48)
5. **main関数のデフォルト引数** (スコア: 48)
6. **エラー時のフォールバック処理** (スコア: 36)
7. **Utils層のテストカバレッジ0%** (スコア: 36)

### 低優先（スコア24以下）
8. **短期的解決の恒久化部分** (スコア: 27)
9. **Presentation層のデフォルト引数** (スコア: 24)
10. **Application層のデフォルト引数** (スコア: 24)

## 実施計画

### Phase 0: 準備・基盤整備（2週間）
- src_checkツールの修正と動作確認
- 自動化スクリプトの実装
- 品質メトリクス収集基盤の構築

### Phase 1: 緊急対応（4週間）
- Critical違反の修正
- 安全網の構築
- CI/CDパイプラインの品質ゲート設定

### Phase 2: 構造改善（6-8週間）
- 副作用の完全移動
- レイヤー間依存関係の整理
- デフォルト値の段階的除去

### Phase 3: 品質向上（8-10週間）
- テストカバレッジ向上
- フォールバック処理の見直し
- 規約遵守の徹底

### Phase 4: 定着・維持（継続的）
- 週次品質メトリクスレビュー
- 月次違反監査
- 四半期アーキテクチャレビュー

## 自動化ツール

### Pre-commit設定
- CLAUDE.md違反チェック
- デフォルト引数チェック
- レイヤー依存関係チェック
- 副作用配置チェック

### CI/CDパイプライン
- 品質ゲート設定
- 違反ブロック機能
- メトリクス収集

## 期待される成果
- 総違反数80%削減（97箇所→20箇所以下）
- Critical違反: 完全ゼロ
- テストカバレッジ: 90%達成
- 技術的負債比率: 10%以下

## 成功指標
- 違反削減率: 月20%削減
- 新規違反発生: 0件/月
- コードレビュー時間: 30%短縮
- バグ発生率: 50%削減