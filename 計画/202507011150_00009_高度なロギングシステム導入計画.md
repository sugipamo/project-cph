# 高度なロギングシステム導入計画

## 概要
old_srcの統一ロガー(Unified Logger)とカラー管理システムを参考に、現在のRustプロジェクトのロギング機能を強化する計画。

## 現状分析
### 現在のRustプロジェクト
- `tracing`による基本的なロギング
- シンプルな出力フォーマット
- 限定的なカラー出力

### old_srcのロギングシステム
- 統一ロガーによる一元管理
- カラーマネージャー
- 出力先の抽象化（OutputManager）
- コンテキスト情報の付加
- モック可能な設計

## 移行によるメリット
1. **デバッグ効率の向上**
   - 構造化ログ
   - コンテキスト情報の自動付加
   - フィルタリング機能

2. **ユーザー体験の改善**
   - 視認性の高いカラー出力
   - プログレス表示
   - インタラクティブな出力

3. **テスタビリティ**
   - ログ出力のモック化
   - テスト時のログ検証

## 実装方針
1. **統一ログインターフェース**
   ```rust
   trait UnifiedLogger {
       fn info(&self, message: &str, context: Context);
       fn error(&self, message: &str, error: &dyn Error);
       fn progress(&self, current: usize, total: usize);
   }
   ```

2. **カラー管理**
   - テーマシステム
   - 端末機能の自動検出
   - NO_COLOR環境変数のサポート

3. **構造化ログ**
   - JSON出力オプション
   - フィールドベースのフィルタリング

## 技術的考察
### Rustでの実装
- `tracing`の高度な機能活用
- `colored`または`termcolor`によるカラー出力
- `indicatif`によるプログレスバー

### 競技プログラミング特有の要件
1. **テスト実行の可視化**
   ```
   Running tests for problem ABC123A...
   ✓ Sample 1: PASSED (12ms)
   ✓ Sample 2: PASSED (15ms)
   ✗ Hidden 1: FAILED (TLE)
   │ Expected: 42
   │ Actual: timeout after 2000ms
   ```

2. **コンパイルエラーの整形**
   - エラー箇所のハイライト
   - 修正提案の表示

3. **実行時情報の表示**
   - メモリ使用量のリアルタイム表示
   - 実行時間の計測

## 実装優先度
**低〜中**：機能的には動作するが、UX改善に寄与

## 想定される課題
1. パフォーマンスへの影響
2. Windows/Linux/macOSでの互換性
3. CI環境での動作

## 具体的な機能
### 1. コンテキスト付きログ
```rust
logger.with_context(Context {
    problem: "ABC123A",
    test_case: "sample_1",
    language: "cpp",
}).info("Compilation started");
```

### 2. インタラクティブな選択
```
Select action:
> [1] Run all tests
  [2] Run sample tests only  
  [3] Submit solution
  [4] View problem statement
```

### 3. エラー表示の改善
```
ERROR: Compilation failed

solution.cpp:10:5: error: use of undeclared identifier 'vectro'
    vectro<int> nums;
    ^~~~~~
    vector

Did you mean 'vector'?
```

## 実装段階
1. **Phase 1: 基本的な統一ロガー**
   - インターフェース定義
   - 既存のtracingとの統合

2. **Phase 2: カラー出力**
   - カラーテーマ
   - 端末検出

3. **Phase 3: 高度な機能**
   - プログレス表示
   - インタラクティブ機能

## 次のステップ
1. 現在のロギング使用状況の調査
2. ユーザーインターフェースの設計
3. プロトタイプ実装