# テストカバレッジ測定環境構築計画

## 現状分析

### 問題点
- cargo-tarpaulin（v0.25.0）でのカバレッジ測定がタイムアウト
- 実行時間が2分を超えて終了しない
- カバレッジの現状が把握できない

## 原因分析

### 考えられる原因
1. **tarpaulinバージョンの問題**
   - v0.25.0は古いバージョン（最新はv0.32.x）
   - Rust/cargoの最新バージョンとの互換性問題

2. **プロジェクト構成の問題**
   - 複雑な依存関係
   - sqlx等のマクロ使用による影響
   - 非同期コードの多用

3. **環境設定の問題**
   - デフォルトのタイムアウト設定
   - メモリ制限

## 対応計画

### 短期対策
1. **代替ツールの検討**
   ```bash
   # llvm-covの使用
   cargo install cargo-llvm-cov
   cargo llvm-cov --html
   ```

2. **tarpaulin設定の最適化**
   ```toml
   # tarpaulin.toml
   [default]
   timeout = "600"
   exclude-files = ["*/tests/*", "*/benches/*"]
   ```

3. **部分的なカバレッジ測定**
   - モジュール単位での測定
   - テストサポートモジュールの除外

### 中期対策
1. **CI/CDでのカバレッジ測定**
   - GitHub Actionsでの自動測定
   - カバレッジレポートの可視化

2. **カバレッジ目標の設定**
   - 全体カバレッジ: 80%以上
   - コアモジュール: 90%以上
   - ユーティリティ: 70%以上

## 実装優先度

### 優先度：中
- テストは全て成功しているため、緊急性は低い
- ただし、品質指標として重要なため、中期的には対応が必要

### 推奨アクション
1. cargo-llvm-covを試す
2. 成功した場合、CIに組み込む
3. カバレッジの低い部分を特定し、テストを追加