# ワークフローエンジン基礎実装計画

## 概要
old_srcのワークフロー実行エンジンを参考に、競技プログラミング向けのタスク実行管理システムを構築する。

## 背景
- old_srcでは、Stepという抽象化により様々なタスクを統一的に管理
- 依存関係の自動解決により、並列実行可能なタスクを最適化
- 不変データ構造により、実行状態の管理が堅牢

## 目的
1. テストケースの並列実行管理
2. ビルド・実行・検証のパイプライン化
3. エラー時の詳細な実行履歴の提供

## 実装方針
### フェーズ1: 基本的なStep抽象化
- Stepトレイトの定義（実行、検証、メタデータ）
- 基本的なステップ実装（ShellStep、FileStep等）
- ステップ間の依存関係定義

### フェーズ2: 実行エンジン
- ワークフロー実行サービスの実装
- 並列実行のサポート（tokio活用）
- 実行結果の集約とレポーティング

### フェーズ3: 最適化機能
- 重複するステップの検出と除去
- キャッシング機能
- 実行順序の最適化

## 技術的詳細
- `async/await`による非同期実行
- DAG（有向非巡回グラフ）による依存関係管理
- 状態機械パターンによる実行状態管理

## 期待される効果
- テストケースの実行時間短縮
- エラー時のデバッグ情報の充実
- 複雑な実行フローの可視化

## リスクと対策
- 過度な抽象化による学習コスト
  - 対策: シンプルなAPIと豊富なドキュメント
- メモリ使用量の増加
  - 対策: 実行済みステップの適切なクリーンアップ

## 参考
- old_src/workflow/step/step.py
- old_src/services/workflow_execution/workflow_execution_service.py
- 既存のワークフロー実行エンジン実装計画（202506301636_00007）との連携