# Dockerドライバー実装計画

## 概要
old_srcの高度なDockerドライバー実装をRustに移植し、コンテナ管理とトラッキング機能を実現する。

## 現状分析
### old_srcの実装
- `infrastructure/drivers/docker/`配下に包括的なDocker管理機能
- コンテナトラッキング機能（`docker_driver_with_tracking.py`）
- Dockerパス操作とネーミング規則のユーティリティ
- 永続化によるコンテナ状態管理

### 現在のRustプロジェクト
- `interfaces/docker.rs`でトレイトは定義済み
- 実装は未着手
- テストランナーでのDocker利用を想定

## 実装方針
### 1. 基本的なDockerドライバー
```rust
// src/infrastructure/drivers/docker.rs
pub struct DockerDriver {
    client: bollard::Docker,
    naming_strategy: Box<dyn NamingStrategy>,
}

impl Docker for DockerDriver {
    async fn run_container(&self, config: ContainerConfig) -> Result<ContainerResult> {
        // 実装
    }
}
```

### 2. トラッキング機能
```rust
// src/infrastructure/drivers/docker_tracking.rs
pub struct DockerDriverWithTracking {
    inner: DockerDriver,
    repository: Arc<dyn ContainerRepository>,
}
```

### 3. ユーティリティ機能
- コンテナ命名規則の実装
- Dockerパス操作（ホスト⇔コンテナパス変換）
- ボリュームマウント管理

## 使用するクレート
- `bollard`: Docker APIクライアント
- `tokio`: 非同期ランタイム
- `serde`: 設定のシリアライズ/デシリアライズ

## 実装ステップ
1. bollardクレートを使用した基本的なDocker操作の実装
2. コンテナ設定とビルダーパターンの実装
3. トラッキング機能の追加
4. ユーティリティ関数の移植
5. エラーハンドリングとリトライ機構
6. 統合テストの作成

## 考慮事項
- 非同期処理によるパフォーマンス向上
- コンテナのライフサイクル管理
- リソースのクリーンアップ処理
- Dockerデーモンが利用できない環境での graceful degradation