# 依存性注入パターン導入計画

## 概要
old_srcで実装されていた依存性注入（DI）パターンをRustに適応させ、main.rsからすべての副作用を注入する設計を実現する。

## 現状分析
### old_srcの実装
- `infrastructure/di_container.py`でDIコンテナを実装
- すべてのドライバーとプロバイダーをコンテナ経由で管理
- 副作用のあるコンポーネントを明確に分離

### 現在のRustプロジェクト
- interfacesディレクトリでトレイトを定義
- main.rsから各サービスへの注入は部分的
- テスト用のモックドライバーは存在するが、DIパターンは未確立

## 実装方針
### 1. DIコンテナの設計
```rust
// src/infrastructure/di_container.rs
pub struct DIContainer {
    file_system: Arc<dyn FileSystem>,
    shell: Arc<dyn Shell>,
    logger: Arc<dyn Logger>,
    config_loader: Arc<dyn ConfigLoader>,
    // 他のドライバー
}
```

### 2. ビルダーパターンによる構築
```rust
impl DIContainer {
    pub fn builder() -> DIContainerBuilder {
        DIContainerBuilder::default()
    }
}
```

### 3. main.rsでの一元管理
- すべての副作用コンポーネントをmain.rsで生成
- DIコンテナに登録してアプリケーション層に渡す

## 利点
1. **テスタビリティの向上**: モックの注入が容易
2. **副作用の明確化**: すべての副作用がmain.rsで可視化
3. **拡張性**: 新しいドライバーの追加が簡単
4. **設定の一元化**: 環境変数やコンフィグファイルの管理が容易

## 実装ステップ
1. DIContainerとBuilderの基本実装
2. 既存のドライバーをDIコンテナに統合
3. アプリケーション層のサービスをDI対応に修正
4. main.rsでの初期化処理の実装
5. テストケースの更新

## 考慮事項
- Rustの所有権モデルに適したArc<dyn Trait>パターンの使用
- ライフタイムの管理を簡潔にするためのスマートポインタ活用
- 循環依存を防ぐための設計