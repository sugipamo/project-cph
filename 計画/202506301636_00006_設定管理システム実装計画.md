# 設定管理システム実装計画

## 概要
old_srcのconfig/ディレクトリに実装されている型安全な設定管理システムをRustに移植する計画。

## 背景と目的
- **現状**: 現在のRustプロジェクトには設定管理機能が未実装
- **old_srcの実装**: TypeSafeConfigNodeManagerによる階層的な設定管理とテンプレート変数の解決機能を持つ
- **目的**: 型安全で柔軟な設定管理システムの実装

## 実装すべき機能

### 1. 設定ファイルローダー
- JSON/YAML形式の設定ファイルの読み込み
- 複数ファイルのマージ機能
- 環境変数によるオーバーライド

### 2. テンプレート変数の解決
- `${変数名}`形式のテンプレート文字列の再帰的解決
- 循環参照の検出とエラーハンドリング

### 3. 型安全な設定アクセス
- serdeを使用した型安全なデシリアライゼーション
- 設定値のバリデーション
- デフォルト値の設定

### 4. ランタイム設定のオーバーレイ
- CLIオプションによる設定の上書き
- 優先順位: CLI引数 > 環境変数 > 設定ファイル > デフォルト値

## 実装方針

### ディレクトリ構造
```
src/infrastructure/config/
├── mod.rs
├── loader.rs          # ファイルローダー
├── resolver.rs        # テンプレート解決
├── manager.rs         # 設定マネージャー
└── types.rs          # 設定の型定義
```

### 主要な型定義
```rust
// 設定マネージャーのトレイト
trait ConfigManager {
    fn load_from_file(&mut self, path: &Path) -> Result<()>;
    fn get<T: DeserializeOwned>(&self, key: &str) -> Result<T>;
    fn resolve_template(&self, value: &str) -> Result<String>;
}

// 実行設定の構造体
#[derive(Serialize, Deserialize)]
struct ExecutionConfig {
    problem_name: String,
    language: Language,
    timeout: Option<Duration>,
    // その他の設定項目
}
```

## 技術選定
- **serde**: シリアライゼーション/デシリアライゼーション
- **config**: 設定ファイルの読み込みとマージ
- **regex**: テンプレート変数の検出
- **thiserror**: エラー型の定義

## 期待される効果
1. 複雑な設定の一元管理
2. 実行時エラーの削減（型安全性）
3. 環境別設定の容易な切り替え
4. 設定値の再利用性向上（テンプレート機能）

## 実装優先度
**高**: プロジェクト全体の基盤となる機能であり、他の機能実装の前提となるため