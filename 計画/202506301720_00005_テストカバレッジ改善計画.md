# テストカバレッジ改善計画

## 調査日時
2025-06-30

## 現状分析

### カバレッジサマリー
- **全体カバレッジ**: 59.38% (38/64行)
- **ファイル別カバレッジ**:
  - src/infrastructure/drivers/file_system.rs: 95% (19/20行)
  - src/infrastructure/drivers/logger.rs: 42.9% (6/14行)
  - src/infrastructure/drivers/shell.rs: 100% (13/13行)
  - src/main.rs: 0% (0/17行)

### 未カバー行の詳細
1. **file_system.rs**: 34行目のみ未カバー
2. **logger.rs**: 17-18, 21-22, 29-30, 33-34行が未カバー
3. **main.rs**: 59, 64, 66-67, 71, 74, 77-81, 85-86, 89-90, 94, 99行（全体）が未カバー

## 問題点の分析

### 1. main.rsの完全未カバー（最優先）
- **原因**: CLI機能のテストが未実装
- **影響**: アプリケーションのエントリーポイントが未検証
- **リスク**: CLIの引数処理やコマンド実行の動作が保証されない

### 2. logger.rsの低カバレッジ
- **原因**: エラーハンドリングやフォーマット処理のテスト不足
- **影響**: ログ出力の信頼性が低い
- **該当箇所**: 
  - レベル設定のエラーハンドリング
  - フォーマット処理部分

### 3. file_system.rsの1行未カバー
- **原因**: 特定のエラーケースのテスト不足
- **影響**: エッジケースでの動作が未検証

## 改善方針

### 優先度：高
1. **main.rsのテスト追加**
   - CLIパーサーのテスト
   - 各コマンドの実行テスト
   - エラーハンドリングのテスト
   - 統合テストでのE2Eテスト追加

### 優先度：中
1. **logger.rsのテスト拡充**
   - 無効なログレベル設定のテスト
   - フォーマット処理のエッジケーステスト
   - 並行実行時の安全性テスト

### 優先度：低
1. **file_system.rsの完全カバー**
   - 34行目をカバーするエラーケースの追加
   - 権限エラーなどのシステムエラーテスト

## 実装提案

### main.rsのテスト戦略
```rust
// 単体テストの例
#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_cli_parsing() {
        // CLIパーサーのテスト
    }
    
    #[test]
    fn test_command_execution() {
        // モックを使用したコマンド実行テスト
    }
}

// 統合テストの例（tests/cli_test.rs）
#[test]
fn test_cli_end_to_end() {
    // 実際のCLI呼び出しをテスト
}
```

### 目標カバレッジ
- 全体: 80%以上
- 各ファイル: 70%以上
- main.rs: 60%以上（CLIテストの制約を考慮）

## 結論
現在のカバレッジ59.38%は改善の余地が大きい。特にmain.rsの0%カバレッジは早急な対応が必要。段階的にテストを追加し、最終的に80%以上のカバレッジを目指すことが推奨される。