# 統一ロギングシステム実装計画

## 概要
インフラストラクチャ層に定義されているロギング機能を完全実装し、統一されたロギングシステムを構築する。

## 背景と現状
- インフラストラクチャ層にロギングの枠組みは存在
- 実装が不完全で一貫性に欠ける
- ログレベル、フォーマット、出力先が統一されていない
- エラートラッキングが不十分

## 目標
1. 統一されたロギングインターフェースの実装
2. 構造化ログの実現
3. エラートラッキングの強化
4. パフォーマンスへの影響最小化

## 実施内容

### Phase 1: 基盤実装（1週間）
- `LoggerInterface`の完全実装
- `UnifiedLogger`の実装
- ログレベル管理機能
- 基本的なフォーマッター実装

### Phase 2: 高度な機能（2週間）
- 構造化ログのサポート
- コンテキスト情報の自動付与
- エラートラッキング機能
- ログローテーション

### Phase 3: 出力先の拡張（1週間）
- ファイル出力
- 標準出力（色付き）
- JSON形式出力
- リモートログ収集対応

### Phase 4: 統合とパフォーマンス最適化（1週間）
- 既存コンポーネントへの統合
- 非同期ログ出力
- バッファリング最適化
- ベンチマーク実施

## 技術仕様

### ログレベル定義
```rust
#[derive(Debug, Clone, Copy, PartialEq, Eq, PartialOrd, Ord)]
pub enum LogLevel {
    Trace = 10,
    Debug = 20,
    Info = 30,
    Warn = 40,
    Error = 50,
}
```

### ログエントリー構造
```rust
#[derive(Debug, Serialize)]
pub struct LogEntry {
    pub timestamp: DateTime<Utc>,
    pub level: LogLevel,
    pub message: String,
    pub context: HashMap<String, Value>,
    pub location: LogLocation,
    pub correlation_id: Option<String>,
}

#[derive(Debug, Serialize)]
pub struct LogLocation {
    pub file: String,
    pub line: u32,
    pub module: String,
}
```

### 使用例
```rust
// 基本的な使用
log::info!("Operation completed successfully");

// 構造化ログ
log::info!({
    "event": "test_execution",
    "test_count": 10,
    "duration_ms": 1500,
}, "All tests passed");

// エラーコンテキスト付き
log::error!({
    "error_type": "FileNotFound",
    "path": "/test/data.json",
    "context": context.clone(),
}, "Failed to load test data");
```

### 設定例
```json
{
  "logging": {
    "level": "info",
    "format": "json",
    "outputs": [
      {
        "type": "file",
        "path": "logs/cph.log",
        "rotation": {
          "max_size": "10MB",
          "max_files": 5
        }
      },
      {
        "type": "console",
        "format": "colored"
      }
    ],
    "error_tracking": {
      "enabled": true,
      "sample_rate": 1.0
    }
  }
}
```

## 期待される成果
- 統一されたロギング体験
- デバッグ効率の向上
- エラー原因の迅速な特定
- 運用監視の改善

## リスクと対策
- **リスク**: パフォーマンスへの影響
- **対策**: 非同期処理、適切なログレベル設定

## 成功指標
- ログ出力のオーバーヘッド: 5%以下
- エラー追跡率: 100%
- ログの可読性向上: 開発者満足度80%以上
- 統一度: 全モジュールで統一API使用