# 依存性注入システム移植計画

## 概要
old_srcのPythonコードから依存性注入（DI）コンテナシステムをRustに移植する計画です。このシステムは副作用の集約と管理を実現し、クリーンアーキテクチャの原則に従った設計となっています。

## 現状分析

### old_srcのDIシステム特徴
- `DIContainer`クラスによる依存性の登録と解決
- `DIKey`列挙型による型安全なキー管理
- 遅延解決と自動依存性注入
- テスト用のオーバーライド機能

### 現在のRustプロジェクト構造
- `src/infrastructure`配下に副作用を集約
- `main.rs`から依存性を注入
- インターフェースベースの抽象化

## 移植方針

### 1. Rustでの実装方法
- トレイトベースの依存性定義
- `Arc<dyn Trait>`による動的ディスパッチ
- ビルダーパターンによる依存性構築
- `once_cell`や`lazy_static`による遅延初期化

### 2. 型安全性の確保
- ジェネリクスを活用した型パラメータ
- コンパイル時の依存性チェック
- PhantomDataを使用した型マーカー

### 3. テスタビリティ
- モックオブジェクトの注入
- テスト用の依存性オーバーライド
- 分離されたテスト環境

## 実装ステップ

### Phase 1: 基本構造の実装
1. DIコンテナトレイトの定義
2. 依存性キーの型定義
3. 基本的な登録・解決メカニズム

### Phase 2: 自動依存性解決
1. 依存グラフの構築
2. 循環依存の検出
3. 自動インジェクション

### Phase 3: 高度な機能
1. スコープ管理（Singleton, Transient）
2. ファクトリーパターンのサポート
3. 非同期依存性の対応

## 期待される効果
- テストの容易性向上
- モジュール間の疎結合
- 設定の一元管理
- 副作用の明確な分離

## 注意事項
- Rustの所有権システムとの調和
- パフォーマンスへの影響を最小限に
- 既存コードとの互換性維持