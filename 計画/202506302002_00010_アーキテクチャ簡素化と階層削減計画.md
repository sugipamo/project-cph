# アーキテクチャ簡素化と階層削減計画

## 概要
現在のPythonコードベースで確認された過度な分割と7層アーキテクチャの問題を踏まえ、Rust実装では最初から4層構造での実装を行う。

## 現状分析
- Pythonコードベース: 134ファイル、75ディレクトリ、7層構造
- 問題点: 過度な細分化、レイヤー間責務の曖昧さ、循環依存のリスク
- Rust実装の現状: 基本的な4層構造は確立済み

## 目標
- **4層アーキテクチャの維持**: Presentation, Application, Domain, Infrastructure
- **ファイル数の適正化**: 機能ごとに適切な粒度でモジュール化
- **明確な依存方向**: 上位層から下位層への単方向依存

## 実装方針

### 1. レイヤー定義の明確化
```rust
// 各層の責務を明確に定義
// Presentation層: CLI、出力フォーマット
// Application層: ユースケース、ワークフロー制御
// Domain層: ビジネスロジック、純粋関数
// Infrastructure層: 外部システムとの統合、副作用
```

### 2. モジュール統合基準
- 関連する型定義は同一ファイルに配置
- 50行未満のファイルは関連モジュールと統合
- 共通の責務を持つ機能は同一モジュールに

### 3. インターフェース設計
```rust
// 統一されたDriverインターフェース
pub trait Driver: Send + Sync {
    type Request;
    type Response;
    type Error;
    
    async fn execute(&self, request: Self::Request) -> Result<Self::Response, Self::Error>;
}
```

## 実施計画

### Phase 1: 現状評価とガイドライン策定（1週間）
- [ ] 現在のRustコードの構造分析
- [ ] モジュール統合ガイドラインの作成
- [ ] レイヤー間依存関係の可視化

### Phase 2: モジュール再構成（2週間）
- [ ] 細分化されたモジュールの統合
- [ ] インターフェースの統一
- [ ] 依存関係の整理

### Phase 3: 検証と最適化（1週間）
- [ ] レイヤー違反の検出と修正
- [ ] パフォーマンステスト
- [ ] ドキュメント更新

## 成功指標
- レイヤー違反: 0件
- 平均ファイルサイズ: 100-300行
- モジュール間の循環依存: 0件

## リスクと対策
- **リスク**: 統合による責務の混在
- **対策**: 明確なモジュール設計ドキュメントの作成

## 長期的な維持
- 定期的なアーキテクチャレビュー（月次）
- 新規機能追加時のレイヤー適合性確認
- 継続的なリファクタリング