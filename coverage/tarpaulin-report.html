<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: white;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
  counter-reset: line;
  display: flex;
  flex-direction: column;
}

.code-line::before {
    content: counter(line);
    margin-right: 10px;
}
.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
  counter-increment: line;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","cphelper-dev","project-cph","contest_template","rust","src","generator.rs"],"content":"use rand::Rng;\n\nfn main() {\n    let mut rng = rand::thread_rng();\n    let n = rng.gen_range(1..=100);\n    \n    println!(\"{}\", n);\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","contest_template","rust","src","solution.rs"],"content":"fn main() {\n    proconio::input! {\n        n: usize,\n    }\n    \n    // TODO: Implement solution\n    println!(\"{}\", n);\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","contest_template","rust","src","tester.rs"],"content":"use std::io::{self, Write};\n\nstruct JudgeInterface {\n    query_count: u32,\n    max_queries: u32,\n}\n\nimpl JudgeInterface {\n    fn new() -\u003e Self {\n        Self {\n            query_count: 0,\n            max_queries: 100, // デフォルトのクエリ制限\n        }\n    }\n\n    fn set_max_queries(\u0026mut self, max_queries: u32) {\n        self.max_queries = max_queries;\n    }\n\n    fn output(\u0026self, message: \u0026str) {\n        println!(\"{}\", message);\n        io::stdout().flush().unwrap();\n    }\n\n    fn input(\u0026mut self) -\u003e String {\n        if self.query_count \u003e= self.max_queries {\n            self.wrong_answer(\"クエリ制限超過\");\n        }\n        self.query_count += 1;\n        \n        let mut input = String::new();\n        io::stdin().read_line(\u0026mut input).unwrap();\n        input.trim().to_string()\n    }\n\n    fn correct_answer(\u0026self) -\u003e ! {\n        std::process::exit(0);\n    }\n\n    fn wrong_answer(\u0026self, message: \u0026str) -\u003e ! {\n        eprintln!(\"Wrong Answer: {}\", message);\n        std::process::exit(1);\n    }\n}\n\nfn main() {\n    let mut judge = JudgeInterface::new();\n    // TODO: インタラクティブジャッジの実装\n    // 例: 数当てゲーム\n    let n = 42;\n    judge.output(\"数当てゲームを開始します。1から100の数字を当ててください。\");\n    \n    loop {\n        let input = judge.input();\n        match input.parse::\u003ci32\u003e() {\n            Ok(guess) =\u003e {\n                if guess == n {\n                    judge.output(\"正解です！\");\n                    judge.correct_answer();\n                } else if guess \u003c n {\n                    judge.output(\"もっと大きいです\");\n                } else {\n                    judge.output(\"もっと小さいです\");\n                }\n            }\n            Err(_) =\u003e judge.wrong_answer(\"不正な入力です\"),\n        }\n    }\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","bin","cph.rs"],"content":"use std::env;\nuse anyhow::Result;\nuse cph::config::Config;\n\nfn main() -\u003e Result\u003c()\u003e {\n    if env::args().nth(1).is_none() {\n        println!(\"Usage: cph \u003ccommand\u003e [args...]\");\n        return Ok(());\n    }\n\n    let _config = Config::load()?;\n    Ok(())\n}\n","traces":[{"line":5,"address":[1014779,1014336],"length":1,"stats":{"Line":0}},{"line":6,"address":[1014343,1014729],"length":1,"stats":{"Line":0}},{"line":7,"address":[1014739],"length":1,"stats":{"Line":0}},{"line":8,"address":[1014768],"length":1,"stats":{"Line":0}},{"line":11,"address":[1014534,1014682],"length":1,"stats":{"Line":0}},{"line":12,"address":[1014657],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":6},{"path":["/","home","cphelper-dev","project-cph","src","config","mod.rs"],"content":"// Configuration Module\n//\n// このモジュールは、イミュータブルで型安全な設定管理を提供します。\n// 主な機能：\n// - 型安全な設定アクセス\n// - イミュータブルな設定値\n// - カスタムスキーマによるバリデーション\n// - 柔軟な型変換システム\n\nuse std::path::Path;\nuse std::fs;\nuse std::collections::HashMap;\nuse anyhow::{Result, Context};\nuse serde::{Deserialize, Serialize};\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Config {\n    pub system: SystemConfig,\n    pub languages: LanguagesConfig,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct SystemConfig {\n    pub browser: String,\n    pub editors: Vec\u003cString\u003e,\n    pub docker: DockerConfig,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct DockerConfig {\n    pub timeout_seconds: u32,\n    pub memory_limit_mb: u32,\n    pub mount_point: String,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct LanguagesConfig {\n    pub default: String,\n    #[serde(rename = \"_base\")]\n    pub base: LanguageBaseConfig,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct LanguageBaseConfig {\n    pub compile: Vec\u003cString\u003e,\n    pub run: Vec\u003cString\u003e,\n    pub runner: RunnerConfig,\n    pub templates: TemplatesConfig,\n    pub contest_dir: ContestDirConfig,\n    pub active_contest_yaml: String,\n    pub test: TestConfig,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct RunnerConfig {\n    pub compile_dir: String,\n    pub require_files: Vec\u003cString\u003e,\n    pub env_vars: Vec\u003cString\u003e,\n    pub docker: DockerConfig,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct TemplatesConfig {\n    pub patterns: HashMap\u003cString, String\u003e,\n    pub directory: String,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct ContestDirConfig {\n    pub active: String,\n    pub storage: String,\n    pub template: String,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct TestConfig {\n    pub dir: String,\n}\n\nimpl Config {\n    /// 設定ファイルから設定を読み込みます\n    /// \n    /// # Errors\n    /// \n    /// - 設定ファイルが存在しない場合\n    /// - 設定ファイルの形式が不正な場合\n    pub fn load() -\u003e Result\u003cSelf\u003e {\n        let config_path = Path::new(\"src/config/config.yaml\");\n        let config_str = fs::read_to_string(config_path)\n            .with_context(|| format!(\"設定ファイルの読み込みに失敗: {}\", config_path.display()))?;\n        let config: Self = serde_yaml::from_str(\u0026config_str)\n            .with_context(|| \"設定ファイルのパースに失敗\")?;\n        Ok(config)\n    }\n\n    /// ブラウザの設定を取得します\n    #[must_use]\n    pub fn browser(\u0026self) -\u003e \u0026str {\n        \u0026self.system.browser\n    }\n\n    /// エディタの設定を取得します\n    #[must_use]\n    pub fn editors(\u0026self) -\u003e \u0026[String] {\n        \u0026self.system.editors\n    }\n\n    /// Dockerの設定を取得します\n    #[must_use]\n    pub const fn docker(\u0026self) -\u003e \u0026DockerConfig {\n        \u0026self.system.docker\n    }\n\n    /// デフォルトの言語を取得します\n    #[must_use]\n    pub fn default_language(\u0026self) -\u003e \u0026str {\n        \u0026self.languages.default\n    }\n\n    /// テストディレクトリを取得します\n    #[must_use]\n    pub fn test_dir(\u0026self) -\u003e String {\n        self.languages.base.test.dir.clone()\n    }\n\n    /// アクティブなコンテストのディレクトリを取得します\n    #[must_use]\n    pub fn active_contest_dir(\u0026self) -\u003e String {\n        self.languages.base.contest_dir.active.clone()\n    }\n\n    /// コンテストのテンプレートディレクトリを取得します\n    #[must_use]\n    pub fn contest_template_dir(\u0026self) -\u003e String {\n        self.languages.base.contest_dir.template.clone()\n    }\n\n    /// コンテストのストレージディレクトリを取得します\n    #[must_use]\n    pub fn contest_storage_dir(\u0026self) -\u003e String {\n        self.languages.base.contest_dir.storage.clone()\n    }\n} ","traces":[{"line":96,"address":[1122410,1121888],"length":1,"stats":{"Line":0}},{"line":97,"address":[1954033],"length":1,"stats":{"Line":0}},{"line":98,"address":[1954080,1954256],"length":1,"stats":{"Line":0}},{"line":99,"address":[2929152,2929320,2929179,2929420],"length":1,"stats":{"Line":0}},{"line":100,"address":[1954222,1954324,1954515],"length":1,"stats":{"Line":0}},{"line":101,"address":[1240688],"length":1,"stats":{"Line":0}},{"line":102,"address":[1122318],"length":1,"stats":{"Line":0}},{"line":107,"address":[3078320],"length":1,"stats":{"Line":0}},{"line":108,"address":[1954597],"length":1,"stats":{"Line":0}},{"line":113,"address":[1954608],"length":1,"stats":{"Line":0}},{"line":114,"address":[1954613],"length":1,"stats":{"Line":0}},{"line":119,"address":[1954640],"length":1,"stats":{"Line":0}},{"line":120,"address":[3078376],"length":1,"stats":{"Line":0}},{"line":125,"address":[1954656],"length":1,"stats":{"Line":0}},{"line":126,"address":[3078389],"length":1,"stats":{"Line":0}},{"line":131,"address":[1954672],"length":1,"stats":{"Line":0}},{"line":132,"address":[3078417],"length":1,"stats":{"Line":0}},{"line":137,"address":[1954720],"length":1,"stats":{"Line":0}},{"line":138,"address":[1954737],"length":1,"stats":{"Line":0}},{"line":143,"address":[1954768],"length":1,"stats":{"Line":0}},{"line":144,"address":[1954785],"length":1,"stats":{"Line":0}},{"line":149,"address":[1954832],"length":1,"stats":{"Line":0}},{"line":150,"address":[1954849],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":23},{"path":["/","home","cphelper-dev","project-cph","src","contest","mod.rs"],"content":"pub mod model;\npub mod parse;\npub mod service;\n\npub use model::{Command, CommandContext, Contest, TestCase};\npub use service::{ContestHandler as Handler, TestRunner};\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","contest","model","mod.rs"],"content":"pub mod state;\n\nuse std::path::PathBuf;\nuse anyhow::Result;\nuse crate::fs::manager::Manager;\n\n#[derive(Debug, Clone)]\npub struct Contest {\n    pub id: String,\n    pub name: String,\n    pub url: String,\n    pub site: String,\n    pub contest_id: String,\n    pub problem_id: String,\n    pub language: String,\n}\n\nimpl Contest {\n    /// Creates a new Contest instance\n    #[must_use = \"この関数は新しいContestインスタンスを返します\"]\n    pub fn new(site: String, contest_id: String, problem_id: String, language: String, url: String) -\u003e Self {\n        Self {\n            id: format!(\"{site}_{problem_id}\"),\n            name: format!(\"{contest_id} - {problem_id}\"),\n            url,\n            site,\n            contest_id,\n            problem_id,\n            language,\n        }\n    }\n\n    /// Creates a workspace directory structure for the contest\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if:\n    /// - Failed to create directories\n    /// - Failed to begin or commit transaction\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn create_workspace(\u0026self, manager: Manager) -\u003e Result\u003cManager\u003e {\n        let workspace_path = PathBuf::from(\u0026self.id);\n        \n        manager.begin_transaction()?\n            .create_dir(\u0026workspace_path)?\n            .create_dir(workspace_path.join(\"src\"))?\n            .create_dir(workspace_path.join(\"test\"))?\n            .commit()\n    }\n\n    /// Saves the template code to the workspace\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if:\n    /// - Failed to write template file\n    /// - Failed to begin or commit transaction\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn save_template(\u0026self, manager: Manager, template: \u0026str) -\u003e Result\u003cManager\u003e {\n        let source_path = PathBuf::from(\u0026self.id).join(\"src\").join(\"main.rs\");\n        \n        manager.begin_transaction()?\n            .write_file(\u0026source_path, template)?\n            .commit()\n    }\n\n    /// Saves a test case to the workspace\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if:\n    /// - Failed to write input/expected files\n    /// - Failed to begin or commit transaction\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn save_test_case(\u0026self, manager: Manager, test_case: \u0026TestCase, index: usize) -\u003e Result\u003cManager\u003e {\n        let test_dir = PathBuf::from(\u0026self.id).join(\"test\");\n        let input_path = test_dir.join(format!(\"input{index}.txt\"));\n        let expected_path = test_dir.join(format!(\"expected{index}.txt\"));\n\n        manager.begin_transaction()?\n            .write_file(\u0026input_path, \u0026test_case.input)?\n            .write_file(\u0026expected_path, \u0026test_case.expected)?\n            .commit()\n    }\n\n    /// Cleans up the workspace by deleting all files\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if:\n    /// - Failed to delete workspace directory\n    /// - Failed to begin or commit transaction\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn cleanup(\u0026self, manager: Manager) -\u003e Result\u003cManager\u003e {\n        let workspace_path = PathBuf::from(\u0026self.id);\n        \n        manager.begin_transaction()?\n            .delete_file(\u0026workspace_path)?\n            .commit()\n    }\n\n    /// テストディレクトリのパスを取得します\n    /// \n    /// # Returns\n    /// * `Result\u003cPathBuf\u003e` - テストディレクトリのパス\n    /// \n    /// # Errors\n    /// - テストディレクトリが存在しない場合\n    pub fn get_test_dir(\u0026self) -\u003e Result\u003cPathBuf\u003e {\n        let path = PathBuf::from(\u0026self.id).join(\"test\");\n        if !path.exists() {\n            return Err(anyhow::anyhow!(\n                \"テストディレクトリが見つかりません: {}\", path.display()\n            ));\n        }\n        Ok(path)\n    }\n\n    /// ソースファイルのパスを取得します\n    /// \n    /// # Returns\n    /// * `Result\u003cPathBuf\u003e` - ソースファイルのパス\n    /// \n    /// # Errors\n    /// - ソースファイルが存在しない場合\n    pub fn get_source_file(\u0026self) -\u003e Result\u003cPathBuf\u003e {\n        let path = PathBuf::from(\u0026self.id).join(\"src\").join(\"main.rs\");\n        if !path.exists() {\n            return Err(anyhow::anyhow!(\n                \"ソースファイルが見つかりません: {}\", path.display()\n            ));\n        }\n        Ok(path)\n    }\n}\n\n#[derive(Debug, Clone, PartialEq, Eq)]\npub struct TestCase {\n    pub input: String,\n    pub expected: String,\n    pub path: String,\n}\n\nimpl TestCase {\n    #[must_use]\n    pub const fn new(input: String, expected: String) -\u003e Self {\n        Self {\n            input,\n            expected,\n            path: String::new(),\n        }\n    }\n}\n\n#[derive(Debug, Clone, PartialEq, Eq)]\npub enum Command {\n    Login,\n    Config {\n        site: Option\u003cString\u003e,\n        contest_id: Option\u003cString\u003e,\n        problem_id: Option\u003cString\u003e,\n        language: Option\u003cString\u003e,\n    },\n    Open,\n    Test {\n        test_number: Option\u003cusize\u003e,\n    },\n    Submit,\n}\n\n#[derive(Debug, Clone)]\npub struct CommandContext {\n    pub command: Command,\n    pub contest: Option\u003cContest\u003e,\n}\n\nimpl CommandContext {\n    #[must_use]\n    pub const fn new(command: Command) -\u003e Self {\n        Self {\n            command,\n            contest: None,\n        }\n    }\n\n    #[must_use]\n    pub const fn with_contest(command: Command, contest: Contest) -\u003e Self {\n        Self {\n            command,\n            contest: Some(contest),\n        }\n    }\n} ","traces":[{"line":21,"address":[1702466,1702393,1701184],"length":1,"stats":{"Line":0}},{"line":23,"address":[2839766],"length":1,"stats":{"Line":0}},{"line":24,"address":[1716517],"length":1,"stats":{"Line":0}},{"line":41,"address":[1718725,1717216,1718872],"length":1,"stats":{"Line":0}},{"line":42,"address":[1702510],"length":1,"stats":{"Line":0}},{"line":44,"address":[1718443,1718621,1718289,1718108,1717451,1717340,1717676,1717989,1718040,1717885,1718392,1718508],"length":1,"stats":{"Line":0}},{"line":45,"address":[2841453],"length":1,"stats":{"Line":0}},{"line":46,"address":[1718273,1717906,1718780,1718032,1717847,1718837],"length":1,"stats":{"Line":0}},{"line":47,"address":[1703527,1703936,1703473,1703996,1703641,1703806,1704031],"length":1,"stats":{"Line":0}},{"line":59,"address":[2843501,2842496,2843526],"length":1,"stats":{"Line":0}},{"line":60,"address":[1704152,1704226],"length":1,"stats":{"Line":0}},{"line":62,"address":[1719813,1719353,1719658],"length":1,"stats":{"Line":0}},{"line":63,"address":[1719797],"length":1,"stats":{"Line":0}},{"line":75,"address":[1721880,1722167,1719984],"length":1,"stats":{"Line":0}},{"line":76,"address":[1720032,1720110],"length":1,"stats":{"Line":0}},{"line":77,"address":[1705659,1705512,1705394],"length":1,"stats":{"Line":0}},{"line":78,"address":[1720838,1720547,1720708],"length":1,"stats":{"Line":0}},{"line":80,"address":[2845044,2845199,2844923,2844454,2844568,2844804,2844979],"length":1,"stats":{"Line":0}},{"line":81,"address":[1721379],"length":1,"stats":{"Line":0}},{"line":82,"address":[1721599,1721335],"length":1,"stats":{"Line":0}},{"line":94,"address":[1722208,1722885,1722910],"length":1,"stats":{"Line":0}},{"line":95,"address":[1707309],"length":1,"stats":{"Line":0}},{"line":97,"address":[1707502,1707822,1707706,1707382],"length":1,"stats":{"Line":0}},{"line":98,"address":[1707809],"length":1,"stats":{"Line":0}},{"line":109,"address":[1723677,1722944],"length":1,"stats":{"Line":0}},{"line":110,"address":[2846553],"length":1,"stats":{"Line":0}},{"line":111,"address":[1723161],"length":1,"stats":{"Line":0}},{"line":112,"address":[1708513,1708634],"length":1,"stats":{"Line":0}},{"line":113,"address":[1708360,1708246],"length":1,"stats":{"Line":0}},{"line":116,"address":[2846820],"length":1,"stats":{"Line":0}},{"line":126,"address":[2848201,2847296],"length":1,"stats":{"Line":0}},{"line":127,"address":[1723737],"length":1,"stats":{"Line":0}},{"line":128,"address":[2847684],"length":1,"stats":{"Line":0}},{"line":129,"address":[2848128,2848007],"length":1,"stats":{"Line":0}},{"line":130,"address":[1724153,1724270],"length":1,"stats":{"Line":0}},{"line":133,"address":[1724175],"length":1,"stats":{"Line":0}},{"line":146,"address":[1724825,1724640,1724850],"length":1,"stats":{"Line":0}},{"line":150,"address":[1724692],"length":1,"stats":{"Line":0}},{"line":179,"address":[1724864],"length":1,"stats":{"Line":4}},{"line":187,"address":[1724960],"length":1,"stats":{"Line":0}},{"line":190,"address":[1724993],"length":1,"stats":{"Line":0}}],"covered":1,"coverable":41},{"path":["/","home","cphelper-dev","project-cph","src","contest","model","state.rs"],"content":"// ContestStateとValidatedStateの実装について：\n// \n// 当初はCow\u003c'static, str\u003eやStringの使用を検討しましたが、以下の理由でArcを採用しています：\n// 1. イミュータブルな設計の維持\n//    - validate()メソッドで所有権の移動が不要（Arc::cloneで対応）\n//    - 元のContestStateは変更されず再利用可能\n// \n// 2. 将来のマルチスレッド対応\n//    - Arcによりスレッド間で安全に共有可能\n//    - 後からの変更コストを最小化\n// \n// 3. パフォーマンスの最適化\n//    - Arc::cloneは参照カウントの増加のみで、実データのコピーは発生しない\n//    - メモリ効率が良い\n//\n// これらの理由から、シンプルさと将来の拡張性を両立する設計としてArcを採用しています。\n\nuse std::path::PathBuf;\nuse std::sync::Arc;\nuse anyhow::{Result, anyhow};\n\n#[derive(Debug, Clone)]\npub struct State {\n    site: Option\u003cArc\u003cString\u003e\u003e,\n    contest_id: Option\u003cArc\u003cString\u003e\u003e,\n    problem_id: Option\u003cArc\u003cString\u003e\u003e,\n    language: Option\u003cArc\u003cString\u003e\u003e,\n    source_path: Option\u003cArc\u003cPathBuf\u003e\u003e,\n}\n\n#[derive(Debug, Clone)]\npub struct Validated {\n    pub(crate) site: Arc\u003cString\u003e,\n    pub(crate) contest_id: Arc\u003cString\u003e,\n    pub(crate) problem_id: Arc\u003cString\u003e,\n    pub(crate) language: Arc\u003cString\u003e,\n    pub(crate) source_path: Arc\u003cPathBuf\u003e,\n}\n\n// 状態遷移の型安全性を向上させるための新しい型\n#[derive(Debug, Clone)]\npub enum Transition {\n    SetSite(String),\n    SetContestId(String),\n    SetProblemId(String),\n    SetLanguage(String),\n    SetSourcePath(PathBuf),\n}\n\nimpl Default for State {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl State {\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub const fn new() -\u003e Self {\n        Self {\n            site: None,\n            contest_id: None,\n            problem_id: None,\n            language: None,\n            source_path: None,\n        }\n    }\n\n    #[must_use = \"この関数は状態の参照を返します\"]\n    pub fn site(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.site.as_deref().map(String::as_str)\n    }\n\n    #[must_use = \"この関数はコンテストIDの参照を返します\"]\n    pub fn contest_id(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.contest_id.as_deref().map(String::as_str)\n    }\n\n    #[must_use = \"この関数は問題IDの参照を返します\"]\n    pub fn problem_id(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.problem_id.as_deref().map(String::as_str)\n    }\n\n    #[must_use = \"この関数は言語の参照を返します\"]\n    pub fn language(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.language.as_deref().map(String::as_str)\n    }\n\n    #[must_use = \"この関数はソースファイルのパスの参照を返します\"]\n    pub fn source_path(\u0026self) -\u003e Option\u003c\u0026PathBuf\u003e {\n        self.source_path.as_deref()\n    }\n\n    #[must_use = \"この関数は新しい状態を返します\"]\n    pub fn apply_transition(self, transition: Transition) -\u003e Self {\n        match transition {\n            Transition::SetSite(site) =\u003e self.with_site(site),\n            Transition::SetContestId(id) =\u003e self.with_contest_id(id),\n            Transition::SetProblemId(id) =\u003e self.with_problem_id(id),\n            Transition::SetLanguage(lang) =\u003e self.with_language(lang),\n            Transition::SetSourcePath(path) =\u003e self.with_source_path(path),\n        }\n    }\n\n    /// 状態を検証し、�証済みの状態を返します\n    ///\n    /// # Returns\n    /// * `Result\u003cValidated\u003e` - 検証済みの状態\n    ///\n    /// # Errors\n    /// * サイトが指定されていない場合\n    /// * コンテストIDが指定されていない場合\n    /// * 問題IDが指定されていない場合\n    /// * 言語が指定されていない場合\n    /// * ソースパスが指定されていない場合\n    /// * サイトが空の場合\n    /// * コンテストIDが空の場合\n    /// * 問題IDが空の場合\n    /// * 言語が空の場合\n    /// * 指定されたソースパスが存在しない場合\n    /// * 指定されたソースパスがファイルではない場合\n    pub fn validate(\u0026self) -\u003e Result\u003cValidated\u003e {\n        let site = self.site.clone()\n            .ok_or_else(|| anyhow!(\"サイトが指定されていません\"))?;\n        \n        let contest_id = self.contest_id.clone()\n            .ok_or_else(|| anyhow!(\"コンテストIDが指定されていません\"))?;\n        \n        let problem_id = self.problem_id.clone()\n            .ok_or_else(|| anyhow!(\"問題IDが指定されていません\"))?;\n        \n        let language = self.language.clone()\n            .ok_or_else(|| anyhow!(\"言語が指定されていません\"))?;\n        \n        let source_path = self.source_path.clone()\n            .ok_or_else(|| anyhow!(\"ソースパスが指定されていません\"))?;\n\n        // 拡張されたバリデーションルール\n        if site.is_empty() {\n            return Err(anyhow!(\"サイトが空です\"));\n        }\n        if contest_id.is_empty() {\n            return Err(anyhow!(\"コンテストIDが空です\"));\n        }\n        if problem_id.is_empty() {\n            return Err(anyhow!(\"問題IDが空です\"));\n        }\n        if language.is_empty() {\n            return Err(anyhow!(\"言語が空です\"));\n        }\n\n        // パスのバリデーション\n        if !source_path.exists() {\n            return Err(anyhow!(\"指定されたソースパスが存在しません\"));\n        }\n        if !source_path.is_file() {\n            return Err(anyhow!(\"指定されたソースパスはファイルではありません\"));\n        }\n\n        Ok(Validated {\n            site,\n            contest_id,\n            problem_id,\n            language,\n            source_path,\n        })\n    }\n\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub fn with_site\u003cT: Into\u003cString\u003e\u003e(self, site: T) -\u003e Self {\n        Self {\n            site: Some(Arc::new(site.into())),\n            contest_id: self.contest_id,\n            problem_id: self.problem_id,\n            language: self.language,\n            source_path: self.source_path,\n        }\n    }\n\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub fn with_contest_id\u003cT: Into\u003cString\u003e\u003e(self, contest_id: T) -\u003e Self {\n        Self {\n            site: self.site,\n            contest_id: Some(Arc::new(contest_id.into())),\n            problem_id: self.problem_id,\n            language: self.language,\n            source_path: self.source_path,\n        }\n    }\n\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub fn with_problem_id\u003cT: Into\u003cString\u003e\u003e(self, problem_id: T) -\u003e Self {\n        Self {\n            site: self.site,\n            contest_id: self.contest_id,\n            problem_id: Some(Arc::new(problem_id.into())),\n            language: self.language,\n            source_path: self.source_path,\n        }\n    }\n\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub fn with_language\u003cT: Into\u003cString\u003e\u003e(self, language: T) -\u003e Self {\n        Self {\n            site: self.site,\n            contest_id: self.contest_id,\n            problem_id: self.problem_id,\n            language: Some(Arc::new(language.into())),\n            source_path: self.source_path,\n        }\n    }\n\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub fn with_source_path\u003cT: Into\u003cPathBuf\u003e\u003e(self, source_path: T) -\u003e Self {\n        Self {\n            site: self.site,\n            contest_id: self.contest_id,\n            problem_id: self.problem_id,\n            language: self.language,\n            source_path: Some(Arc::new(source_path.into())),\n        }\n    }\n}\n\nimpl Validated {\n    #[must_use = \"この関数はサイト名を返します\"]\n    pub fn site(\u0026self) -\u003e \u0026str {\n        \u0026self.site\n    }\n\n    #[must_use = \"この関数はコンテストIDを返します\"]\n    pub fn contest_id(\u0026self) -\u003e \u0026str {\n        \u0026self.contest_id\n    }\n\n    #[must_use = \"この関数は問題IDを返します\"]\n    pub fn problem_id(\u0026self) -\u003e \u0026str {\n        \u0026self.problem_id\n    }\n\n    #[must_use = \"この関数は言語を返します\"]\n    pub fn language(\u0026self) -\u003e \u0026str {\n        \u0026self.language\n    }\n\n    #[must_use = \"この関数はソースファイルのパスを返します\"]\n    pub fn source_path(\u0026self) -\u003e \u0026PathBuf {\n        \u0026self.source_path\n    }\n\n    /// 状態を更新します。\n    /// \n    /// # Arguments\n    /// * `transition` - 適用する状態遷移\n    /// \n    /// # Errors\n    /// - 状態遷移後の検証に失敗した場合\n    /// - 必須フィールドが未設定の場合\n    /// - パスの検証に失敗した場合\n    pub fn try_update(\u0026self, transition: Transition) -\u003e Result\u003cSelf\u003e {\n        let mut new_state = State::new()\n            .with_site(self.site.as_ref().clone())\n            .with_contest_id(self.contest_id.as_ref().clone())\n            .with_problem_id(self.problem_id.as_ref().clone())\n            .with_language(self.language.as_ref().clone())\n            .with_source_path(self.source_path.as_ref().clone());\n\n        new_state = new_state.apply_transition(transition);\n        new_state.validate()\n    }\n}\n\nimpl PartialEq for Validated {\n    fn eq(\u0026self, other: \u0026Self) -\u003e bool {\n        self.site == other.site \u0026\u0026\n        self.contest_id == other.contest_id \u0026\u0026\n        self.problem_id == other.problem_id \u0026\u0026\n        self.language == other.language \u0026\u0026\n        self.source_path == other.source_path\n    }\n}\n\nimpl Eq for Validated {} ","traces":[{"line":51,"address":[1628832],"length":1,"stats":{"Line":0}},{"line":52,"address":[2149080],"length":1,"stats":{"Line":0}},{"line":58,"address":[2149104],"length":1,"stats":{"Line":0}},{"line":69,"address":[3271856],"length":1,"stats":{"Line":0}},{"line":70,"address":[3271861],"length":1,"stats":{"Line":0}},{"line":74,"address":[3271888],"length":1,"stats":{"Line":0}},{"line":75,"address":[3271893],"length":1,"stats":{"Line":0}},{"line":79,"address":[3271920],"length":1,"stats":{"Line":0}},{"line":80,"address":[3271925],"length":1,"stats":{"Line":0}},{"line":84,"address":[2149296],"length":1,"stats":{"Line":0}},{"line":85,"address":[2149301],"length":1,"stats":{"Line":0}},{"line":89,"address":[2149328],"length":1,"stats":{"Line":0}},{"line":90,"address":[1629093],"length":1,"stats":{"Line":0}},{"line":94,"address":[1629104],"length":1,"stats":{"Line":0}},{"line":95,"address":[2149387],"length":1,"stats":{"Line":0}},{"line":96,"address":[1629177],"length":1,"stats":{"Line":0}},{"line":97,"address":[1629234],"length":1,"stats":{"Line":0}},{"line":98,"address":[1629291],"length":1,"stats":{"Line":0}},{"line":99,"address":[3272260],"length":1,"stats":{"Line":0}},{"line":100,"address":[3272321],"length":1,"stats":{"Line":0}},{"line":121,"address":[2152284,2149728,2152210],"length":1,"stats":{"Line":0}},{"line":122,"address":[2149778,2149911],"length":1,"stats":{"Line":0}},{"line":123,"address":[3200816,3200820],"length":1,"stats":{"Line":0}},{"line":125,"address":[2152282,2149981,2149864,2150173],"length":1,"stats":{"Line":0}},{"line":126,"address":[1629877],"length":1,"stats":{"Line":0}},{"line":128,"address":[3272782,3273094,3274917,3272902],"length":1,"stats":{"Line":0}},{"line":129,"address":[3273078],"length":1,"stats":{"Line":0}},{"line":131,"address":[3273047,3273167,3273359,3274896],"length":1,"stats":{"Line":0}},{"line":132,"address":[1630367],"length":1,"stats":{"Line":0}},{"line":134,"address":[3273312,3273620,3274875,3273432],"length":1,"stats":{"Line":0}},{"line":135,"address":[3201076,3201072],"length":1,"stats":{"Line":0}},{"line":138,"address":[3273569,3273693],"length":1,"stats":{"Line":0}},{"line":139,"address":[3273747,3274781],"length":1,"stats":{"Line":0}},{"line":141,"address":[3273720,3273784],"length":1,"stats":{"Line":0}},{"line":142,"address":[2151182,2152051],"length":1,"stats":{"Line":0}},{"line":144,"address":[1630863,1630811],"length":1,"stats":{"Line":0}},{"line":145,"address":[2151977,2151273],"length":1,"stats":{"Line":0}},{"line":147,"address":[3273966,3273902],"length":1,"stats":{"Line":0}},{"line":148,"address":[3274559,3274020],"length":1,"stats":{"Line":0}},{"line":152,"address":[3273993,3274057],"length":1,"stats":{"Line":0}},{"line":153,"address":[2151467,2151528],"length":1,"stats":{"Line":0}},{"line":155,"address":[1631247,1631137],"length":1,"stats":{"Line":0}},{"line":156,"address":[3274327,3274469],"length":1,"stats":{"Line":0}},{"line":159,"address":[3274401],"length":1,"stats":{"Line":0}},{"line":160,"address":[2151705],"length":1,"stats":{"Line":0}},{"line":161,"address":[2151713],"length":1,"stats":{"Line":0}},{"line":162,"address":[3274377],"length":1,"stats":{"Line":0}},{"line":163,"address":[3274385],"length":1,"stats":{"Line":0}},{"line":164,"address":[2151737],"length":1,"stats":{"Line":0}},{"line":169,"address":[3201318,3201136],"length":1,"stats":{"Line":0}},{"line":171,"address":[1639828,1639776],"length":1,"stats":{"Line":0}},{"line":172,"address":[2078382],"length":1,"stats":{"Line":0}},{"line":173,"address":[2078386],"length":1,"stats":{"Line":0}},{"line":174,"address":[3201270],"length":1,"stats":{"Line":0}},{"line":175,"address":[3201274],"length":1,"stats":{"Line":0}},{"line":180,"address":[2078464,2078661,2078750],"length":1,"stats":{"Line":0}},{"line":182,"address":[2078496],"length":1,"stats":{"Line":0}},{"line":183,"address":[3201439,3201384],"length":1,"stats":{"Line":0}},{"line":184,"address":[3201480],"length":1,"stats":{"Line":0}},{"line":185,"address":[2078604],"length":1,"stats":{"Line":0}},{"line":186,"address":[1640068],"length":1,"stats":{"Line":0}},{"line":191,"address":[3201938,3201648,3201853],"length":1,"stats":{"Line":0}},{"line":193,"address":[3201680],"length":1,"stats":{"Line":0}},{"line":194,"address":[3201688],"length":1,"stats":{"Line":0}},{"line":195,"address":[3201752,3201697],"length":1,"stats":{"Line":0}},{"line":196,"address":[2078911],"length":1,"stats":{"Line":0}},{"line":197,"address":[1640343],"length":1,"stats":{"Line":0}},{"line":202,"address":[3202172,3201952,3202253],"length":1,"stats":{"Line":0}},{"line":204,"address":[3201984],"length":1,"stats":{"Line":0}},{"line":205,"address":[1640520],"length":1,"stats":{"Line":0}},{"line":206,"address":[2079121],"length":1,"stats":{"Line":0}},{"line":207,"address":[3202010,3202068],"length":1,"stats":{"Line":0}},{"line":208,"address":[3202109],"length":1,"stats":{"Line":0}},{"line":213,"address":[3202500,3202577,3202272],"length":1,"stats":{"Line":0}},{"line":215,"address":[3202304],"length":1,"stats":{"Line":0}},{"line":216,"address":[1640808],"length":1,"stats":{"Line":0}},{"line":217,"address":[3202321],"length":1,"stats":{"Line":0}},{"line":218,"address":[1640826],"length":1,"stats":{"Line":0}},{"line":219,"address":[2079459,2079517],"length":1,"stats":{"Line":0}},{"line":226,"address":[3274960],"length":1,"stats":{"Line":0}},{"line":227,"address":[3274965],"length":1,"stats":{"Line":0}},{"line":231,"address":[1631952],"length":1,"stats":{"Line":0}},{"line":232,"address":[1631957],"length":1,"stats":{"Line":0}},{"line":236,"address":[3275024],"length":1,"stats":{"Line":0}},{"line":237,"address":[2152373],"length":1,"stats":{"Line":0}},{"line":241,"address":[2152400],"length":1,"stats":{"Line":0}},{"line":242,"address":[1632021],"length":1,"stats":{"Line":0}},{"line":246,"address":[3275088],"length":1,"stats":{"Line":0}},{"line":247,"address":[1632053],"length":1,"stats":{"Line":0}},{"line":259,"address":[3275120,3276295,3276411],"length":1,"stats":{"Line":0}},{"line":260,"address":[3275370,3275668,3275155,3275519,3275817,3275959],"length":1,"stats":{"Line":0}},{"line":261,"address":[2153733,2152762,2152628],"length":1,"stats":{"Line":0}},{"line":262,"address":[1632366,1632491,1633243],"length":1,"stats":{"Line":0}},{"line":263,"address":[3276345,3275716,3275583],"length":1,"stats":{"Line":0}},{"line":264,"address":[3275862,3276323,3275732],"length":1,"stats":{"Line":0}},{"line":265,"address":[3275878,3276304,3276001],"length":1,"stats":{"Line":0}},{"line":267,"address":[1633068,1632917],"length":1,"stats":{"Line":0}},{"line":268,"address":[1633120],"length":1,"stats":{"Line":0}},{"line":273,"address":[3276448],"length":1,"stats":{"Line":0}},{"line":274,"address":[2153815],"length":1,"stats":{"Line":0}},{"line":275,"address":[2153841],"length":1,"stats":{"Line":0}},{"line":276,"address":[2153870],"length":1,"stats":{"Line":0}},{"line":277,"address":[2153899],"length":1,"stats":{"Line":0}},{"line":278,"address":[2153928],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":104},{"path":["/","home","cphelper-dev","project-cph","src","contest","parse","config.rs"],"content":"use serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\nuse std::fs;\nuse std::path::Path;\nuse anyhow::Result;\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct AliasInfo {\n    pub original: String,\n    pub category: String,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Config {\n    pub commands: HashMap\u003cString, HashMap\u003cString, CommandValue\u003e\u003e,\n    #[serde(skip)]\n    alias_map: HashMap\u003cString, AliasInfo\u003e,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\n#[serde(untagged)]\npub enum CommandValue {\n    Command { aliases: Vec\u003cString\u003e },\n    Setting { priority: i32 },\n}\n\nimpl Default for Config {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Config {\n    #[must_use = \"この関数は新しいConfigインスタンスを返します\"]\n    pub fn new() -\u003e Self {\n        Self::from_file(\"src/config/commands.yaml\").unwrap_or_else(|_| Self::default_config())\n    }\n\n    /// ファイルからConfigを読み込みます\n    /// \n    /// # Errors\n    /// \n    /// - ファイルが存在しない場合\n    /// - ファイルの読み込みに失敗した場合\n    /// - YAMLのパースに失敗した場合\n    pub fn from_file\u003cP: AsRef\u003cPath\u003e\u003e(path: P) -\u003e Result\u003cSelf\u003e {\n        let contents = fs::read_to_string(path)?;\n        let mut config: Self = serde_yaml::from_str(\u0026contents)?;\n        config.build_alias_map();\n        Ok(config)\n    }\n\n    fn default_config() -\u003e Self {\n        let mut commands = HashMap::new();\n        let alias_map = HashMap::new();\n        \n        // デフォルトの設定\n        let mut sites = HashMap::new();\n        sites.insert(\n            \"atcoder\".to_string(),\n            CommandValue::Command {\n                aliases: vec![\"at\".to_string()],\n            },\n        );\n        commands.insert(\"site\".to_string(), sites);\n\n        let mut languages = HashMap::new();\n        languages.insert(\n            \"rust\".to_string(),\n            CommandValue::Command {\n                aliases: vec![\"rs\".to_string()],\n            },\n        );\n        commands.insert(\"language\".to_string(), languages);\n\n        let mut config = Self { commands, alias_map };\n        config.build_alias_map();\n        config\n    }\n\n    fn build_alias_map(\u0026mut self) {\n        self.alias_map.clear();\n        for (category, subcmds) in \u0026self.commands {\n            for (original, value) in subcmds {\n                match value {\n                    CommandValue::Command { aliases } =\u003e {\n                        for alias in aliases {\n                            if !alias.contains(char::is_whitespace) {\n                                self.alias_map.insert(\n                                    alias.clone(),\n                                    AliasInfo {\n                                        original: original.clone(),\n                                        category: category.clone(),\n                                    },\n                                );\n                            }\n                        }\n                    }\n                    CommandValue::Setting { priority: _ } =\u003e {\n                        // priorityの設定は無視\n                    }\n                }\n            }\n        }\n    }\n\n    /// トークンに対応するエイリアスを解決します\n    /// \n    /// 返り値は (コマンドタイプ, 実際の値) のタプルです\n    #[must_use]\n    pub fn resolve_alias(\u0026self, token: \u0026str) -\u003e Option\u003c(String, String)\u003e {\n        self.alias_map.get(token).map(|info| {\n            (info.category.clone(), info.original.clone())\n        })\n    }\n}","traces":[{"line":28,"address":[1672256],"length":1,"stats":{"Line":0}},{"line":29,"address":[1798552],"length":1,"stats":{"Line":0}},{"line":35,"address":[1798576],"length":1,"stats":{"Line":0}},{"line":36,"address":[1798590],"length":1,"stats":{"Line":0}},{"line":46,"address":[2900016,2900729,2900707],"length":1,"stats":{"Line":4}},{"line":47,"address":[1776465,1776596],"length":1,"stats":{"Line":5}},{"line":48,"address":[2900261,2900556,2900159],"length":1,"stats":{"Line":8}},{"line":49,"address":[2900532],"length":1,"stats":{"Line":4}},{"line":50,"address":[2900634],"length":1,"stats":{"Line":4}},{"line":53,"address":[1798656,1800380,1800506],"length":1,"stats":{"Line":0}},{"line":54,"address":[2922257],"length":1,"stats":{"Line":0}},{"line":55,"address":[1798743],"length":1,"stats":{"Line":0}},{"line":58,"address":[2922384],"length":1,"stats":{"Line":0}},{"line":59,"address":[1799231,1798865],"length":1,"stats":{"Line":0}},{"line":60,"address":[1672573,1672638],"length":1,"stats":{"Line":0}},{"line":61,"address":[2922783],"length":1,"stats":{"Line":0}},{"line":62,"address":[1799011,1798956,1800438],"length":1,"stats":{"Line":0}},{"line":65,"address":[1799309],"length":1,"stats":{"Line":0}},{"line":67,"address":[1799451],"length":1,"stats":{"Line":0}},{"line":68,"address":[1799470,1799836],"length":1,"stats":{"Line":0}},{"line":69,"address":[1673154,1673222],"length":1,"stats":{"Line":0}},{"line":70,"address":[1799804],"length":1,"stats":{"Line":0}},{"line":71,"address":[2923148,2923203,2923973],"length":1,"stats":{"Line":0}},{"line":74,"address":[1673578],"length":1,"stats":{"Line":0}},{"line":76,"address":[1800056],"length":1,"stats":{"Line":0}},{"line":77,"address":[2923833],"length":1,"stats":{"Line":0}},{"line":78,"address":[1800317],"length":1,"stats":{"Line":0}},{"line":81,"address":[1800544,1801346],"length":1,"stats":{"Line":4}},{"line":82,"address":[2924148],"length":1,"stats":{"Line":4}},{"line":83,"address":[1800682,1800587],"length":1,"stats":{"Line":8}},{"line":84,"address":[1800719],"length":1,"stats":{"Line":4}},{"line":85,"address":[2924448],"length":1,"stats":{"Line":4}},{"line":86,"address":[2924487],"length":1,"stats":{"Line":4}},{"line":87,"address":[2924495],"length":1,"stats":{"Line":4}},{"line":88,"address":[1674636],"length":1,"stats":{"Line":4}},{"line":89,"address":[2924860,2924624],"length":1,"stats":{"Line":8}},{"line":90,"address":[1801049],"length":1,"stats":{"Line":4}},{"line":91,"address":[2924796],"length":1,"stats":{"Line":4}},{"line":92,"address":[1801097],"length":1,"stats":{"Line":4}},{"line":93,"address":[2924731],"length":1,"stats":{"Line":4}},{"line":111,"address":[1801392],"length":1,"stats":{"Line":1}},{"line":112,"address":[1777334,1777168],"length":1,"stats":{"Line":2}},{"line":113,"address":[1777192],"length":1,"stats":{"Line":1}}],"covered":21,"coverable":43},{"path":["/","home","cphelper-dev","project-cph","src","contest","parse","mod.rs"],"content":"mod config;\nmod parser;\n\npub use config::*;\npub use parser::*;","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","contest","parse","parser.rs"],"content":"use anyhow::{Result, anyhow};\nuse crate::contest::model::{Command, CommandContext};\n\n#[derive(Debug, Clone, PartialEq, Eq)]\nenum TokenType {\n    Site,\n    Language,\n    ContestId,\n    ProblemId,\n}\n\n#[derive(Debug, Clone)]\nstruct TokenInterpretation {\n    token: String,\n    interpretations: Vec\u003c(TokenType, String)\u003e,\n}\n\npub struct Parser {\n    config: crate::contest::parse::config::Config,\n}\n\nimpl Default for Parser {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Parser {\n    #[must_use = \"この関数は新しいParserインスタンスを返します\"]\n    pub fn new() -\u003e Self {\n        Self {\n            config: crate::contest::parse::config::Config::new(),\n        }\n    }\n\n    /// 新しいParserインスタンスを設定で初期化します\n    #[must_use]\n    pub const fn with_config(config: crate::contest::parse::config::Config) -\u003e Self {\n        Self { config }\n    }\n\n    /// `入力文字列`をパースして`CommandContext`を生成します\n    /// \n    /// # Errors\n    /// \n    /// - 入力文字列のパースに失敗した場合\n    /// - コマンドの解釈に失敗した場合\n    pub fn parse(\u0026self, input: \u0026str) -\u003e Result\u003cCommandContext\u003e {\n        let input = input.trim();\n        if input.is_empty() {\n            return Err(anyhow!(\"入力が空です\"));\n        }\n\n        let tokens: Vec\u003c\u0026str\u003e = input.split_whitespace().collect();\n        Ok(self.parse_tokens(\u0026tokens))\n    }\n\n    fn parse_tokens(\u0026self, tokens: \u0026[\u0026str]) -\u003e CommandContext {\n        let mut interpretations = Vec::new();\n        for token in tokens {\n            let token_interp = self.interpret_token(token);\n            interpretations.push(token_interp);\n        }\n\n        Self::build_command(\u0026interpretations)\n    }\n\n    fn get_token_type(token: \u0026str) -\u003e Option\u003cTokenType\u003e {\n        match token {\n            \"site\" | \"atcoder\" =\u003e Some(TokenType::Site),\n            \"language\" | \"rust\" =\u003e Some(TokenType::Language),\n            \"contest\" =\u003e Some(TokenType::ContestId),\n            \"problem\" =\u003e Some(TokenType::ProblemId),\n            _ =\u003e None,\n        }\n    }\n\n    /// トークンを解釈し、可能な解釈のリストを返します\n    fn interpret_token(\u0026self, token: \u0026str) -\u003e TokenInterpretation {\n        let mut interpretations = Vec::new();\n\n        // エイリアス解決を試みる\n        if let Some((category, original)) = self.config.resolve_alias(token) {\n            if let Some(token_type) = Self::get_token_type(\u0026category) {\n                interpretations.push((token_type, original));\n                return TokenInterpretation {\n                    token: token.to_string(),\n                    interpretations,\n                };\n            }\n        }\n\n        // カテゴリ直接マッチを試みる\n        if let Some(token_type) = Self::get_token_type(token) {\n            interpretations.push((token_type, token.to_string()));\n            return TokenInterpretation {\n                token: token.to_string(),\n                interpretations,\n            };\n        }\n\n        // 解釈できなかった場合は空の解釈リストを返す\n        TokenInterpretation {\n            token: token.to_string(),\n            interpretations,\n        }\n    }\n\n    fn assign_interpreted_tokens(\n        interpretations: \u0026[TokenInterpretation],\n    ) -\u003e (Option\u003cString\u003e, Option\u003cString\u003e, Option\u003cString\u003e, Option\u003cString\u003e) {\n        let mut site = None;\n        let mut language = None;\n        let mut contest_id = None;\n        let mut problem_id = None;\n\n        for interp in interpretations {\n            for (token_type, value) in \u0026interp.interpretations {\n                match token_type {\n                    TokenType::Site =\u003e site = Some(value.clone()),\n                    TokenType::Language =\u003e language = Some(value.clone()),\n                    TokenType::ContestId =\u003e contest_id = Some(value.clone()),\n                    TokenType::ProblemId =\u003e problem_id = Some(value.clone()),\n                }\n            }\n        }\n\n        (site, language, contest_id, problem_id)\n    }\n\n    fn assign_uninterpreted_tokens(\n        interpretations: \u0026[TokenInterpretation],\n        contest_id: Option\u003cString\u003e,\n        problem_id: Option\u003cString\u003e,\n    ) -\u003e (Option\u003cString\u003e, Option\u003cString\u003e) {\n        let mut contest_id = contest_id;\n        let mut problem_id = problem_id;\n        \n        // エイリアスとして解釈できなかったトークンを収集\n        let uninterpreted_tokens: Vec\u003c_\u003e = interpretations\n            .iter()\n            .filter(|i| i.interpretations.is_empty())\n            .map(|i| i.token.clone())\n            .collect();\n\n        // 未解釈トークンがある場合、priorityの高い順に割り当てる\n        if !uninterpreted_tokens.is_empty() {\n            // priority=2のcontest_idを先に割り当て\n            if contest_id.is_none() \u0026\u0026 !uninterpreted_tokens.is_empty() {\n                contest_id = Some(uninterpreted_tokens[0].clone());\n            }\n            // priority=1のproblem_idを次に割り当て\n            if problem_id.is_none() \u0026\u0026 uninterpreted_tokens.len() \u003e 1 {\n                problem_id = Some(uninterpreted_tokens[1].clone());\n            }\n        }\n\n        (contest_id, problem_id)\n    }\n\n    fn build_command(interpretations: \u0026[TokenInterpretation]) -\u003e CommandContext {\n        let (site, language, contest_id, problem_id) = Self::assign_interpreted_tokens(interpretations);\n        let (contest_id, problem_id) = Self::assign_uninterpreted_tokens(\n            interpretations,\n            contest_id,\n            problem_id,\n        );\n\n        let command = Command::Config {\n            site,\n            contest_id,\n            problem_id,\n            language,\n        };\n\n        CommandContext::new(command)\n    }\n} ","traces":[{"line":23,"address":[1314448],"length":1,"stats":{"Line":0}},{"line":24,"address":[1422488],"length":1,"stats":{"Line":0}},{"line":30,"address":[1314480],"length":1,"stats":{"Line":0}},{"line":32,"address":[1314494],"length":1,"stats":{"Line":0}},{"line":38,"address":[1422576],"length":1,"stats":{"Line":3}},{"line":48,"address":[2544181,2543792],"length":1,"stats":{"Line":3}},{"line":49,"address":[1422680],"length":1,"stats":{"Line":3}},{"line":50,"address":[1314685],"length":1,"stats":{"Line":3}},{"line":51,"address":[1314765],"length":1,"stats":{"Line":1}},{"line":54,"address":[2543932],"length":1,"stats":{"Line":3}},{"line":55,"address":[1422784,1422940],"length":1,"stats":{"Line":8}},{"line":58,"address":[1314992,1315344],"length":1,"stats":{"Line":4}},{"line":59,"address":[1423080],"length":1,"stats":{"Line":4}},{"line":60,"address":[2544464,2544288,2544360],"length":1,"stats":{"Line":12}},{"line":61,"address":[2544480],"length":1,"stats":{"Line":4}},{"line":62,"address":[1423364],"length":1,"stats":{"Line":1}},{"line":65,"address":[1423249,1423333],"length":1,"stats":{"Line":8}},{"line":68,"address":[2544608],"length":1,"stats":{"Line":3}},{"line":70,"address":[1423447],"length":1,"stats":{"Line":4}},{"line":71,"address":[2544711],"length":1,"stats":{"Line":3}},{"line":72,"address":[2544788,2544841],"length":1,"stats":{"Line":3}},{"line":73,"address":[1423634,1423679],"length":1,"stats":{"Line":3}},{"line":74,"address":[1423672],"length":1,"stats":{"Line":3}},{"line":79,"address":[1424584,1425218,1423712],"length":1,"stats":{"Line":4}},{"line":80,"address":[1423768],"length":1,"stats":{"Line":4}},{"line":83,"address":[1315790,1315838],"length":1,"stats":{"Line":8}},{"line":84,"address":[2545322,2545213],"length":1,"stats":{"Line":2}},{"line":85,"address":[1316143],"length":1,"stats":{"Line":1}},{"line":86,"address":[2545572],"length":1,"stats":{"Line":1}},{"line":87,"address":[2545526],"length":1,"stats":{"Line":1}},{"line":88,"address":[1424354],"length":1,"stats":{"Line":1}},{"line":94,"address":[1316571,1316686],"length":1,"stats":{"Line":6}},{"line":95,"address":[1424814,1424853],"length":1,"stats":{"Line":3}},{"line":96,"address":[2546177],"length":1,"stats":{"Line":2}},{"line":97,"address":[1424934],"length":1,"stats":{"Line":2}},{"line":98,"address":[1424946],"length":1,"stats":{"Line":1}},{"line":104,"address":[2546023],"length":1,"stats":{"Line":4}},{"line":109,"address":[2546432,2548084,2548024],"length":1,"stats":{"Line":4}},{"line":112,"address":[1425317],"length":1,"stats":{"Line":4}},{"line":113,"address":[1317258],"length":1,"stats":{"Line":4}},{"line":114,"address":[2546511],"length":1,"stats":{"Line":4}},{"line":115,"address":[1425335],"length":1,"stats":{"Line":4}},{"line":117,"address":[1425845,1425418,1425343],"length":1,"stats":{"Line":12}},{"line":118,"address":[1317789],"length":1,"stats":{"Line":4}},{"line":119,"address":[1426022],"length":1,"stats":{"Line":1}},{"line":120,"address":[2547241,2547338],"length":1,"stats":{"Line":2}},{"line":121,"address":[1318000,1318232],"length":1,"stats":{"Line":2}},{"line":122,"address":[1426482,1426106],"length":1,"stats":{"Line":0}},{"line":123,"address":[1318581,1318052],"length":1,"stats":{"Line":0}},{"line":128,"address":[2546698],"length":1,"stats":{"Line":3}},{"line":131,"address":[1428109,1428149,1426928],"length":1,"stats":{"Line":4}},{"line":136,"address":[2548171],"length":1,"stats":{"Line":4}},{"line":137,"address":[1427031],"length":1,"stats":{"Line":4}},{"line":140,"address":[2548319,2548247],"length":1,"stats":{"Line":8}},{"line":142,"address":[1533024,1533038],"length":1,"stats":{"Line":8}},{"line":143,"address":[2656691,2656656],"length":1,"stats":{"Line":8}},{"line":147,"address":[1319187,1319128],"length":1,"stats":{"Line":8}},{"line":149,"address":[1427503,1427770,1427471,1427293],"length":1,"stats":{"Line":16}},{"line":150,"address":[1427536],"length":1,"stats":{"Line":4}},{"line":153,"address":[1427477,1427779,1428075],"length":1,"stats":{"Line":10}},{"line":154,"address":[1427827],"length":1,"stats":{"Line":2}},{"line":158,"address":[1427321],"length":1,"stats":{"Line":2}},{"line":161,"address":[1428192,1429219,1429101],"length":1,"stats":{"Line":4}},{"line":162,"address":[1428234],"length":1,"stats":{"Line":4}},{"line":165,"address":[1428447],"length":1,"stats":{"Line":3}},{"line":166,"address":[1428481],"length":1,"stats":{"Line":3}},{"line":176,"address":[1428953],"length":1,"stats":{"Line":2}}],"covered":61,"coverable":67},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","command.rs"],"content":"use crate::contest::model::{Command, CommandContext, Contest};\nuse crate::contest::service::{ContestHandler, TestRunner};\nuse crate::config::Config;\nuse anyhow::Result;\nuse crate::message::contest;\n\npub struct Service {\n    contest_service: ContestHandler,\n    test_service: TestRunner,\n    config: Config,\n}\n\nimpl Service {\n    /// `CommandService`の新しいインスタンスを作成します\n    /// \n    /// # Errors\n    /// \n    /// - 設定ファイルの読み込みに失敗した場合\n    pub fn new(contest_service: ContestHandler, test_service: TestRunner) -\u003e Result\u003cSelf\u003e {\n        let config = Config::load()?;\n        Ok(Self {\n            contest_service,\n            test_service,\n            config,\n        })\n    }\n\n    /// コマンドを実行します。\n    /// \n    /// # Errors\n    /// - コマンドの実行に失敗した場合\n    /// - コンテストが選択されていない場合（必要な場合）\n    pub fn execute(\u0026self, context: CommandContext) -\u003e Result\u003c()\u003e {\n        match context.command {\n            Command::Login =\u003e {\n                println!(\"ログイン処理を実行します\");\n                // TODO: ログイン処理の実装\n                Ok(())\n            }\n            Command::Config { site, contest_id, problem_id, language: _ } =\u003e {\n                println!(\"問題を開きます: site={site:?}, contest={contest_id:?}, problem={problem_id:?}\");\n                site.map_or_else(\n                    || Err(anyhow::anyhow!(contest::error(\"invalid_command\", \"サイトが指定されていません\"))),\n                    |site_str| {\n                        // 設定からテンプレートディレクトリを取得\n                        let template_dir = self.config.contest_template_dir();\n                        let active_dir = self.config.active_contest_dir();\n                        \n                        self.contest_service.open_with_config(\n                            \u0026site_str,\n                            contest_id.as_ref().ok_or_else(|| anyhow::anyhow!(contest::error(\"invalid_command\", \"コンテストIDが指定されていません\")))?,\n                            problem_id.as_ref().ok_or_else(|| anyhow::anyhow!(contest::error(\"invalid_command\", \"問題IDが指定されていません\")))?,\n                            \u0026template_dir,\n                            \u0026active_dir,\n                        )\n                    }\n                )\n            }\n            Command::Open =\u003e {\n                println!(\"問題を開きます\");\n                Ok(())\n            }\n            Command::Test { test_number } =\u003e {\n                context.contest.map_or_else(\n                    || Err(anyhow::anyhow!(contest::error(\"invalid_command\", \"コンテストが選択されていません\"))),\n                    |contest| {\n                        println!(\"テストを実行します: test_number={test_number:?}\");\n                        // 設定からテストディレクトリを取得\n                        let test_dir = self.config.test_dir();\n                        let result = self.test_service.run_test_with_config(\u0026contest, test_number, \u0026test_dir)?;\n                        println!(\"{}\", result.summary());\n                        Ok(())\n                    }\n                )\n            }\n            Command::Submit =\u003e {\n                context.contest.map_or_else(\n                    || Err(anyhow::anyhow!(contest::error(\"invalid_command\", \"コンテストが選択されていません\"))),\n                    |contest| {\n                        println!(\"提出を行います\");\n                        self.contest_service.submit(\u0026contest)\n                    }\n                )\n            }\n        }\n    }\n\n    #[must_use = \"この関数は新しいCommandContextインスタンスを返します\"]\n    pub const fn with_contest(\u0026self, command: Command, contest: Contest) -\u003e CommandContext {\n        CommandContext::with_contest(command, contest)\n    }\n\n    #[must_use = \"この関数は新しいCommandContextインスタンスを返します\"]\n    pub const fn without_contest(\u0026self, command: Command) -\u003e CommandContext {\n        CommandContext::new(command)\n    }\n} ","traces":[{"line":19,"address":[1472368,1472788],"length":1,"stats":{"Line":0}},{"line":20,"address":[1472402,1472458,1472691],"length":1,"stats":{"Line":0}},{"line":21,"address":[1472569],"length":1,"stats":{"Line":0}},{"line":22,"address":[1472529],"length":1,"stats":{"Line":0}},{"line":23,"address":[1472551],"length":1,"stats":{"Line":0}},{"line":33,"address":[1474168,1472816,1474328],"length":1,"stats":{"Line":0}},{"line":34,"address":[1472841],"length":1,"stats":{"Line":0}},{"line":36,"address":[1473478,1472929],"length":1,"stats":{"Line":0}},{"line":38,"address":[1473494],"length":1,"stats":{"Line":0}},{"line":40,"address":[1472960],"length":1,"stats":{"Line":0}},{"line":41,"address":[1473820],"length":1,"stats":{"Line":0}},{"line":42,"address":[1474019,1473926],"length":1,"stats":{"Line":0}},{"line":43,"address":[1468583,1468576],"length":1,"stats":{"Line":0}},{"line":44,"address":[3266209,3264816,3266102],"length":1,"stats":{"Line":0}},{"line":46,"address":[2142188],"length":1,"stats":{"Line":0}},{"line":47,"address":[3264925],"length":1,"stats":{"Line":0}},{"line":49,"address":[3265867,3265011],"length":1,"stats":{"Line":0}},{"line":50,"address":[1469014],"length":1,"stats":{"Line":0}},{"line":51,"address":[1470075,1470192,1469118,1470196],"length":1,"stats":{"Line":0}},{"line":52,"address":[3265438,3266040,3266464,3266468],"length":1,"stats":{"Line":0}},{"line":53,"address":[2143079],"length":1,"stats":{"Line":0}},{"line":54,"address":[3265780],"length":1,"stats":{"Line":0}},{"line":60,"address":[1473206,1474196],"length":1,"stats":{"Line":0}},{"line":61,"address":[1474215],"length":1,"stats":{"Line":0}},{"line":63,"address":[1473240],"length":1,"stats":{"Line":0}},{"line":64,"address":[1474234,1473270],"length":1,"stats":{"Line":0}},{"line":65,"address":[2144055,2144048],"length":1,"stats":{"Line":0}},{"line":66,"address":[2144304,2145371,2145422],"length":1,"stats":{"Line":0}},{"line":67,"address":[2144326,2144460],"length":1,"stats":{"Line":0}},{"line":69,"address":[3267179],"length":1,"stats":{"Line":0}},{"line":70,"address":[1471260,1471526,1471928,1471122],"length":1,"stats":{"Line":0}},{"line":71,"address":[3267599,3267824],"length":1,"stats":{"Line":0}},{"line":72,"address":[2145300],"length":1,"stats":{"Line":0}},{"line":77,"address":[1474249,1473343],"length":1,"stats":{"Line":0}},{"line":78,"address":[2145447,2145440],"length":1,"stats":{"Line":0}},{"line":79,"address":[2145696,2145826],"length":1,"stats":{"Line":0}},{"line":80,"address":[2145710,2145765],"length":1,"stats":{"Line":0}},{"line":81,"address":[2145786],"length":1,"stats":{"Line":0}},{"line":89,"address":[1474432],"length":1,"stats":{"Line":0}},{"line":90,"address":[1474475],"length":1,"stats":{"Line":0}},{"line":94,"address":[1474496],"length":1,"stats":{"Line":0}},{"line":95,"address":[1474524],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":42},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","contest.rs"],"content":"use anyhow::{Result, anyhow};\nuse crate::config::Config;\nuse crate::contest::model::{Contest, TestCase};\nuse crate::fs::manager::Manager;\nuse crate::message::contest;\n\n#[derive(Clone)]\npub struct Service {\n    site: Option\u003cString\u003e,\n    contest_id: Option\u003cString\u003e,\n    problem_id: Option\u003cString\u003e,\n    language: Option\u003cString\u003e,\n    url: Option\u003cString\u003e,\n    file_manager: Option\u003cManager\u003e,\n    #[allow(dead_code)]\n    config: Config,\n}\n\n// 状態遷移を表現する型\n#[derive(Debug, Clone)]\npub enum ServiceTransition {\n    Site(String),\n    ContestId(String),\n    ProblemId(String),\n    TestCase(TestCase),\n    FileManager(Manager),\n}\n\nimpl Service {\n    /// 新しいサービスインスタンスを作成します\n    ///\n    /// # Arguments\n    /// * `config` - サービスの設定\n    ///\n    /// # Returns\n    /// * `Result\u003cSelf\u003e` - 作成されたサービスインスタンス\n    ///\n    /// # Errors\n    /// * 設定の読み込みに失敗した場合\n    pub fn new(config: \u0026Config) -\u003e Result\u003cSelf\u003e {\n        Ok(Self {\n            site: None,\n            contest_id: None,\n            problem_id: None,\n            language: None,\n            url: None,\n            file_manager: None,\n            config: config.clone(),\n        })\n    }\n\n    // アクセサメソッド\n    #[must_use]\n    pub fn site(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.site.as_deref()\n    }\n\n    #[must_use]\n    pub fn contest_id(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.contest_id.as_deref()\n    }\n\n    #[must_use]\n    pub fn problem_id(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.problem_id.as_deref()\n    }\n\n    #[must_use]\n    pub fn language(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.language.as_deref()\n    }\n\n    #[must_use]\n    pub fn url(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.url.as_deref()\n    }\n\n    // 状態遷移を適用するメソッド\n    #[must_use]\n    pub fn apply_transition(self, transition: ServiceTransition) -\u003e Self {\n        match transition {\n            ServiceTransition::Site(site) =\u003e self.with_site(site),\n            ServiceTransition::ContestId(id) =\u003e self.with_contest_id(id),\n            ServiceTransition::ProblemId(id) =\u003e self.with_problem_id(id),\n            ServiceTransition::TestCase(test_case) =\u003e self.with_test_case(test_case),\n            ServiceTransition::FileManager(manager) =\u003e self.with_file_manager(manager),\n        }\n    }\n\n    /// Validates site field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if site is not set\n    pub fn validate_site(\u0026self) -\u003e Result\u003c()\u003e {\n        self.site.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"サイトが指定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates language field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if language is not set\n    pub fn validate_language(\u0026self) -\u003e Result\u003c()\u003e {\n        self.language.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"言語が指定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates `contest_id` field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if `contest_id` is not set\n    pub fn validate_contest_id(\u0026self) -\u003e Result\u003c()\u003e {\n        self.contest_id.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"コンテストIDが指定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates `problem_id` field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if `problem_id` is not set\n    pub fn validate_problem_id(\u0026self) -\u003e Result\u003c()\u003e {\n        self.problem_id.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"問題IDが指定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates url field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if url is not set\n    pub fn validate_url(\u0026self) -\u003e Result\u003c()\u003e {\n        self.url.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"URLが指定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates `file_manager` field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if `file_manager` is not set\n    pub fn validate_file_manager(\u0026self) -\u003e Result\u003c()\u003e {\n        self.file_manager.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"FileManagerが設定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates all fields\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if any field validation fails\n    pub fn validate_all(\u0026self) -\u003e Result\u003c()\u003e {\n        self.validate_site()?;\n        self.validate_contest_id()?;\n        self.validate_problem_id()?;\n        self.validate_language()?;\n        self.validate_url()?;\n        self.validate_file_manager()?;\n        Ok(())\n    }\n\n    // イミュータブルなビルダーメソッド\n    #[must_use]\n    pub fn with_site\u003cT: Into\u003cString\u003e\u003e(self, site: T) -\u003e Self {\n        Self {\n            site: Some(site.into()),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_contest_id\u003cT: Into\u003cString\u003e\u003e(self, contest_id: T) -\u003e Self {\n        Self {\n            contest_id: Some(contest_id.into()),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_problem_id\u003cT: Into\u003cString\u003e\u003e(self, problem_id: T) -\u003e Self {\n        Self {\n            problem_id: Some(problem_id.into()),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_language\u003cT: Into\u003cString\u003e\u003e(self, language: T) -\u003e Self {\n        Self {\n            language: Some(language.into()),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_url\u003cT: Into\u003cString\u003e\u003e(self, url: T) -\u003e Self {\n        Self {\n            url: Some(url.into()),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_file_manager(self, file_manager: Manager) -\u003e Self {\n        Self {\n            file_manager: Some(file_manager),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_test_case(self, _test_case: TestCase) -\u003e Self {\n        // テストケースは状態に影響を与えないため、そのまま返す\n        self\n    }\n\n    /// Builds a Contest instance and returns it with the `FileManager`\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if:\n    /// - Any field validation fails\n    /// - Workspace creation fails\n    #[must_use = \"この関数はContestインスタンスとManagerを返します\"]\n    pub fn build(self) -\u003e Result\u003c(Contest, Manager)\u003e {\n        self.validate_all()?;\n        \n        let site = self.site.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"サイトが設定されていません\")))?;\n        let contest_id = self.contest_id.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"コンテストIDが設定されていません\")))?;\n        let problem_id = self.problem_id.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"問題IDが設定されていません\")))?;\n        let language = self.language.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"言語が設定されていません\")))?;\n        let url = self.url.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"URLが設定されていません\")))?;\n        let file_manager = self.file_manager.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"FileManagerが設定されていません\")))?;\n\n        let contest = Contest::new(\n            site,\n            contest_id,\n            problem_id,\n            language,\n            url,\n        );\n\n        Ok((contest, file_manager))\n    }\n\n    /// コンテストを開きます。\n    /// \n    /// # Arguments\n    /// * `site` - サイト名\n    /// * `contest_id` - コンテストID（オプション）\n    /// * `problem_id` - 問題ID（オプション）\n    /// \n    /// # Errors\n    /// - サイトが無効な場合\n    /// - コンテストIDが無効な場合\n    /// - 問題IDが無効な場合\n    pub fn open(\u0026self, site: \u0026str, contest_id: \u0026Option\u003cString\u003e, problem_id: \u0026Option\u003cString\u003e) -\u003e Result\u003c()\u003e {\n        // TODO: 実装\n        println!(\"問題を開きます: site={site}, contest={contest_id:?}, problem={problem_id:?}\");\n        Ok(())\n    }\n\n    /// Submits a solution for the contest\n    /// \n    /// # Errors\n    /// \n    /// Currently this function cannot fail, but returns Result for consistency\n    pub fn submit(\u0026self, contest: \u0026Contest) -\u003e Result\u003c()\u003e {\n        println!(\"{}\", contest::hint(\"optimize_code\", format!(\"提出を行います: contest={contest:?}\")));\n        Ok(())\n    }\n\n    /// 設定を使用してコンテストを開きます\n    /// \n    /// # Arguments\n    /// \n    /// * `site` - サイト名\n    /// * `contest_id` - コンテストID\n    /// * `problem_id` - 問題ID\n    /// * `template_dir` - テンプレートディレクトリ\n    /// * `active_dir` - アクティブディレクトリ\n    /// \n    /// # Errors\n    /// \n    /// - ディレクトリの作成に失敗した場合\n    /// - ファイルのコピーに失敗した場合\n    /// - 問題情報のダウンロードに失敗した場合\n    pub fn open_with_config(\n        \u0026self,\n        site: \u0026str,\n        contest_id: \u0026str,\n        problem_id: \u0026str,\n        template_dir: \u0026str,\n        active_dir: \u0026str,\n    ) -\u003e Result\u003c()\u003e {\n        // アクティブディレクトリのパスを構築\n        let contest_path = format!(\"{active_dir}/{site}/{contest_id}\");\n        let problem_path = format!(\"{contest_path}/{problem_id}\");\n\n        // ファイルマネージャーを作成\n        let mut manager = Manager::new(\u0026problem_path);\n\n        // ディレクトリが存在しない場合は作成\n        if !manager.exists(\"\")? {\n            manager = manager.create_dir(\"\")?;\n        }\n\n        // テンプレートファイルをコピー\n        let template_path = format!(\"{template_dir}/main.rs\");\n        let template_content = std::fs::read_to_string(template_path)\n            .map_err(|e| anyhow::anyhow!(\"テンプレートファイルの読み込みに失敗しました: {e}\"))?;\n\n        // ファイルを書き込み\n        manager.write_file(\"main.rs\", template_content)?;\n\n        // TODO: 問題情報のダウンロード\n        // self.download_problem_info(site, contest_id, problem_id)?;\n\n        Ok(())\n    }\n} ","traces":[{"line":40,"address":[969792,969688,969216],"length":1,"stats":{"Line":0}},{"line":41,"address":[3234519],"length":1,"stats":{"Line":0}},{"line":42,"address":[2111746],"length":1,"stats":{"Line":0}},{"line":43,"address":[3234410],"length":1,"stats":{"Line":0}},{"line":44,"address":[3234418],"length":1,"stats":{"Line":0}},{"line":45,"address":[2111770],"length":1,"stats":{"Line":0}},{"line":46,"address":[969282],"length":1,"stats":{"Line":0}},{"line":47,"address":[2111796],"length":1,"stats":{"Line":0}},{"line":48,"address":[2111812],"length":1,"stats":{"Line":0}},{"line":54,"address":[2112320],"length":1,"stats":{"Line":0}},{"line":55,"address":[2112325],"length":1,"stats":{"Line":0}},{"line":59,"address":[3235008],"length":1,"stats":{"Line":0}},{"line":60,"address":[3235013],"length":1,"stats":{"Line":0}},{"line":64,"address":[2112384],"length":1,"stats":{"Line":0}},{"line":65,"address":[2112389],"length":1,"stats":{"Line":0}},{"line":69,"address":[969904],"length":1,"stats":{"Line":0}},{"line":70,"address":[969909],"length":1,"stats":{"Line":0}},{"line":74,"address":[969936],"length":1,"stats":{"Line":0}},{"line":75,"address":[2112453],"length":1,"stats":{"Line":0}},{"line":80,"address":[3235136],"length":1,"stats":{"Line":0}},{"line":81,"address":[969994],"length":1,"stats":{"Line":0}},{"line":82,"address":[3235236],"length":1,"stats":{"Line":0}},{"line":83,"address":[3235293],"length":1,"stats":{"Line":0}},{"line":84,"address":[3235350],"length":1,"stats":{"Line":0}},{"line":85,"address":[2112738],"length":1,"stats":{"Line":0}},{"line":86,"address":[3235436],"length":1,"stats":{"Line":0}},{"line":95,"address":[2112848],"length":1,"stats":{"Line":0}},{"line":96,"address":[3235509],"length":1,"stats":{"Line":0}},{"line":97,"address":[1788320,1788324],"length":1,"stats":{"Line":0}},{"line":98,"address":[1788544,1788549],"length":1,"stats":{"Line":0}},{"line":106,"address":[3235552],"length":1,"stats":{"Line":0}},{"line":107,"address":[3235557],"length":1,"stats":{"Line":0}},{"line":108,"address":[1788564,1788560],"length":1,"stats":{"Line":0}},{"line":109,"address":[1788784,1788789],"length":1,"stats":{"Line":0}},{"line":117,"address":[3235600],"length":1,"stats":{"Line":0}},{"line":118,"address":[2112949],"length":1,"stats":{"Line":0}},{"line":119,"address":[1880624,1880628],"length":1,"stats":{"Line":0}},{"line":120,"address":[1880864,1880869],"length":1,"stats":{"Line":0}},{"line":128,"address":[3235648],"length":1,"stats":{"Line":0}},{"line":129,"address":[970485],"length":1,"stats":{"Line":0}},{"line":130,"address":[1880880,1880884],"length":1,"stats":{"Line":0}},{"line":131,"address":[1789264,1789269],"length":1,"stats":{"Line":0}},{"line":139,"address":[3235696],"length":1,"stats":{"Line":0}},{"line":140,"address":[2113045],"length":1,"stats":{"Line":0}},{"line":141,"address":[1789280,1789284],"length":1,"stats":{"Line":0}},{"line":142,"address":[1881376,1881381],"length":1,"stats":{"Line":0}},{"line":150,"address":[3235744],"length":1,"stats":{"Line":0}},{"line":151,"address":[970581],"length":1,"stats":{"Line":0}},{"line":152,"address":[1789520,1789524],"length":1,"stats":{"Line":0}},{"line":153,"address":[3005221,3005216],"length":1,"stats":{"Line":0}},{"line":161,"address":[2113136],"length":1,"stats":{"Line":0}},{"line":162,"address":[2113153,2113252],"length":1,"stats":{"Line":0}},{"line":163,"address":[3235997,3235860],"length":1,"stats":{"Line":0}},{"line":164,"address":[970905,970776],"length":1,"stats":{"Line":0}},{"line":165,"address":[970988,970859],"length":1,"stats":{"Line":0}},{"line":166,"address":[2113596,2113465],"length":1,"stats":{"Line":0}},{"line":167,"address":[3236293,3236204],"length":1,"stats":{"Line":0}},{"line":168,"address":[971097],"length":1,"stats":{"Line":0}},{"line":173,"address":[1789760,1790158],"length":1,"stats":{"Line":0}},{"line":175,"address":[1881680,1881748],"length":1,"stats":{"Line":0}},{"line":181,"address":[3005664,3006070],"length":1,"stats":{"Line":0}},{"line":183,"address":[1882180,1882112],"length":1,"stats":{"Line":0}},{"line":189,"address":[3006096,3006502],"length":1,"stats":{"Line":0}},{"line":191,"address":[1882612,1882544],"length":1,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[3236336],"length":1,"stats":{"Line":0}},{"line":215,"address":[971184],"length":1,"stats":{"Line":0}},{"line":221,"address":[2114032],"length":1,"stats":{"Line":0}},{"line":223,"address":[3236705],"length":1,"stats":{"Line":0}},{"line":234,"address":[973942,971536,974778],"length":1,"stats":{"Line":0}},{"line":235,"address":[2114110,2114430,2116855,2114308],"length":1,"stats":{"Line":0}},{"line":237,"address":[3237019,3237120,3239497,3237312],"length":1,"stats":{"Line":0}},{"line":238,"address":[1791280,1791284],"length":1,"stats":{"Line":0}},{"line":239,"address":[972294,972639,972450,974121],"length":1,"stats":{"Line":0}},{"line":240,"address":[972729,972918,972573,974070],"length":1,"stats":{"Line":0}},{"line":241,"address":[1791956,1791952],"length":1,"stats":{"Line":0}},{"line":242,"address":[1884144,1884148],"length":1,"stats":{"Line":0}},{"line":245,"address":[973444],"length":1,"stats":{"Line":0}},{"line":246,"address":[2116106],"length":1,"stats":{"Line":0}},{"line":247,"address":[3238802],"length":1,"stats":{"Line":0}},{"line":248,"address":[3238842],"length":1,"stats":{"Line":0}},{"line":249,"address":[3238882],"length":1,"stats":{"Line":0}},{"line":252,"address":[3239067],"length":1,"stats":{"Line":0}},{"line":266,"address":[975008],"length":1,"stats":{"Line":0}},{"line":268,"address":[975339],"length":1,"stats":{"Line":0}},{"line":269,"address":[2118110],"length":1,"stats":{"Line":0}},{"line":277,"address":[3240800,3241297],"length":1,"stats":{"Line":0}},{"line":278,"address":[2118388,2118516,2118258],"length":1,"stats":{"Line":0}},{"line":279,"address":[3241275],"length":1,"stats":{"Line":0}},{"line":297,"address":[3243887,3241328,3244010],"length":1,"stats":{"Line":0}},{"line":306,"address":[2118792,2119111],"length":1,"stats":{"Line":0}},{"line":307,"address":[2119562],"length":1,"stats":{"Line":0}},{"line":310,"address":[977110,977059],"length":1,"stats":{"Line":0}},{"line":313,"address":[977608,978545,977204,977143],"length":1,"stats":{"Line":0}},{"line":314,"address":[977296,977506,977613],"length":1,"stats":{"Line":0}},{"line":318,"address":[3243013],"length":1,"stats":{"Line":0}},{"line":319,"address":[3243134,3243485,3243901],"length":1,"stats":{"Line":0}},{"line":320,"address":[1884384,1884493],"length":1,"stats":{"Line":0}},{"line":323,"address":[2121191,2120670,2120896],"length":1,"stats":{"Line":0}},{"line":328,"address":[2121112],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":103},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","mod.rs"],"content":"mod contest;\nmod path;\nmod test;\nmod url;\nmod command;\n\npub use contest::Service as ContestHandler;\npub use path::Service as PathHandler;\npub use test::Service as TestRunner;\npub use url::Service as UrlHandler;\npub use command::Service as CommandProcessor; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","path.rs"],"content":"use std::path::{Path, PathBuf};\nuse anyhow::{Result, anyhow};\nuse crate::message::contest;\n\n/// パスの種類を表す列挙型\n#[derive(Debug, Clone, Copy)]\npub enum Type {\n    Contest,\n    Problem,\n    Source,\n    Test,\n}\n\nimpl Type {\n    /// パスの種類を文字列として取得します\n    const fn as_str(self) -\u003e \u0026'static str {\n        match self {\n            Self::Contest =\u003e \"コンテスト\",\n            Self::Problem =\u003e \"問題\",\n            Self::Source =\u003e \"ソース\",\n            Self::Test =\u003e \"テスト\",\n        }\n    }\n}\n\n/// パス管理サービスを提供する構造体\n#[derive(Debug)]\npub struct Service {\n    #[allow(dead_code)]\n    base_dir: PathBuf,\n}\n\nimpl Service {\n    /// 新しいパス管理サービスを作成します\n    ///\n    /// # Arguments\n    /// * `base_dir` - ベースディレクトリ\n    ///\n    /// # Returns\n    /// * `Self` - 新しいパス管理サービスインスタンス\n    #[must_use = \"この関数は新しいPathServiceインスタンスを返します\"]\n    pub fn new(base_dir: impl AsRef\u003cPath\u003e) -\u003e Self {\n        Self {\n            base_dir: base_dir.as_ref().to_path_buf(),\n        }\n    }\n\n    /// パスの存在を検証します\n    ///\n    /// # Arguments\n    /// * `path` - 検証するパス\n    /// * `path_type` - パスの種類\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 検証結果\n    ///\n    /// # Errors\n    /// * パスが存在しない場合\n    pub fn validate_path_exists(path: impl AsRef\u003cPath\u003e, path_type: Type) -\u003e Result\u003c()\u003e {\n        let path = path.as_ref();\n        if !path.exists() {\n            return Err(anyhow!(contest::error(\n                \"path_error\",\n                format!(\"{}ディレクトリが存在しません: {}\", path_type.as_str(), path.display())\n            )));\n        }\n        Ok(())\n    }\n\n    /// ディレクトリを作成します\n    ///\n    /// # Arguments\n    /// * `path` - 作成するディレクトリのパス\n    /// * `path_type` - パスの種類\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 作成結果\n    ///\n    /// # Errors\n    /// * ディレクトリの作成に失敗した場合\n    pub fn create_directory(path: impl AsRef\u003cPath\u003e, path_type: Type) -\u003e Result\u003c()\u003e {\n        let path = path.as_ref();\n        if !path.exists() {\n            std::fs::create_dir_all(path)\n                .map_err(|e| anyhow!(contest::error(\n                    \"path_error\",\n                    format!(\"{}ディレクトリの作成に失敗: {}: {}\", path_type.as_str(), path.display(), e)\n                )))?;\n        }\n        Ok(())\n    }\n}","traces":[{"line":16,"address":[1826736],"length":1,"stats":{"Line":0}},{"line":17,"address":[1826743],"length":1,"stats":{"Line":0}},{"line":18,"address":[1826776],"length":1,"stats":{"Line":0}},{"line":19,"address":[1826799],"length":1,"stats":{"Line":0}},{"line":20,"address":[1826822],"length":1,"stats":{"Line":0}},{"line":21,"address":[1826845],"length":1,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":23},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","test.rs"],"content":"use std::path::{Path, PathBuf};\nuse anyhow::{Result as AnyhowResult, anyhow};\nuse crate::config::Config;\nuse crate::contest::model::Contest;\nuse crate::message::contest;\nuse crate::docker::execution::Runtime;\n\n/// テスト結果の状態を表す列挙型\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum Status {\n    Success,\n    Failure,\n    Error,\n}\n\n/// テストケースの結果を表す構造体\n#[derive(Debug)]\npub struct CaseResult {\n    pub case_number: usize,\n    pub status: Status,\n    pub execution_time: std::time::Duration,\n    pub stdout: String,\n    pub stderr: String,\n    pub expected: String,\n    pub actual: String,\n}\n\n/// テスト実行の結果を表す構造体\n#[derive(Debug)]\n#[allow(clippy::module_name_repetitions)]\npub struct TestResults {\n    pub total_cases: usize,\n    pub successful_cases: usize,\n    pub failed_cases: usize,\n    pub error_cases: usize,\n    pub total_time: std::time::Duration,\n    pub case_results: Vec\u003cCaseResult\u003e,\n}\n\nimpl TestResults {\n    /// テスト結果の概要を文字列として取得します\n    #[must_use]\n    pub fn summary(\u0026self) -\u003e String {\n        format!(\n            \"テスト結果: {} テスト中 {} 成功, {} 失敗, {} エラー (合計時間: {:.2}秒)\",\n            self.total_cases,\n            self.successful_cases,\n            self.failed_cases,\n            self.error_cases,\n            self.total_time.as_secs_f64()\n        )\n    }\n}\n\n/// テスト実行サービスを提供する構造体\n#[derive(Debug)]\npub struct Service {\n    #[allow(dead_code)]\n    config: Config,\n    #[allow(dead_code)]\n    runtime: Runtime,\n}\n\nimpl Service {\n    /// 新しいテストサービスを作成します\n    /// \n    /// # Arguments\n    /// * `config` - 設定情報\n    /// \n    /// # Returns\n    /// * `AnyhowResult\u003cSelf\u003e` - 新しいテストサービスインスタンス\n    /// \n    /// # Errors\n    /// - 設定の読み込みに失敗した場合\n    #[must_use = \"この関数は新しいTestServiceインスタンスを返します\"]\n    pub fn new(config: \u0026Config) -\u003e AnyhowResult\u003cSelf\u003e {\n        Ok(Self {\n            config: config.clone(),\n            runtime: Runtime::new(),\n        })\n    }\n\n    /// テストを実行します\n    /// \n    /// # Arguments\n    /// * `contest` - コンテスト情報\n    /// * `test_number` - 実行するテストケース番号（Noneの場合は全テストを実行）\n    /// \n    /// # Returns\n    /// * `AnyhowResult\u003cTestResults\u003e` - テスト実行結果\n    /// \n    /// # Errors\n    /// - テストの実行に失敗した場合\n    pub fn run_test(\u0026self, contest: \u0026Contest, test_number: Option\u003cusize\u003e) -\u003e AnyhowResult\u003cTestResults\u003e {\n        let test_dir = contest.get_test_dir()?;\n        let source_file = contest.get_source_file()?;\n\n        // テストケースの一覧を取得\n        let test_cases = Self::get_test_cases(\u0026test_dir, test_number)?;\n        if test_cases.is_empty() {\n            return Err(anyhow!(contest::error(\"test_failed\", \"テストケースが見つかりません\")));\n        }\n\n        let start_time = std::time::Instant::now();\n        let mut results = Vec::new();\n        let mut successful_cases = 0;\n        let mut failed_cases = 0;\n        let mut error_cases = 0;\n        let total_cases = test_cases.len();\n\n        // 各テストケースを実行\n        for (case_number, (input_file, expected_file)) in test_cases {\n            match Self::run_test_case(case_number, \u0026source_file, \u0026input_file, \u0026expected_file) {\n                Ok(result) =\u003e {\n                    match result.status {\n                        Status::Success =\u003e successful_cases += 1,\n                        Status::Failure =\u003e failed_cases += 1,\n                        Status::Error =\u003e error_cases += 1,\n                    }\n                    results.push(result);\n                }\n                Err(e) =\u003e {\n                    error_cases += 1;\n                    results.push(CaseResult {\n                        case_number,\n                        status: Status::Error,\n                        execution_time: std::time::Duration::from_secs(0),\n                        stdout: String::new(),\n                        stderr: e.to_string(),\n                        expected: String::new(),\n                        actual: String::new(),\n                    });\n                }\n            }\n        }\n\n        Ok(TestResults {\n            total_cases,\n            successful_cases,\n            failed_cases,\n            error_cases,\n            total_time: start_time.elapsed(),\n            case_results: results,\n        })\n    }\n\n    /// テストケースの一覧を取得します\n    /// \n    /// # Arguments\n    /// * `test_dir` - テストディレクトリ\n    /// * `test_number` - 取得するテストケース番号（Noneの場合は全テスト）\n    /// \n    /// # Returns\n    /// * `AnyhowResult\u003cVec\u003c(usize, (PathBuf, PathBuf))\u003e\u003e` - テストケース番号とテストファイルのペアのリスト\n    /// \n    /// # Errors\n    /// - テストケースの読み取りに失敗した場合\n    fn get_test_cases(\n        test_dir: \u0026Path,\n        test_number: Option\u003cusize\u003e,\n    ) -\u003e AnyhowResult\u003cVec\u003c(usize, (PathBuf, PathBuf))\u003e\u003e {\n        let mut cases = Vec::new();\n        \n        if let Some(n) = test_number {\n            let input = test_dir.join(format!(\"{n}.in\"));\n            let expected = test_dir.join(format!(\"{n}.out\"));\n            if input.exists() \u0026\u0026 expected.exists() {\n                cases.push((n, (input, expected)));\n            }\n        } else {\n            for entry in std::fs::read_dir(test_dir)? {\n                let entry = entry?;\n                let path = entry.path();\n                if let Some(ext) = path.extension() {\n                    if ext == \"in\" {\n                        if let Some(stem) = path.file_stem() {\n                            if let Ok(n) = stem.to_string_lossy().parse::\u003cusize\u003e() {\n                                let expected = test_dir.join(format!(\"{n}.out\"));\n                                if expected.exists() {\n                                    cases.push((n, (path, expected)));\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n            cases.sort_by_key(|(n, _)| *n);\n        }\n\n        Ok(cases)\n    }\n\n    /// 単一のテストケースを実行します\n    /// \n    /// # Arguments\n    /// * `case_number` - テストケース番号\n    /// * `source_file` - ソースファイル\n    /// * `input_file` - 入力ファイル\n    /// * `expected_file` - 期待される出力ファイル\n    /// \n    /// # Returns\n    /// * `AnyhowResult\u003cCaseResult\u003e` - テストケースの実実行結果\n    /// \n    /// # Errors\n    /// - テストケースの実行に失敗した場合\n    fn run_test_case(\n        case_number: usize,\n        source_file: \u0026Path,\n        input_file: \u0026Path,\n        expected_file: \u0026Path,\n    ) -\u003e AnyhowResult\u003cCaseResult\u003e {\n        let start_time = std::time::Instant::now();\n\n        // コンテナを作成して実行\n        let mut runtime = Runtime::new().with_auto_remove(true);\n        runtime.create(\"rust:latest\", \u0026[])?;\n        let (stdout, stderr) = runtime.execute_command(\u0026[\n            \"exec\",\n            source_file.to_string_lossy().as_ref(),\n            \"\u003c\",\n            input_file.to_string_lossy().as_ref(),\n        ])?;\n\n        // 期待される出力を読み込み\n        let expected = std::fs::read_to_string(expected_file)?;\n        let actual = stdout.trim().to_string();\n\n        // 結果を比較\n        let status = if stderr.is_empty() \u0026\u0026 actual == expected.trim() {\n            Status::Success\n        } else if !stderr.is_empty() {\n            Status::Error\n        } else {\n            Status::Failure\n        };\n\n        Ok(CaseResult {\n            case_number,\n            status,\n            execution_time: start_time.elapsed(),\n            stdout,\n            stderr,\n            expected,\n            actual,\n        })\n    }\n\n    /// 設定を使用してテストを実行します\n    /// \n    /// # Arguments\n    /// \n    /// * `contest` - コンテスト情報\n    /// * `test_number` - テスト番号（Noneの場合は全てのテストを実行）\n    /// * `test_dir` - テストディレクトリ\n    /// \n    /// # Errors\n    /// \n    /// - テストの実行に失敗した場合\n    pub fn run_test_with_config(\n        \u0026self,\n        _contest: \u0026Contest,\n        _test_number: Option\u003cusize\u003e,\n        test_dir: \u0026str,\n    ) -\u003e AnyhowResult\u003cTestResults\u003e {\n        // TODO: 実装\n        println!(\"テストディレクトリ: {test_dir}\");\n        Ok(TestResults {\n            total_cases: 0,\n            successful_cases: 0,\n            failed_cases: 0,\n            error_cases: 0,\n            total_time: std::time::Duration::from_secs(0),\n            case_results: Vec::new(),\n        })\n    }\n} ","traces":[{"line":43,"address":[3113664],"length":1,"stats":{"Line":0}},{"line":44,"address":[1991508,1991740,1990253,1990848,1990160,1990067,1989974,1991288,1991068,1990474],"length":1,"stats":{"Line":0}},{"line":50,"address":[1990346],"length":1,"stats":{"Line":0}},{"line":76,"address":[1992000,1992219],"length":1,"stats":{"Line":0}},{"line":77,"address":[1992100],"length":1,"stats":{"Line":0}},{"line":78,"address":[3115760],"length":1,"stats":{"Line":0}},{"line":79,"address":[1771629],"length":1,"stats":{"Line":0}},{"line":94,"address":[1996085,1992256,1995104],"length":1,"stats":{"Line":0}},{"line":95,"address":[1992346,1992540],"length":1,"stats":{"Line":0}},{"line":96,"address":[1775560,1772195,1772087,1772340],"length":1,"stats":{"Line":0}},{"line":99,"address":[3116807,3116632,3116480,3119790],"length":1,"stats":{"Line":0}},{"line":100,"address":[3116892,3116773],"length":1,"stats":{"Line":0}},{"line":101,"address":[3119457,3119746,3116924],"length":1,"stats":{"Line":0}},{"line":104,"address":[1993258,1993170],"length":1,"stats":{"Line":0}},{"line":105,"address":[1993273],"length":1,"stats":{"Line":0}},{"line":106,"address":[1993292],"length":1,"stats":{"Line":0}},{"line":107,"address":[1772837],"length":1,"stats":{"Line":0}},{"line":108,"address":[3117044],"length":1,"stats":{"Line":0}},{"line":109,"address":[1993407,1993328],"length":1,"stats":{"Line":0}},{"line":112,"address":[3117143,3117345,3117399],"length":1,"stats":{"Line":0}},{"line":113,"address":[3117969,3117495],"length":1,"stats":{"Line":0}},{"line":114,"address":[1994429],"length":1,"stats":{"Line":0}},{"line":115,"address":[1774074],"length":1,"stats":{"Line":0}},{"line":116,"address":[1994740,1994649],"length":1,"stats":{"Line":0}},{"line":117,"address":[1994673,1994979],"length":1,"stats":{"Line":0}},{"line":118,"address":[1994704,1995018],"length":1,"stats":{"Line":0}},{"line":120,"address":[3118539],"length":1,"stats":{"Line":0}},{"line":122,"address":[1994600],"length":1,"stats":{"Line":0}},{"line":123,"address":[1774619,1774655,1774125],"length":1,"stats":{"Line":0}},{"line":124,"address":[3119177],"length":1,"stats":{"Line":0}},{"line":126,"address":[3118854],"length":1,"stats":{"Line":0}},{"line":127,"address":[1995138],"length":1,"stats":{"Line":0}},{"line":128,"address":[1774746],"length":1,"stats":{"Line":0}},{"line":129,"address":[1995252],"length":1,"stats":{"Line":0}},{"line":130,"address":[1995328],"length":1,"stats":{"Line":0}},{"line":131,"address":[1774881],"length":1,"stats":{"Line":0}},{"line":137,"address":[1993962],"length":1,"stats":{"Line":0}},{"line":139,"address":[1993793],"length":1,"stats":{"Line":0}},{"line":140,"address":[1773318],"length":1,"stats":{"Line":0}},{"line":141,"address":[3117553],"length":1,"stats":{"Line":0}},{"line":142,"address":[3117569],"length":1,"stats":{"Line":0}},{"line":143,"address":[3117658],"length":1,"stats":{"Line":0}},{"line":158,"address":[3123409,3119840,3121313],"length":1,"stats":{"Line":0}},{"line":162,"address":[1775655],"length":1,"stats":{"Line":0}},{"line":164,"address":[1775700,1776897],"length":1,"stats":{"Line":0}},{"line":165,"address":[1996454,1996591],"length":1,"stats":{"Line":0}},{"line":166,"address":[1776238,1776391],"length":1,"stats":{"Line":0}},{"line":167,"address":[1997093,1997039,1996959],"length":1,"stats":{"Line":0}},{"line":168,"address":[3120887],"length":1,"stats":{"Line":0}},{"line":171,"address":[1997616,1997881,1997911,1996388,1999679],"length":1,"stats":{"Line":0}},{"line":172,"address":[1997959,1998063,1998223],"length":1,"stats":{"Line":0}},{"line":173,"address":[3122032,3121916],"length":1,"stats":{"Line":0}},{"line":174,"address":[1998320,1998385],"length":1,"stats":{"Line":0}},{"line":175,"address":[3122221,3122274],"length":1,"stats":{"Line":0}},{"line":176,"address":[3122288],"length":1,"stats":{"Line":0}},{"line":177,"address":[3122435,3122525,3123252],"length":1,"stats":{"Line":0}},{"line":178,"address":[3122716,3122853],"length":1,"stats":{"Line":0}},{"line":179,"address":[3122964,3122896],"length":1,"stats":{"Line":0}},{"line":180,"address":[1999276],"length":1,"stats":{"Line":0}},{"line":187,"address":[1777429],"length":1,"stats":{"Line":0}},{"line":190,"address":[3121203],"length":1,"stats":{"Line":0}},{"line":206,"address":[2002017,2002164,1999696],"length":1,"stats":{"Line":0}},{"line":212,"address":[1999880],"length":1,"stats":{"Line":0}},{"line":215,"address":[3123632],"length":1,"stats":{"Line":0}},{"line":216,"address":[2000068,1999975,2000171,2002162],"length":1,"stats":{"Line":0}},{"line":217,"address":[3124512,3124165],"length":1,"stats":{"Line":0}},{"line":219,"address":[2000208,2000156],"length":1,"stats":{"Line":0}},{"line":221,"address":[2000337],"length":1,"stats":{"Line":0}},{"line":225,"address":[2000925,2001103],"length":1,"stats":{"Line":0}},{"line":226,"address":[2001194,2001078],"length":1,"stats":{"Line":0}},{"line":229,"address":[2001339,2001244,2001303,2001457],"length":1,"stats":{"Line":0}},{"line":230,"address":[2001449],"length":1,"stats":{"Line":0}},{"line":231,"address":[3125205,3125045,3125191],"length":1,"stats":{"Line":0}},{"line":232,"address":[1780833],"length":1,"stats":{"Line":0}},{"line":234,"address":[3125207],"length":1,"stats":{"Line":0}},{"line":237,"address":[3125475],"length":1,"stats":{"Line":0}},{"line":239,"address":[2001487],"length":1,"stats":{"Line":0}},{"line":240,"address":[3125226],"length":1,"stats":{"Line":0}},{"line":241,"address":[2001555],"length":1,"stats":{"Line":0}},{"line":242,"address":[3125331],"length":1,"stats":{"Line":0}},{"line":243,"address":[2001651],"length":1,"stats":{"Line":0}},{"line":244,"address":[2001699],"length":1,"stats":{"Line":0}},{"line":259,"address":[2002192],"length":1,"stats":{"Line":0}},{"line":266,"address":[2002354],"length":1,"stats":{"Line":0}},{"line":267,"address":[2002452],"length":1,"stats":{"Line":0}},{"line":272,"address":[2002408],"length":1,"stats":{"Line":0}},{"line":273,"address":[2002425],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":87},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","url.rs"],"content":"use anyhow::{Result, anyhow};\nuse crate::message::contest;\n\n/// URL生成を担当するトレイト\npub trait Generator: std::fmt::Debug {\n    /// コンテストのURLを生成します\n    fn contest_url(\u0026self, contest_id: \u0026str) -\u003e String;\n\n    /// 問題のURLを生成します\n    fn problem_url(\u0026self, contest_id: \u0026str, problem_id: \u0026str) -\u003e String;\n}\n\n/// `AtCoder`のURL生成を担当する構造体\n#[derive(Debug)]\npub struct AtCoderGenerator;\n\nimpl Generator for AtCoderGenerator {\n    fn contest_url(\u0026self, contest_id: \u0026str) -\u003e String {\n        format!(\"https://atcoder.jp/contests/{contest_id}\")\n    }\n\n    fn problem_url(\u0026self, contest_id: \u0026str, problem_id: \u0026str) -\u003e String {\n        format!(\"https://atcoder.jp/contests/{contest_id}/tasks/{problem_id}\")\n    }\n}\n\n/// URL管理サービスを提供する構造体\n#[derive(Debug)]\npub struct Service {\n    site: Option\u003cBox\u003cdyn Generator\u003e\u003e,\n    contest_id: Option\u003cString\u003e,\n    problem_id: Option\u003cString\u003e,\n}\n\nimpl Default for Service {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Service {\n    /// 新しいURL管理サービスを作成します\n    ///\n    /// # Returns\n    /// * `Self` - 新しいURL管理サービスインスタンス\n    #[must_use = \"この関数は新しいURLServiceインスタンスを返します\"]\n    pub const fn new() -\u003e Self {\n        Self {\n            site: None,\n            contest_id: None,\n            problem_id: None,\n        }\n    }\n\n    /// サイトを設定します\n    ///\n    /// # Arguments\n    /// * `site` - URL生成を担当する構造体\n    ///\n    /// # Returns\n    /// * `Self` - 設定を変更したURL管理サービスインスタンス\n    #[must_use = \"この関数は新しいURLServiceインスタンスを返します\"]\n    pub fn with_site(mut self, site: Box\u003cdyn Generator\u003e) -\u003e Self {\n        self.site = Some(site);\n        self\n    }\n\n    /// コンテストIDを設定します\n    ///\n    /// # Arguments\n    /// * `contest_id` - コンテストID\n    ///\n    /// # Returns\n    /// * `Self` - 設定を変更したURL管理サービスインスタンス\n    #[must_use = \"この関数は新しいURLServiceインスタンスを返します\"]\n    pub fn with_contest_id(mut self, contest_id: impl Into\u003cString\u003e) -\u003e Self {\n        self.contest_id = Some(contest_id.into());\n        self\n    }\n\n    /// 問題IDを設定します\n    ///\n    /// # Arguments\n    /// * `problem_id` - 問題ID\n    ///\n    /// # Returns\n    /// * `Self` - 設定を変更したURL管理サービスインスタンス\n    #[must_use = \"この関数は新しいURLServiceインスタンスを返します\"]\n    pub fn with_problem_id(mut self, problem_id: impl Into\u003cString\u003e) -\u003e Self {\n        self.problem_id = Some(problem_id.into());\n        self\n    }\n\n    /// コンテストのURLを取得します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - コンテストのURL\n    ///\n    /// # Errors\n    /// * サイトが設定されていない場合\n    /// * コンテストIDが設定されていない場合\n    /// * 内部状態が不整合な場合（`validate_site`が成功したのに`site`が`None`の場合など）\n    pub fn get_contest_url(\u0026self) -\u003e Result\u003cString\u003e {\n        self.validate_site()?;\n        self.validate_contest_id()?;\n\n        let site = self.site.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"url_error\", \"サイトが設定されていません\")))?;\n        let contest_id = self.contest_id.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"url_error\", \"コンテストIDが設定されていません\")))?;\n\n        Ok(site.contest_url(contest_id))\n    }\n\n    /// 問題のURLを取得します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - 問題のURL\n    ///\n    /// # Errors\n    /// * サイトが設定されていない場合\n    /// * コンテストIDが設定されていない場合\n    /// * 問題IDが設定されていない場合\n    /// * 内部状態が不整合な場合（`validate_site`が成功したのに`site`が`None`の場合など）\n    pub fn get_problem_url(\u0026self) -\u003e Result\u003cString\u003e {\n        self.validate_site()?;\n        self.validate_contest_id()?;\n        self.validate_problem_id()?;\n\n        let site = self.site.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"url_error\", \"サイトが設定されていません\")))?;\n        let contest_id = self.contest_id.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"url_error\", \"コンテストIDが設定されていません\")))?;\n        let problem_id = self.problem_id.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"url_error\", \"問題IDが設定されていません\")))?;\n\n        Ok(site.problem_url(contest_id, problem_id))\n    }\n\n    /// サイトの設定を検証します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 検証結果\n    ///\n    /// # Errors\n    /// * サイトが設定されていない場合\n    fn validate_site(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.site.is_none() {\n            return Err(anyhow!(contest::error(\"url_error\", \"サイトが設定されていません\")));\n        }\n        Ok(())\n    }\n\n    /// コンテストIDの設定を検証します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 検証結果\n    ///\n    /// # Errors\n    /// * コンテストIDが設定されていない場合\n    fn validate_contest_id(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.contest_id.is_none() {\n            return Err(anyhow!(contest::error(\"url_error\", \"コンテストIDが設定されていません\")));\n        }\n        Ok(())\n    }\n\n    /// 問題IDの設定を検証します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 検証結果\n    ///\n    /// # Errors\n    /// * 問題IDが設定されていない場合\n    fn validate_problem_id(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.problem_id.is_none() {\n            return Err(anyhow!(contest::error(\"url_error\", \"問題IDが設定されていません\")));\n        }\n        Ok(())\n    }\n} ","traces":[{"line":18,"address":[1830096],"length":1,"stats":{"Line":0}},{"line":19,"address":[1830228],"length":1,"stats":{"Line":0}},{"line":22,"address":[1830336],"length":1,"stats":{"Line":0}},{"line":23,"address":[1830583],"length":1,"stats":{"Line":0}},{"line":36,"address":[1830736],"length":1,"stats":{"Line":0}},{"line":37,"address":[1830744],"length":1,"stats":{"Line":0}},{"line":47,"address":[1830768],"length":1,"stats":{"Line":0}},{"line":63,"address":[1830896,1831044],"length":1,"stats":{"Line":0}},{"line":64,"address":[1830931,1831006],"length":1,"stats":{"Line":0}},{"line":65,"address":[1831024],"length":1,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[1831072],"length":1,"stats":{"Line":0}},{"line":104,"address":[1831110,1831210],"length":1,"stats":{"Line":0}},{"line":105,"address":[1831298,1831159],"length":1,"stats":{"Line":0}},{"line":107,"address":[1831245,1831333,1831416],"length":1,"stats":{"Line":0}},{"line":108,"address":[2130208,2130212],"length":1,"stats":{"Line":0}},{"line":109,"address":[1831561,1831351,1831438],"length":1,"stats":{"Line":0}},{"line":110,"address":[2130452,2130448],"length":1,"stats":{"Line":0}},{"line":112,"address":[1831451],"length":1,"stats":{"Line":0}},{"line":125,"address":[1831600],"length":1,"stats":{"Line":0}},{"line":126,"address":[1831638,1831738],"length":1,"stats":{"Line":0}},{"line":127,"address":[1831687,1831824],"length":1,"stats":{"Line":0}},{"line":128,"address":[1831912,1831773],"length":1,"stats":{"Line":0}},{"line":130,"address":[1831947,1831859,1832030],"length":1,"stats":{"Line":0}},{"line":131,"address":[2130688,2130692],"length":1,"stats":{"Line":0}},{"line":132,"address":[1832052,1831965,1832154],"length":1,"stats":{"Line":0}},{"line":133,"address":[2130932,2130928],"length":1,"stats":{"Line":0}},{"line":134,"address":[1832073,1832181,1832342],"length":1,"stats":{"Line":0}},{"line":135,"address":[2131172,2131168],"length":1,"stats":{"Line":0}},{"line":137,"address":[1832201],"length":1,"stats":{"Line":0}},{"line":147,"address":[1832368,1832636,1832607],"length":1,"stats":{"Line":0}},{"line":148,"address":[1832380],"length":1,"stats":{"Line":0}},{"line":149,"address":[1832620,1832409,1832504],"length":1,"stats":{"Line":0}},{"line":151,"address":[1832398],"length":1,"stats":{"Line":0}},{"line":161,"address":[1832656,1832920,1832891],"length":1,"stats":{"Line":0}},{"line":162,"address":[1832668],"length":1,"stats":{"Line":0}},{"line":163,"address":[1832693,1832788,1832904],"length":1,"stats":{"Line":0}},{"line":165,"address":[1832682],"length":1,"stats":{"Line":0}},{"line":175,"address":[1833183,1833212,1832944],"length":1,"stats":{"Line":0}},{"line":176,"address":[1832956],"length":1,"stats":{"Line":0}},{"line":177,"address":[1833196,1833080,1832985],"length":1,"stats":{"Line":0}},{"line":179,"address":[1832974],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":47},{"path":["/","home","cphelper-dev","project-cph","src","docker","config.rs"],"content":"use std::path::PathBuf;\n\n/// Dockerコンテナの実行設定\n#[derive(Debug, Clone)]\npub struct Config {\n    /// コンテナのイメージ名\n    pub image: String,\n    /// コンテナ内で実行するコマンド\n    pub command: Vec\u003cString\u003e,\n    /// コンテナ内の作業ディレクトリ\n    pub working_dir: PathBuf,\n    /// コンテナ内の環境変数\n    pub env_vars: Vec\u003cString\u003e,\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","execution","command.rs"],"content":"use std::process::{Command, Output};\nuse std::borrow::Cow;\nuse anyhow::{Result, anyhow, Context};\nuse crate::message::docker;\n\n/// Dockerコマンドの実行結果を表す構造体\n#[derive(Debug)]\npub struct ExecutionResult {\n    pub stdout: String,\n    pub stderr: String,\n    pub exit_code: i32,\n}\n\n/// Dockerコマンドの実行を担当する構造体\n///\n/// # Fields\n/// * `name` - 実行するDockerコマンド名\n/// * `args` - コマンドの引数リスト\n/// * `capture_stderr` - 標準エラー出力をキャプチャするかどうか\n#[derive(Clone)]\npub struct Executor {\n    name: String,\n    args: Vec\u003cString\u003e,\n    capture_stderr: bool,\n}\n\nimpl Executor {\n    /// 新しいExecutorインスタンスを作成します\n    ///\n    /// # Arguments\n    /// * `name` - 実行するDockerコマンド名\n    ///\n    /// # Returns\n    /// * `Self` - 新しいExecutorインスタンス\n    #[must_use = \"この関数は新しいExecutorインスタンスを返します\"]\n    pub fn new(name: impl Into\u003cString\u003e) -\u003e Self {\n        Self {\n            name: name.into(),\n            args: Vec::new(),\n            capture_stderr: false,\n        }\n    }\n\n    /// 標準エラー出力のキャプチャを設定します\n    ///\n    /// # Arguments\n    /// * `capture` - キャプチャするかどうか\n    ///\n    /// # Returns\n    /// * `Self` - 新しいExecutorインスタンス\n    #[must_use = \"この関数は新しいExecutorインスタンスを返します\"]\n    pub fn capture_stderr(self, capture: bool) -\u003e Self {\n        Self {\n            capture_stderr: capture,\n            ..self\n        }\n    }\n\n    /// コマンドに単一の引数を追加します\n    ///\n    /// # Arguments\n    /// * `arg` - 追加する引数\n    ///\n    /// # Returns\n    /// * `Self` - 新しいExecutorインスタンス\n    #[must_use = \"この関数は新しいExecutorインスタンスを返します\"]\n    pub fn arg\u003c'a, S: Into\u003cCow\u003c'a, str\u003e\u003e\u003e(self, arg: S) -\u003e Self {\n        let mut args = self.args;\n        args.push(arg.into().into_owned());\n        Self {\n            name: self.name,\n            args,\n            capture_stderr: self.capture_stderr,\n        }\n    }\n\n    /// コマンドに複数の引数を追加します\n    ///\n    /// # Arguments\n    /// * `args` - 追加する引数のイテレータ\n    ///\n    /// # Returns\n    /// * `Self` - 新しいExecutorインスタンス\n    #[must_use = \"この関数は新しいExecutorインスタンスを返します\"]\n    pub fn args\u003cI, S\u003e(self, args: I) -\u003e Self\n    where\n        I: IntoIterator\u003cItem = S\u003e,\n        S: AsRef\u003cstr\u003e,\n    {\n        let mut new_args = self.args;\n        new_args.extend(args.into_iter().map(|s| s.as_ref().to_owned()));\n        Self {\n            name: self.name,\n            args: new_args,\n            capture_stderr: self.capture_stderr,\n        }\n    }\n\n    /// コマンドを実行し、生の出力を返します\n    ///\n    /// # Returns\n    /// * `Result\u003cOutput\u003e` - コマンドの実行結果\n    ///\n    /// # Errors\n    /// * コマンドの実行に失敗した場合\n    fn execute_raw(\u0026self) -\u003e Result\u003cOutput\u003e {\n        Command::new(\"docker\")\n            .arg(\u0026self.name)\n            .args(\u0026self.args)\n            .output()\n            .with_context(|| docker::error(\"command_failed\", \"コマンドの実行に失敗しました\"))\n    }\n\n    /// コマンドを実行し、結果を返します\n    ///\n    /// # Returns\n    /// * `Result\u003cExecutionResult\u003e` - コマンドの実行結果\n    ///\n    /// # Errors\n    /// * コマンドの実行に失敗した場合\n    /// * 出力の文字列変換に失敗した場合\n    pub fn execute(self) -\u003e Result\u003cExecutionResult\u003e {\n        let output = self.execute_raw()?;\n\n        let stdout = String::from_utf8(output.stdout)\n            .with_context(|| docker::error(\"command_failed\", \"標準出力の解析に失敗しました\"))?;\n        let stderr = String::from_utf8(output.stderr)\n            .with_context(|| docker::error(\"command_failed\", \"標準エラー出力の解析に失敗しました\"))?;\n\n        if !output.status.success() {\n            if self.capture_stderr {\n                return Ok(ExecutionResult {\n                    stdout,\n                    stderr,\n                    exit_code: output.status.code().unwrap_or(-1),\n                });\n            }\n            return Err(anyhow!(docker::error(\"command_failed\", stderr)));\n        }\n\n        Ok(ExecutionResult {\n            stdout,\n            stderr,\n            exit_code: 0,\n        })\n    }\n\n    /// コマンドを実行し、標準出力のみを返します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - コマンドの標準出力\n    ///\n    /// # Errors\n    /// * コマンドの実行に失敗した場合\n    /// * 出力の文字列変換に失敗した場合\n    pub fn execute_output(self) -\u003e Result\u003cString\u003e {\n        self.execute().map(|result| result.stdout)\n    }\n} ","traces":[{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[2097680],"length":1,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[2097981,2097760],"length":1,"stats":{"Line":0}},{"line":107,"address":[3220555,3220446],"length":1,"stats":{"Line":0}},{"line":109,"address":[2097895],"length":1,"stats":{"Line":0}},{"line":111,"address":[1684924,1684912],"length":1,"stats":{"Line":0}},{"line":122,"address":[3222484,3220672,3222925],"length":1,"stats":{"Line":0}},{"line":123,"address":[1028582,1030761,1028690,1028930],"length":1,"stats":{"Line":0}},{"line":125,"address":[2098332,2098472,2098715,2100167],"length":1,"stats":{"Line":0}},{"line":126,"address":[1555068,1555056],"length":1,"stats":{"Line":0}},{"line":127,"address":[3221631,3221433,3221293,3222757],"length":1,"stats":{"Line":0}},{"line":128,"address":[1029471],"length":1,"stats":{"Line":0}},{"line":130,"address":[2098938,2099041],"length":1,"stats":{"Line":0}},{"line":131,"address":[2099052],"length":1,"stats":{"Line":0}},{"line":132,"address":[2099918],"length":1,"stats":{"Line":0}},{"line":133,"address":[2099436],"length":1,"stats":{"Line":0}},{"line":134,"address":[2099476],"length":1,"stats":{"Line":0}},{"line":135,"address":[3222545,3222172],"length":1,"stats":{"Line":0}},{"line":138,"address":[2099539,2099806,2099357],"length":1,"stats":{"Line":0}},{"line":141,"address":[3221840],"length":1,"stats":{"Line":0}},{"line":142,"address":[2099072],"length":1,"stats":{"Line":0}},{"line":143,"address":[2099128],"length":1,"stats":{"Line":0}},{"line":156,"address":[2100288],"length":1,"stats":{"Line":0}},{"line":157,"address":[1555207,1555184],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":35},{"path":["/","home","cphelper-dev","project-cph","src","docker","execution","compilation.rs"],"content":"use std::process::Command;\nuse anyhow::{Result, anyhow};\nuse crate::message::docker;\n\n/// コンパイル処理を管理する構造体\n///\n/// # Fields\n/// * `container_id` - コンパイル用コンテナのID（オプション）\n#[derive(Debug, Default)]\npub struct Compiler {\n    container_id: Option\u003cString\u003e,\n}\n\nimpl Compiler {\n    /// 新しいCompilerインスタンスを作成します\n    ///\n    /// # Returns\n    /// * `Self` - 新しいCompilerインスタンス\n    #[must_use = \"この関数は新しいCompilerインスタンスを返します\"]\n    pub const fn new() -\u003e Self {\n        Self {\n            container_id: None,\n        }\n    }\n\n    /// コマンドを実行してコンパイルを行います\n    ///\n    /// # Arguments\n    /// * `command` - コンパイルコマンドとその引数\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - コンパイル結果\n    ///\n    /// # Errors\n    /// * コンパイルが既に実行されている場合\n    /// * コンパイルの実行に失敗した場合\n    #[must_use = \"この関数はコンパイルの結果を返します\"]\n    pub fn compile(\u0026mut self, command: \u0026[String]) -\u003e Result\u003c()\u003e {\n        if self.container_id.is_some() {\n            return Err(anyhow!(docker::error(\"build_error\", \"コンパイルは既に実行されています\")));\n        }\n\n        let output = Command::new(\u0026command[0])\n            .args(\u0026command[1..])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"build_error\", format!(\"{e}。コマンド: {command:?}\"))))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            let stdout = String::from_utf8_lossy(\u0026output.stdout);\n            return Err(anyhow!(docker::error(\"build_error\", \n                format!(\"標準エラー出力: {stderr}\\n標準出力: {stdout}\\n終了コード: {:?}\", output.status.code()))));\n        }\n\n        Ok(())\n    }\n\n    /// コンテナIDを取得します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - コンテナID\n    ///\n    /// # Errors\n    /// * コンテナIDが設定されていない場合\n    #[must_use = \"この関数はコンテナIDを返します\"]\n    pub fn get_container_id(\u0026self) -\u003e Result\u003cString\u003e {\n        self.container_id\n            .clone()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナIDが取得できません\")))\n    }\n\n    /// コンパイル出力を取得します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - コンパイル出力\n    ///\n    /// # Errors\n    /// * コンパイルが実行されていない場合\n    /// * コンパイル出力の取得に失敗した場合\n    #[must_use = \"この関数はコンパイル出力を返します\"]\n    pub fn get_output(\u0026self) -\u003e Result\u003cString\u003e {\n        let container_id = self.container_id\n            .as_ref()\n            .ok_or_else(|| anyhow!(docker::error(\"build_error\", \"コンパイルが実行されていません\")))?;\n\n        let output = Command::new(\"docker\")\n            .args([\"logs\", container_id])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"build_error\", \n                format!(\"出力の取得に失敗: {e}。コンテナID: {container_id}\"))))?;\n\n        String::from_utf8(output.stdout)\n            .map_err(|e| anyhow!(docker::error(\"build_error\", format!(\"出力の解析に失敗: {e}\"))))\n    }\n} ","traces":[{"line":20,"address":[1833488],"length":1,"stats":{"Line":0}},{"line":38,"address":[1833536,1835375],"length":1,"stats":{"Line":0}},{"line":39,"address":[1833561],"length":1,"stats":{"Line":0}},{"line":40,"address":[1833608,1835426],"length":1,"stats":{"Line":0}},{"line":43,"address":[1833720,1833586,1833812,1835402,1834183,1833894],"length":1,"stats":{"Line":0}},{"line":44,"address":[1833738],"length":1,"stats":{"Line":0}},{"line":46,"address":[1676673,1676784,1677026,1676916,1676656],"length":1,"stats":{"Line":0}},{"line":48,"address":[1834245],"length":1,"stats":{"Line":0}},{"line":49,"address":[1834343,1834274],"length":1,"stats":{"Line":0}},{"line":50,"address":[1834362,1834445],"length":1,"stats":{"Line":0}},{"line":51,"address":[1835353,1835033],"length":1,"stats":{"Line":0}},{"line":52,"address":[1834880,1834692,1834786,1834464,1834536],"length":1,"stats":{"Line":0}},{"line":55,"address":[1834303],"length":1,"stats":{"Line":0}},{"line":66,"address":[1835584],"length":1,"stats":{"Line":0}},{"line":67,"address":[1835603],"length":1,"stats":{"Line":0}},{"line":69,"address":[1897280,1897284],"length":1,"stats":{"Line":0}},{"line":81,"address":[1835648,1836455],"length":1,"stats":{"Line":0}},{"line":82,"address":[1835686,1835831],"length":1,"stats":{"Line":0}},{"line":84,"address":[1897520,1897524],"length":1,"stats":{"Line":0}},{"line":86,"address":[1836252,1835756,1835961],"length":1,"stats":{"Line":0}},{"line":87,"address":[1835902,1835781],"length":1,"stats":{"Line":0}},{"line":89,"address":[1898130,1897777,1897888,1897760,1898394],"length":1,"stats":{"Line":0}},{"line":90,"address":[1898020,1898386,1897929],"length":1,"stats":{"Line":0}},{"line":92,"address":[1836310],"length":1,"stats":{"Line":0}},{"line":93,"address":[1898460,1898561,1898448,1898691],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":25},{"path":["/","home","cphelper-dev","project-cph","src","docker","execution","container.rs"],"content":"use std::process::Command;\nuse anyhow::{Result, anyhow};\nuse crate::message::docker;\n\n/// Dockerコンテナのランタイム管理を担当する構造体\n///\n/// # Fields\n/// * `container_id` - 管理対象のコンテナID（オプション）\n/// * `auto_remove` - コンテナを自動的に削除するかどうか\n#[derive(Debug)]\npub struct Runtime {\n    container_id: Option\u003cString\u003e,\n    auto_remove: bool,\n}\n\nimpl Default for Runtime {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Runtime {\n    /// 新しいRuntimeインスタンスを作成します\n    ///\n    /// # Returns\n    /// * `Self` - 新しいRuntimeインスタンス\n    #[must_use = \"この関数は新しいRuntimeインスタンスを返します\"]\n    pub const fn new() -\u003e Self {\n        Self {\n            container_id: None,\n            auto_remove: true,\n        }\n    }\n\n    /// 自動削除の設定を変更します\n    ///\n    /// # Arguments\n    /// * `auto_remove` - コンテナを自動的に削除するかどうか\n    ///\n    /// # Returns\n    /// * `Self` - 設定を変更したRuntimeインスタンス\n    #[must_use = \"この関数は新しいRuntimeインスタンスを返します\"]\n    pub const fn with_auto_remove(mut self, auto_remove: bool) -\u003e Self {\n        self.auto_remove = auto_remove;\n        self\n    }\n\n    /// コンテナを作成します\n    ///\n    /// # Arguments\n    /// * `image` - 使用するDockerイメージ名\n    /// * `options` - 追加のDockerオプション\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 作成結果\n    ///\n    /// # Errors\n    /// * コンテナが既に作成されている場合\n    /// * コンテナの作成に失敗した場合\n    pub fn create(\u0026mut self, image: \u0026str, options: \u0026[\u0026str]) -\u003e Result\u003c()\u003e {\n        if self.container_id.is_some() {\n            return Err(anyhow!(docker::error(\"container_error\", \"コンテナは既に作成されています\")));\n        }\n\n        let mut args = vec![\"create\"];\n        if self.auto_remove {\n            args.push(\"--rm\");\n        }\n        args.extend(options);\n        args.push(image);\n\n        let output = Command::new(\"docker\")\n            .args(\u0026args)\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", e)))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            return Err(anyhow!(docker::error(\"container_error\", stderr)));\n        }\n\n        let container_id = String::from_utf8(output.stdout)\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"コンテナIDの解析に失敗: {e}\"))))?\n            .trim()\n            .to_string();\n\n        self.container_id = Some(container_id);\n        Ok(())\n    }\n\n    /// コンテナを起動します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 起動結果\n    ///\n    /// # Errors\n    /// * コンテナが作成されていない場合\n    /// * コンテナの起動に失敗した場合\n    #[must_use = \"この関数はコンテナの起動結果を返します\"]\n    pub fn start(\u0026mut self) -\u003e Result\u003c()\u003e {\n        let container_id = self.container_id\n            .as_ref()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナが作成されていません\")))?;\n\n        let output = Command::new(\"docker\")\n            .args([\"start\", container_id])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", e)))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            return Err(anyhow!(docker::error(\"container_error\", stderr)));\n        }\n\n        Ok(())\n    }\n\n    /// コンテナを停止します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 停止結果\n    ///\n    /// # Errors\n    /// * コンテナが作成されていない場合\n    /// * コンテナの停止に失敗した場合\n    #[must_use = \"この関数はコンテナの停止結果を返します\"]\n    pub fn stop(\u0026mut self) -\u003e Result\u003c()\u003e {\n        let container_id = self.container_id\n            .as_ref()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナが作成されていません\")))?;\n\n        let output = Command::new(\"docker\")\n            .args([\"stop\", container_id])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", e)))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            return Err(anyhow!(docker::error(\"container_error\", stderr)));\n        }\n\n        Ok(())\n    }\n\n    /// コンテナの終了を待機し、終了コードを返します\n    ///\n    /// # Returns\n    /// * `Result\u003ci32\u003e` - 終了コード\n    ///\n    /// # Errors\n    /// * コンテナが作成されていない場合\n    /// * 終了コードの取得に失敗した場合\n    #[must_use = \"この関数はコンテナの終了コードを返します\"]\n    pub fn wait(\u0026mut self) -\u003e Result\u003ci32\u003e {\n        let container_id = self.container_id\n            .as_ref()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナが作成されていません\")))?;\n\n        let output = Command::new(\"docker\")\n            .args([\"wait\", container_id])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"終了コードの取得に失敗: {e}\"))))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            return Err(anyhow!(docker::error(\"container_error\", format!(\"終了コードの取得に失敗: {stderr}\"))));\n        }\n\n        let exit_code = String::from_utf8(output.stdout)\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"終了コードの解析に失敗: {e}\"))))?\n            .trim()\n            .parse()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"終了コードの解析に失敗: {e}\"))))?;\n\n        Ok(exit_code)\n    }\n\n    /// イメージの存在を確認し、必要に応じてプルします\n    ///\n    /// # Arguments\n    /// * `image` - 確認するDockerイメージ名\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 確認結果\n    ///\n    /// # Errors\n    /// * イメージの確認に失敗した場合\n    /// * イメージのプルに失敗したた場合\n    #[must_use = \"この関数はイメージの確認結果を返します\"]\n    pub fn ensure_image(\u0026self, image: \u0026str) -\u003e Result\u003c()\u003e {\n        let output = Command::new(\"docker\")\n            .args([\"images\", \"-q\", image])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"イメージの確認に失敗: {e}\"))))?;\n\n        if output.stdout.is_empty() {\n            let output = Command::new(\"docker\")\n                .args([\"pull\", image])\n                .output()\n                .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"イメージの取得に失敗: {e}\"))))?;\n\n            if !output.status.success() {\n                let stderr = String::from_utf8_lossy(\u0026output.stderr);\n                return Err(anyhow!(docker::error(\"container_error\", format!(\"イメージの取得に失敗: {stderr}\"))));\n            }\n        }\n\n        Ok(())\n    }\n\n    /// コンテナを削除します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 削除結果\n    ///\n    /// # Errors\n    /// * コンテナが作成されていない場合\n    /// * コンテナの削除に失敗した場合\n    pub fn remove(\u0026mut self) -\u003e Result\u003c()\u003e {\n        let container_id = self.container_id.take()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナが作成されていません\")))?;\n\n        let output = Command::new(\"docker\")\n            .args([\"rm\", \"-f\", \u0026container_id])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", e)))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            return Err(anyhow!(docker::error(\"container_error\", stderr)));\n        }\n\n        Ok(())\n    }\n\n    /// コンテナIDを取得します\n    ///\n    /// # Returns\n    /// * `Option\u003c\u0026str\u003e` - コンテナID\n    #[must_use]\n    pub fn container_id(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.container_id.as_deref()\n    }\n\n    /// コンテナ内でコマンドを実行します\n    ///\n    /// # Arguments\n    /// * `command` - 実行するコマンドとその引数\n    ///\n    /// # Returns\n    /// * `Result\u003c(String, String)\u003e` - 標準出力と標準エラー出力のタプル\n    ///\n    /// # Errors\n    /// * コンテナが作成されていない場合\n    /// * コマンドの実行に失敗した場合\n    pub fn execute_command(\u0026self, command: \u0026[\u0026str]) -\u003e Result\u003c(String, String)\u003e {\n        let container_id = self.container_id\n            .as_ref()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナが作成されていません\")))?;\n\n        let mut args = vec![\"exec\", container_id];\n        args.extend(command);\n\n        let output = Command::new(\"docker\")\n            .args(\u0026args)\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", e)))?;\n\n        let stdout = String::from_utf8(output.stdout)\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"標準出力の解析に失敗: {e}\"))))?;\n        let stderr = String::from_utf8(output.stderr)\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"標準エラー出力の解析に失敗: {e}\"))))?;\n\n        Ok((stdout, stderr))\n    }\n}\n\nimpl Drop for Runtime {\n    fn drop(\u0026mut self) {\n        if self.auto_remove {\n            if let Some(container_id) = \u0026self.container_id {\n                let _ = Command::new(\"docker\")\n                    .args([\"rm\", \"-f\", container_id])\n                    .output();\n            }\n        }\n    }\n} ","traces":[{"line":17,"address":[1641152],"length":1,"stats":{"Line":0}},{"line":18,"address":[2003608],"length":1,"stats":{"Line":0}},{"line":28,"address":[2003632],"length":1,"stats":{"Line":0}},{"line":43,"address":[2003696],"length":1,"stats":{"Line":0}},{"line":44,"address":[3127438],"length":1,"stats":{"Line":0}},{"line":45,"address":[3127444],"length":1,"stats":{"Line":0}},{"line":60,"address":[2005190,2003760,2006073],"length":1,"stats":{"Line":0}},{"line":61,"address":[1641396],"length":1,"stats":{"Line":0}},{"line":62,"address":[3129814,3127649],"length":1,"stats":{"Line":0}},{"line":65,"address":[2004046,2003886,2004101],"length":1,"stats":{"Line":0}},{"line":66,"address":[1641630],"length":1,"stats":{"Line":0}},{"line":67,"address":[2004157,2004232],"length":1,"stats":{"Line":0}},{"line":69,"address":[1641688],"length":1,"stats":{"Line":0}},{"line":70,"address":[3127978],"length":1,"stats":{"Line":0}},{"line":72,"address":[3128109,3129774,3128392,3127997],"length":1,"stats":{"Line":0}},{"line":75,"address":[3070879,3070864],"length":1,"stats":{"Line":0}},{"line":77,"address":[3128459],"length":1,"stats":{"Line":0}},{"line":78,"address":[3128488,3128593],"length":1,"stats":{"Line":0}},{"line":79,"address":[1642394,1642666],"length":1,"stats":{"Line":0}},{"line":82,"address":[3129598,3128927,3129121,3128517,3129201],"length":1,"stats":{"Line":0}},{"line":83,"address":[3071347,3071217,3071104,3071116],"length":1,"stats":{"Line":0}},{"line":87,"address":[1643074],"length":1,"stats":{"Line":0}},{"line":88,"address":[2005766],"length":1,"stats":{"Line":0}},{"line":100,"address":[1643728,1644752],"length":1,"stats":{"Line":0}},{"line":101,"address":[3129999,3130134],"length":1,"stats":{"Line":0}},{"line":103,"address":[1129696,1129700],"length":1,"stats":{"Line":0}},{"line":105,"address":[1643811,1644287,1644779,1644006],"length":1,"stats":{"Line":0}},{"line":106,"address":[1643947,1643841],"length":1,"stats":{"Line":0}},{"line":108,"address":[2007354,2006429,2006800],"length":1,"stats":{"Line":0}},{"line":110,"address":[3130630],"length":1,"stats":{"Line":0}},{"line":111,"address":[2006995,2006931],"length":1,"stats":{"Line":0}},{"line":112,"address":[3130742,3131028],"length":1,"stats":{"Line":0}},{"line":115,"address":[3130688],"length":1,"stats":{"Line":0}},{"line":127,"address":[2008442,2007376],"length":1,"stats":{"Line":0}},{"line":128,"address":[2007526,2007391],"length":1,"stats":{"Line":0}},{"line":130,"address":[3131241],"length":1,"stats":{"Line":0}},{"line":132,"address":[3131683,3131190,3131374,3132197],"length":1,"stats":{"Line":0}},{"line":133,"address":[2007603,2007496],"length":1,"stats":{"Line":0}},{"line":135,"address":[2008474,2007549,2007920],"length":1,"stats":{"Line":0}},{"line":137,"address":[3131750],"length":1,"stats":{"Line":0}},{"line":138,"address":[3131779,3131843],"length":1,"stats":{"Line":0}},{"line":139,"address":[3132148,3131862],"length":1,"stats":{"Line":0}},{"line":142,"address":[2008080],"length":1,"stats":{"Line":0}},{"line":154,"address":[1645872,1647316,1647995],"length":1,"stats":{"Line":0}},{"line":155,"address":[3132434,3132268],"length":1,"stats":{"Line":0}},{"line":157,"address":[1130596,1130592],"length":1,"stats":{"Line":0}},{"line":159,"address":[3132359,3132549,3132877],"length":1,"stats":{"Line":0}},{"line":160,"address":[2008778,2008665],"length":1,"stats":{"Line":0}},{"line":162,"address":[1646462,1646092,1648046],"length":1,"stats":{"Line":0}},{"line":164,"address":[2009211],"length":1,"stats":{"Line":0}},{"line":165,"address":[1646592,1646697],"length":1,"stats":{"Line":0}},{"line":166,"address":[2009641,2009520,2009954],"length":1,"stats":{"Line":0}},{"line":169,"address":[2010262,2010478,2010581,2010187,2009985,2009269],"length":1,"stats":{"Line":0}},{"line":170,"address":[3133899],"length":1,"stats":{"Line":0}},{"line":173,"address":[2010559,2010208,2010435],"length":1,"stats":{"Line":0}},{"line":175,"address":[2010508],"length":1,"stats":{"Line":0}},{"line":190,"address":[3136344,3136395,3134480],"length":1,"stats":{"Line":0}},{"line":191,"address":[2010793,2011265,2012685,2010993,2010920],"length":1,"stats":{"Line":0}},{"line":192,"address":[2010850],"length":1,"stats":{"Line":0}},{"line":194,"address":[1950748,1950859,1950736,1950994],"length":1,"stats":{"Line":0}},{"line":196,"address":[2011332],"length":1,"stats":{"Line":0}},{"line":197,"address":[3135199,3135280,3135555,3135115,3136371],"length":1,"stats":{"Line":0}},{"line":198,"address":[2011428],"length":1,"stats":{"Line":0}},{"line":200,"address":[3136376,3135231,3135520],"length":1,"stats":{"Line":0}},{"line":202,"address":[2011897],"length":1,"stats":{"Line":0}},{"line":203,"address":[2011926,2011987],"length":1,"stats":{"Line":0}},{"line":204,"address":[2012162,2012283,2012594],"length":1,"stats":{"Line":0}},{"line":208,"address":[2011362],"length":1,"stats":{"Line":0}},{"line":219,"address":[3136448,3137678,3137740],"length":1,"stats":{"Line":0}},{"line":220,"address":[3136657,3136466],"length":1,"stats":{"Line":0}},{"line":221,"address":[1650141],"length":1,"stats":{"Line":0}},{"line":223,"address":[2013136,2013448,2012885,2013988],"length":1,"stats":{"Line":0}},{"line":224,"address":[1650222,1650290],"length":1,"stats":{"Line":0}},{"line":226,"address":[1952128,1952143],"length":1,"stats":{"Line":0}},{"line":228,"address":[3137246],"length":1,"stats":{"Line":0}},{"line":229,"address":[1650817,1650751],"length":1,"stats":{"Line":0}},{"line":230,"address":[1651112,1650836],"length":1,"stats":{"Line":0}},{"line":233,"address":[3137304],"length":1,"stats":{"Line":0}},{"line":241,"address":[3137760],"length":1,"stats":{"Line":0}},{"line":242,"address":[3137765],"length":1,"stats":{"Line":0}},{"line":256,"address":[2015888,2014048,2015754],"length":1,"stats":{"Line":0}},{"line":257,"address":[1651296,1651435],"length":1,"stats":{"Line":0}},{"line":259,"address":[3137969],"length":1,"stats":{"Line":0}},{"line":261,"address":[1651382,1651611,1651460],"length":1,"stats":{"Line":0}},{"line":262,"address":[2014427],"length":1,"stats":{"Line":0}},{"line":264,"address":[3138635,3138233,3138339],"length":1,"stats":{"Line":0}},{"line":267,"address":[3076351,3076336],"length":1,"stats":{"Line":0}},{"line":269,"address":[2014969,2015763,2015269],"length":1,"stats":{"Line":0}},{"line":270,"address":[2015253],"length":1,"stats":{"Line":0}},{"line":271,"address":[2015334,2015692,2015185],"length":1,"stats":{"Line":0}},{"line":272,"address":[1652804],"length":1,"stats":{"Line":0}},{"line":274,"address":[3139208],"length":1,"stats":{"Line":0}},{"line":279,"address":[2519104,2519435],"length":1,"stats":{"Line":0}},{"line":280,"address":[1397940],"length":1,"stats":{"Line":0}},{"line":281,"address":[1397959],"length":1,"stats":{"Line":0}},{"line":282,"address":[1398171,1398002],"length":1,"stats":{"Line":0}},{"line":283,"address":[1398101,1398033],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":97},{"path":["/","home","cphelper-dev","project-cph","src","docker","execution","mod.rs"],"content":"pub mod command;\npub mod compilation;\npub mod container;\n\npub use compilation::Compiler;\npub use container::Runtime;\n\nuse anyhow::Result;\n\n#[derive(Debug)]\npub struct CommandOutput {\n    pub stdout: String,\n    pub stderr: String,\n    pub exit_code: i32,\n}\n\nimpl CommandOutput {\n    #[must_use = \"この関数は新しいCommandOutputインスタンスを返します\"]\n    pub const fn new(stdout: String, stderr: String, exit_code: i32) -\u003e Self {\n        Self {\n            stdout,\n            stderr,\n            exit_code,\n        }\n    }\n}\n\n#[async_trait::async_trait]\npub trait Executor {\n    async fn execute(\u0026self, command: command::Executor) -\u003e Result\u003cCommandOutput\u003e;\n} ","traces":[{"line":19,"address":[1119472],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":1},{"path":["/","home","cphelper-dev","project-cph","src","docker","fs.rs"],"content":"use std::path::Path;\nuse anyhow::Result;\n\n\n/// コンテナにファイルをコピー�す\n///\n/// # Arguments\n/// * `container_id` - コンテナID\n/// * `source` - コピー元のパス\n/// * `target` - コピー先のパス\n///\n/// # Errors\n/// * コピー操作に失敗した場合\npub fn copy_to_container(_container_id: \u0026str, _source: impl AsRef\u003cPath\u003e, _target: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    // TODO: 実装\n    unimplemented!()\n}\n\n/// コンテナからファイルをコピーします\n///\n/// # Arguments\n/// * `container_id` - コンテナID\n/// * `source` - コピー元のパス\n/// * `target` - コピー先のパス\n///\n/// # Errors\n/// * コピー操作に失敗した場合\npub fn copy_from_container(_container_id: \u0026str, _source: impl AsRef\u003cPath\u003e, _target: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    // TODO: 実装\n    unimplemented!()\n} ","traces":[{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":2},{"path":["/","home","cphelper-dev","project-cph","src","docker","mod.rs"],"content":"pub mod config;\npub mod execution;\npub mod fs;\npub mod state;\npub mod test_helpers;\npub mod traits;\n\npub use execution::container::Runtime; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","state","container_state.rs"],"content":"use std::fmt;\n\n/// コンテ�の状態を表す列挙型\n///\n/// # Variants\n/// * `Running` - コンテナが実行中\n/// * `Executing` - コンテナでコマンドを実行中（コマンド文字列を保持）\n/// * `Stopped` - コンテナが停止済み\n/// * `Failed` - コンテナが失敗（エラーメッセージを保持）\n#[derive(Debug, Clone, PartialEq, Eq)]\npub enum Type {\n    Running,\n    Executing(String),\n    Stopped,\n    Failed(String),\n}\n\n/// コンテナの状態情報を保持する構造体\n///\n/// # Fields\n/// * `container_id` - コンテナのID\n/// * `state_type` - コンテナの状態\n#[derive(Debug, Clone, PartialEq, Eq)]\npub struct Info {\n    pub container_id: String,\n    pub state_type: Type,\n}\n\nimpl Info {\n    /// 新しい状態情報インスタンスを作成します\n    ///\n    /// # Arguments\n    /// * `container_id` - コンテナのID\n    /// * `state_type` - コンテナの状態\n    ///\n    /// # Returns\n    /// * `Self` - 新しい状態情報インスタンス\n    #[must_use = \"この関数は新しい状態情報インスタンスを返します\"]\n    pub const fn new(container_id: String, state_type: Type) -\u003e Self {\n        Self {\n            container_id,\n            state_type,\n        }\n    }\n}\n\nimpl fmt::Display for Info {\n    /// 状態情報を文字列として整形します\n    ///\n    /// # Arguments\n    /// * `f` - フォーマッタ\n    ///\n    /// # Returns\n    /// * `fmt::Result` - 文字列フォーマット結果\n    fn fmt(\u0026self, f: \u0026mut fmt::Formatter\u003c'_\u003e) -\u003e fmt::Result {\n        match \u0026self.state_type {\n            Type::Running =\u003e {\n                write!(f, \"実行中(ID: {container_id})\", container_id = self.container_id)\n            }\n            Type::Executing(command) =\u003e {\n                write!(f, \"コマンド実行中(ID: {container_id}, コマンド: {command})\", container_id = self.container_id)\n            }\n            Type::Stopped =\u003e {\n                write!(f, \"停止済み(ID: {container_id})\", container_id = self.container_id)\n            }\n            Type::Failed(error) =\u003e {\n                write!(f, \"失敗(ID: {container_id}, エラー: {error})\", container_id = self.container_id)\n            }\n        }\n    }\n} ","traces":[{"line":39,"address":[2131472],"length":1,"stats":{"Line":0}},{"line":55,"address":[2131536],"length":1,"stats":{"Line":0}},{"line":56,"address":[2131569],"length":1,"stats":{"Line":0}},{"line":58,"address":[2131605,2131689],"length":1,"stats":{"Line":0}},{"line":60,"address":[2131763],"length":1,"stats":{"Line":0}},{"line":61,"address":[2131966,2131775],"length":1,"stats":{"Line":0}},{"line":64,"address":[2132183,2132093],"length":1,"stats":{"Line":0}},{"line":66,"address":[2132278],"length":1,"stats":{"Line":0}},{"line":67,"address":[2132293,2132493],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":9},{"path":["/","home","cphelper-dev","project-cph","src","docker","state","manager.rs"],"content":"use std::sync::Arc;\nuse tokio::sync::RwLock;\nuse anyhow::Result;\n\nuse super::container_state::Info;\n\n/// Dockerコンテナの状態を管理する構造体\n///\n/// # Fields\n/// * `state` - コンテナの状態情報\n#[derive(Debug, Default)]\npub struct Manager {\n    state: Arc\u003cRwLock\u003cOption\u003cInfo\u003e\u003e\u003e,\n}\n\nimpl Manager {\n    /// 新しい状態管理インスタンスを作成します\n    ///\n    /// # Returns\n    /// * `Self` - 新しい状態管理インスタンス\n    #[must_use = \"この関数は新しい状態管理インスタンスを返します\"]\n    pub fn new() -\u003e Self {\n        Self {\n            state: Arc::new(RwLock::new(None)),\n        }\n    }\n\n    /// 現在のコンテナの状態を取得します\n    ///\n    /// # Returns\n    /// * `Option\u003cInfo\u003e` - コンテナの状態情報（存在する場合）\n    pub async fn get_state(\u0026self) -\u003e Option\u003cInfo\u003e {\n        self.state.read().await.clone()\n    }\n\n    /// コンテナの状態を設定します\n    ///\n    /// # Arguments\n    /// * `state` - 設定する状態\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 設定結果\n    ///\n    /// # Errors\n    /// * 状態の設定に失敗した場合（ロックの取得に失敗など）\n    pub async fn set_state(\u0026self, state: Info) -\u003e Result\u003c()\u003e {\n        *self.state.write().await = Some(state);\n        Ok(())\n    }\n\n    /// コンテナの状態をクリアします\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - クリア結果\n    ///\n    /// # Errors\n    /// * 状態のクリアに失敗した場合（ロックの取得に失敗など）\n    pub async fn clear_state(\u0026self) -\u003e Result\u003c()\u003e {\n        *self.state.write().await = None;\n        Ok(())\n    }\n} ","traces":[{"line":22,"address":[1827168],"length":1,"stats":{"Line":0}},{"line":24,"address":[1827175],"length":1,"stats":{"Line":0}},{"line":32,"address":[1827240,1827232],"length":1,"stats":{"Line":0}},{"line":46,"address":[1827248,1827283],"length":1,"stats":{"Line":0}},{"line":58,"address":[1827336,1827328],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":5},{"path":["/","home","cphelper-dev","project-cph","src","docker","state","mod.rs"],"content":"mod container_state;\npub use container_state::{Info, Type};\nmod manager;\n\npub use manager::Manager as ContainerStateManager; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","test_helpers","mod.rs"],"content":"#![allow(clippy::ref_option_ref)]\n\nuse crate::docker::execution::{command, CommandOutput};\nuse mockall::automock;\nuse async_trait::async_trait;\nuse anyhow::Result;\n\n/// テスト用のモックを生成するためのトレイト\n#[async_trait]\n#[automock]\npub trait Executor {\n    async fn execute(\u0026self, command: command::Executor) -\u003e Result\u003cCommandOutput\u003e;\n}\n\n#[automock]\n#[async_trait]\npub trait TestContainerManager: Send + Sync {\n    async fn create_container(\u0026mut self, image: \u0026str, cmd: Vec\u003cString\u003e, working_dir: \u0026str) -\u003e Result\u003c()\u003e;\n    async fn start_container(\u0026mut self) -\u003e Result\u003c()\u003e;\n    async fn stop_container(\u0026mut self) -\u003e Result\u003c()\u003e;\n    async fn get_container_id(\u0026self) -\u003e Result\u003cString\u003e;\n    async fn get_exit_code(\u0026self) -\u003e Result\u003ci32\u003e;\n    async fn check_image(\u0026self, image: \u0026str) -\u003e Result\u003cbool\u003e;\n    async fn pull_image(\u0026self, image: \u0026str) -\u003e Result\u003c()\u003e;\n}\n\n#[automock]\n#[async_trait]\npub trait TestCompilationManager: Send + Sync {\n    async fn compile\u003c'a\u003e(\u0026mut self, source_code: \u0026str, compile_cmd: Option\u003c\u0026'a [String]\u003e, env_vars: \u0026[String]) -\u003e Result\u003c()\u003e;\n    async fn get_compilation_output(\u0026self) -\u003e Result\u003c(String, String)\u003e;\n}\n\n#[automock]\npub trait TestHelper {\n    fn get_test_case(\u0026self) -\u003e Option\u003cString\u003e;\n    fn get_expected_output(\u0026self) -\u003e Option\u003cString\u003e;\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","traits","compilation.rs"],"content":"use async_trait::async_trait;\nuse anyhow::Result;\n\n/// コンパイル操作を提供するトレイト\n///\n/// このトレイトは、ソースコードのコンパイルに関連する\n/// 基本的な操作を定義します。\n#[async_trait]\npub trait CompilerOperations: Send + Sync {\n    /// ソースコードをコンパイルします\n    ///\n    /// # Arguments\n    /// * `source_code` - コンパイル対象のソースコード\n    /// * `compile_cmd` - コンパイルコマンドとその引数（オプション）\n    /// * `env_vars` - コンパイル時に設定する環境変数\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - コンパイル結果\n    ///\n    /// # Errors\n    /// * コンパイルに失敗した場合\n    /// * コンパイラの実行に失敗した場合\n    async fn compile(\n        \u0026mut self,\n        source_code: \u0026str,\n        compile_cmd: Option\u003cVec\u003cString\u003e\u003e,\n        env_vars: Vec\u003cString\u003e,\n    ) -\u003e Result\u003c()\u003e;\n\n    /// コンパイル結果を取得します\n    ///\n    /// # Returns\n    /// * `Result\u003c(String, String)\u003e` - (標準出力, 標準エラー出力)\n    ///\n    /// # Errors\n    /// * コンパイル結果の取得に失敗した場合\n    async fn get_compilation_output(\u0026self) -\u003e Result\u003c(String, String)\u003e;\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","traits","container.rs"],"content":"use async_trait::async_trait;\nuse anyhow::Result;\n\n/// Dockerコンテナのランタイム管理を行うトレイト\n///\n/// このトレイトは、Dockerコンテナのライフサイクル管理に必要な\n/// 基本的な操作を定義します。\n#[async_trait]\npub trait RuntimeManager: Send + Sync {\n    /// コンテナを作成します\n    ///\n    /// # Arguments\n    /// * `image` - 使用するDockerイメージ名\n    /// * `cmd` - コンテナで実行するコマンドとその引数\n    /// * `working_dir` - コンテナ内の作業ディレクトリ\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 作成結果\n    ///\n    /// # Errors\n    /// * コンテナの作成に失敗した場合\n    async fn create_container(\u0026mut self, image: \u0026str, cmd: Vec\u003cString\u003e, working_dir: \u0026str) -\u003e Result\u003c()\u003e;\n    \n    /// コンテナを起動します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 起動結果\n    ///\n    /// # Errors\n    /// * コンテナの起動に失敗した場合\n    async fn start_container(\u0026mut self) -\u003e Result\u003c()\u003e;\n    \n    /// コンテナを停止します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 停止結果\n    ///\n    /// # Errors\n    /// * コンテナの停止に失敗した場合\n    async fn stop_container(\u0026mut self) -\u003e Result\u003c()\u003e;\n    \n    /// コンテナIDを取得します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - コンテナID\n    ///\n    /// # Errors\n    /// * コンテナIDの取得に失敗した場合\n    async fn get_container_id(\u0026self) -\u003e Result\u003cString\u003e;\n    \n    /// コンテナの終了コードを取得します\n    ///\n    /// # Returns\n    /// * `Result\u003ci32\u003e` - 終了コード\n    ///\n    /// # Errors\n    /// * 終了コードの取得に失敗した場合\n    async fn get_exit_code(\u0026self) -\u003e Result\u003ci32\u003e;\n    \n    /// イメージの存在を確認します\n    ///\n    /// # Arguments\n    /// * `image` - 確認するDockerイメージ名\n    ///\n    /// # Returns\n    /// * `Result\u003cbool\u003e` - イメージが存在する場合はtrue\n    ///\n    /// # Errors\n    /// * イメージの確認に失敗した場合\n    async fn check_image(\u0026self, image: \u0026str) -\u003e Result\u003cbool\u003e;\n    \n    /// イメージをプルします\n    ///\n    /// # Arguments\n    /// * `image` - プルするDockerイメージ名\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - プル結果\n    ///\n    /// # Errors\n    /// * イメージのプルに失敗した場合\n    async fn pull_image(\u0026self, image: \u0026str) -\u003e Result\u003c()\u003e;\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","traits","mod.rs"],"content":"pub mod container;\npub mod operations;\npub mod compilation;\n\npub use container::RuntimeManager;\npub use operations::Operations;\npub use compilation::CompilerOperations; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","traits","operations.rs"],"content":"use async_trait::async_trait;\nuse std::time::Duration;\nuse anyhow::Result;\nuse crate::docker::config::Config;\n\n/// Dockerコンテナの実行操作を提供するトレイト\n///\n/// このトレイトは、Dockerコンテナの実行に関連する\n/// 基本的な操作を定義します。\n#[async_trait]\npub trait Operations: Send + Sync {\n    /// コンテナを作成し、初期化します\n    ///\n    /// # Arguments\n    /// * `config` - コンテナの実行設定\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 初期化結果\n    ///\n    /// # Errors\n    /// * コンテナの作成または初期化に失敗した場合\n    async fn initialize(\u0026mut self, config: Config) -\u003e Result\u003c()\u003e;\n\n    /// コンテナを起動します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 起動結果\n    ///\n    /// # Errors\n    /// * コンテナの起動に失敗した場合\n    async fn start(\u0026mut self) -\u003e Result\u003c()\u003e;\n\n    /// コンテナを停止します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 停止結果\n    ///\n    /// # Errors\n    /// * コンテナの停止に失敗した場合\n    async fn stop(\u0026mut self) -\u003e Result\u003c()\u003e;\n\n    /// コンテナでコマンドを実行します\n    ///\n    /// # Arguments\n    /// * `command` - 実行するコマンド\n    ///\n    /// # Returns\n    /// * `Result\u003c(String, String)\u003e` - (標準出力, 標準エラー出力)\n    ///\n    /// # Errors\n    /// * コマンドの実行に失敗した場合\n    async fn execute(\u0026mut self, command: \u0026str) -\u003e Result\u003c(String, String)\u003e;\n\n    /// コンテナの標準入力にデータを書き込みます\n    ///\n    /// # Arguments\n    /// * `input` - 書き込むデータ\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 書き込み結果\n    ///\n    /// # Errors\n    /// * データの書き込みに失敗した場合\n    async fn write(\u0026mut self, input: \u0026str) -\u003e Result\u003c()\u003e;\n\n    /// コンテナの標準出力からデータを読み取ります\n    ///\n    /// # Arguments\n    /// * `timeout` - 読み取りのタイムアウト時間\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - 読み取ったデータ\n    ///\n    /// # Errors\n    /// * データの読み取りに失敗した場合\n    /// * タイムアウトが発生した場合\n    async fn read_stdout(\u0026mut self, timeout: Duration) -\u003e Result\u003cString\u003e;\n\n    /// コンテナの標準エラー出力からデータを読み取ります\n    ///\n    /// # Arguments\n    /// * `timeout` - 読み取りのタイムアウト時間\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - 読み取ったデータ\n    ///\n    /// # Errors\n    /// * データの読み取りに失敗した場合\n    /// * タイムアウトが発生した場合\n    async fn read_stderr(\u0026mut self, timeout: Duration) -\u003e Result\u003cString\u003e;\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","fs","backup.rs"],"content":"use std::path::{Path, PathBuf};\nuse anyhow::{Result, anyhow};\nuse chrono::Local;\nuse tokio::fs;\nuse crate::message::fs as fs_message;\n\n/// バックアップファイルの管理を行う構造体\n#[derive(Debug)]\npub struct Manager {\n    /// バックアップディレクトリのパス\n    backup_dir: PathBuf,\n}\n\nimpl Manager {\n    /// 新しいバックアップマネージャを作成します\n    ///\n    /// # Arguments\n    /// * `backup_dir` - バックアップディレクトリのパス\n    ///\n    /// # Returns\n    /// * `Result\u003cSelf\u003e` - バックアップマネージャのインスタンス\n    ///\n    /// # Errors\n    /// * バックアップディレクトリの作成に失敗した場合\n    pub async fn new\u003cP: AsRef\u003cPath\u003e + Send\u003e(backup_dir: P) -\u003e Result\u003cSelf\u003e {\n        let backup_dir = backup_dir.as_ref().to_path_buf();\n        if !backup_dir.exists() {\n            fs::create_dir_all(\u0026backup_dir).await\n                .map_err(|e| anyhow!(fs_message::error(\"backup_dir_create_error\", e)))?;\n        }\n        Ok(Self { backup_dir })\n    }\n\n    /// ファイルをバックアップします\n    ///\n    /// # Arguments\n    /// * `file_path` - バックアップするファイルのパス\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - バックアップの結果\n    ///\n    /// # Errors\n    /// * バックアップファイルの作成に失敗した場合\n    /// * ファイルのコピーに失敗した場合\n    pub async fn backup\u003cP: AsRef\u003cPath\u003e + Send\u003e(\u0026self, file_path: P) -\u003e Result\u003c()\u003e {\n        let file_path = file_path.as_ref();\n        if !file_path.exists() {\n            return Ok(());\n        }\n\n        let file_name = file_path.file_name()\n            .ok_or_else(|| anyhow!(fs_message::error(\"filename_get_error\", \"\")))?\n            .to_str()\n            .ok_or_else(|| anyhow!(fs_message::error(\"filename_convert_error\", \"\")))?;\n\n        let timestamp = Local::now().format(\"%Y%m%d_%H%M%S\");\n        let backup_file_name = format!(\"{file_name}.{timestamp}.bak\");\n        let backup_path = self.backup_dir.join(backup_file_name);\n\n        fs::copy(file_path, \u0026backup_path).await\n            .map_err(|e| anyhow!(fs_message::error(\"backup_error\", e)))?;\n\n        Ok(())\n    }\n\n    /// バックアップファイルを復元します\n    ///\n    /// # Arguments\n    /// * `file_path` - 復元先のファイルパス\n    /// * `backup_file_name` - バックアップファイル名\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 復元の結果\n    ///\n    /// # Errors\n    /// * バックアップファイルが存在しない場合\n    /// * ファイルの復元に失敗した場合\n    pub async fn restore\u003cP: AsRef\u003cPath\u003e + Send\u003e(\u0026self, file_path: P, backup_file_name: \u0026str) -\u003e Result\u003c()\u003e {\n        let backup_path = self.backup_dir.join(backup_file_name);\n        if !backup_path.exists() {\n            return Err(anyhow!(fs_message::error(\"backup_not_found\", backup_file_name)));\n        }\n\n        fs::copy(\u0026backup_path, file_path.as_ref()).await\n            .map_err(|e| anyhow!(fs_message::error(\"restore_error\", e)))?;\n\n        Ok(())\n    }\n\n    /// バックアップファイルの一覧を取得します\n    ///\n    /// # Arguments\n    /// * `file_name` - 元のファイル名\n    ///\n    /// # Returns\n    /// * `Result\u003cVec\u003cString\u003e\u003e` - バックアップファイル名のリスト\n    ///\n    /// # Errors\n    /// * バックアップディレクトリの読み取りに失敗した場合\n    pub async fn list_backups(\u0026self, file_name: \u0026str) -\u003e Result\u003cVec\u003cString\u003e\u003e {\n        let mut entries = fs::read_dir(\u0026self.backup_dir).await\n            .map_err(|e| anyhow!(fs_message::error(\"backup_dir_read_error\", e)))?;\n\n        let mut backups = Vec::new();\n        while let Some(entry) = entries.next_entry().await\n            .map_err(|e| anyhow!(fs_message::error(\"backup_dir_read_error\", e)))? {\n            if let Some(name) = entry.file_name().to_str() {\n                if name.starts_with(file_name) \u0026\u0026 \n                    std::path::Path::new(name)\n                        .extension()\n                        .map_or(false, |ext| ext.eq_ignore_ascii_case(\"bak\")) {\n                    backups.push(name.to_string());\n                }\n            }\n        }\n\n        Ok(backups)\n    }\n} ","traces":[{"line":25,"address":[],"length":0,"stats":{"Line":13}},{"line":26,"address":[1264728,1264618],"length":1,"stats":{"Line":8}},{"line":27,"address":[],"length":0,"stats":{"Line":9}},{"line":28,"address":[],"length":0,"stats":{"Line":9}},{"line":29,"address":[1265584,1265599,1265422],"length":1,"stats":{"Line":0}},{"line":31,"address":[1264886],"length":1,"stats":{"Line":2}},{"line":45,"address":[],"length":0,"stats":{"Line":4}},{"line":46,"address":[],"length":0,"stats":{"Line":2}},{"line":47,"address":[],"length":0,"stats":{"Line":1}},{"line":48,"address":[1266223],"length":1,"stats":{"Line":1}},{"line":51,"address":[],"length":0,"stats":{"Line":2}},{"line":52,"address":[1268164,1266420,1268160],"length":1,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":2}},{"line":57,"address":[],"length":0,"stats":{"Line":4}},{"line":58,"address":[],"length":0,"stats":{"Line":2}},{"line":60,"address":[],"length":0,"stats":{"Line":3}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":1}},{"line":78,"address":[],"length":0,"stats":{"Line":4}},{"line":79,"address":[],"length":0,"stats":{"Line":2}},{"line":80,"address":[1269263,1269362],"length":1,"stats":{"Line":2}},{"line":81,"address":[],"length":0,"stats":{"Line":2}},{"line":84,"address":[],"length":0,"stats":{"Line":3}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":1}},{"line":100,"address":[1261680,1261847,1261727,1261908,1262729,1262035],"length":1,"stats":{"Line":4}},{"line":101,"address":[1261877,1261971,1262067,1261840,1262656,1262550],"length":1,"stats":{"Line":3}},{"line":102,"address":[1264223,1262534,1264208],"length":1,"stats":{"Line":0}},{"line":104,"address":[1262620,1262511],"length":1,"stats":{"Line":2}},{"line":105,"address":[1403950],"length":1,"stats":{"Line":4}},{"line":106,"address":[1263968,1263983,1263158],"length":1,"stats":{"Line":0}},{"line":107,"address":[1263312,1263215,1263380],"length":1,"stats":{"Line":3}},{"line":108,"address":[1263551,1263494],"length":1,"stats":{"Line":2}},{"line":109,"address":[1263567],"length":1,"stats":{"Line":1}},{"line":111,"address":[1264448,1264462],"length":1,"stats":{"Line":2}},{"line":112,"address":[1263662],"length":1,"stats":{"Line":1}},{"line":117,"address":[1263826],"length":1,"stats":{"Line":1}}],"covered":31,"coverable":38},{"path":["/","home","cphelper-dev","project-cph","src","fs","manager.rs"],"content":"use std::path::{Path, PathBuf};\nuse std::sync::Arc;\nuse anyhow::{Result, anyhow};\nuse crate::fs::path::normalize;\nuse crate::fs::{FileOperation, Transaction, CreateFileOperation, DeleteFileOperation};\n\n/// ファイル管理の状態を表現する型\n#[derive(Debug, Clone)]\npub enum State {\n    /// アイドル状態\n    Idle,\n    /// トランザクション実行中\n    InTransaction(Transaction),\n}\n\n/// 状態遷移を表現する型\n#[derive(Debug, Clone)]\npub enum Transition {\n    /// トランザクションの開始\n    BeginTransaction,\n    /// 操作の追加\n    AddOperation(Arc\u003cdyn FileOperation\u003e),\n    /// トランザクションのコミット\n    Commit,\n    /// トランザクションのロールバック\n    Rollback,\n}\n\n/// ファイル管理を行う構造体\n#[derive(Debug, Clone)]\npub struct Manager {\n    root: Arc\u003cPathBuf\u003e,\n    state: State,\n}\n\nimpl Manager {\n    /// 新しいファイルシステムインスタンスを作成します。\n    /// \n    /// # Arguments\n    /// * `root` - ルートディレクトリのパス\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn new(root: impl Into\u003cPathBuf\u003e) -\u003e Self {\n        Self {\n            root: Arc::new(root.into()),\n            state: State::Idle,\n        }\n    }\n\n    /// 状態遷移を適用します。\n    /// \n    /// # Arguments\n    /// * `transition` - 適用する状態遷移\n    /// \n    /// # Errors\n    /// - 無効な状態遷移が指定された場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    fn apply_transition(self, transition: Transition) -\u003e Result\u003cSelf\u003e {\n        match (self.state, transition) {\n            (State::Idle, Transition::BeginTransaction) =\u003e {\n                Ok(Self {\n                    root: self.root,\n                    state: State::InTransaction(Transaction::new()),\n                })\n            },\n            (State::InTransaction(transaction), Transition::AddOperation(operation)) =\u003e {\n                let new_transaction = transaction.with_operation(operation)?;\n                Ok(Self {\n                    root: self.root,\n                    state: State::InTransaction(new_transaction),\n                })\n            },\n            (State::InTransaction(transaction), Transition::Commit) =\u003e {\n                let _ = transaction.execute()?;\n                Ok(Self {\n                    root: self.root,\n                    state: State::Idle,\n                })\n            },\n            (State::InTransaction(_), Transition::Rollback) =\u003e {\n                Ok(Self {\n                    root: self.root,\n                    state: State::Idle,\n                })\n            },\n            (state, transition) =\u003e {\n                Err(anyhow!(\"無効な状態遷移です: {state:?} -\u003e {transition:?}\"))\n            }\n        }\n    }\n\n    /// トランザクションを開始します。\n    /// \n    /// # Errors\n    /// - トランザクションの開始に失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn begin_transaction(self) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::BeginTransaction)\n    }\n\n    /// トランザクションをコミットします。\n    /// \n    /// # Errors\n    /// - トランザクションのコミットに失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn commit(self) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::Commit)\n    }\n\n    /// トランザクションをロールバックします。\n    /// \n    /// # Errors\n    /// - トランザクションのロールバックに失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn rollback(self) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::Rollback)\n    }\n\n    /// ファイルの内容を読み込みます。\n    /// \n    /// # Arguments\n    /// * `path` - 読み込むファイルのパス\n    /// \n    /// # Errors\n    /// - パスの正規化に失敗した場合\n    /// - ファイルが存在しない場合\n    /// - ファイルの読み込みに失敗した場合\n    #[must_use = \"この関数はファイルの内容を返します\"]\n    pub fn read_file(\u0026self, path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cString\u003e {\n        let path = normalize(\u0026*self.root, path)?;\n        if !path.exists() {\n            return Err(anyhow!(\"ファイルが見つかりません: {}\", path.display()));\n        }\n        std::fs::read_to_string(\u0026path)\n            .map_err(|e| anyhow!(\"ファイルの読み込みに失敗しました: {e}\"))\n    }\n\n    /// ファイルに内容を書き込みます。\n    /// \n    /// # Arguments\n    /// * `path` - 書き込み先のファイルパス\n    /// * `content` - 書き込む内容\n    /// \n    /// # Errors\n    /// - パスの正規化に失敗した場合\n    /// - トランザクションの操作に失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn write_file(self, path: impl AsRef\u003cPath\u003e, content: impl AsRef\u003cstr\u003e) -\u003e Result\u003cSelf\u003e {\n        let path = normalize(\u0026*self.root, path)?;\n        let operation = Arc::new(CreateFileOperation::new(path, content.as_ref().to_string()));\n        \n        match self.state {\n            State::InTransaction(_) =\u003e {\n                self.apply_transition(Transition::AddOperation(operation))\n            },\n            State::Idle =\u003e {\n                self.begin_transaction()?\n                    .apply_transition(Transition::AddOperation(operation))?\n                    .commit()\n            }\n        }\n    }\n\n    /// ファイルを削除します。\n    /// \n    /// # Arguments\n    /// * `path` - 削除するファイルのパス\n    /// \n    /// # Errors\n    /// - パスの正規化に失敗した場合\n    /// - トランザクションの操作に失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn delete_file(self, path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cSelf\u003e {\n        let path = normalize(\u0026*self.root, path)?;\n        let operation = Arc::new(DeleteFileOperation::new(path)?);\n        \n        match self.state {\n            State::InTransaction(_) =\u003e {\n                self.apply_transition(Transition::AddOperation(operation))\n            },\n            State::Idle =\u003e {\n                self.begin_transaction()?\n                    .apply_transition(Transition::AddOperation(operation))?\n                    .commit()\n            }\n        }\n    }\n\n    /// ディレクトリを作成します。\n    /// \n    /// # Arguments\n    /// * `path` - 作成するディレクトリのパス\n    /// \n    /// # Errors\n    /// - パスの正規化に失敗した場合\n    /// - ディレクトリの作成に失敗した場合\n    /// - トランザクションの操作に失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn create_dir(self, path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cSelf\u003e {\n        let path = normalize(\u0026*self.root, path)?;\n        match self.state {\n            State::InTransaction(_) =\u003e {\n                let operation = Arc::new(CreateFileOperation::new(path, String::new()));\n                self.apply_transition(Transition::AddOperation(operation))\n            },\n            State::Idle =\u003e {\n                std::fs::create_dir_all(\u0026path)\n                    .map_err(|e| anyhow!(\"ディレクトリの作成に失敗しました: {e}\"))?;\n                Ok(self)\n            }\n        }\n    }\n\n    /// パスが存在するかどうかを確認します。\n    /// \n    /// # Arguments\n    /// * `path` - 確認するパス\n    /// \n    /// # Errors\n    /// - パスの正規化に失敗した場合\n    #[must_use = \"この関数はパスの存在を示すブール値を返します\"]\n    pub fn exists(\u0026self, path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cbool\u003e {\n        let path = normalize(\u0026*self.root, path)?;\n        Ok(path.exists())\n    }\n\n    /// ルートディレクトリのパスを取得します。\n    #[must_use = \"この関数はルートディレクトリのパスを返します\"]\n    pub fn root_path(\u0026self) -\u003e \u0026Path {\n        self.root.as_ref()\n    }\n} ","traces":[{"line":42,"address":[1106192],"length":1,"stats":{"Line":1}},{"line":44,"address":[1217608],"length":1,"stats":{"Line":1}},{"line":57,"address":[1749040,1749654,1751101],"length":1,"stats":{"Line":1}},{"line":58,"address":[2872651],"length":1,"stats":{"Line":1}},{"line":60,"address":[2873154],"length":1,"stats":{"Line":1}},{"line":61,"address":[2872849],"length":1,"stats":{"Line":1}},{"line":62,"address":[2872869,2873128],"length":1,"stats":{"Line":2}},{"line":65,"address":[2873268],"length":1,"stats":{"Line":1}},{"line":66,"address":[1592101,1592514,1592322],"length":1,"stats":{"Line":3}},{"line":67,"address":[1750131],"length":1,"stats":{"Line":1}},{"line":68,"address":[2873667],"length":1,"stats":{"Line":1}},{"line":69,"address":[1592416],"length":1,"stats":{"Line":1}},{"line":72,"address":[1749787],"length":1,"stats":{"Line":1}},{"line":73,"address":[2873418,2873862,2874175],"length":1,"stats":{"Line":2}},{"line":74,"address":[1750529],"length":1,"stats":{"Line":1}},{"line":75,"address":[1592798],"length":1,"stats":{"Line":1}},{"line":76,"address":[1592810],"length":1,"stats":{"Line":1}},{"line":80,"address":[2873483],"length":1,"stats":{"Line":1}},{"line":81,"address":[1592189],"length":1,"stats":{"Line":1}},{"line":82,"address":[1749881],"length":1,"stats":{"Line":1}},{"line":85,"address":[2872891],"length":1,"stats":{"Line":0}},{"line":86,"address":[1593058],"length":1,"stats":{"Line":0}},{"line":96,"address":[1593408],"length":1,"stats":{"Line":1}},{"line":97,"address":[2874732],"length":1,"stats":{"Line":1}},{"line":105,"address":[1751184],"length":1,"stats":{"Line":1}},{"line":106,"address":[1751196],"length":1,"stats":{"Line":1}},{"line":114,"address":[1593504],"length":1,"stats":{"Line":1}},{"line":115,"address":[1751244],"length":1,"stats":{"Line":1}},{"line":128,"address":[],"length":0,"stats":{"Line":1}},{"line":129,"address":[],"length":0,"stats":{"Line":4}},{"line":130,"address":[1218117,1218007],"length":1,"stats":{"Line":2}},{"line":131,"address":[1218471,1218143,1218350,1218197],"length":1,"stats":{"Line":4}},{"line":133,"address":[1218562,1218160],"length":1,"stats":{"Line":2}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[2641095,2639321,2637872,2639456,2639420,2637839,2636288,2637740,2641003],"length":1,"stats":{"Line":1}},{"line":148,"address":[2636341,2636686,2639371,2639517,2641053,2639649,2637920,2639877,2637790,2636454,2638265,2638033],"length":1,"stats":{"Line":4}},{"line":149,"address":[1516453,1514942,1516745,1513363,1513253,1515135,1516554,1514832,1517652,1513554,1515970,1514389],"length":1,"stats":{"Line":2}},{"line":151,"address":[1215084],"length":1,"stats":{"Line":1}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[1109243,1110137,1107043,1110760,1108620,1107697],"length":1,"stats":{"Line":2}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[1215532,1215802,1215367,1215119,1215764,1215816],"length":1,"stats":{"Line":3}},{"line":157,"address":[2637327,2638908,2640518,2639175,2637594,2640785],"length":1,"stats":{"Line":1}},{"line":172,"address":[1517776,1519186,1519265],"length":1,"stats":{"Line":1}},{"line":173,"address":[1216088,1216212,1217512,1216415],"length":1,"stats":{"Line":2}},{"line":174,"address":[1518216,1519195,1518075],"length":1,"stats":{"Line":2}},{"line":176,"address":[2641746],"length":1,"stats":{"Line":1}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[2641864,2642509],"length":1,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[1217380,1217342,1217394,1217110,1216697,1216945],"length":1,"stats":{"Line":5}},{"line":182,"address":[2642143,2642410],"length":1,"stats":{"Line":2}},{"line":198,"address":[1520496,1521601,1522790,1520453,1519296,1520406,1522837,1521696,1521662],"length":1,"stats":{"Line":1}},{"line":199,"address":[1520531,1522818,1519697,1521629,1520434,1521739,1521858,1520895,1519476,1522079,1519352,1520650],"length":1,"stats":{"Line":2}},{"line":200,"address":[1519660,1520858,1522042],"length":1,"stats":{"Line":1}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[1521579,1522137,1521289,1522476,1519755,1520094,1520950,1520384,1522768],"length":1,"stats":{"Line":0}},{"line":203,"address":[2643595,2644790,2645979],"length":1,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[2644416,2645603,2645476,2643094,2643377,2644289,2644572,2643221,2645759],"length":1,"stats":{"Line":2}},{"line":207,"address":[1114213,1115347,1115824,1116096,1116368,1116205,1116477,1115933,1113056],"length":1,"stats":{"Line":0}},{"line":208,"address":[2643305,2645687,2644500],"length":1,"stats":{"Line":1}},{"line":221,"address":[1524157,1523696,1524168],"length":1,"stats":{"Line":1}},{"line":222,"address":[1523760,1524017,1523852,1524166],"length":1,"stats":{"Line":2}},{"line":223,"address":[1524099,1523995],"length":1,"stats":{"Line":2}},{"line":228,"address":[1751280],"length":1,"stats":{"Line":1}},{"line":229,"address":[1751285],"length":1,"stats":{"Line":1}}],"covered":54,"coverable":67},{"path":["/","home","cphelper-dev","project-cph","src","fs","mod.rs"],"content":"pub mod operations;\npub mod path;\npub mod backup;\npub mod manager;\npub mod transaction;\n\n// Re-export commonly used operations\npub use operations::{\n    check_exists as exists,\n    check_is_file as is_file,\n    check_is_directory as is_directory,\n    validate::parent_exists as check_permissions,\n};\n\n// Re-export path operations\npub use path::{\n    Validator as PathValidator,\n    ValidationLevel as PathValidationLevel,\n    normalize as normalize_path,\n    validate as validate_path,\n    ensure_path_exists,\n};\n\n// Re-export commonly used types and traits\npub use anyhow::{Result, Context};\npub use std::path::{Path, PathBuf};\n\n// Re-export specific types\npub use transaction::{\n    FileOperation,\n    Transaction,\n    State as TransactionState,\n    Transition as TransactionTransition,\n    CreateFileOperation,\n    DeleteFileOperation,\n};\n\npub use backup::Manager as BackupManager;\npub use manager::Manager; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","check.rs"],"content":"use std::path::Path;\nuse std::fs::metadata;\nuse anyhow::{Result, anyhow};\nuse crate::message::fs;\n\n/// パスが存在するかどうかを確認します\n#[must_use = \"この関数はパスの存在を示すブール値を返します\"]\npub fn exists\u003cP: AsRef\u003cPath\u003e\u003e(path: P) -\u003e bool {\n    path.as_ref().exists()\n}\n\n/// パスがファイルかどうかを確認します\n#[must_use = \"この関数はパスがファイルであることを示すブール値を返します\"]\npub fn is_file\u003cP: AsRef\u003cPath\u003e\u003e(path: P) -\u003e bool {\n    path.as_ref().is_file()\n}\n\n/// パスがディレクトリかどうかを確認します\n#[must_use = \"この関数はパスがディレクトリであることを示すブール値を返します\"]\npub fn is_directory\u003cP: AsRef\u003cPath\u003e\u003e(path: P) -\u003e bool {\n    path.as_ref().is_dir()\n}\n\n/// パスの権限を確認します。\n/// \n/// # Arguments\n/// * `path` - 確認するパス\n/// * `write_required` - 書き込み権限が必要かどうか\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - メタデータの取得に失敗した場合\n/// - 書き込み権限が必要なのに書き込み権限がない場合\npub fn verify_basic_permissions\u003cP: AsRef\u003cPath\u003e\u003e(path: P, write_required: bool) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    let metadata = metadata(path)?;\n    \n    if !metadata.permissions().readonly() \u0026\u0026 write_required {\n        return Err(anyhow!(fs::error(\"permission_error\", path.display())));\n    }\n    Ok(())\n}\n\n/// パスのパーミッションを確認します。\n/// \n/// # Arguments\n/// * `path` - 確認するパス\n/// * `write_required` - 書き込み権限が必要かどうか\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - 読み取り権限がない場合\n/// - 書き込み権限が必要なのに書き込み権限がない場合\npub fn verify_permissions\u003cP: AsRef\u003cPath\u003e\u003e(path: P, write_required: bool) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    if !path.exists() {\n        return Err(anyhow!(fs::error(\"file_not_found\", path.display())));\n    }\n\n    let metadata = path.metadata()\n        .map_err(|e| anyhow!(fs::error(\"metadata_error\", e)))?;\n\n    let permissions = metadata.permissions();\n\n    #[cfg(unix)]\n    {\n        use std::os::unix::fs::PermissionsExt;\n        let mode = permissions.mode();\n        let can_read = mode \u0026 0o444 != 0;\n        let can_write = mode \u0026 0o222 != 0;\n\n        if !can_read {\n            return Err(anyhow!(fs::error(\"permission_error\", path.display())));\n        }\n\n        if write_required \u0026\u0026 !can_write {\n            return Err(anyhow!(fs::error(\"permission_error\", path.display())));\n        }\n    }\n\n    Ok(())\n} ","traces":[{"line":8,"address":[1387971,1387936],"length":1,"stats":{"Line":1}},{"line":9,"address":[],"length":0,"stats":{"Line":2}},{"line":14,"address":[],"length":0,"stats":{"Line":2}},{"line":15,"address":[],"length":0,"stats":{"Line":4}},{"line":20,"address":[1385129,1385187,1385152,1385024],"length":1,"stats":{"Line":2}},{"line":21,"address":[],"length":0,"stats":{"Line":4}},{"line":34,"address":[],"length":0,"stats":{"Line":1}},{"line":35,"address":[],"length":0,"stats":{"Line":2}},{"line":36,"address":[],"length":0,"stats":{"Line":3}},{"line":38,"address":[],"length":0,"stats":{"Line":2}},{"line":39,"address":[],"length":0,"stats":{"Line":1}},{"line":41,"address":[],"length":0,"stats":{"Line":1}},{"line":54,"address":[],"length":0,"stats":{"Line":1}},{"line":55,"address":[],"length":0,"stats":{"Line":4}},{"line":56,"address":[],"length":0,"stats":{"Line":2}},{"line":57,"address":[],"length":0,"stats":{"Line":2}},{"line":60,"address":[],"length":0,"stats":{"Line":2}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[1386076,1386019],"length":1,"stats":{"Line":2}},{"line":68,"address":[],"length":0,"stats":{"Line":1}},{"line":69,"address":[],"length":0,"stats":{"Line":1}},{"line":70,"address":[],"length":0,"stats":{"Line":1}},{"line":72,"address":[],"length":0,"stats":{"Line":2}},{"line":73,"address":[],"length":0,"stats":{"Line":2}},{"line":76,"address":[],"length":0,"stats":{"Line":3}},{"line":77,"address":[],"length":0,"stats":{"Line":1}},{"line":81,"address":[],"length":0,"stats":{"Line":1}}],"covered":26,"coverable":27},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","delete.rs"],"content":"use std::path::Path;\nuse anyhow::{Result, anyhow};\nuse crate::message::fs;\nuse super::validate::{is_file, is_dir};\n\n/// ファイルを削除します。\n/// \n/// # Arguments\n/// * `path` - 削除するファイルのパス\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがファイルでない場合\n/// - ファイルの削除に失敗した場合\npub fn remove_file(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    is_file(path)?;\n    std::fs::remove_file(path)\n        .map_err(|e| anyhow!(fs::error(\"delete_error\", e)))\n}\n\n/// ディレクトリを削除します。\n/// \n/// # Arguments\n/// * `path` - 削除するディレクトリのパス\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがディレクトリでない場合\n/// - ディレクトリの削除に失敗した場合\npub fn remove_dir(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    is_dir(path)?;\n    std::fs::remove_dir_all(path)\n        .map_err(|e| anyhow!(fs::error(\"delete_error\", e)))\n} ","traces":[{"line":15,"address":[],"length":0,"stats":{"Line":1}},{"line":16,"address":[],"length":0,"stats":{"Line":2}},{"line":17,"address":[],"length":0,"stats":{"Line":3}},{"line":18,"address":[],"length":0,"stats":{"Line":2}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":1}},{"line":32,"address":[],"length":0,"stats":{"Line":2}},{"line":33,"address":[],"length":0,"stats":{"Line":3}},{"line":34,"address":[],"length":0,"stats":{"Line":2}},{"line":35,"address":[],"length":0,"stats":{"Line":0}}],"covered":8,"coverable":10},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","mod.rs"],"content":"pub mod check;\npub mod delete;\npub mod read;\npub mod write;\npub mod validate;\n\npub use check::{exists as check_exists, is_file as check_is_file, is_directory as check_is_directory};\npub use delete::*;\npub use read::*;\npub use write::*;\npub use validate::*;\n\n// Re-export commonly used types from std\npub use std::path::PathBuf;\npub use std::fs::{Metadata as FileMetadata, Permissions as FilePermissions};\n\npub use anyhow::{Result, Context}; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","read.rs"],"content":"use std::path::Path;\nuse anyhow::{Result, anyhow};\nuse crate::message::fs;\nuse super::validate::is_file;\n\n/// ファイルの内容を文字列として読み込みます。\n/// \n/// # Arguments\n/// * `path` - 読み込むファイルのパス\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがファイルでない場合\n/// - ファイルの読み込みに失敗した場合\n/// - ファイルの内容がUTF-8でない場合\n#[must_use = \"この関数はファイルの内容を返します\"]\npub fn load_file_as_string(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cString\u003e {\n    let path = path.as_ref();\n    is_file(path)?;\n    std::fs::read_to_string(path)\n        .map_err(|e| anyhow!(fs::error(\"read_error\", e)))\n}\n\n/// ファイルの内容をバイト列として読み込みます。\n/// \n/// # Arguments\n/// * `path` - 読み込むファイルのパス\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがファイルでない場合\n/// - ファイルの読み込みに失敗した場合\n#[must_use = \"この関数はファイルの内容をバイト列として返します\"]\npub fn load_file_as_bytes(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cVec\u003cu8\u003e\u003e {\n    let path = path.as_ref();\n    is_file(path)?;\n    std::fs::read(path)\n        .map_err(|e| anyhow!(fs::error(\"read_error\", e)))\n}\n\n/// ファイルのメタデータを取得します。\n/// \n/// # Arguments\n/// * `path` - メタデータを取得するファイルのパス\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - メタデータの取得に失敗した場合\n#[must_use = \"この関数はファイルのメタデータを返します\"]\npub fn get_metadata(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cstd::fs::Metadata\u003e {\n    let path = path.as_ref();\n    is_file(path)?;\n    path.metadata()\n        .map_err(|e| anyhow!(fs::error(\"metadata_error\", e)))\n} ","traces":[{"line":17,"address":[1384240,1384288],"length":1,"stats":{"Line":1}},{"line":18,"address":[],"length":0,"stats":{"Line":2}},{"line":19,"address":[],"length":0,"stats":{"Line":2}},{"line":20,"address":[],"length":0,"stats":{"Line":2}},{"line":21,"address":[],"length":0,"stats":{"Line":2}},{"line":34,"address":[],"length":0,"stats":{"Line":1}},{"line":35,"address":[],"length":0,"stats":{"Line":2}},{"line":36,"address":[],"length":0,"stats":{"Line":2}},{"line":37,"address":[],"length":0,"stats":{"Line":2}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":1}},{"line":51,"address":[],"length":0,"stats":{"Line":2}},{"line":52,"address":[],"length":0,"stats":{"Line":2}},{"line":53,"address":[],"length":0,"stats":{"Line":2}},{"line":54,"address":[],"length":0,"stats":{"Line":0}}],"covered":13,"coverable":15},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","validate.rs"],"content":"use std::path::Path;\nuse anyhow::{Result, anyhow};\nuse crate::message::fs;\n\n/// パスの存在を検証します。\n/// \n/// # Errors\n/// - パスが存在しない場合\npub fn exists(path: \u0026Path) -\u003e Result\u003c()\u003e {\n    if !path.exists() {\n        return Err(anyhow!(fs::error(\"file_not_found\", path.display())));\n    }\n    Ok(())\n}\n\n/// パスがファイルであることを検証します。\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがファイルでない場合\npub fn is_file(path: \u0026Path) -\u003e Result\u003c()\u003e {\n    exists(path)?;\n    if !path.is_file() {\n        return Err(anyhow!(fs::error(\"invalid_path\", path.display())));\n    }\n    Ok(())\n}\n\n/// パスがディレクトリであることを検証します。\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがディレクトリでない場合\npub fn is_dir(path: \u0026Path) -\u003e Result\u003c()\u003e {\n    exists(path)?;\n    if !path.is_dir() {\n        return Err(anyhow!(fs::error(\"invalid_path\", path.display())));\n    }\n    Ok(())\n}\n\n/// パスの親ディレクトリが存在することを検証します。\n/// \n/// # Errors\n/// - 親ディレクトリが存在しない場合\npub fn parent_exists(path: \u0026Path) -\u003e Result\u003c()\u003e {\n    if let Some(parent) = path.parent() {\n        exists(parent)?;\n    }\n    Ok(())\n} ","traces":[{"line":9,"address":[980448,980739,980710],"length":1,"stats":{"Line":1}},{"line":10,"address":[2602433],"length":1,"stats":{"Line":1}},{"line":11,"address":[2602457,2602556,2602687],"length":1,"stats":{"Line":1}},{"line":13,"address":[2602545],"length":1,"stats":{"Line":1}},{"line":21,"address":[2602720,2603091,2603120],"length":1,"stats":{"Line":1}},{"line":22,"address":[2602753,2602830],"length":1,"stats":{"Line":4}},{"line":23,"address":[2602814],"length":1,"stats":{"Line":2}},{"line":24,"address":[2602876,2602975,2603104],"length":1,"stats":{"Line":2}},{"line":26,"address":[2602964],"length":1,"stats":{"Line":2}},{"line":34,"address":[2603136,2603507,2603536],"length":1,"stats":{"Line":1}},{"line":35,"address":[2603169,2603246],"length":1,"stats":{"Line":2}},{"line":36,"address":[2603230],"length":1,"stats":{"Line":1}},{"line":37,"address":[2603520,2603292,2603391],"length":1,"stats":{"Line":1}},{"line":39,"address":[2603380],"length":1,"stats":{"Line":1}},{"line":46,"address":[2603552],"length":1,"stats":{"Line":1}},{"line":47,"address":[2603566],"length":1,"stats":{"Line":1}},{"line":48,"address":[2603628,2603685],"length":1,"stats":{"Line":2}},{"line":50,"address":[2603674],"length":1,"stats":{"Line":1}}],"covered":18,"coverable":18},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","write.rs"],"content":"use std::path::Path;\nuse anyhow::{Result, anyhow};\nuse crate::message::fs;\nuse super::validate::parent_exists;\n\n/// ディレクトリが存在することを確認し、存在しない場合は作成します。\n/// \n/// # Arguments\n/// * `path` - 確認または作成するディレクトリのパス\n/// \n/// # Errors\n/// - ディレクトリの作成に失敗した場合\npub fn ensure_directory(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    if !path.exists() {\n        std::fs::create_dir_all(path)\n            .map_err(|e| anyhow!(fs::error(\"write_error\", e)))?;\n    }\n    Ok(())\n}\n\n/// ファイルが存在することを確認し、存在しない場合は作成します。\n/// \n/// # Arguments\n/// * `path` - 確認または作成するファイルのパス\n/// \n/// # Errors\n/// - ファイルの作成に失敗した場合\n/// - パスの親ディレクトリの作成に失敗した場合\npub fn ensure_file(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    if !path.exists() {\n        parent_exists(path)?;\n        std::fs::File::create(path)\n            .map_err(|e| anyhow!(fs::error(\"write_error\", e)))?;\n    }\n    Ok(())\n}\n\n/// ファイルに内容を書き込みます。\n/// \n/// # Arguments\n/// * `path` - 書き込み先のファイルパス\n/// * `content` - 書き込む内容\n/// \n/// # Errors\n/// - ファイルの作成に失敗した場合\n/// - ファイルの書き込みに失敗した場合\npub fn save_to_file(path: impl AsRef\u003cPath\u003e, content: impl AsRef\u003c[u8]\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    if let Some(parent) = path.parent() {\n        ensure_directory(parent)?;\n    }\n    std::fs::write(path, content)\n        .map_err(|e| anyhow!(fs::error(\"write_error\", e)))\n} ","traces":[{"line":13,"address":[1473931,1474230,1473888,1474192],"length":1,"stats":{"Line":2}},{"line":14,"address":[],"length":0,"stats":{"Line":4}},{"line":15,"address":[],"length":0,"stats":{"Line":2}},{"line":16,"address":[],"length":0,"stats":{"Line":4}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":2}},{"line":30,"address":[],"length":0,"stats":{"Line":1}},{"line":31,"address":[],"length":0,"stats":{"Line":2}},{"line":32,"address":[],"length":0,"stats":{"Line":1}},{"line":33,"address":[],"length":0,"stats":{"Line":2}},{"line":34,"address":[1472011,1472148,1472067],"length":1,"stats":{"Line":2}},{"line":35,"address":[],"length":0,"stats":{"Line":1}},{"line":37,"address":[],"length":0,"stats":{"Line":1}},{"line":49,"address":[],"length":0,"stats":{"Line":2}},{"line":50,"address":[],"length":0,"stats":{"Line":4}},{"line":51,"address":[],"length":0,"stats":{"Line":2}},{"line":52,"address":[],"length":0,"stats":{"Line":4}},{"line":54,"address":[],"length":0,"stats":{"Line":4}},{"line":55,"address":[],"length":0,"stats":{"Line":0}}],"covered":17,"coverable":19},{"path":["/","home","cphelper-dev","project-cph","src","fs","path.rs"],"content":"use std::path::{Path, PathBuf};\nuse anyhow::{Result, anyhow};\nuse crate::message::fs as fs_message;\n\n/// パスの検証レベルを定義する列挙型\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum ValidationLevel {\n    /// 基本的な検証のみ（絶対パスとパストラバーサルのチェック）\n    Basic,\n    /// 厳格な検証（Basic + 特殊文字、非ASCII文字、長さ制限など）\n    Strict,\n}\n\n/// パス操作に関する共通機能を提供する構造体\n#[derive(Debug)]\n#[allow(dead_code)]\npub struct Validator {\n    /// パスの検証レベル\n    validation_level: ValidationLevel,\n    /// パス長の最大値（バイト単位）\n    max_path_length: usize,\n    /// ファイル名の最大長（バイト単位）\n    max_filename_length: usize,\n}\n\nimpl Default for Validator {\n    #[must_use = \"この関数は新しいValidatorインスタンスを返します\"]\n    fn default() -\u003e Self {\n        Self {\n            validation_level: ValidationLevel::Basic,\n            max_path_length: 4096,\n            max_filename_length: 255,\n        }\n    }\n}\n\nimpl Validator {\n    /// 新しいValidatorインスタンスを作成します\n    ///\n    /// # Arguments\n    /// * `validation_level` - パスの検証レベル\n    /// * `max_path_length` - パス長の最大値（バイト単位）\n    /// * `max_filename_length` - ファイル名の最大長（バイト単位）\n    #[must_use = \"この関数は新しいValidatorインスタンスを返します\"]\n    pub const fn new(\n        validation_level: ValidationLevel,\n        max_path_length: usize,\n        max_filename_length: usize,\n    ) -\u003e Self {\n        Self {\n            validation_level,\n            max_path_length,\n            max_filename_length,\n        }\n    }\n\n    /// パスを検証します\n    ///\n    /// # Arguments\n    /// * `path` - 検証するパス\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 検証結果\n    ///\n    /// # Errors\n    /// * パスが無効な場合\n    pub fn validate\u003cP: AsRef\u003cPath\u003e\u003e(\u0026self, path: P) -\u003e Result\u003c()\u003e {\n        let path = path.as_ref();\n\n        // パスコンポーネントの検証\n        for component in path.components() {\n            match component {\n                std::path::Component::ParentDir =\u003e {\n                    return Err(anyhow!(fs_message::error(\"path_traversal_error\", \"\")));\n                }\n                std::path::Component::RootDir =\u003e {\n                    return Err(anyhow!(fs_message::error(\"absolute_path_error\", \"\")));\n                }\n                std::path::Component::Normal(name) =\u003e {\n                    let name_str = name.to_string_lossy();\n                    if name_str.len() \u003e self.max_filename_length {\n                        return Err(anyhow!(fs_message::error(\"filename_too_long\", self.max_filename_length)));\n                    }\n                }\n                _ =\u003e {}\n            }\n        }\n\n        Ok(())\n    }\n\n    /// パスを正規化します\n    /// \n    /// # Arguments\n    /// * `root` - ルートディレクトリのパス\n    /// * `path` - 正規化するパス\n    /// \n    /// # Returns\n    /// * `Result\u003cPathBuf\u003e` - 正規化されたパス\n    /// \n    /// # Errors\n    /// * パスの検証に失敗した場合\n    /// * パスの正規化に失敗した場合\n    #[must_use = \"この関数は正規化されたパスを返します\"]\n    pub fn normalize\u003cP1: AsRef\u003cPath\u003e, P2: AsRef\u003cPath\u003e\u003e(\u0026self, root: P1, path: P2) -\u003e Result\u003cPathBuf\u003e {\n        // パスの検証\n        self.validate(path.as_ref())?;\n\n        // パスの正規化\n        let normalized = path.as_ref().strip_prefix(\".\").unwrap_or_else(|_| path.as_ref());\n        Ok(root.as_ref().join(normalized))\n    }\n}\n\n/// パスを正規化します\n/// \n/// # Arguments\n/// * `root` - ルートディレクトリのパス\n/// * `path` - 正規化するパス\n/// \n/// # Returns\n/// * `Result\u003cPathBuf\u003e` - 正規化されたパス\n/// \n/// # Errors\n/// * パスの検証に失敗した場合\n/// * パスの正規化に失敗した場合\npub fn normalize\u003cP1: AsRef\u003cPath\u003e, P2: AsRef\u003cPath\u003e\u003e(root: P1, path: P2) -\u003e Result\u003cPathBuf\u003e {\n    Validator::default().normalize(root, path)\n}\n\n/// パスを検証します\n/// \n/// # Arguments\n/// * `path` - 検証するパス\n/// \n/// # Returns\n/// * `Result\u003c()\u003e` - 検証結果\n/// \n/// # Errors\n/// * パスが無効な場合\npub fn validate\u003cP: AsRef\u003cPath\u003e\u003e(path: P) -\u003e Result\u003c()\u003e {\n    Validator::default().validate(path)\n}\n\n/// パスが存在することを確認し、存在しない場合はディレクトリを作成します。\n/// \n/// # Arguments\n/// * `path` - 確認または作成するパス\n/// \n/// # Errors\n/// - ディレクトリの作成に失敗した場合\npub fn ensure_path_exists(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    if !path.exists() {\n        std::fs::create_dir_all(path)\n            .map_err(|e| anyhow!(\"ディレクトリの作成に失敗しました: {e}\"))?;\n    }\n    Ok(())\n} ","traces":[{"line":28,"address":[1154800],"length":1,"stats":{"Line":1}},{"line":45,"address":[1912048],"length":1,"stats":{"Line":1}},{"line":67,"address":[1527459,1526720,1526640],"length":1,"stats":{"Line":3}},{"line":68,"address":[2650349,2650254],"length":1,"stats":{"Line":6}},{"line":71,"address":[2650506,2650365],"length":1,"stats":{"Line":6}},{"line":72,"address":[2650570],"length":1,"stats":{"Line":3}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[1527112,1527468],"length":1,"stats":{"Line":4}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[1527437,1527206,1527071],"length":1,"stats":{"Line":4}},{"line":79,"address":[1527156],"length":1,"stats":{"Line":3}},{"line":80,"address":[1527196],"length":1,"stats":{"Line":3}},{"line":81,"address":[2651388,2651305],"length":1,"stats":{"Line":6}},{"line":82,"address":[1527859,1528142],"length":1,"stats":{"Line":2}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[1526905],"length":1,"stats":{"Line":2}},{"line":105,"address":[1215360,1215888,1215865,1215337,1214768,1215266,1216401],"length":1,"stats":{"Line":2}},{"line":107,"address":[1529473,1529028,1528838,1529586,1528421,1528230,1528315,1529390,1528915],"length":1,"stats":{"Line":6}},{"line":110,"address":[1529552,1529904,1529936,1529633,1529913,1528468,1529977,1528399,1529075,1529968,1528994,1529945],"length":1,"stats":{"Line":8}},{"line":111,"address":[2652779,2652170,2653338],"length":1,"stats":{"Line":2}},{"line":127,"address":[2653772,2653808,2653984,2654156,2653965,2653584],"length":1,"stats":{"Line":2}},{"line":128,"address":[1530029,1530258,1530334,1530105,1530444,1530525],"length":1,"stats":{"Line":4}},{"line":141,"address":[],"length":0,"stats":{"Line":1}},{"line":142,"address":[1228453,1228392],"length":1,"stats":{"Line":2}},{"line":152,"address":[2654176,2654219],"length":1,"stats":{"Line":2}},{"line":153,"address":[1227804,1227866],"length":1,"stats":{"Line":4}},{"line":154,"address":[2654287],"length":1,"stats":{"Line":2}},{"line":155,"address":[1227929,1227961,1228043],"length":1,"stats":{"Line":4}},{"line":156,"address":[1530839,1531005,1530896],"length":1,"stats":{"Line":0}},{"line":158,"address":[1530750],"length":1,"stats":{"Line":2}}],"covered":26,"coverable":30},{"path":["/","home","cphelper-dev","project-cph","src","fs","transaction.rs"],"content":"use std::path::PathBuf;\nuse std::sync::Arc;\nuse std::time::{SystemTime, UNIX_EPOCH};\nuse anyhow::{Result, anyhow};\nuse crate::fs::ensure_path_exists;\n\n/// ファイル操作のトレイト\npub trait FileOperation: Send + Sync + std::fmt::Debug {\n    /// ファイル操作を実行します\n    /// # Errors\n    /// - ファイル操作に失敗した場合\n    fn execute(\u0026self) -\u003e Result\u003c()\u003e;\n\n    /// ファイル操作をロールバックします\n    /// # Errors\n    /// - ロールバックに失敗した場合\n    fn rollback(\u0026self) -\u003e Result\u003c()\u003e;\n\n    /// ファイル操作の説明を取得します\n    #[must_use = \"この関数の戻り値は操作の説明を含むため、使用する必要があります\"]\n    fn description(\u0026self) -\u003e String;\n\n    /// ファイル操作の検証を行います\n    /// # Errors\n    /// - 検証に失敗した場合\n    fn validate(\u0026self) -\u003e Result\u003c()\u003e;\n}\n\n/// トランザクションの状態を表す列挙型\n#[derive(Debug, Clone)]\npub enum State {\n    /// 初期状態\n    Pending {\n        /// 作成時のタイムスタンプ\n        created_at: u64,\n    },\n    /// 実行済み\n    Executed {\n        /// 実行時のタイムスタンプ\n        executed_at: u64,\n    },\n    /// ロールバック済み\n    RolledBack {\n        /// ロールバック時のタイムスタンプ\n        rolled_back_at: u64,\n    },\n    /// 失敗\n    Failed {\n        /// エラー情報\n        error: String,\n        /// 失敗時のタイムスタンプ\n        failed_at: u64,\n    },\n}\n\nimpl State {\n    /// 現在のUNIXタイムスタンプを取得\n    fn now() -\u003e u64 {\n        SystemTime::now()\n            .duration_since(UNIX_EPOCH)\n            .map_or(0, |duration| duration.as_secs())\n    }\n\n    /// 状態の説明を取得\n    #[must_use = \"状態の説明は重要な情報を含むため、使用する必要があります\"]\n    fn description(\u0026self) -\u003e String {\n        match self {\n            Self::Pending { created_at } =\u003e {\n                format!(\"保留中 (作成: {created_at})\")\n            }\n            Self::Executed { executed_at } =\u003e {\n                format!(\"実行済み (実行: {executed_at})\")\n            }\n            Self::RolledBack { rolled_back_at } =\u003e {\n                format!(\"ロールバック済み (ロールバック: {rolled_back_at})\")\n            }\n            Self::Failed { error, failed_at } =\u003e {\n                format!(\"失敗 (時刻: {failed_at}): {error}\")\n            }\n        }\n    }\n}\n\n/// トランザクションの遷移を表す列挙型\n#[derive(Debug, Clone)]\npub enum Transition {\n    /// 操作の追加\n    AddOperation(Arc\u003cdyn FileOperation\u003e),\n    /// トランザクションの実行\n    Execute,\n    /// トランザクションのロールバック\n    Rollback,\n}\n\n/// ファイルトランザクションを表す構造体\n#[derive(Debug, Clone)]\npub struct Transaction {\n    /// ファイル操作のリスト\n    operations: Arc\u003cVec\u003cArc\u003cdyn FileOperation\u003e\u003e\u003e,\n    /// トランザクションの状態\n    state: State,\n}\n\nimpl Default for Transaction {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Transaction {\n    /// 新しいトランザクションを作成します\n    #[must_use = \"新しいトランザクションインスタンスは使用する必要があります\"]\n    pub fn new() -\u003e Self {\n        Self {\n            operations: Arc::new(Vec::new()),\n            state: State::Pending {\n                created_at: State::now(),\n            },\n        }\n    }\n\n    /// 操作を追加\n    #[must_use]\n    #[allow(dead_code)]\n    fn with_operations(\u0026self, operations: Vec\u003cArc\u003cdyn FileOperation\u003e\u003e) -\u003e Self {\n        Self {\n            operations: Arc::new(operations),\n            state: self.state.clone(),\n        }\n    }\n\n    /// 状態を更新\n    #[must_use]\n    fn with_state(\u0026self, state: State) -\u003e Self {\n        Self {\n            operations: Arc::clone(\u0026self.operations),\n            state,\n        }\n    }\n\n    /// 状態遷移を適用します\n    /// # Errors\n    /// - 無効な状態遷移の場合\n    /// - 操作の実行に失敗した場合\n    /// - ロールバックに失敗した場合\n    #[must_use = \"状態遷移の結果は新しいトランザクションインスタンスとして返されます\"]\n    pub fn apply_transition(self, transition: Transition) -\u003e Result\u003cSelf\u003e {\n        match (\u0026self.state, transition) {\n            (State::Pending { .. }, Transition::AddOperation(operation)) =\u003e {\n                // 操作の検証\n                if let Err(e) = operation.validate() {\n                    return Err(anyhow!(\"操作の検証に失敗: {}\", e));\n                }\n\n                let mut operations = (*self.operations).clone();\n                operations.push(operation);\n\n                Ok(Self {\n                    operations: Arc::new(operations),\n                    state: self.state,\n                })\n            }\n            (State::Pending { .. }, Transition::Execute) =\u003e {\n                // 全ての操作を実行\n                for op in self.operations.iter() {\n                    // 検証を実行\n                    if let Err(e) = op.validate() {\n                        return Ok(self.with_state(State::Failed {\n                            error: e.to_string(),\n                            failed_at: State::now(),\n                        }));\n                    }\n                }\n\n                // 全ての操作を実行\n                for op in self.operations.iter() {\n                    if let Err(e) = op.execute() {\n                        // エラーが発生した場合、実行済みの操作をロールバック\n                        for prev_op in self.operations.iter().rev() {\n                            if let Err(rollback_err) = prev_op.rollback() {\n                                return Err(anyhow!(\n                                    \"ロールバックに失敗: {}（元のエラー: {}）\",\n                                    rollback_err, e\n                                ));\n                            }\n                        }\n                        return Ok(self.with_state(State::Failed {\n                            error: e.to_string(),\n                            failed_at: State::now(),\n                        }));\n                    }\n                }\n\n                Ok(self.with_state(State::Executed {\n                    executed_at: State::now(),\n                }))\n            }\n            (State::Pending { .. }, Transition::Rollback) =\u003e {\n                // 全ての操作をロールバック\n                for op in self.operations.iter().rev() {\n                    if let Err(e) = op.rollback() {\n                        return Err(anyhow!(\"ロールバックに失敗: {}\", e));\n                    }\n                }\n\n                Ok(self.with_state(State::RolledBack {\n                    rolled_back_at: State::now(),\n                }))\n            }\n            (state, transition) =\u003e {\n                Err(anyhow!(\n                    \"無効な状態遷移です: {:?} -\u003e {:?}\",\n                    state, transition\n                ))\n            }\n        }\n    }\n\n    /// トランザクションの状態を取得します\n    #[must_use = \"トランザクションの状態は重要な情報を含むため、使用する必要があります\"]\n    pub const fn state(\u0026self) -\u003e \u0026State {\n        \u0026self.state\n    }\n\n    /// トランザクションの説明を取得します\n    #[must_use = \"トランザクションの説明は重要な情報を含むため、使用する必要があります\"]\n    pub fn description(\u0026self) -\u003e String {\n        format!(\n            \"トランザクション（{}）:\\n{}\",\n            self.state.description(),\n            self.operations\n                .iter()\n                .enumerate()\n                .map(|(i, op)| format!(\"  {}: {}\", i + 1, op.description()))\n                .collect::\u003cVec\u003c_\u003e\u003e()\n                .join(\"\\n\")\n        )\n    }\n\n    /// 操作を追加します\n    /// # Errors\n    /// - 操作の検証に失敗した場合\n    #[must_use = \"操作を追加した結果は新しいトランザクションインスタンスとして返されます\"]\n    pub fn with_operation(self, operation: Arc\u003cdyn FileOperation\u003e) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::AddOperation(operation))\n    }\n\n    /// トランザクションを実行します\n    /// # Errors\n    /// - 操作の実行に失敗した場合\n    /// - ロールバックに失敗した場合\n    #[must_use = \"トランザクションの実行結果は新しいトランザクションインスタンスとして返されます\"]\n    pub fn execute(self) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::Execute)\n    }\n\n    /// トランザクションをロールバックします\n    /// # Errors\n    /// - ロールバックに失敗した場合\n    #[must_use = \"トランザクションのロールバック結果は新しいトランザクションインスタンスとして返されます\"]\n    pub fn rollback(self) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::Rollback)\n    }\n\n    /// トランザクションの操作一覧を取得します\n    #[must_use = \"トランザクションの操作一覧は重要な情報を含むため、使用する必要があります\"]\n    pub fn operations(\u0026self) -\u003e \u0026[Arc\u003cdyn FileOperation\u003e] {\n        \u0026self.operations\n    }\n\n    /// トランザクションを結合します\n    /// # Errors\n    /// - いずれかのトランザクションが保留状態でない場合\n    #[must_use = \"トランザクションの結合結果は新しいトランザクションインスタンスとして返されます\"]\n    pub fn combine(self, other: \u0026Self) -\u003e Result\u003cSelf\u003e {\n        match (\u0026self.state, \u0026other.state) {\n            (State::Pending { .. }, State::Pending { .. }) =\u003e {\n                let mut operations = (*self.operations).clone();\n                operations.extend(other.operations.iter().cloned());\n                Ok(Self {\n                    operations: Arc::new(operations),\n                    state: State::Pending {\n                        created_at: State::now(),\n                    },\n                })\n            }\n            _ =\u003e {\n                Err(anyhow!(\"トランザクションの結合は保留状態でのみ可能です\"))\n            }\n        }\n    }\n}\n\n// イミュータブルな操作を実装するための具体的な型\n#[derive(Debug)]\npub struct CreateFileOperation {\n    path: Arc\u003cPathBuf\u003e,\n    content: Arc\u003cString\u003e,\n}\n\nimpl CreateFileOperation {\n    /// 新しいファイル作成操作を作成します\n    #[must_use = \"新しいファイル作成操作インスタンスは使用する必要があります\"]\n    pub fn new(path: PathBuf, content: String) -\u003e Self {\n        Self {\n            path: Arc::new(path),\n            content: Arc::new(content),\n        }\n    }\n}\n\nimpl FileOperation for CreateFileOperation {\n    fn execute(\u0026self) -\u003e Result\u003c()\u003e {\n        if let Some(parent) = self.path.parent() {\n            ensure_path_exists(parent)?;\n        }\n        std::fs::write(\u0026*self.path, \u0026*self.content)\n            .map_err(|e| anyhow!(\"ファイルの書き込みに失敗: {}: {}\", self.path.display(), e))\n    }\n\n    fn rollback(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.path.exists() {\n            std::fs::remove_file(\u0026*self.path)\n                .map_err(|e| anyhow!(\"ファイルの削除に失敗: {}: {}\", self.path.display(), e))?;\n        }\n        Ok(())\n    }\n\n    fn description(\u0026self) -\u003e String {\n        format!(\"ファイル作成: {}\", self.path.display())\n    }\n\n    fn validate(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.path.as_os_str().is_empty() {\n            return Err(anyhow!(\"パスが空です\"));\n        }\n        if self.path.exists() {\n            return Err(anyhow!(\"ファイルが既に存在します: {}\", self.path.display()));\n        }\n        Ok(())\n    }\n}\n\n#[derive(Debug)]\npub struct DeleteFileOperation {\n    path: Arc\u003cPathBuf\u003e,\n    original_content: Option\u003cArc\u003cString\u003e\u003e,\n}\n\nimpl DeleteFileOperation {\n    /// 新しいファイル削除操作を作成します\n    /// # Errors\n    /// - ァイルの読み込みに失敗した場合\n    #[must_use = \"新しいファイル削除操作インスタンスは使用する必要があります\"]\n    pub fn new(path: PathBuf) -\u003e Result\u003cSelf\u003e {\n        let original_content = if path.exists() {\n            Some(Arc::new(std::fs::read_to_string(\u0026path)\n                .map_err(|e| anyhow!(\"ファイルの読み込みに失敗: {}: {}\", path.display(), e))?))\n        } else {\n            None\n        };\n\n        Ok(Self {\n            path: Arc::new(path),\n            original_content,\n        })\n    }\n}\n\nimpl FileOperation for DeleteFileOperation {\n    fn execute(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.path.exists() {\n            std::fs::remove_file(\u0026*self.path)\n                .map_err(|e| anyhow!(\"ファイルの削除に失敗: {}: {}\", self.path.display(), e))?;\n        }\n        Ok(())\n    }\n\n    fn rollback(\u0026self) -\u003e Result\u003c()\u003e {\n        if let Some(content) = \u0026self.original_content {\n            if let Some(parent) = self.path.parent() {\n                ensure_path_exists(parent)?;\n            }\n            std::fs::write(\u0026*self.path, \u0026**content)\n                .map_err(|e| anyhow!(\"ファイルの復元に失敗: {}: {}\", self.path.display(), e))?;\n        }\n        Ok(())\n    }\n\n    fn description(\u0026self) -\u003e String {\n        format!(\"ファイル削除: {}\", self.path.display())\n    }\n\n    fn validate(\u0026self) -\u003e Result\u003c()\u003e {\n        if !self.path.exists() {\n            return Err(anyhow!(\"ファイルが存在しません: {}\", self.path.display()));\n        }\n        Ok(())\n    }\n} \n","traces":[{"line":58,"address":[2825264],"length":1,"stats":{"Line":1}},{"line":59,"address":[2825268],"length":1,"stats":{"Line":1}},{"line":61,"address":[2674860,2674848],"length":1,"stats":{"Line":2}},{"line":66,"address":[1701744],"length":1,"stats":{"Line":1}},{"line":67,"address":[1701773],"length":1,"stats":{"Line":1}},{"line":68,"address":[1011677],"length":1,"stats":{"Line":1}},{"line":69,"address":[2825531,2825626],"length":1,"stats":{"Line":2}},{"line":71,"address":[2825635],"length":1,"stats":{"Line":0}},{"line":72,"address":[1012013,1012135],"length":1,"stats":{"Line":0}},{"line":74,"address":[1702304],"length":1,"stats":{"Line":0}},{"line":75,"address":[2826010,2826132],"length":1,"stats":{"Line":0}},{"line":77,"address":[2826141],"length":1,"stats":{"Line":0}},{"line":78,"address":[1012637],"length":1,"stats":{"Line":0}},{"line":105,"address":[2826560],"length":1,"stats":{"Line":0}},{"line":106,"address":[1702984],"length":1,"stats":{"Line":0}},{"line":113,"address":[2826592,2826772],"length":1,"stats":{"Line":1}},{"line":115,"address":[1703022],"length":1,"stats":{"Line":1}},{"line":116,"address":[2826703],"length":1,"stats":{"Line":1}},{"line":125,"address":[1703375,1703216],"length":1,"stats":{"Line":0}},{"line":127,"address":[1703253],"length":1,"stats":{"Line":0}},{"line":128,"address":[1703277],"length":1,"stats":{"Line":0}},{"line":134,"address":[1013396,1013216],"length":1,"stats":{"Line":1}},{"line":136,"address":[1013253],"length":1,"stats":{"Line":1}},{"line":147,"address":[1018512,1014534,1013424],"length":1,"stats":{"Line":1}},{"line":148,"address":[1013455],"length":1,"stats":{"Line":1}},{"line":149,"address":[2827582],"length":1,"stats":{"Line":2}},{"line":151,"address":[1013994,1013854],"length":1,"stats":{"Line":3}},{"line":152,"address":[1704457,1704578],"length":1,"stats":{"Line":2}},{"line":155,"address":[1704768],"length":1,"stats":{"Line":1}},{"line":156,"address":[2828410],"length":1,"stats":{"Line":1}},{"line":158,"address":[1705056],"length":1,"stats":{"Line":1}},{"line":159,"address":[2828494],"length":1,"stats":{"Line":1}},{"line":160,"address":[2828585],"length":1,"stats":{"Line":1}},{"line":165,"address":[2827665,2829072,2828824],"length":1,"stats":{"Line":3}},{"line":167,"address":[2830834,2829088],"length":1,"stats":{"Line":2}},{"line":168,"address":[1707492],"length":1,"stats":{"Line":0}},{"line":169,"address":[1707327],"length":1,"stats":{"Line":0}},{"line":170,"address":[2831004],"length":1,"stats":{"Line":0}},{"line":176,"address":[1015273,1015489,1015204],"length":1,"stats":{"Line":3}},{"line":177,"address":[1705929,1705790],"length":1,"stats":{"Line":2}},{"line":179,"address":[1706398,1706014,1706111],"length":1,"stats":{"Line":0}},{"line":180,"address":[1706414,1706646],"length":1,"stats":{"Line":0}},{"line":181,"address":[1707015,1707152],"length":1,"stats":{"Line":0}},{"line":187,"address":[1706519],"length":1,"stats":{"Line":0}},{"line":188,"address":[1706371],"length":1,"stats":{"Line":0}},{"line":189,"address":[2830028],"length":1,"stats":{"Line":0}},{"line":194,"address":[2829417],"length":1,"stats":{"Line":1}},{"line":195,"address":[1015474],"length":1,"stats":{"Line":1}},{"line":200,"address":[1013915,1017489,1017291],"length":1,"stats":{"Line":3}},{"line":201,"address":[1017625,1017505],"length":1,"stats":{"Line":2}},{"line":202,"address":[1708360,1708239],"length":1,"stats":{"Line":0}},{"line":206,"address":[1017535],"length":1,"stats":{"Line":1}},{"line":207,"address":[1017477],"length":1,"stats":{"Line":1}},{"line":210,"address":[1703817],"length":1,"stats":{"Line":0}},{"line":211,"address":[1708743,1708606],"length":1,"stats":{"Line":0}},{"line":221,"address":[1018576],"length":1,"stats":{"Line":1}},{"line":227,"address":[1018592,1019538],"length":1,"stats":{"Line":1}},{"line":228,"address":[1019157,1018747,1018960],"length":1,"stats":{"Line":0}},{"line":230,"address":[1709006],"length":1,"stats":{"Line":1}},{"line":231,"address":[1709180,1709421],"length":1,"stats":{"Line":2}},{"line":234,"address":[2677790,2677629,2677584,2677922,2678185],"length":1,"stats":{"Line":4}},{"line":244,"address":[1709968],"length":1,"stats":{"Line":1}},{"line":245,"address":[2833574],"length":1,"stats":{"Line":1}},{"line":253,"address":[1019632],"length":1,"stats":{"Line":1}},{"line":254,"address":[2833628],"length":1,"stats":{"Line":1}},{"line":261,"address":[1019680],"length":1,"stats":{"Line":1}},{"line":262,"address":[2833676],"length":1,"stats":{"Line":1}},{"line":267,"address":[1710128],"length":1,"stats":{"Line":1}},{"line":268,"address":[2833717],"length":1,"stats":{"Line":1}},{"line":275,"address":[1020476,1020577,1019760],"length":1,"stats":{"Line":0}},{"line":276,"address":[1710198],"length":1,"stats":{"Line":0}},{"line":278,"address":[1710408,1710342],"length":1,"stats":{"Line":0}},{"line":279,"address":[2834024,2834087],"length":1,"stats":{"Line":0}},{"line":280,"address":[1710784],"length":1,"stats":{"Line":0}},{"line":281,"address":[2834199],"length":1,"stats":{"Line":0}},{"line":282,"address":[2834342],"length":1,"stats":{"Line":0}},{"line":283,"address":[2834276],"length":1,"stats":{"Line":0}},{"line":288,"address":[2833892,2834540],"length":1,"stats":{"Line":0}},{"line":304,"address":[1711040,1711210],"length":1,"stats":{"Line":1}},{"line":306,"address":[1711049,1711117],"length":1,"stats":{"Line":2}},{"line":307,"address":[2834706],"length":1,"stats":{"Line":1}},{"line":313,"address":[1711248],"length":1,"stats":{"Line":1}},{"line":314,"address":[1020798],"length":1,"stats":{"Line":1}},{"line":315,"address":[2834928,2835038],"length":1,"stats":{"Line":1}},{"line":317,"address":[1711395],"length":1,"stats":{"Line":1}},{"line":318,"address":[1551661,1551771,1551296,1551313],"length":1,"stats":{"Line":0}},{"line":321,"address":[2835088],"length":1,"stats":{"Line":1}},{"line":322,"address":[1021038],"length":1,"stats":{"Line":1}},{"line":323,"address":[1021157,1021082],"length":1,"stats":{"Line":0}},{"line":324,"address":[2675441,2675789,2675424,2675899],"length":1,"stats":{"Line":0}},{"line":326,"address":[1711547],"length":1,"stats":{"Line":1}},{"line":329,"address":[1021184],"length":1,"stats":{"Line":1}},{"line":330,"address":[1021369,1021222],"length":1,"stats":{"Line":2}},{"line":333,"address":[2835568],"length":1,"stats":{"Line":1}},{"line":334,"address":[2835587],"length":1,"stats":{"Line":1}},{"line":335,"address":[1021580],"length":1,"stats":{"Line":0}},{"line":337,"address":[2835631],"length":1,"stats":{"Line":1}},{"line":338,"address":[2835734,2835988,2835885],"length":1,"stats":{"Line":3}},{"line":340,"address":[2835716],"length":1,"stats":{"Line":1}},{"line":355,"address":[2836538,2836032,2836516],"length":1,"stats":{"Line":1}},{"line":356,"address":[2836146,2836435,2836062,2836176],"length":1,"stats":{"Line":4}},{"line":357,"address":[2836408,2836267,2836183],"length":1,"stats":{"Line":2}},{"line":358,"address":[1552384,1552728,1552838,1552401],"length":1,"stats":{"Line":0}},{"line":360,"address":[1022071],"length":1,"stats":{"Line":1}},{"line":363,"address":[1022372],"length":1,"stats":{"Line":1}},{"line":364,"address":[1022104],"length":1,"stats":{"Line":1}},{"line":365,"address":[2836491],"length":1,"stats":{"Line":1}},{"line":371,"address":[1022448],"length":1,"stats":{"Line":1}},{"line":372,"address":[1713006],"length":1,"stats":{"Line":1}},{"line":373,"address":[2836635,2836714],"length":1,"stats":{"Line":1}},{"line":374,"address":[1553387,1553277,1552929,1552912],"length":1,"stats":{"Line":0}},{"line":376,"address":[1713035],"length":1,"stats":{"Line":1}},{"line":379,"address":[1022608],"length":1,"stats":{"Line":0}},{"line":380,"address":[1022622],"length":1,"stats":{"Line":0}},{"line":381,"address":[1713234,1713312],"length":1,"stats":{"Line":0}},{"line":382,"address":[2837061,2836916],"length":1,"stats":{"Line":0}},{"line":384,"address":[1713383,1713525],"length":1,"stats":{"Line":0}},{"line":385,"address":[1808417,1808400,1808871,1808761],"length":1,"stats":{"Line":0}},{"line":387,"address":[1713298],"length":1,"stats":{"Line":0}},{"line":390,"address":[1713552],"length":1,"stats":{"Line":0}},{"line":391,"address":[1713590,1713738],"length":1,"stats":{"Line":0}},{"line":394,"address":[1713856],"length":1,"stats":{"Line":1}},{"line":395,"address":[1713876],"length":1,"stats":{"Line":1}},{"line":396,"address":[1714065,1714162,1713914],"length":1,"stats":{"Line":3}},{"line":398,"address":[1714180],"length":1,"stats":{"Line":1}}],"covered":77,"coverable":125},{"path":["/","home","cphelper-dev","project-cph","src","lib.rs"],"content":"pub mod config;\npub mod contest;\npub mod docker;\npub mod message;\npub mod fs;\n\npub use contest::{Command, Contest, Handler, TestCase, TestRunner};\npub use docker::Runtime;\npub use message::{Type, messages};\npub use anyhow::{anyhow, Context, Error, Result};\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","main.rs"],"content":"use clap::Parser;\nuse cph::cli::Cli;\n\n#[tokio::main]\nasync fn main() -\u003e cph::error::Result\u003c()\u003e {\n    let cli = Cli::parse();\n    cli.execute().await\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","message","messages.rs"],"content":"use serde::Deserialize;\nuse std::collections::HashMap;\nuse once_cell::sync::Lazy;\nuse super::Type;\n\n#[derive(Debug, Deserialize)]\nstruct MessageCategory {\n    error: HashMap\u003cString, String\u003e,\n    warning: HashMap\u003cString, String\u003e,\n    hint: HashMap\u003cString, String\u003e,\n}\n\n#[derive(Debug, Deserialize)]\nstruct Messages {\n    messages: HashMap\u003cString, MessageCategory\u003e,\n}\n\nstatic MESSAGES: Lazy\u003cMessages\u003e = Lazy::new(|| {\n    let yaml = include_str!(\"messages.yaml\");\n    serde_yaml::from_str(yaml).expect(\"メッセージ定義の読み込みに失敗しました\")\n});\n\n/// メッセージを取得します。\n/// \n/// # Arguments\n/// * `category` - メッセージのカテゴリ（\"fs\", \"docker\", \"contest\", \"common\"）\n/// * `msg_type` - メッセージの種類（Error, Warning, Hint）\n/// * `key` - メッセージのキー\n/// \n/// # Returns\n/// * `Option\u003c\u0026'static str\u003e` - メッセージのテンプレート\n#[must_use]\npub fn get(category: \u0026str, msg_type: Type, key: \u0026str) -\u003e Option\u003c\u0026'static str\u003e {\n    MESSAGES.messages.get(category).and_then(|cat| {\n        match msg_type {\n            Type::Error =\u003e cat.error.get(key),\n            Type::Warning =\u003e cat.warning.get(key),\n            Type::Hint =\u003e cat.hint.get(key),\n        }\n    }).map(String::as_str)\n}\n\n/// メッセージをフォーマットします。\n/// \n/// # Arguments\n/// * `category` - メッセージのカテゴリ\n/// * `msg_type` - メッセージの種類\n/// * `key` - メッセージのキー\n/// * `args` - フォーマット引数\n/// \n/// # Returns\n/// * `String` - フォーマットされたメッセージ\n/// \n/// # Panics\n/// * メッセージが見つからない場合\npub fn format\u003cD: std::fmt::Display\u003e(\n    category: \u0026str,\n    msg_type: Type,\n    key: \u0026str,\n    args: D,\n) -\u003e String {\n    let template = get(category, msg_type, key)\n        .unwrap_or_else(|| panic!(\"メッセージが見つかりません: {category}/{msg_type:?}/{key}\"));\n    template.replace(\"{}\", \u0026args.to_string())\n}\n\n// 利便性のために各カテゴリのモジュールを提供\npub mod fs {\n    use super::{Type, format};\n\n    pub fn error\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"fs\", Type::Error, key, args)\n    }\n\n    pub fn warning\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"fs\", Type::Warning, key, args)\n    }\n\n    pub fn hint\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"fs\", Type::Hint, key, args)\n    }\n}\n\npub mod docker {\n    use super::{Type, format};\n\n    pub fn error\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"docker\", Type::Error, key, args)\n    }\n\n    pub fn warning\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"docker\", Type::Warning, key, args)\n    }\n\n    pub fn hint\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"docker\", Type::Hint, key, args)\n    }\n}\n\npub mod contest {\n    use super::{Type, format};\n\n    pub fn error\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"contest\", Type::Error, key, args)\n    }\n\n    pub fn warning\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"contest\", Type::Warning, key, args)\n    }\n\n    pub fn hint\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"contest\", Type::Hint, key, args)\n    }\n}\n\npub mod common {\n    use super::{Type, format};\n\n    pub fn error\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"common\", Type::Error, key, args)\n    }\n\n    pub fn warning\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"common\", Type::Warning, key, args)\n    }\n\n    pub fn hint\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"common\", Type::Hint, key, args)\n    }\n} ","traces":[{"line":18,"address":[1686576],"length":1,"stats":{"Line":1}},{"line":19,"address":[2018738],"length":1,"stats":{"Line":1}},{"line":20,"address":[2018759],"length":1,"stats":{"Line":1}},{"line":33,"address":[2101440],"length":1,"stats":{"Line":1}},{"line":34,"address":[2101490],"length":1,"stats":{"Line":2}},{"line":35,"address":[3142578],"length":1,"stats":{"Line":1}},{"line":36,"address":[3142622],"length":1,"stats":{"Line":1}},{"line":37,"address":[2018924],"length":1,"stats":{"Line":0}},{"line":38,"address":[3142686],"length":1,"stats":{"Line":0}},{"line":40,"address":[3142709],"length":1,"stats":{"Line":1}},{"line":56,"address":[3143216,3143381,3144720,3145199,3145232,3144375,3145703,3144736,3143744,3143909,3143728,3144272,3143183,3144260,3142720],"length":1,"stats":{"Line":4}},{"line":62,"address":[3145428,3143471,3143854,3144795,3142918,3143999,3143326,3144459,3144934,3144326,3145286,3142779],"length":1,"stats":{"Line":10}},{"line":63,"address":[2022000,2019156,2022007,2021172,2022070,2022197,2022485,2023152,2019703,2023001,2023440,2022864,2023061,2022871,2020231,2023637,2022576,2022295,2023577,2022934,2023349,2022773,2022646,2023447,2023222,2022358,2023510,2022288,2022713,2023159,2020697,2022583,2022137,2022425,2023289,2021666],"length":1,"stats":{"Line":4}},{"line":64,"address":[3143110,3144658,3143565,3143009,3143666,3145025,3144537,3145506,3144077,3144198,3145627,3145126],"length":1,"stats":{"Line":9}},{"line":71,"address":[1740144,1740320,1740240],"length":1,"stats":{"Line":4}},{"line":72,"address":[1225060],"length":1,"stats":{"Line":5}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[2868704,2868608,2868528,2868448],"length":1,"stats":{"Line":0}},{"line":88,"address":[1745156,1744895,1744975,1745068],"length":1,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[3230672],"length":1,"stats":{"Line":0}},{"line":104,"address":[2108060],"length":1,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[2108112],"length":1,"stats":{"Line":0}},{"line":112,"address":[2108143],"length":1,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}}],"covered":14,"coverable":38},{"path":["/","home","cphelper-dev","project-cph","src","message","mod.rs"],"content":"pub mod messages;\n\n/// メッセージの種類\n#[derive(Debug, Clone, Copy)]\npub enum Type {\n    Error,\n    Warning,\n    Hint,\n}\n\npub use messages::{get, format};\npub use messages::{fs, docker, contest, common}; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","oj","mod.rs"],"content":"use crate::error::Result;\nuse std::path::PathBuf;\nuse colored::*;\nuse std::process::Command;\nuse std::env;\nuse users;\nuse std::os::unix::fs::PermissionsExt;\nuse dirs;\nuse crate::config::Config;\n\nconst COOKIE_DIR: \u0026str = \".local/share/online-judge-tools\";\nconst COOKIE_FILE: \u0026str = \"cookie.jar\";\nconst DOCKERFILE_PATH: \u0026str = \"src/oj/Dockerfile\";\nconst DOCKER_IMAGE_NAME: \u0026str = \"oj-container\";\n\n// エラーメッセージ\nconst ERROR_DOCKER_IMAGE_NOT_FOUND: \u0026str = \"Dockerイメージが見つかりません。'cargo run -- atcoder login'を実行してログインしてください。\";\nconst ERROR_DOCKERFILE_NOT_FOUND: \u0026str = \"Dockerfile not found\";\n\npub fn open_in_cursor(url: \u0026str, source_path: Option\u003c\u0026PathBuf\u003e) -\u003e Result\u003c()\u003e {\n    // 問題ページを開く\n    if let Ok(browser) = env::var(\"BROWSER\") {\n        Command::new(\u0026browser)\n            .arg(url)\n            .output()?;\n    } else {\n        println!(\"{}\", format!(\"Note: To automatically open URLs, please set the $BROWSER environment variable.\").yellow());\n    }\n    \n    if let Some(path) = source_path {\n        if let Err(e) = Command::new(\"code\").arg(path.display().to_string()).output() {\n            println!(\"Note: Failed to open in VSCode: {}\", e);\n        }\n\n        if let Err(e) = Command::new(\"cursor\").arg(path.display().to_string()).output() {\n            println!(\"Note: Failed to open in Cursor: {}\", e);\n        }\n    }\n\n    Ok(())\n}\n\n#[derive(Debug, Clone)]\npub struct ProblemInfo {\n    pub url: String,\n    pub source_path: PathBuf,\n    pub problem_id: String,\n}\n\npub struct OJContainer {\n    workspace_path: PathBuf,\n    site_name: String,\n    config: Config,\n}\n\nimpl OJContainer {\n    pub fn new(workspace_path: PathBuf, site_name: String) -\u003e Result\u003cSelf\u003e {\n        let config = Config::load()\n            .map_err(|e| format!(\"設定の読み込みに失敗しました: {}\", e))?;\n        Ok(Self { workspace_path, site_name, config })\n    }\n\n    fn get_dockerfile_path() -\u003e PathBuf {\n        PathBuf::from(DOCKERFILE_PATH)\n    }\n\n    fn check_dockerfile_exists() -\u003e Result\u003c()\u003e {\n        if !Self::get_dockerfile_path().exists() {\n            println!(\"{}\", \"Error: Dockerfile not found\".red());\n            return Err(ERROR_DOCKERFILE_NOT_FOUND.into());\n        }\n        Ok(())\n    }\n\n    fn get_cookie_paths() -\u003e Result\u003c(PathBuf, PathBuf)\u003e {\n        let home_dir = dirs::home_dir().ok_or(\"Failed to get home directory\")?;\n        let cookie_dir = home_dir.join(COOKIE_DIR);\n        let cookie_path = cookie_dir.join(COOKIE_FILE);\n        Ok((cookie_dir, cookie_path))\n    }\n\n    fn setup_cookie_file(cookie_dir: \u0026PathBuf, cookie_path: \u0026PathBuf) -\u003e Result\u003c()\u003e {\n        std::fs::create_dir_all(cookie_dir)?;\n        std::fs::write(cookie_path, \"#LWP-Cookies-2.0\\n\")?;\n        std::fs::set_permissions(cookie_path, std::fs::Permissions::from_mode(0o600))?;\n        Ok(())\n    }\n\n    async fn run_oj_command(\u0026self, args: \u0026[\u0026str], mount_workspace: bool) -\u003e Result\u003c()\u003e {\n        let (_cookie_dir, cookie_path) = Self::get_cookie_paths()?;\n        let mut command = Command::new(\"docker\");\n\n        // 基本的なdockerコマンドを構築\n        let is_login = args.get(0).map_or(false, |\u0026cmd| cmd == \"login\");\n        if is_login {\n            command.args([\"run\", \"--rm\", \"-it\"]);\n        } else {\n            command.args([\"run\", \"--rm\"]);\n        }\n        \n        // ユーザーIDとグループIDを設定\n        let uid = users::get_current_uid();\n        let gid = users::get_current_gid();\n        command.args([\"-u\", \u0026format!(\"{}:{}\", uid, gid)]);\n\n        // 環境変数を設定\n        command.args([\"-e\", \u0026format!(\"HOME=/home/oj-user\")]);\n\n        // cookieファイルをコンテナ内の期待されるパスにマウント\n        command.args([\"-v\", \u0026format!(\"{}:/home/oj-user/{}/{}\", cookie_path.display(), COOKIE_DIR, COOKIE_FILE)]);\n\n        // ワークスペースのマウントが必要な場合\n        if mount_workspace {\n            let workspace_mount = format!(\"{}:/workspace\", self.workspace_path.display());\n            command.args([\"-v\", \u0026workspace_mount, \"-w\", \"/workspace\"]);\n        }\n\n        // OJコマンドを実行\n        let status = command\n            .args([DOCKER_IMAGE_NAME, \"oj\"])\n            .args(args)\n            .status()?;\n\n        if !status.success() {\n            return Err(format!(\"Command failed with status: {}\", status).into());\n        }\n\n        Ok(())\n    }\n\n    async fn check_image_exists(\u0026self) -\u003e Result\u003c()\u003e {\n        let output = Command::new(\"docker\")\n            .args([\"images\", \"-q\", DOCKER_IMAGE_NAME])\n            .output()?;\n\n        if output.stdout.is_empty() {\n            return Err(ERROR_DOCKER_IMAGE_NOT_FOUND.into());\n        }\n\n        Ok(())\n    }\n\n    pub async fn ensure_image(\u0026self) -\u003e Result\u003c()\u003e {\n        Self::check_dockerfile_exists()?;\n        println!(\"{}\", \"Building OJ container image...\".cyan());\n\n        let status = Command::new(\"docker\")\n            .args([\"build\", \"-t\", DOCKER_IMAGE_NAME, \"-f\", DOCKERFILE_PATH, \"src/oj\"])\n            .status()?;\n\n        if !status.success() {\n            return Err(\"Failed to build docker image\".into());\n        }\n\n        Ok(())\n    }\n\n    pub async fn login(\u0026self) -\u003e Result\u003c()\u003e {\n        // サイトのURLを取得\n        let url = self.config.get::\u003cString\u003e(\u0026format!(\"sites.{}.url\", self.site_name))?;\n        let name = self.config.get::\u003cString\u003e(\u0026format!(\"sites.{}.name\", self.site_name))?;\n\n        println!(\"{}\", format!(\"Logging in to {}...\", name).cyan());\n\n        // cookieファイルをリセット\n        println!(\"{}\", \"Resetting cookie file...\".cyan());\n        let (cookie_dir, cookie_path) = Self::get_cookie_paths()?;\n\n        // cookieファイルが存在する場合は削除\n        if cookie_path.exists() {\n            std::fs::remove_file(\u0026cookie_path)?;\n        }\n\n        // cookieファイルを作成\n        Self::setup_cookie_file(\u0026cookie_dir, \u0026cookie_path)?;\n\n        // Dockerイメージを再ビルド\n        println!(\"{}\", \"Rebuilding Docker image...\".cyan());\n        Self::check_dockerfile_exists()?;\n\n        let status = Command::new(\"docker\")\n            .args([\"build\", \"--no-cache\", \"-t\", DOCKER_IMAGE_NAME, \"-f\", DOCKERFILE_PATH, \"src/oj\"])\n            .status()?;\n\n        if !status.success() {\n            return Err(\"Failed to build docker image\".into());\n        }\n\n        // ログインを実行\n        self.run_oj_command(\u0026[\"login\", \u0026url], false).await?;\n\n        println!(\"{}\", format!(\"Successfully logged in to {}\", name).green());\n        Ok(())\n    }\n\n    pub async fn open(\u0026self, problem: ProblemInfo) -\u003e Result\u003c()\u003e {\n        println!(\"{}\", format!(\"Opening problem URL: {}\", problem.url).cyan());\n\n        // ブラウザ設定を確認\n        let browser = self.config.get::\u003cString\u003e(\"system.browser\")\n            .or_else(|_| env::var(\"BROWSER\"))\n            .unwrap_or_else(|_| {\n                println!(\"{}\", format!(\"Note: To automatically open URLs, please set the $BROWSER environment variable or configure system.browser in config.yaml\").yellow());\n                String::new()\n            });\n\n        if !browser.is_empty() {\n            if let Err(e) = Command::new(\u0026browser).arg(\u0026problem.url).output() {\n                println!(\"Note: Failed to open in browser: {}\", e);\n            }\n        }\n\n        // エディタ設定を取得\n        let editors = self.config.get::\u003cVec\u003cString\u003e\u003e(\"system.editors\")\n            .unwrap_or_else(|_| vec![\"code\".to_string(), \"cursor\".to_string()]);\n\n        // 各エディタで開く\n        for editor in editors {\n            if let Some(source_path) = problem.source_path.to_str() {\n                if let Err(e) = Command::new(\u0026editor).arg(source_path).output() {\n                    println!(\"Note: Failed to open in {}: {}\", editor, e);\n                }\n            }\n        }\n\n        // Dockerイメージの存在確認\n        self.check_image_exists().await?;\n\n        // 問題ディレクトリのパスを取得\n        let problem_dir = problem.source_path.parent()\n            .ok_or_else(|| \"Invalid problem path\".to_string())?;\n\n        // 問題ディレクトリを基準にコマンドを実行\n        let relative_problem_dir = problem_dir.strip_prefix(\u0026self.workspace_path)\n            .map_err(|_| \"Failed to get relative problem path\")?;\n\n        // テストディレクトリを設定から取得\n        let test_dir = self.config.get::\u003cString\u003e(\"system.test.directory\")\n            .unwrap_or_else(|_| \"test\".to_string());\n\n        self.run_oj_command(\u0026[\n            \"download\",\n            \"-d\", \u0026format!(\"{}/{}\", relative_problem_dir.display(), test_dir),\n            \u0026problem.url,\n        ], true).await?;\n\n        println!(\"{}\", \"Problem setup completed\".green());\n        Ok(())\n    }\n\n    pub async fn submit(\u0026self, problem: \u0026ProblemInfo, language_id: \u0026str) -\u003e Result\u003c()\u003e {\n        // Dockerイメージの存在確認\n        self.check_image_exists().await?;\n\n        // 提出コマンドを実行\n        println!(\"{}\", format!(\"Submitting solution for problem {}...\", problem.problem_id).cyan());\n\n        self.run_oj_command(\u0026[\n            \"submit\",\n            \"-l\", language_id,\n            \"-y\",  // 確認をスキップ\n            \u0026problem.url,\n            \u0026problem.source_path.to_string_lossy(),\n        ], true).await?;\n\n        println!(\"{}\", \"Solution submitted successfully\".green());\n        Ok(())\n    }\n}\n\npub fn has_test_cases(dir: \u0026PathBuf) -\u003e Result\u003cbool\u003e {\n    if !dir.exists() {\n        return Ok(false);\n    }\n\n    let entries = std::fs::read_dir(dir)?;\n    let mut has_input = false;\n    let mut has_output = false;\n\n    for entry in entries {\n        let entry = entry?;\n        let path = entry.path();\n        if let Some(extension) = path.extension() {\n            if extension == \"in\" {\n                has_input = true;\n            } else if extension == \"out\" {\n                has_output = true;\n            }\n        }\n    }\n\n    Ok(has_input \u0026\u0026 has_output)\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","contest","mod.rs"],"content":"#[cfg(test)]\nmod parse; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","contest","parse","config.rs"],"content":"use anyhow::Result;\nuse cph::contest::parse::Config;\n\n#[test]\nfn test_config_loading() -\u003e Result\u003c()\u003e {\n    let config = Config::from_file(\"tests/contest/parse/test_commands.yaml\")?;\n    \n    // サイトのエイリアス解決をテスト\n    assert_eq!(\n        config.resolve_alias(\"at\"),\n        Some((\"site\".to_string(), \"atcoder\".to_string()))\n    );\n\n    // 言語のエイリアス解決をテスト\n    assert_eq!(\n        config.resolve_alias(\"rs\"),\n        Some((\"language\".to_string(), \"rust\".to_string()))\n    );\n\n    // 存在しないエイリアスのテスト\n    assert_eq!(config.resolve_alias(\"nonexistent\"), None);\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","contest","parse","mod.rs"],"content":"#[cfg(test)]\nmod config;\n#[cfg(test)]\nmod parser; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","contest","parse","parser.rs"],"content":"use anyhow::Result;\nuse cph::contest::model::Command;\nuse cph::contest::parse::{Parser, Config};\n\nfn create_test_parser() -\u003e Parser {\n    let config = Config::from_file(\"tests/contest/parse/test_commands.yaml\").unwrap();\n    Parser::with_config(config)\n}\n\n#[test]\nfn test_basic_parsing() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n    \n    // 基本的なパースのテスト\n    let context = parser.parse(\"abc123 a\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: None,\n        }\n    );\n\n    // サイトとproblem_idのテスト\n    let context = parser.parse(\"atcoder abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    // 全パラメータのテスト\n    let context = parser.parse(\"atcoder abc123 a rust\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_alias_resolution() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n    \n    // サイトのエイリアス解決\n    let context = parser.parse(\"at abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    // 言語のエイリアス解決\n    let context = parser.parse(\"abc123 a rs\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_complex_patterns() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // 複数の問題ID候補がある場合\n    let context = parser.parse(\"abc123 a b c\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),  // 最初の値を問題IDとして解釈\n            language: None,\n        }\n    );\n\n    // 順序が異なる場合\n    let context = parser.parse(\"rs abc123 atcoder a\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_edge_cases() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // 最小限の入力\n    let context = parser.parse(\"abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    // サイトのみの入力\n    let context = parser.parse(\"atcoder\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: None,\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_error_cases() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n    \n    // 空入力のテスト\n    assert!(parser.parse(\"\").is_err());\n    assert!(parser.parse(\"   \").is_err());\n\n    // 余分な空白を含む入力\n    let context = parser.parse(\"  abc123   a  \")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_priority_handling() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // サイトと1つのトークン\n    let context = parser.parse(\"atcoder abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_invalid_config() -\u003e Result\u003c()\u003e {\n    // 無効な設定ファイルの読み込み\n    let config = Config::from_file(\"tests/contest/parse/invalid_commands.yaml\")?;\n    \n    // 空白を含むエイリアスが無視されていることを確認\n    assert!(!config.resolve_alias(\"at test\").is_some());\n    assert!(!config.resolve_alias(\"at coder\").is_some());\n    assert!(!config.resolve_alias(\"cf test\").is_some());\n    assert!(!config.resolve_alias(\"code forces\").is_some());\n    assert!(!config.resolve_alias(\"rust 2021\").is_some());\n    assert!(!config.resolve_alias(\"rs test\").is_some());\n\n    // 存在しない設定ファイル\n    let result = Config::from_file(\"nonexistent.yaml\");\n    assert!(result.is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_special_characters() -\u003e Result\u003c()\u003e {\n    let config = Config::from_file(\"tests/contest/parse/special_commands.yaml\")?;\n    let parser = Parser::with_config(config);\n\n    // ハイフンを含むエイリアス\n    let context = parser.parse(\"at-test abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder-test\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    // 空白を含むエイリアス\n    let context = parser.parse(\"at test abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"at\".to_string()),\n            problem_id: Some(\"test\".to_string()),\n            language: None,\n        }\n    );\n\n    // Unicode文字\n    let context = parser.parse(\"ユ abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"ユーコーダー\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_performance() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n    \n    // 長い入力のテスト\n    let long_input = \"atcoder abc123 a rust \".repeat(100);\n    let context = parser.parse(\u0026long_input)?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    // 多数のトークンを含む入力\n    let many_tokens = \"abc123 a b c d e f g h i j k l m n o p\".to_string();\n    let context = parser.parse(\u0026many_tokens)?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_whitespace_handling() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // タブを含む入力\n    let context = parser.parse(\"atcoder\\tabc123\\ta\\trust\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    // 複数の連続した空白\n    let context = parser.parse(\"atcoder    abc123  a    rust\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    // 前後の空白\n    let context = parser.parse(\"   atcoder abc123 a rust   \")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_problem_id_priority() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // 一のトークンはcontest_idとして解釈\n    let context = parser.parse(\"at a\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"a\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_token_interpretation() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // 単一のトークンはcontest_idとして解釈\n    let context = parser.parse(\"aaa\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"aaa\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","backup","mod.rs"],"content":"use std::fs::File;\nuse std::io::{Write, Read};\nuse tempfile::TempDir;\nuse anyhow::Result;\nuse tokio;\n\nuse cph::fs::backup::Manager;\n\n#[tokio::test]\nasync fn test_backup_manager_new() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let backup_dir = temp_dir.path().join(\"backup\");\n\n    // バックアップディレクトリが存在しない場合\n    assert!(!backup_dir.exists());\n    let _manager = Manager::new(\u0026backup_dir).await?;\n    assert!(backup_dir.exists());\n\n    // バックアップディレクトリが既に存在する場合\n    let _manager = Manager::new(\u0026backup_dir).await?;\n    assert!(backup_dir.exists());\n\n    Ok(())\n}\n\n#[tokio::test]\nasync fn test_backup_and_restore() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let backup_dir = temp_dir.path().join(\"backup\");\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // バックアップマネージャを作成\n    let manager = Manager::new(\u0026backup_dir).await?;\n\n    // テストファイルを作成\n    {\n        let mut file = File::create(\u0026test_file)?;\n        write!(file, \"{}\", test_content)?;\n    }\n\n    // バックアップを作成\n    manager.backup(\u0026test_file).await?;\n\n    // バックアップファイルの一覧を取得\n    let backups = manager.list_backups(\"test.txt\").await?;\n    assert_eq!(backups.len(), 1);\n\n    // 元のファイルを変更\n    {\n        let mut file = File::create(\u0026test_file)?;\n        write!(file, \"Modified content\")?;\n    }\n\n    // バックアップから復元\n    manager.restore(\u0026test_file, \u0026backups[0]).await?;\n\n    // 復元されたファイルの内容を確認\n    let mut content = String::new();\n    File::open(\u0026test_file)?.read_to_string(\u0026mut content)?;\n    assert_eq!(content, test_content);\n\n    Ok(())\n}\n\n#[tokio::test]\nasync fn test_multiple_backups() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let backup_dir = temp_dir.path().join(\"backup\");\n    let test_file = temp_dir.path().join(\"test.txt\");\n\n    // バックアップマネージャを作成\n    let manager = Manager::new(\u0026backup_dir).await?;\n\n    // 複数のバックアップを作成\n    for i in 1..=3 {\n        {\n            let mut file = File::create(\u0026test_file)?;\n            write!(file, \"Content {}\", i)?;\n        }\n        tokio::time::sleep(tokio::time::Duration::from_secs(1)).await;\n        manager.backup(\u0026test_file).await?;\n    }\n\n    // バックアップファイルの一覧を取得\n    let mut backups = manager.list_backups(\"test.txt\").await?;\n    assert_eq!(backups.len(), 3);\n\n    // バックアップファイルを時系列順にソート\n    backups.sort();\n\n    // 最新のバックアップから復元\n    manager.restore(\u0026test_file, \u0026backups[2]).await?;\n\n    // 復元されたファイルの内容を確認\n    let mut content = String::new();\n    File::open(\u0026test_file)?.read_to_string(\u0026mut content)?;\n    assert_eq!(content, \"Content 3\");\n\n    Ok(())\n}\n\n#[tokio::test]\nasync fn test_backup_error_cases() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let backup_dir = temp_dir.path().join(\"backup\");\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let non_existent_file = temp_dir.path().join(\"non_existent.txt\");\n\n    // バックアップマネージャを作成\n    let manager = Manager::new(\u0026backup_dir).await?;\n\n    // 存在しないファイルのバックアップ\n    assert!(manager.backup(\u0026non_existent_file).await.is_ok());\n\n    // 存在しないバックアップファイルからの復元\n    assert!(manager.restore(\u0026test_file, \"non_existent.bak\").await.is_err());\n\n    // 存在しないファイルのバックアップ一覧\n    let backups = manager.list_backups(\"non_existent.txt\").await?;\n    assert!(backups.is_empty());\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","manager.rs"],"content":"use tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::Manager;\n\n#[test]\nfn test_manager_new() {\n    let temp_dir = TempDir::new().unwrap();\n    let manager = Manager::new(temp_dir.path());\n    assert_eq!(manager.root_path(), temp_dir.path());\n}\n\n#[test]\nfn test_file_operations() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let manager = Manager::new(temp_dir.path());\n\n    // ファイルの存在確認（存在しない場合）\n    assert!(!manager.exists(\"test.txt\")?);\n\n    // ファイルの書き込み\n    let content = \"Hello, World!\";\n    let manager = manager.write_file(\"test.txt\", content)?;\n    assert!(manager.exists(\"test.txt\")?);\n\n    // ファイルの読み込み\n    assert_eq!(manager.read_file(\"test.txt\")?, content);\n\n    // ファイルの削除\n    let manager = manager.delete_file(\"test.txt\")?;\n    assert!(!manager.exists(\"test.txt\")?);\n\n    Ok(())\n}\n\n#[test]\nfn test_directory_operations() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let manager = Manager::new(temp_dir.path());\n\n    // ディレクトリの存在確認（存在しない場合）\n    assert!(!manager.exists(\"test_dir\")?);\n\n    // ディレクトリの作成\n    let manager = manager.create_dir(\"test_dir\")?;\n    assert!(manager.exists(\"test_dir\")?);\n\n    // ネストしたディレクトリの作成\n    let manager = manager.create_dir(\"test_dir/nested/deep\")?;\n    assert!(manager.exists(\"test_dir/nested/deep\")?);\n\n    Ok(())\n}\n\n#[test]\nfn test_transaction_operations() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let manager = Manager::new(temp_dir.path());\n\n    // トランザクション内でのファイル操作\n    let manager = manager\n        .begin_transaction()?\n        .write_file(\"test1.txt\", \"Content 1\")?\n        .write_file(\"test2.txt\", \"Content 2\")?\n        .commit()?;\n\n    assert!(manager.exists(\"test1.txt\")?);\n    assert!(manager.exists(\"test2.txt\")?);\n    assert_eq!(manager.read_file(\"test1.txt\")?, \"Content 1\");\n    assert_eq!(manager.read_file(\"test2.txt\")?, \"Content 2\");\n\n    // トランザクションのロールバック\n    let manager = manager\n        .begin_transaction()?\n        .write_file(\"test3.txt\", \"Content 3\")?\n        .rollback()?;\n\n    assert!(!manager.exists(\"test3.txt\")?);\n\n    Ok(())\n}\n\n#[test]\nfn test_error_cases() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let manager = Manager::new(temp_dir.path());\n\n    // 存在しないファイルの読み込み\n    assert!(manager.clone().read_file(\"non_existent.txt\").is_err());\n\n    // 存在しないファイルの削除\n    assert!(manager.clone().delete_file(\"non_existent.txt\").is_err());\n\n    // パストラバーサルの試行\n    assert!(manager.clone().read_file(\"../test.txt\").is_err());\n    assert!(manager.clone().write_file(\"../test.txt\", \"content\").is_err());\n\n    // 絶対パスの試行\n    assert!(manager.clone().read_file(\"/test.txt\").is_err());\n    assert!(manager.write_file(\"/test.txt\", \"content\").is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_path_normalization() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let manager = Manager::new(temp_dir.path());\n\n    // 通常のパス\n    let manager = manager.write_file(\"test.txt\", \"content\")?;\n    assert!(manager.exists(\"test.txt\")?);\n\n    // カレントディレクトリを含むパス\n    let manager = manager.write_file(\"./test2.txt\", \"content\")?;\n    assert!(manager.exists(\"test2.txt\")?);\n\n    // 重複したスラッシュを含むパス\n    let manager = manager.write_file(\"dir//test3.txt\", \"content\")?;\n    assert!(manager.exists(\"dir/test3.txt\")?);\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","mod.rs"],"content":"pub mod backup;\npub mod operations;\npub mod manager;\npub mod path;\npub mod transaction; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","check.rs"],"content":"use std::fs::{self, File};\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::operations::check;\n\n#[test]\nfn test_exists() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n\n    // ファイルが存在しない場合\n    assert!(!check::exists(\u0026test_file));\n\n    // ファイルを作成\n    File::create(\u0026test_file)?;\n    assert!(check::exists(\u0026test_file));\n\n    // ディレクトリを作成\n    fs::create_dir(\u0026test_dir)?;\n    assert!(check::exists(\u0026test_dir));\n\n    Ok(())\n}\n\n#[test]\nfn test_is_file() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n\n    // ファイルを作成\n    File::create(\u0026test_file)?;\n    fs::create_dir(\u0026test_dir)?;\n\n    assert!(check::is_file(\u0026test_file));\n    assert!(!check::is_file(\u0026test_dir));\n    assert!(!check::is_file(temp_dir.path().join(\"non_existent.txt\")));\n\n    Ok(())\n}\n\n#[test]\nfn test_is_directory() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n\n    // ファイルとディレクトリを作成\n    File::create(\u0026test_file)?;\n    fs::create_dir(\u0026test_dir)?;\n\n    assert!(check::is_directory(\u0026test_dir));\n    assert!(!check::is_directory(\u0026test_file));\n    assert!(!check::is_directory(temp_dir.path().join(\"non_existent_dir\")));\n\n    Ok(())\n}\n\n#[test]\nfn test_verify_basic_permissions() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n\n    // ファイルが存在しない場合\n    assert!(check::verify_basic_permissions(\u0026test_file, false).is_err());\n\n    // ファイルを作成\n    File::create(\u0026test_file)?;\n\n    // 読み取り権限のみの確認\n    assert!(check::verify_basic_permissions(\u0026test_file, false).is_ok());\n\n    // 書き込み権限の確認（読み取り専用でない場合はエラー）\n    {\n        let metadata = fs::metadata(\u0026test_file)?;\n        let mut perms = metadata.permissions();\n        perms.set_readonly(true);\n        fs::set_permissions(\u0026test_file, perms)?;\n        assert!(check::verify_basic_permissions(\u0026test_file, true).is_ok());\n    }\n\n    {\n        let metadata = fs::metadata(\u0026test_file)?;\n        let mut perms = metadata.permissions();\n        perms.set_readonly(false);\n        fs::set_permissions(\u0026test_file, perms)?;\n        assert!(check::verify_basic_permissions(\u0026test_file, true).is_err());\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_verify_permissions() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n\n    // ファイルが存在しない場合\n    assert!(check::verify_permissions(\u0026test_file, false).is_err());\n\n    // ファイルを作成\n    File::create(\u0026test_file)?;\n\n    // 読み取り権限のみの確認\n    assert!(check::verify_permissions(\u0026test_file, false).is_ok());\n\n    // 書き込み権限の確認\n    assert!(check::verify_permissions(\u0026test_file, true).is_ok());\n\n    Ok(())\n}\n\n#[cfg(unix)]\nmod unix_tests {\n    use super::*;\n    use std::os::unix::fs::PermissionsExt;\n\n    #[test]\n    fn test_unix_permissions() -\u003e Result\u003c()\u003e {\n        let temp_dir = TempDir::new()?;\n        let test_file = temp_dir.path().join(\"test.txt\");\n\n        // ファイルを作成\n        File::create(\u0026test_file)?;\n\n        // 読み取り権限を削除\n        let metadata = fs::metadata(\u0026test_file)?;\n        let mut perms = metadata.permissions();\n        perms.set_mode(0o222); // 書き込みのみ\n        fs::set_permissions(\u0026test_file, perms)?;\n\n        assert!(check::verify_permissions(\u0026test_file, false).is_err());\n\n        // 書き込み権限を削除\n        let metadata = fs::metadata(\u0026test_file)?;\n        let mut perms = metadata.permissions();\n        perms.set_mode(0o444); // 読み取りのみ\n        fs::set_permissions(\u0026test_file, perms)?;\n\n        assert!(check::verify_permissions(\u0026test_file, true).is_err());\n\n        Ok(())\n    }\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","delete.rs"],"content":"use std::fs::{self, File};\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::operations::{delete, check_exists};\n\n#[test]\nfn test_remove_file() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n\n    // ファイルが存在しない場合\n    assert!(delete::remove_file(\u0026test_file).is_err());\n\n    // ファイルを作成して削除\n    File::create(\u0026test_file)?;\n    assert!(check_exists(\u0026test_file));\n    assert!(delete::remove_file(\u0026test_file).is_ok());\n    assert!(!check_exists(\u0026test_file));\n\n    // ディレクトリを削除しようとした場合\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    fs::create_dir(\u0026test_dir)?;\n    assert!(delete::remove_file(\u0026test_dir).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_remove_dir() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    let nested_dir = test_dir.join(\"nested\");\n    let nested_file = nested_dir.join(\"test.txt\");\n\n    // ディレクトリが存在しない場合\n    assert!(delete::remove_dir(\u0026test_dir).is_err());\n\n    // 空のディレクトリを作成して削除\n    fs::create_dir(\u0026test_dir)?;\n    assert!(check_exists(\u0026test_dir));\n    assert!(delete::remove_dir(\u0026test_dir).is_ok());\n    assert!(!check_exists(\u0026test_dir));\n\n    // ネストしたディレクトリとファイルを含むディレクトリを削除\n    fs::create_dir_all(\u0026nested_dir)?;\n    File::create(\u0026nested_file)?;\n    assert!(check_exists(\u0026nested_file));\n    assert!(delete::remove_dir(\u0026test_dir).is_ok());\n    assert!(!check_exists(\u0026test_dir));\n    assert!(!check_exists(\u0026nested_dir));\n    assert!(!check_exists(\u0026nested_file));\n\n    // ファイルを削除しようとした場合\n    let test_file = temp_dir.path().join(\"test.txt\");\n    File::create(\u0026test_file)?;\n    assert!(delete::remove_dir(\u0026test_file).is_err());\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","mod.rs"],"content":"mod check;\nmod delete;\nmod read;\nmod write;\nmod validate; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","read.rs"],"content":"use std::fs::{self, File};\nuse std::io::Write;\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::operations::read;\n\n#[test]\nfn test_load_file_as_string() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // ファイルが存在しない場合\n    assert!(read::load_file_as_string(\u0026test_file).is_err());\n\n    // 通常のテキストファイル\n    {\n        let mut file = File::create(\u0026test_file)?;\n        write!(file, \"{}\", test_content)?;\n    }\n    let content = read::load_file_as_string(\u0026test_file)?;\n    assert_eq!(content, test_content);\n\n    // ディレクトリを読み込もうとした場合\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    fs::create_dir(\u0026test_dir)?;\n    assert!(read::load_file_as_string(\u0026test_dir).is_err());\n\n    // 非UTF-8文字列を含むファイル\n    {\n        let mut file = File::create(\u0026test_file)?;\n        file.write_all(\u0026[0xFF, 0xFF, 0xFF])?;\n    }\n    assert!(read::load_file_as_string(\u0026test_file).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_load_file_as_bytes() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.bin\");\n    let test_bytes = vec![1, 2, 3, 4, 5];\n\n    // ファイルが存在しない場合\n    assert!(read::load_file_as_bytes(\u0026test_file).is_err());\n\n    // バイナリファイル\n    {\n        let mut file = File::create(\u0026test_file)?;\n        file.write_all(\u0026test_bytes)?;\n    }\n    let content = read::load_file_as_bytes(\u0026test_file)?;\n    assert_eq!(content, test_bytes);\n\n    // ディレクトリを読み込もうとした場合\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    fs::create_dir(\u0026test_dir)?;\n    assert!(read::load_file_as_bytes(\u0026test_dir).is_err());\n\n    // 大きなファイル\n    {\n        let mut file = File::create(\u0026test_file)?;\n        let large_bytes = vec![0; 1024 * 1024]; // 1MB\n        file.write_all(\u0026large_bytes)?;\n    }\n    let content = read::load_file_as_bytes(\u0026test_file)?;\n    assert_eq!(content.len(), 1024 * 1024);\n\n    Ok(())\n}\n\n#[test]\nfn test_get_metadata() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // ファイルが存在しない場合\n    assert!(read::get_metadata(\u0026test_file).is_err());\n\n    // ファイルのメタデータを取得\n    {\n        let mut file = File::create(\u0026test_file)?;\n        write!(file, \"{}\", test_content)?;\n    }\n    let metadata = read::get_metadata(\u0026test_file)?;\n    assert!(metadata.is_file());\n    assert_eq!(metadata.len(), test_content.len() as u64);\n\n    // ディレクトリのメタデータを取得しようとした場合\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    fs::create_dir(\u0026test_dir)?;\n    assert!(read::get_metadata(\u0026test_dir).is_err());\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","validate.rs"],"content":"use std::fs::{self, File};\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::operations::validate;\n\n#[test]\nfn test_exists() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    let non_existent = temp_dir.path().join(\"non_existent\");\n\n    // 存在しないパス\n    assert!(validate::exists(\u0026non_existent).is_err());\n\n    // ファイルを作成して検証\n    File::create(\u0026test_file)?;\n    assert!(validate::exists(\u0026test_file).is_ok());\n\n    // ディレクトリを作成して検証\n    fs::create_dir(\u0026test_dir)?;\n    assert!(validate::exists(\u0026test_dir).is_ok());\n\n    Ok(())\n}\n\n#[test]\nfn test_is_file() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    let non_existent = temp_dir.path().join(\"non_existent\");\n\n    // 存在しないパス\n    assert!(validate::is_file(\u0026non_existent).is_err());\n\n    // ファイルを作成して検証\n    File::create(\u0026test_file)?;\n    assert!(validate::is_file(\u0026test_file).is_ok());\n\n    // ディレクトリに対して検証\n    fs::create_dir(\u0026test_dir)?;\n    assert!(validate::is_file(\u0026test_dir).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_is_dir() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    let non_existent = temp_dir.path().join(\"non_existent\");\n\n    // 存在しないパス\n    assert!(validate::is_dir(\u0026non_existent).is_err());\n\n    // ディレクトリを作成して検証\n    fs::create_dir(\u0026test_dir)?;\n    assert!(validate::is_dir(\u0026test_dir).is_ok());\n\n    // ファイルに対して検証\n    File::create(\u0026test_file)?;\n    assert!(validate::is_dir(\u0026test_file).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_parent_exists() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let nested_file = temp_dir.path().join(\"nested/test.txt\");\n    let nested_dir = temp_dir.path().join(\"nested\");\n\n    // 親ディレクトリが存在する場合\n    assert!(validate::parent_exists(\u0026test_file).is_ok());\n\n    // 親ディレクトリが存在しない場合\n    assert!(validate::parent_exists(\u0026nested_file).is_err());\n\n    // 親ディレクトリを作成\n    fs::create_dir(\u0026nested_dir)?;\n    assert!(validate::parent_exists(\u0026nested_file).is_ok());\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","write.rs"],"content":"use std::fs::File;\nuse std::io::Read;\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::operations::{write, check_exists, check_is_file, check_is_directory};\n\n#[test]\nfn test_ensure_directory() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    let nested_dir = test_dir.join(\"nested/deep/path\");\n\n    // ディレクトリが存在しない場合\n    assert!(!check_exists(\u0026test_dir));\n    write::ensure_directory(\u0026test_dir)?;\n    assert!(check_exists(\u0026test_dir));\n    assert!(check_is_directory(\u0026test_dir));\n\n    // ネストしたディレクトリの作成\n    assert!(!check_exists(\u0026nested_dir));\n    write::ensure_directory(\u0026nested_dir)?;\n    assert!(check_exists(\u0026nested_dir));\n    assert!(check_is_directory(\u0026nested_dir));\n\n    // 既に存在するディレクトリ\n    write::ensure_directory(\u0026test_dir)?;\n    assert!(check_exists(\u0026test_dir));\n    assert!(check_is_directory(\u0026test_dir));\n\n    Ok(())\n}\n\n#[test]\nfn test_ensure_file() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let nested_dir = temp_dir.path().join(\"nested/dir\");\n    let nested_file = nested_dir.join(\"test.txt\");\n\n    // ファイルが存在しない場合\n    assert!(!check_exists(\u0026test_file));\n    write::ensure_file(\u0026test_file)?;\n    assert!(check_exists(\u0026test_file));\n    assert!(check_is_file(\u0026test_file));\n\n    // 親ディレクトリを作成してからファイルを作成\n    write::ensure_directory(\u0026nested_dir)?;\n    assert!(!check_exists(\u0026nested_file));\n    write::ensure_file(\u0026nested_file)?;\n    assert!(check_exists(\u0026nested_file));\n    assert!(check_is_file(\u0026nested_file));\n\n    // 既に存在するファイル\n    write::ensure_file(\u0026test_file)?;\n    assert!(check_exists(\u0026test_file));\n    assert!(check_is_file(\u0026test_file));\n\n    Ok(())\n}\n\n#[test]\nfn test_save_to_file() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let nested_file = temp_dir.path().join(\"nested/dir/test.txt\");\n    let test_content = \"Hello, World!\";\n    let binary_content = vec![1, 2, 3, 4, 5];\n\n    // テキストファイルの書き込み\n    write::save_to_file(\u0026test_file, test_content)?;\n    assert!(check_exists(\u0026test_file));\n    let mut content = String::new();\n    File::open(\u0026test_file)?.read_to_string(\u0026mut content)?;\n    assert_eq!(content, test_content);\n\n    // 親ディレクトリが存在しないファイルへの書き込み\n    write::save_to_file(\u0026nested_file, test_content)?;\n    assert!(check_exists(\u0026nested_file));\n    let mut content = String::new();\n    File::open(\u0026nested_file)?.read_to_string(\u0026mut content)?;\n    assert_eq!(content, test_content);\n\n    // バイナリデータの書き込み\n    write::save_to_file(\u0026test_file, \u0026binary_content)?;\n    let mut content = Vec::new();\n    File::open(\u0026test_file)?.read_to_end(\u0026mut content)?;\n    assert_eq!(content, binary_content);\n\n    // 既存ファイルの上書き\n    let new_content = \"New content\";\n    write::save_to_file(\u0026test_file, new_content)?;\n    let mut content = String::new();\n    File::open(\u0026test_file)?.read_to_string(\u0026mut content)?;\n    assert_eq!(content, new_content);\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","path","mod.rs"],"content":"use tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::path::{self, ValidationLevel, Validator};\n\n#[test]\nfn test_validator_default() {\n    let validator = Validator::default();\n    assert!(validator.validate(\"test.txt\").is_ok());\n    assert!(validator.validate(\"a\".repeat(256)).is_err());\n}\n\n#[test]\nfn test_validator_new() {\n    let validator = Validator::new(ValidationLevel::Strict, 1024, 128);\n    assert!(validator.validate(\"test.txt\").is_ok());\n    assert!(validator.validate(\"a\".repeat(129)).is_err());\n}\n\n#[test]\nfn test_validate() -\u003e Result\u003c()\u003e {\n    let validator = Validator::default();\n\n    // 有効なパス\n    assert!(validator.validate(\"test.txt\").is_ok());\n    assert!(validator.validate(\"dir/test.txt\").is_ok());\n    assert!(validator.validate(\"dir/subdir/test.txt\").is_ok());\n\n    // 無効なパス（パストラバーサル）\n    assert!(validator.validate(\"../test.txt\").is_err());\n    assert!(validator.validate(\"dir/../test.txt\").is_err());\n    assert!(validator.validate(\"dir/../../test.txt\").is_err());\n\n    // 無効なパス（絶対パス）\n    assert!(validator.validate(\"/test.txt\").is_err());\n    assert!(validator.validate(\"/dir/test.txt\").is_err());\n\n    // 無効なパス（ファイル名が長すぎる）\n    let long_filename = \"a\".repeat(256);\n    assert!(validator.validate(long_filename).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_normalize() -\u003e Result\u003c()\u003e {\n    let validator = Validator::default();\n    let temp_dir = TempDir::new()?;\n    let root = temp_dir.path();\n\n    // 通常のパス\n    let path = \"test.txt\";\n    let normalized = validator.normalize(root, path)?;\n    assert_eq!(normalized, root.join(path));\n\n    // ディレクトリを含むパス\n    let path = \"dir/test.txt\";\n    let normalized = validator.normalize(root, path)?;\n    assert_eq!(normalized, root.join(path));\n\n    // カレントディレクトリを含むパス\n    let path = \"./test.txt\";\n    let normalized = validator.normalize(root, path)?;\n    assert_eq!(normalized, root.join(\"test.txt\"));\n\n    // 無効なパス\n    let path = \"../test.txt\";\n    assert!(validator.normalize(root, path).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_path_functions() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let root = temp_dir.path();\n\n    // normalize関数のテスト\n    let path = \"test.txt\";\n    let normalized = path::normalize(root, path)?;\n    assert_eq!(normalized, root.join(path));\n\n    // validate関数のテスト\n    assert!(path::validate(\"test.txt\").is_ok());\n    assert!(path::validate(\"../test.txt\").is_err());\n\n    // ensure_path_exists関数のテスト\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    assert!(!test_dir.exists());\n    path::ensure_path_exists(\u0026test_dir)?;\n    assert!(test_dir.exists());\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","transaction.rs"],"content":"use std::sync::Arc;\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::transaction::{Transaction, State, CreateFileOperation, DeleteFileOperation};\n\n#[test]\nfn test_transaction_new() {\n    let transaction = Transaction::new();\n    assert!(matches!(transaction.state(), State::Pending { .. }));\n    assert!(transaction.operations().is_empty());\n}\n\n#[test]\nfn test_create_file_operation() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    let operation = CreateFileOperation::new(test_file.clone(), test_content.to_string());\n    let transaction = Transaction::new()\n        .with_operation(Arc::new(operation))?\n        .execute()?;\n\n    assert!(matches!(transaction.state(), State::Executed { .. }));\n    assert!(test_file.exists());\n    assert_eq!(std::fs::read_to_string(\u0026test_file)?, test_content);\n\n    Ok(())\n}\n\n#[test]\nfn test_delete_file_operation() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // ファイルを作成\n    std::fs::write(\u0026test_file, test_content)?;\n    assert!(test_file.exists());\n\n    // ファイルを削除\n    let operation = DeleteFileOperation::new(test_file.clone())?;\n    let transaction = Transaction::new()\n        .with_operation(Arc::new(operation))?\n        .execute()?;\n\n    assert!(matches!(transaction.state(), State::Executed { .. }));\n    assert!(!test_file.exists());\n\n    Ok(())\n}\n\n#[test]\nfn test_transaction_rollback() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // ファイルを作成するトランザクション\n    let operation = CreateFileOperation::new(test_file.clone(), test_content.to_string());\n    let transaction = Transaction::new()\n        .with_operation(Arc::new(operation))?;\n\n    // ロールバック\n    let transaction = transaction.rollback()?;\n    assert!(matches!(transaction.state(), State::RolledBack { .. }));\n    assert!(!test_file.exists());\n\n    Ok(())\n}\n\n#[test]\nfn test_multiple_operations() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file1 = temp_dir.path().join(\"test1.txt\");\n    let test_file2 = temp_dir.path().join(\"test2.txt\");\n    let test_content = \"Hello, World!\";\n\n    // 2つのファイルを作成するトランザクション\n    let operation1 = CreateFileOperation::new(test_file1.clone(), test_content.to_string());\n    let operation2 = CreateFileOperation::new(test_file2.clone(), test_content.to_string());\n\n    let transaction = Transaction::new()\n        .with_operation(Arc::new(operation1))?\n        .with_operation(Arc::new(operation2))?\n        .execute()?;\n\n    assert!(matches!(transaction.state(), State::Executed { .. }));\n    assert!(test_file1.exists());\n    assert!(test_file2.exists());\n    assert_eq!(std::fs::read_to_string(\u0026test_file1)?, test_content);\n    assert_eq!(std::fs::read_to_string(\u0026test_file2)?, test_content);\n\n    Ok(())\n}\n\n#[test]\nfn test_transaction_error() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // 先にファイルを作成\n    std::fs::write(\u0026test_file, test_content)?;\n\n    // 既に存在するファイルを作成しようとする\n    let operation = CreateFileOperation::new(test_file.clone(), test_content.to_string());\n    let result = Transaction::new()\n        .with_operation(Arc::new(operation));\n\n    // 検証エラーが発生することを確認\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"ファイルが既に存在します\"));\n    \n    Ok(())\n}\n\n#[test]\nfn test_transaction_description() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    let operation = CreateFileOperation::new(test_file.clone(), test_content.to_string());\n    let transaction = Transaction::new()\n        .with_operation(Arc::new(operation))?;\n\n    let description = transaction.description();\n    assert!(description.contains(\"トランザクション\"));\n    assert!(description.contains(\"保留中\"));\n    assert!(description.contains(\"test.txt\"));\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","lib.rs"],"content":"mod contest;\nmod fs; ","traces":[],"covered":0,"coverable":0}]};
        var previousData = {"files":[{"path":["/","home","cphelper-dev","project-cph","contest_template","rust","src","generator.rs"],"content":"use rand::Rng;\n\nfn main() {\n    let mut rng = rand::thread_rng();\n    let n = rng.gen_range(1..=100);\n    \n    println!(\"{}\", n);\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","contest_template","rust","src","solution.rs"],"content":"fn main() {\n    proconio::input! {\n        n: usize,\n    }\n    \n    // TODO: Implement solution\n    println!(\"{}\", n);\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","contest_template","rust","src","tester.rs"],"content":"use std::io::{self, Write};\n\nstruct JudgeInterface {\n    query_count: u32,\n    max_queries: u32,\n}\n\nimpl JudgeInterface {\n    fn new() -\u003e Self {\n        Self {\n            query_count: 0,\n            max_queries: 100, // デフォルトのクエリ制限\n        }\n    }\n\n    fn set_max_queries(\u0026mut self, max_queries: u32) {\n        self.max_queries = max_queries;\n    }\n\n    fn output(\u0026self, message: \u0026str) {\n        println!(\"{}\", message);\n        io::stdout().flush().unwrap();\n    }\n\n    fn input(\u0026mut self) -\u003e String {\n        if self.query_count \u003e= self.max_queries {\n            self.wrong_answer(\"クエリ制限超過\");\n        }\n        self.query_count += 1;\n        \n        let mut input = String::new();\n        io::stdin().read_line(\u0026mut input).unwrap();\n        input.trim().to_string()\n    }\n\n    fn correct_answer(\u0026self) -\u003e ! {\n        std::process::exit(0);\n    }\n\n    fn wrong_answer(\u0026self, message: \u0026str) -\u003e ! {\n        eprintln!(\"Wrong Answer: {}\", message);\n        std::process::exit(1);\n    }\n}\n\nfn main() {\n    let mut judge = JudgeInterface::new();\n    // TODO: インタラクティブジャッジの実装\n    // 例: 数当てゲーム\n    let n = 42;\n    judge.output(\"数当てゲームを開始します。1から100の数字を当ててください。\");\n    \n    loop {\n        let input = judge.input();\n        match input.parse::\u003ci32\u003e() {\n            Ok(guess) =\u003e {\n                if guess == n {\n                    judge.output(\"正解です！\");\n                    judge.correct_answer();\n                } else if guess \u003c n {\n                    judge.output(\"もっと大きいです\");\n                } else {\n                    judge.output(\"もっと小さいです\");\n                }\n            }\n            Err(_) =\u003e judge.wrong_answer(\"不正な入力です\"),\n        }\n    }\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","bin","cph.rs"],"content":"use std::env;\nuse anyhow::Result;\nuse cph::config::Config;\n\nfn main() -\u003e Result\u003c()\u003e {\n    if env::args().nth(1).is_none() {\n        println!(\"Usage: cph \u003ccommand\u003e [args...]\");\n        return Ok(());\n    }\n\n    let _config = Config::load()?;\n    Ok(())\n}\n","traces":[{"line":5,"address":[1014779,1014336],"length":1,"stats":{"Line":0}},{"line":6,"address":[1014729,1014343],"length":1,"stats":{"Line":0}},{"line":7,"address":[1014739],"length":1,"stats":{"Line":0}},{"line":8,"address":[1014768],"length":1,"stats":{"Line":0}},{"line":11,"address":[1014682,1014534],"length":1,"stats":{"Line":0}},{"line":12,"address":[1014657],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":6},{"path":["/","home","cphelper-dev","project-cph","src","config","mod.rs"],"content":"// Configuration Module\n//\n// このモジュールは、イミュータブルで型安全な設定管理を提供します。\n// 主な機能：\n// - 型安全な設定アクセス\n// - イミュータブルな設定値\n// - カスタムスキーマによるバリデーション\n// - 柔軟な型変換システム\n\nuse std::path::Path;\nuse std::fs;\nuse std::collections::HashMap;\nuse anyhow::{Result, Context};\nuse serde::{Deserialize, Serialize};\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Config {\n    pub system: SystemConfig,\n    pub languages: LanguagesConfig,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct SystemConfig {\n    pub browser: String,\n    pub editors: Vec\u003cString\u003e,\n    pub docker: DockerConfig,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct DockerConfig {\n    pub timeout_seconds: u32,\n    pub memory_limit_mb: u32,\n    pub mount_point: String,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct LanguagesConfig {\n    pub default: String,\n    #[serde(rename = \"_base\")]\n    pub base: LanguageBaseConfig,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct LanguageBaseConfig {\n    pub compile: Vec\u003cString\u003e,\n    pub run: Vec\u003cString\u003e,\n    pub runner: RunnerConfig,\n    pub templates: TemplatesConfig,\n    pub contest_dir: ContestDirConfig,\n    pub active_contest_yaml: String,\n    pub test: TestConfig,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct RunnerConfig {\n    pub compile_dir: String,\n    pub require_files: Vec\u003cString\u003e,\n    pub env_vars: Vec\u003cString\u003e,\n    pub docker: DockerConfig,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct TemplatesConfig {\n    pub patterns: HashMap\u003cString, String\u003e,\n    pub directory: String,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct ContestDirConfig {\n    pub active: String,\n    pub storage: String,\n    pub template: String,\n}\n\n#[allow(clippy::module_name_repetitions)]\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct TestConfig {\n    pub dir: String,\n}\n\nimpl Config {\n    /// 設定ファイルから設定を読み込みます\n    /// \n    /// # Errors\n    /// \n    /// - 設定ファイルが存在しない場合\n    /// - 設定ファイルの形式が不正な場合\n    pub fn load() -\u003e Result\u003cSelf\u003e {\n        let config_path = Path::new(\"src/config/config.yaml\");\n        let config_str = fs::read_to_string(config_path)\n            .with_context(|| format!(\"設定ファイルの読み込みに失敗: {}\", config_path.display()))?;\n        let config: Self = serde_yaml::from_str(\u0026config_str)\n            .with_context(|| \"設定ファイルのパースに失敗\")?;\n        Ok(config)\n    }\n\n    /// ブラウザの設定を取得します\n    #[must_use]\n    pub fn browser(\u0026self) -\u003e \u0026str {\n        \u0026self.system.browser\n    }\n\n    /// エディタの設定を取得します\n    #[must_use]\n    pub fn editors(\u0026self) -\u003e \u0026[String] {\n        \u0026self.system.editors\n    }\n\n    /// Dockerの設定を取得します\n    #[must_use]\n    pub const fn docker(\u0026self) -\u003e \u0026DockerConfig {\n        \u0026self.system.docker\n    }\n\n    /// デフォルトの言語を取得します\n    #[must_use]\n    pub fn default_language(\u0026self) -\u003e \u0026str {\n        \u0026self.languages.default\n    }\n\n    /// テストディレクトリを取得します\n    #[must_use]\n    pub fn test_dir(\u0026self) -\u003e String {\n        self.languages.base.test.dir.clone()\n    }\n\n    /// アクティブなコンテストのディレクトリを取得します\n    #[must_use]\n    pub fn active_contest_dir(\u0026self) -\u003e String {\n        self.languages.base.contest_dir.active.clone()\n    }\n\n    /// コンテストのテンプレートディレクトリを取得します\n    #[must_use]\n    pub fn contest_template_dir(\u0026self) -\u003e String {\n        self.languages.base.contest_dir.template.clone()\n    }\n\n    /// コンテストのストレージディレクトリを取得します\n    #[must_use]\n    pub fn contest_storage_dir(\u0026self) -\u003e String {\n        self.languages.base.contest_dir.storage.clone()\n    }\n} ","traces":[{"line":96,"address":[1122410,1121888],"length":1,"stats":{"Line":0}},{"line":97,"address":[1954033],"length":1,"stats":{"Line":0}},{"line":98,"address":[1954080,1954256],"length":1,"stats":{"Line":0}},{"line":99,"address":[2929152,2929179,2929420,2929320],"length":1,"stats":{"Line":0}},{"line":100,"address":[1954222,1954324,1954515],"length":1,"stats":{"Line":0}},{"line":101,"address":[1240688],"length":1,"stats":{"Line":0}},{"line":102,"address":[1122318],"length":1,"stats":{"Line":0}},{"line":107,"address":[3078320],"length":1,"stats":{"Line":0}},{"line":108,"address":[1954597],"length":1,"stats":{"Line":0}},{"line":113,"address":[1954608],"length":1,"stats":{"Line":0}},{"line":114,"address":[1954613],"length":1,"stats":{"Line":0}},{"line":119,"address":[1954640],"length":1,"stats":{"Line":0}},{"line":120,"address":[3078376],"length":1,"stats":{"Line":0}},{"line":125,"address":[1954656],"length":1,"stats":{"Line":0}},{"line":126,"address":[3078389],"length":1,"stats":{"Line":0}},{"line":131,"address":[1954672],"length":1,"stats":{"Line":0}},{"line":132,"address":[3078417],"length":1,"stats":{"Line":0}},{"line":137,"address":[1954720],"length":1,"stats":{"Line":0}},{"line":138,"address":[1954737],"length":1,"stats":{"Line":0}},{"line":143,"address":[1954768],"length":1,"stats":{"Line":0}},{"line":144,"address":[1954785],"length":1,"stats":{"Line":0}},{"line":149,"address":[1954832],"length":1,"stats":{"Line":0}},{"line":150,"address":[1954849],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":23},{"path":["/","home","cphelper-dev","project-cph","src","contest","mod.rs"],"content":"pub mod model;\npub mod parse;\npub mod service;\n\npub use model::{Command, CommandContext, Contest, TestCase};\npub use service::{ContestHandler as Handler, TestRunner};\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","contest","model","mod.rs"],"content":"pub mod state;\n\nuse std::path::PathBuf;\nuse anyhow::Result;\nuse crate::fs::manager::Manager;\n\n#[derive(Debug, Clone)]\npub struct Contest {\n    pub id: String,\n    pub name: String,\n    pub url: String,\n    pub site: String,\n    pub contest_id: String,\n    pub problem_id: String,\n    pub language: String,\n}\n\nimpl Contest {\n    /// Creates a new Contest instance\n    #[must_use = \"この関数は新しいContestインスタンスを返します\"]\n    pub fn new(site: String, contest_id: String, problem_id: String, language: String, url: String) -\u003e Self {\n        Self {\n            id: format!(\"{site}_{problem_id}\"),\n            name: format!(\"{contest_id} - {problem_id}\"),\n            url,\n            site,\n            contest_id,\n            problem_id,\n            language,\n        }\n    }\n\n    /// Creates a workspace directory structure for the contest\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if:\n    /// - Failed to create directories\n    /// - Failed to begin or commit transaction\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn create_workspace(\u0026self, manager: Manager) -\u003e Result\u003cManager\u003e {\n        let workspace_path = PathBuf::from(\u0026self.id);\n        \n        manager.begin_transaction()?\n            .create_dir(\u0026workspace_path)?\n            .create_dir(workspace_path.join(\"src\"))?\n            .create_dir(workspace_path.join(\"test\"))?\n            .commit()\n    }\n\n    /// Saves the template code to the workspace\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if:\n    /// - Failed to write template file\n    /// - Failed to begin or commit transaction\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn save_template(\u0026self, manager: Manager, template: \u0026str) -\u003e Result\u003cManager\u003e {\n        let source_path = PathBuf::from(\u0026self.id).join(\"src\").join(\"main.rs\");\n        \n        manager.begin_transaction()?\n            .write_file(\u0026source_path, template)?\n            .commit()\n    }\n\n    /// Saves a test case to the workspace\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if:\n    /// - Failed to write input/expected files\n    /// - Failed to begin or commit transaction\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn save_test_case(\u0026self, manager: Manager, test_case: \u0026TestCase, index: usize) -\u003e Result\u003cManager\u003e {\n        let test_dir = PathBuf::from(\u0026self.id).join(\"test\");\n        let input_path = test_dir.join(format!(\"input{index}.txt\"));\n        let expected_path = test_dir.join(format!(\"expected{index}.txt\"));\n\n        manager.begin_transaction()?\n            .write_file(\u0026input_path, \u0026test_case.input)?\n            .write_file(\u0026expected_path, \u0026test_case.expected)?\n            .commit()\n    }\n\n    /// Cleans up the workspace by deleting all files\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if:\n    /// - Failed to delete workspace directory\n    /// - Failed to begin or commit transaction\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn cleanup(\u0026self, manager: Manager) -\u003e Result\u003cManager\u003e {\n        let workspace_path = PathBuf::from(\u0026self.id);\n        \n        manager.begin_transaction()?\n            .delete_file(\u0026workspace_path)?\n            .commit()\n    }\n\n    /// テストディレクトリのパスを取得します\n    /// \n    /// # Returns\n    /// * `Result\u003cPathBuf\u003e` - テストディレクトリのパス\n    /// \n    /// # Errors\n    /// - テストディレクトリが存在しない場合\n    pub fn get_test_dir(\u0026self) -\u003e Result\u003cPathBuf\u003e {\n        let path = PathBuf::from(\u0026self.id).join(\"test\");\n        if !path.exists() {\n            return Err(anyhow::anyhow!(\n                \"テストディレクトリが見つかりません: {}\", path.display()\n            ));\n        }\n        Ok(path)\n    }\n\n    /// ソースファイルのパスを取得します\n    /// \n    /// # Returns\n    /// * `Result\u003cPathBuf\u003e` - ソースファイルのパス\n    /// \n    /// # Errors\n    /// - ソースファイルが存在しない場合\n    pub fn get_source_file(\u0026self) -\u003e Result\u003cPathBuf\u003e {\n        let path = PathBuf::from(\u0026self.id).join(\"src\").join(\"main.rs\");\n        if !path.exists() {\n            return Err(anyhow::anyhow!(\n                \"ソースファイルが見つかりません: {}\", path.display()\n            ));\n        }\n        Ok(path)\n    }\n}\n\n#[derive(Debug, Clone, PartialEq, Eq)]\npub struct TestCase {\n    pub input: String,\n    pub expected: String,\n    pub path: String,\n}\n\nimpl TestCase {\n    #[must_use]\n    pub const fn new(input: String, expected: String) -\u003e Self {\n        Self {\n            input,\n            expected,\n            path: String::new(),\n        }\n    }\n}\n\n#[derive(Debug, Clone, PartialEq, Eq)]\npub enum Command {\n    Login,\n    Config {\n        site: Option\u003cString\u003e,\n        contest_id: Option\u003cString\u003e,\n        problem_id: Option\u003cString\u003e,\n        language: Option\u003cString\u003e,\n    },\n    Open,\n    Test {\n        test_number: Option\u003cusize\u003e,\n    },\n    Submit,\n}\n\n#[derive(Debug, Clone)]\npub struct CommandContext {\n    pub command: Command,\n    pub contest: Option\u003cContest\u003e,\n}\n\nimpl CommandContext {\n    #[must_use]\n    pub const fn new(command: Command) -\u003e Self {\n        Self {\n            command,\n            contest: None,\n        }\n    }\n\n    #[must_use]\n    pub const fn with_contest(command: Command, contest: Contest) -\u003e Self {\n        Self {\n            command,\n            contest: Some(contest),\n        }\n    }\n} ","traces":[{"line":21,"address":[1701184,1702393,1702466],"length":1,"stats":{"Line":0}},{"line":23,"address":[2839766],"length":1,"stats":{"Line":0}},{"line":24,"address":[1716517],"length":1,"stats":{"Line":0}},{"line":41,"address":[1718725,1718872,1717216],"length":1,"stats":{"Line":0}},{"line":42,"address":[1702510],"length":1,"stats":{"Line":0}},{"line":44,"address":[1717885,1718108,1718392,1718040,1717340,1717676,1718443,1718289,1717451,1718621,1717989,1718508],"length":1,"stats":{"Line":0}},{"line":45,"address":[2841453],"length":1,"stats":{"Line":0}},{"line":46,"address":[1718273,1718837,1717847,1717906,1718780,1718032],"length":1,"stats":{"Line":0}},{"line":47,"address":[1703527,1703641,1703473,1704031,1703936,1703806,1703996],"length":1,"stats":{"Line":0}},{"line":59,"address":[2842496,2843501,2843526],"length":1,"stats":{"Line":0}},{"line":60,"address":[1704152,1704226],"length":1,"stats":{"Line":0}},{"line":62,"address":[1719813,1719658,1719353],"length":1,"stats":{"Line":0}},{"line":63,"address":[1719797],"length":1,"stats":{"Line":0}},{"line":75,"address":[1722167,1721880,1719984],"length":1,"stats":{"Line":0}},{"line":76,"address":[1720110,1720032],"length":1,"stats":{"Line":0}},{"line":77,"address":[1705394,1705512,1705659],"length":1,"stats":{"Line":0}},{"line":78,"address":[1720708,1720838,1720547],"length":1,"stats":{"Line":0}},{"line":80,"address":[2844979,2845044,2844568,2844923,2844454,2844804,2845199],"length":1,"stats":{"Line":0}},{"line":81,"address":[1721379],"length":1,"stats":{"Line":0}},{"line":82,"address":[1721599,1721335],"length":1,"stats":{"Line":0}},{"line":94,"address":[1722208,1722910,1722885],"length":1,"stats":{"Line":0}},{"line":95,"address":[1707309],"length":1,"stats":{"Line":0}},{"line":97,"address":[1707382,1707822,1707706,1707502],"length":1,"stats":{"Line":0}},{"line":98,"address":[1707809],"length":1,"stats":{"Line":0}},{"line":109,"address":[1722944,1723677],"length":1,"stats":{"Line":0}},{"line":110,"address":[2846553],"length":1,"stats":{"Line":0}},{"line":111,"address":[1723161],"length":1,"stats":{"Line":0}},{"line":112,"address":[1708513,1708634],"length":1,"stats":{"Line":0}},{"line":113,"address":[1708246,1708360],"length":1,"stats":{"Line":0}},{"line":116,"address":[2846820],"length":1,"stats":{"Line":0}},{"line":126,"address":[2847296,2848201],"length":1,"stats":{"Line":0}},{"line":127,"address":[1723737],"length":1,"stats":{"Line":0}},{"line":128,"address":[2847684],"length":1,"stats":{"Line":0}},{"line":129,"address":[2848007,2848128],"length":1,"stats":{"Line":0}},{"line":130,"address":[1724153,1724270],"length":1,"stats":{"Line":0}},{"line":133,"address":[1724175],"length":1,"stats":{"Line":0}},{"line":146,"address":[1724825,1724850,1724640],"length":1,"stats":{"Line":0}},{"line":150,"address":[1724692],"length":1,"stats":{"Line":0}},{"line":179,"address":[1724864],"length":1,"stats":{"Line":1}},{"line":187,"address":[1724960],"length":1,"stats":{"Line":0}},{"line":190,"address":[1724993],"length":1,"stats":{"Line":0}}],"covered":1,"coverable":41},{"path":["/","home","cphelper-dev","project-cph","src","contest","model","state.rs"],"content":"// ContestStateとValidatedStateの実装について：\n// \n// 当初はCow\u003c'static, str\u003eやStringの使用を検討しましたが、以下の理由でArcを採用しています：\n// 1. イミュータブルな設計の維持\n//    - validate()メソッドで所有権の移動が不要（Arc::cloneで対応）\n//    - 元のContestStateは変更されず再利用可能\n// \n// 2. 将来のマルチスレッド対応\n//    - Arcによりスレッド間で安全に共有可能\n//    - 後からの変更コストを最小化\n// \n// 3. パフォーマンスの最適化\n//    - Arc::cloneは参照カウントの増加のみで、実データのコピーは発生しない\n//    - メモリ効率が良い\n//\n// これらの理由から、シンプルさと将来の拡張性を両立する設計としてArcを採用しています。\n\nuse std::path::PathBuf;\nuse std::sync::Arc;\nuse anyhow::{Result, anyhow};\n\n#[derive(Debug, Clone)]\npub struct State {\n    site: Option\u003cArc\u003cString\u003e\u003e,\n    contest_id: Option\u003cArc\u003cString\u003e\u003e,\n    problem_id: Option\u003cArc\u003cString\u003e\u003e,\n    language: Option\u003cArc\u003cString\u003e\u003e,\n    source_path: Option\u003cArc\u003cPathBuf\u003e\u003e,\n}\n\n#[derive(Debug, Clone)]\npub struct Validated {\n    pub(crate) site: Arc\u003cString\u003e,\n    pub(crate) contest_id: Arc\u003cString\u003e,\n    pub(crate) problem_id: Arc\u003cString\u003e,\n    pub(crate) language: Arc\u003cString\u003e,\n    pub(crate) source_path: Arc\u003cPathBuf\u003e,\n}\n\n// 状態遷移の型安全性を向上させるための新しい型\n#[derive(Debug, Clone)]\npub enum Transition {\n    SetSite(String),\n    SetContestId(String),\n    SetProblemId(String),\n    SetLanguage(String),\n    SetSourcePath(PathBuf),\n}\n\nimpl Default for State {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl State {\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub const fn new() -\u003e Self {\n        Self {\n            site: None,\n            contest_id: None,\n            problem_id: None,\n            language: None,\n            source_path: None,\n        }\n    }\n\n    #[must_use = \"この関数は状態の参照を返します\"]\n    pub fn site(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.site.as_deref().map(String::as_str)\n    }\n\n    #[must_use = \"この関数はコンテストIDの参照を返します\"]\n    pub fn contest_id(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.contest_id.as_deref().map(String::as_str)\n    }\n\n    #[must_use = \"この関数は問題IDの参照を返します\"]\n    pub fn problem_id(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.problem_id.as_deref().map(String::as_str)\n    }\n\n    #[must_use = \"この関数は言語の参照を返します\"]\n    pub fn language(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.language.as_deref().map(String::as_str)\n    }\n\n    #[must_use = \"この関数はソースファイルのパスの参照を返します\"]\n    pub fn source_path(\u0026self) -\u003e Option\u003c\u0026PathBuf\u003e {\n        self.source_path.as_deref()\n    }\n\n    #[must_use = \"この関数は新しい状態を返します\"]\n    pub fn apply_transition(self, transition: Transition) -\u003e Self {\n        match transition {\n            Transition::SetSite(site) =\u003e self.with_site(site),\n            Transition::SetContestId(id) =\u003e self.with_contest_id(id),\n            Transition::SetProblemId(id) =\u003e self.with_problem_id(id),\n            Transition::SetLanguage(lang) =\u003e self.with_language(lang),\n            Transition::SetSourcePath(path) =\u003e self.with_source_path(path),\n        }\n    }\n\n    /// 状態を検証し、�証済みの状態を返します\n    ///\n    /// # Returns\n    /// * `Result\u003cValidated\u003e` - 検証済みの状態\n    ///\n    /// # Errors\n    /// * サイトが指定されていない場合\n    /// * コンテストIDが指定されていない場合\n    /// * 問題IDが指定されていない場合\n    /// * 言語が指定されていない場合\n    /// * ソースパスが指定されていない場合\n    /// * サイトが空の場合\n    /// * コンテストIDが空の場合\n    /// * 問題IDが空の場合\n    /// * 言語が空の場合\n    /// * 指定されたソースパスが存在しない場合\n    /// * 指定されたソースパスがファイルではない場合\n    pub fn validate(\u0026self) -\u003e Result\u003cValidated\u003e {\n        let site = self.site.clone()\n            .ok_or_else(|| anyhow!(\"サイトが指定されていません\"))?;\n        \n        let contest_id = self.contest_id.clone()\n            .ok_or_else(|| anyhow!(\"コンテストIDが指定されていません\"))?;\n        \n        let problem_id = self.problem_id.clone()\n            .ok_or_else(|| anyhow!(\"問題IDが指定されていません\"))?;\n        \n        let language = self.language.clone()\n            .ok_or_else(|| anyhow!(\"言語が指定されていません\"))?;\n        \n        let source_path = self.source_path.clone()\n            .ok_or_else(|| anyhow!(\"ソースパスが指定されていません\"))?;\n\n        // 拡張されたバリデーションルール\n        if site.is_empty() {\n            return Err(anyhow!(\"サイトが空です\"));\n        }\n        if contest_id.is_empty() {\n            return Err(anyhow!(\"コンテストIDが空です\"));\n        }\n        if problem_id.is_empty() {\n            return Err(anyhow!(\"問題IDが空です\"));\n        }\n        if language.is_empty() {\n            return Err(anyhow!(\"言語が空です\"));\n        }\n\n        // パスのバリデーション\n        if !source_path.exists() {\n            return Err(anyhow!(\"指定されたソースパスが存在しません\"));\n        }\n        if !source_path.is_file() {\n            return Err(anyhow!(\"指定されたソースパスはファイルではありません\"));\n        }\n\n        Ok(Validated {\n            site,\n            contest_id,\n            problem_id,\n            language,\n            source_path,\n        })\n    }\n\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub fn with_site\u003cT: Into\u003cString\u003e\u003e(self, site: T) -\u003e Self {\n        Self {\n            site: Some(Arc::new(site.into())),\n            contest_id: self.contest_id,\n            problem_id: self.problem_id,\n            language: self.language,\n            source_path: self.source_path,\n        }\n    }\n\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub fn with_contest_id\u003cT: Into\u003cString\u003e\u003e(self, contest_id: T) -\u003e Self {\n        Self {\n            site: self.site,\n            contest_id: Some(Arc::new(contest_id.into())),\n            problem_id: self.problem_id,\n            language: self.language,\n            source_path: self.source_path,\n        }\n    }\n\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub fn with_problem_id\u003cT: Into\u003cString\u003e\u003e(self, problem_id: T) -\u003e Self {\n        Self {\n            site: self.site,\n            contest_id: self.contest_id,\n            problem_id: Some(Arc::new(problem_id.into())),\n            language: self.language,\n            source_path: self.source_path,\n        }\n    }\n\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub fn with_language\u003cT: Into\u003cString\u003e\u003e(self, language: T) -\u003e Self {\n        Self {\n            site: self.site,\n            contest_id: self.contest_id,\n            problem_id: self.problem_id,\n            language: Some(Arc::new(language.into())),\n            source_path: self.source_path,\n        }\n    }\n\n    #[must_use = \"この関数は新しいContestStateインスタンスを返します\"]\n    pub fn with_source_path\u003cT: Into\u003cPathBuf\u003e\u003e(self, source_path: T) -\u003e Self {\n        Self {\n            site: self.site,\n            contest_id: self.contest_id,\n            problem_id: self.problem_id,\n            language: self.language,\n            source_path: Some(Arc::new(source_path.into())),\n        }\n    }\n}\n\nimpl Validated {\n    #[must_use = \"この関数はサイト名を返します\"]\n    pub fn site(\u0026self) -\u003e \u0026str {\n        \u0026self.site\n    }\n\n    #[must_use = \"この関数はコンテストIDを返します\"]\n    pub fn contest_id(\u0026self) -\u003e \u0026str {\n        \u0026self.contest_id\n    }\n\n    #[must_use = \"この関数は問題IDを返します\"]\n    pub fn problem_id(\u0026self) -\u003e \u0026str {\n        \u0026self.problem_id\n    }\n\n    #[must_use = \"この関数は言語を返します\"]\n    pub fn language(\u0026self) -\u003e \u0026str {\n        \u0026self.language\n    }\n\n    #[must_use = \"この関数はソースファイルのパスを返します\"]\n    pub fn source_path(\u0026self) -\u003e \u0026PathBuf {\n        \u0026self.source_path\n    }\n\n    /// 状態を更新します。\n    /// \n    /// # Arguments\n    /// * `transition` - 適用する状態遷移\n    /// \n    /// # Errors\n    /// - 状態遷移後の検証に失敗した場合\n    /// - 必須フィールドが未設定の場合\n    /// - パスの検証に失敗した場合\n    pub fn try_update(\u0026self, transition: Transition) -\u003e Result\u003cSelf\u003e {\n        let mut new_state = State::new()\n            .with_site(self.site.as_ref().clone())\n            .with_contest_id(self.contest_id.as_ref().clone())\n            .with_problem_id(self.problem_id.as_ref().clone())\n            .with_language(self.language.as_ref().clone())\n            .with_source_path(self.source_path.as_ref().clone());\n\n        new_state = new_state.apply_transition(transition);\n        new_state.validate()\n    }\n}\n\nimpl PartialEq for Validated {\n    fn eq(\u0026self, other: \u0026Self) -\u003e bool {\n        self.site == other.site \u0026\u0026\n        self.contest_id == other.contest_id \u0026\u0026\n        self.problem_id == other.problem_id \u0026\u0026\n        self.language == other.language \u0026\u0026\n        self.source_path == other.source_path\n    }\n}\n\nimpl Eq for Validated {} ","traces":[{"line":51,"address":[1628832],"length":1,"stats":{"Line":0}},{"line":52,"address":[2149080],"length":1,"stats":{"Line":0}},{"line":58,"address":[2149104],"length":1,"stats":{"Line":0}},{"line":69,"address":[3271856],"length":1,"stats":{"Line":0}},{"line":70,"address":[3271861],"length":1,"stats":{"Line":0}},{"line":74,"address":[3271888],"length":1,"stats":{"Line":0}},{"line":75,"address":[3271893],"length":1,"stats":{"Line":0}},{"line":79,"address":[3271920],"length":1,"stats":{"Line":0}},{"line":80,"address":[3271925],"length":1,"stats":{"Line":0}},{"line":84,"address":[2149296],"length":1,"stats":{"Line":0}},{"line":85,"address":[2149301],"length":1,"stats":{"Line":0}},{"line":89,"address":[2149328],"length":1,"stats":{"Line":0}},{"line":90,"address":[1629093],"length":1,"stats":{"Line":0}},{"line":94,"address":[1629104],"length":1,"stats":{"Line":0}},{"line":95,"address":[2149387],"length":1,"stats":{"Line":0}},{"line":96,"address":[1629177],"length":1,"stats":{"Line":0}},{"line":97,"address":[1629234],"length":1,"stats":{"Line":0}},{"line":98,"address":[1629291],"length":1,"stats":{"Line":0}},{"line":99,"address":[3272260],"length":1,"stats":{"Line":0}},{"line":100,"address":[3272321],"length":1,"stats":{"Line":0}},{"line":121,"address":[2149728,2152210,2152284],"length":1,"stats":{"Line":0}},{"line":122,"address":[2149911,2149778],"length":1,"stats":{"Line":0}},{"line":123,"address":[3200816,3200820],"length":1,"stats":{"Line":0}},{"line":125,"address":[2149864,2152282,2149981,2150173],"length":1,"stats":{"Line":0}},{"line":126,"address":[1629877],"length":1,"stats":{"Line":0}},{"line":128,"address":[3272902,3272782,3274917,3273094],"length":1,"stats":{"Line":0}},{"line":129,"address":[3273078],"length":1,"stats":{"Line":0}},{"line":131,"address":[3274896,3273359,3273047,3273167],"length":1,"stats":{"Line":0}},{"line":132,"address":[1630367],"length":1,"stats":{"Line":0}},{"line":134,"address":[3273312,3274875,3273432,3273620],"length":1,"stats":{"Line":0}},{"line":135,"address":[3201076,3201072],"length":1,"stats":{"Line":0}},{"line":138,"address":[3273569,3273693],"length":1,"stats":{"Line":0}},{"line":139,"address":[3273747,3274781],"length":1,"stats":{"Line":0}},{"line":141,"address":[3273784,3273720],"length":1,"stats":{"Line":0}},{"line":142,"address":[2152051,2151182],"length":1,"stats":{"Line":0}},{"line":144,"address":[1630811,1630863],"length":1,"stats":{"Line":0}},{"line":145,"address":[2151977,2151273],"length":1,"stats":{"Line":0}},{"line":147,"address":[3273902,3273966],"length":1,"stats":{"Line":0}},{"line":148,"address":[3274020,3274559],"length":1,"stats":{"Line":0}},{"line":152,"address":[3273993,3274057],"length":1,"stats":{"Line":0}},{"line":153,"address":[2151528,2151467],"length":1,"stats":{"Line":0}},{"line":155,"address":[1631247,1631137],"length":1,"stats":{"Line":0}},{"line":156,"address":[3274469,3274327],"length":1,"stats":{"Line":0}},{"line":159,"address":[3274401],"length":1,"stats":{"Line":0}},{"line":160,"address":[2151705],"length":1,"stats":{"Line":0}},{"line":161,"address":[2151713],"length":1,"stats":{"Line":0}},{"line":162,"address":[3274377],"length":1,"stats":{"Line":0}},{"line":163,"address":[3274385],"length":1,"stats":{"Line":0}},{"line":164,"address":[2151737],"length":1,"stats":{"Line":0}},{"line":169,"address":[3201136,3201318],"length":1,"stats":{"Line":0}},{"line":171,"address":[1639828,1639776],"length":1,"stats":{"Line":0}},{"line":172,"address":[2078382],"length":1,"stats":{"Line":0}},{"line":173,"address":[2078386],"length":1,"stats":{"Line":0}},{"line":174,"address":[3201270],"length":1,"stats":{"Line":0}},{"line":175,"address":[3201274],"length":1,"stats":{"Line":0}},{"line":180,"address":[2078750,2078464,2078661],"length":1,"stats":{"Line":0}},{"line":182,"address":[2078496],"length":1,"stats":{"Line":0}},{"line":183,"address":[3201439,3201384],"length":1,"stats":{"Line":0}},{"line":184,"address":[3201480],"length":1,"stats":{"Line":0}},{"line":185,"address":[2078604],"length":1,"stats":{"Line":0}},{"line":186,"address":[1640068],"length":1,"stats":{"Line":0}},{"line":191,"address":[3201938,3201853,3201648],"length":1,"stats":{"Line":0}},{"line":193,"address":[3201680],"length":1,"stats":{"Line":0}},{"line":194,"address":[3201688],"length":1,"stats":{"Line":0}},{"line":195,"address":[3201752,3201697],"length":1,"stats":{"Line":0}},{"line":196,"address":[2078911],"length":1,"stats":{"Line":0}},{"line":197,"address":[1640343],"length":1,"stats":{"Line":0}},{"line":202,"address":[3201952,3202253,3202172],"length":1,"stats":{"Line":0}},{"line":204,"address":[3201984],"length":1,"stats":{"Line":0}},{"line":205,"address":[1640520],"length":1,"stats":{"Line":0}},{"line":206,"address":[2079121],"length":1,"stats":{"Line":0}},{"line":207,"address":[3202010,3202068],"length":1,"stats":{"Line":0}},{"line":208,"address":[3202109],"length":1,"stats":{"Line":0}},{"line":213,"address":[3202272,3202500,3202577],"length":1,"stats":{"Line":0}},{"line":215,"address":[3202304],"length":1,"stats":{"Line":0}},{"line":216,"address":[1640808],"length":1,"stats":{"Line":0}},{"line":217,"address":[3202321],"length":1,"stats":{"Line":0}},{"line":218,"address":[1640826],"length":1,"stats":{"Line":0}},{"line":219,"address":[2079517,2079459],"length":1,"stats":{"Line":0}},{"line":226,"address":[3274960],"length":1,"stats":{"Line":0}},{"line":227,"address":[3274965],"length":1,"stats":{"Line":0}},{"line":231,"address":[1631952],"length":1,"stats":{"Line":0}},{"line":232,"address":[1631957],"length":1,"stats":{"Line":0}},{"line":236,"address":[3275024],"length":1,"stats":{"Line":0}},{"line":237,"address":[2152373],"length":1,"stats":{"Line":0}},{"line":241,"address":[2152400],"length":1,"stats":{"Line":0}},{"line":242,"address":[1632021],"length":1,"stats":{"Line":0}},{"line":246,"address":[3275088],"length":1,"stats":{"Line":0}},{"line":247,"address":[1632053],"length":1,"stats":{"Line":0}},{"line":259,"address":[3276411,3276295,3275120],"length":1,"stats":{"Line":0}},{"line":260,"address":[3275668,3275155,3275959,3275370,3275519,3275817],"length":1,"stats":{"Line":0}},{"line":261,"address":[2153733,2152762,2152628],"length":1,"stats":{"Line":0}},{"line":262,"address":[1632366,1632491,1633243],"length":1,"stats":{"Line":0}},{"line":263,"address":[3275583,3275716,3276345],"length":1,"stats":{"Line":0}},{"line":264,"address":[3276323,3275732,3275862],"length":1,"stats":{"Line":0}},{"line":265,"address":[3275878,3276001,3276304],"length":1,"stats":{"Line":0}},{"line":267,"address":[1633068,1632917],"length":1,"stats":{"Line":0}},{"line":268,"address":[1633120],"length":1,"stats":{"Line":0}},{"line":273,"address":[3276448],"length":1,"stats":{"Line":0}},{"line":274,"address":[2153815],"length":1,"stats":{"Line":0}},{"line":275,"address":[2153841],"length":1,"stats":{"Line":0}},{"line":276,"address":[2153870],"length":1,"stats":{"Line":0}},{"line":277,"address":[2153899],"length":1,"stats":{"Line":0}},{"line":278,"address":[2153928],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":104},{"path":["/","home","cphelper-dev","project-cph","src","contest","parse","config.rs"],"content":"use serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\nuse std::fs;\nuse std::path::Path;\nuse anyhow::Result;\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct AliasInfo {\n    pub original: String,\n    pub category: String,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct Config {\n    pub commands: HashMap\u003cString, HashMap\u003cString, CommandValue\u003e\u003e,\n    #[serde(skip)]\n    alias_map: HashMap\u003cString, AliasInfo\u003e,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\n#[serde(untagged)]\npub enum CommandValue {\n    Command { aliases: Vec\u003cString\u003e },\n    Setting { priority: i32 },\n}\n\nimpl Default for Config {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Config {\n    #[must_use = \"この関数は新しいConfigインスタンスを返します\"]\n    pub fn new() -\u003e Self {\n        Self::from_file(\"src/config/commands.yaml\").unwrap_or_else(|_| Self::default_config())\n    }\n\n    /// ファイルからConfigを読み込みます\n    /// \n    /// # Errors\n    /// \n    /// - ファイルが存在しない場合\n    /// - ファイルの読み込みに失敗した場合\n    /// - YAMLのパースに失敗した場合\n    pub fn from_file\u003cP: AsRef\u003cPath\u003e\u003e(path: P) -\u003e Result\u003cSelf\u003e {\n        let contents = fs::read_to_string(path)?;\n        let mut config: Self = serde_yaml::from_str(\u0026contents)?;\n        config.build_alias_map();\n        Ok(config)\n    }\n\n    fn default_config() -\u003e Self {\n        let mut commands = HashMap::new();\n        let alias_map = HashMap::new();\n        \n        // デフォルトの設定\n        let mut sites = HashMap::new();\n        sites.insert(\n            \"atcoder\".to_string(),\n            CommandValue::Command {\n                aliases: vec![\"at\".to_string()],\n            },\n        );\n        commands.insert(\"site\".to_string(), sites);\n\n        let mut languages = HashMap::new();\n        languages.insert(\n            \"rust\".to_string(),\n            CommandValue::Command {\n                aliases: vec![\"rs\".to_string()],\n            },\n        );\n        commands.insert(\"language\".to_string(), languages);\n\n        let mut config = Self { commands, alias_map };\n        config.build_alias_map();\n        config\n    }\n\n    fn build_alias_map(\u0026mut self) {\n        self.alias_map.clear();\n        for (category, subcmds) in \u0026self.commands {\n            for (original, value) in subcmds {\n                match value {\n                    CommandValue::Command { aliases } =\u003e {\n                        for alias in aliases {\n                            if !alias.contains(char::is_whitespace) {\n                                self.alias_map.insert(\n                                    alias.clone(),\n                                    AliasInfo {\n                                        original: original.clone(),\n                                        category: category.clone(),\n                                    },\n                                );\n                            }\n                        }\n                    }\n                    CommandValue::Setting { priority: _ } =\u003e {\n                        // priorityの設定は無視\n                    }\n                }\n            }\n        }\n    }\n\n    /// トークンに対応するエイリアスを解決します\n    /// \n    /// 返り値は (コマンドタイプ, 実際の値) のタプルです\n    #[must_use]\n    pub fn resolve_alias(\u0026self, token: \u0026str) -\u003e Option\u003c(String, String)\u003e {\n        self.alias_map.get(token).map(|info| {\n            (info.category.clone(), info.original.clone())\n        })\n    }\n}","traces":[{"line":28,"address":[1672256],"length":1,"stats":{"Line":0}},{"line":29,"address":[1798552],"length":1,"stats":{"Line":0}},{"line":35,"address":[1798576],"length":1,"stats":{"Line":0}},{"line":36,"address":[1798590],"length":1,"stats":{"Line":0}},{"line":46,"address":[2900707,2900016,2900729],"length":1,"stats":{"Line":4}},{"line":47,"address":[1776596,1776465],"length":1,"stats":{"Line":5}},{"line":48,"address":[2900261,2900159,2900556],"length":1,"stats":{"Line":8}},{"line":49,"address":[2900532],"length":1,"stats":{"Line":4}},{"line":50,"address":[2900634],"length":1,"stats":{"Line":2}},{"line":53,"address":[1800380,1800506,1798656],"length":1,"stats":{"Line":0}},{"line":54,"address":[2922257],"length":1,"stats":{"Line":0}},{"line":55,"address":[1798743],"length":1,"stats":{"Line":0}},{"line":58,"address":[2922384],"length":1,"stats":{"Line":0}},{"line":59,"address":[1799231,1798865],"length":1,"stats":{"Line":0}},{"line":60,"address":[1672573,1672638],"length":1,"stats":{"Line":0}},{"line":61,"address":[2922783],"length":1,"stats":{"Line":0}},{"line":62,"address":[1800438,1798956,1799011],"length":1,"stats":{"Line":0}},{"line":65,"address":[1799309],"length":1,"stats":{"Line":0}},{"line":67,"address":[1799451],"length":1,"stats":{"Line":0}},{"line":68,"address":[1799836,1799470],"length":1,"stats":{"Line":0}},{"line":69,"address":[1673222,1673154],"length":1,"stats":{"Line":0}},{"line":70,"address":[1799804],"length":1,"stats":{"Line":0}},{"line":71,"address":[2923203,2923973,2923148],"length":1,"stats":{"Line":0}},{"line":74,"address":[1673578],"length":1,"stats":{"Line":0}},{"line":76,"address":[1800056],"length":1,"stats":{"Line":0}},{"line":77,"address":[2923833],"length":1,"stats":{"Line":0}},{"line":78,"address":[1800317],"length":1,"stats":{"Line":0}},{"line":81,"address":[1800544,1801346],"length":1,"stats":{"Line":3}},{"line":82,"address":[2924148],"length":1,"stats":{"Line":4}},{"line":83,"address":[1800682,1800587],"length":1,"stats":{"Line":8}},{"line":84,"address":[1800719],"length":1,"stats":{"Line":4}},{"line":85,"address":[2924448],"length":1,"stats":{"Line":4}},{"line":86,"address":[2924487],"length":1,"stats":{"Line":4}},{"line":87,"address":[2924495],"length":1,"stats":{"Line":4}},{"line":88,"address":[1674636],"length":1,"stats":{"Line":4}},{"line":89,"address":[2924624,2924860],"length":1,"stats":{"Line":6}},{"line":90,"address":[1801049],"length":1,"stats":{"Line":4}},{"line":91,"address":[2924796],"length":1,"stats":{"Line":4}},{"line":92,"address":[1801097],"length":1,"stats":{"Line":4}},{"line":93,"address":[2924731],"length":1,"stats":{"Line":4}},{"line":111,"address":[1801392],"length":1,"stats":{"Line":1}},{"line":112,"address":[1777334,1777168],"length":1,"stats":{"Line":2}},{"line":113,"address":[1777192],"length":1,"stats":{"Line":1}}],"covered":21,"coverable":43},{"path":["/","home","cphelper-dev","project-cph","src","contest","parse","mod.rs"],"content":"mod config;\nmod parser;\n\npub use config::*;\npub use parser::*;","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","contest","parse","parser.rs"],"content":"use anyhow::{Result, anyhow};\nuse crate::contest::model::{Command, CommandContext};\n\n#[derive(Debug, Clone, PartialEq, Eq)]\nenum TokenType {\n    Site,\n    Language,\n    ContestId,\n    ProblemId,\n}\n\n#[derive(Debug, Clone)]\nstruct TokenInterpretation {\n    token: String,\n    interpretations: Vec\u003c(TokenType, String)\u003e,\n}\n\npub struct Parser {\n    config: crate::contest::parse::config::Config,\n}\n\nimpl Default for Parser {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Parser {\n    #[must_use = \"この関数は新しいParserインスタンスを返します\"]\n    pub fn new() -\u003e Self {\n        Self {\n            config: crate::contest::parse::config::Config::new(),\n        }\n    }\n\n    /// 新しいParserインスタンスを設定で初期化します\n    #[must_use]\n    pub const fn with_config(config: crate::contest::parse::config::Config) -\u003e Self {\n        Self { config }\n    }\n\n    /// `入力文字列`をパースして`CommandContext`を生成します\n    /// \n    /// # Errors\n    /// \n    /// - 入力文字列のパースに失敗した場合\n    /// - コマンドの解釈に失敗した場合\n    pub fn parse(\u0026self, input: \u0026str) -\u003e Result\u003cCommandContext\u003e {\n        let input = input.trim();\n        if input.is_empty() {\n            return Err(anyhow!(\"入力が空です\"));\n        }\n\n        let tokens: Vec\u003c\u0026str\u003e = input.split_whitespace().collect();\n        Ok(self.parse_tokens(\u0026tokens))\n    }\n\n    fn parse_tokens(\u0026self, tokens: \u0026[\u0026str]) -\u003e CommandContext {\n        let mut interpretations = Vec::new();\n        for token in tokens {\n            let token_interp = self.interpret_token(token);\n            interpretations.push(token_interp);\n        }\n\n        Self::build_command(\u0026interpretations)\n    }\n\n    fn get_token_type(token: \u0026str) -\u003e Option\u003cTokenType\u003e {\n        match token {\n            \"site\" | \"atcoder\" =\u003e Some(TokenType::Site),\n            \"language\" | \"rust\" =\u003e Some(TokenType::Language),\n            \"contest\" =\u003e Some(TokenType::ContestId),\n            \"problem\" =\u003e Some(TokenType::ProblemId),\n            _ =\u003e None,\n        }\n    }\n\n    /// トークンを解釈し、可能な解釈のリストを返します\n    fn interpret_token(\u0026self, token: \u0026str) -\u003e TokenInterpretation {\n        let mut interpretations = Vec::new();\n\n        // エイリアス解決を試みる\n        if let Some((category, original)) = self.config.resolve_alias(token) {\n            if let Some(token_type) = Self::get_token_type(\u0026category) {\n                interpretations.push((token_type, original));\n                return TokenInterpretation {\n                    token: token.to_string(),\n                    interpretations,\n                };\n            }\n        }\n\n        // カテゴリ直接マッチを試みる\n        if let Some(token_type) = Self::get_token_type(token) {\n            interpretations.push((token_type, token.to_string()));\n            return TokenInterpretation {\n                token: token.to_string(),\n                interpretations,\n            };\n        }\n\n        // 解釈できなかった場合は空の解釈リストを返す\n        TokenInterpretation {\n            token: token.to_string(),\n            interpretations,\n        }\n    }\n\n    fn assign_interpreted_tokens(\n        interpretations: \u0026[TokenInterpretation],\n    ) -\u003e (Option\u003cString\u003e, Option\u003cString\u003e, Option\u003cString\u003e, Option\u003cString\u003e) {\n        let mut site = None;\n        let mut language = None;\n        let mut contest_id = None;\n        let mut problem_id = None;\n\n        for interp in interpretations {\n            for (token_type, value) in \u0026interp.interpretations {\n                match token_type {\n                    TokenType::Site =\u003e site = Some(value.clone()),\n                    TokenType::Language =\u003e language = Some(value.clone()),\n                    TokenType::ContestId =\u003e contest_id = Some(value.clone()),\n                    TokenType::ProblemId =\u003e problem_id = Some(value.clone()),\n                }\n            }\n        }\n\n        (site, language, contest_id, problem_id)\n    }\n\n    fn assign_uninterpreted_tokens(\n        interpretations: \u0026[TokenInterpretation],\n        contest_id: Option\u003cString\u003e,\n        problem_id: Option\u003cString\u003e,\n    ) -\u003e (Option\u003cString\u003e, Option\u003cString\u003e) {\n        let mut contest_id = contest_id;\n        let mut problem_id = problem_id;\n        \n        // エイリアスとして解釈できなかったトークンを収集\n        let uninterpreted_tokens: Vec\u003c_\u003e = interpretations\n            .iter()\n            .filter(|i| i.interpretations.is_empty())\n            .map(|i| i.token.clone())\n            .collect();\n\n        // 未解釈トークンがある場合、priorityの高い順に割り当てる\n        if !uninterpreted_tokens.is_empty() {\n            // priority=2のcontest_idを先に割り当て\n            if contest_id.is_none() \u0026\u0026 !uninterpreted_tokens.is_empty() {\n                contest_id = Some(uninterpreted_tokens[0].clone());\n            }\n            // priority=1のproblem_idを次に割り当て\n            if problem_id.is_none() \u0026\u0026 uninterpreted_tokens.len() \u003e 1 {\n                problem_id = Some(uninterpreted_tokens[1].clone());\n            }\n        }\n\n        (contest_id, problem_id)\n    }\n\n    fn build_command(interpretations: \u0026[TokenInterpretation]) -\u003e CommandContext {\n        let (site, language, contest_id, problem_id) = Self::assign_interpreted_tokens(interpretations);\n        let (contest_id, problem_id) = Self::assign_uninterpreted_tokens(\n            interpretations,\n            contest_id,\n            problem_id,\n        );\n\n        let command = Command::Config {\n            site,\n            contest_id,\n            problem_id,\n            language,\n        };\n\n        CommandContext::new(command)\n    }\n} ","traces":[{"line":23,"address":[1314448],"length":1,"stats":{"Line":0}},{"line":24,"address":[1422488],"length":1,"stats":{"Line":0}},{"line":30,"address":[1314480],"length":1,"stats":{"Line":0}},{"line":32,"address":[1314494],"length":1,"stats":{"Line":0}},{"line":38,"address":[1422576],"length":1,"stats":{"Line":1}},{"line":48,"address":[2543792,2544181],"length":1,"stats":{"Line":2}},{"line":49,"address":[1422680],"length":1,"stats":{"Line":1}},{"line":50,"address":[1314685],"length":1,"stats":{"Line":2}},{"line":51,"address":[1314765],"length":1,"stats":{"Line":1}},{"line":54,"address":[2543932],"length":1,"stats":{"Line":1}},{"line":55,"address":[1422940,1422784],"length":1,"stats":{"Line":3}},{"line":58,"address":[1314992,1315344],"length":1,"stats":{"Line":1}},{"line":59,"address":[1423080],"length":1,"stats":{"Line":2}},{"line":60,"address":[2544288,2544464,2544360],"length":1,"stats":{"Line":5}},{"line":61,"address":[2544480],"length":1,"stats":{"Line":2}},{"line":62,"address":[1423364],"length":1,"stats":{"Line":1}},{"line":65,"address":[1423249,1423333],"length":1,"stats":{"Line":4}},{"line":68,"address":[2544608],"length":1,"stats":{"Line":3}},{"line":70,"address":[1423447],"length":1,"stats":{"Line":1}},{"line":71,"address":[2544711],"length":1,"stats":{"Line":3}},{"line":72,"address":[2544788,2544841],"length":1,"stats":{"Line":3}},{"line":73,"address":[1423679,1423634],"length":1,"stats":{"Line":3}},{"line":74,"address":[1423672],"length":1,"stats":{"Line":3}},{"line":79,"address":[1425218,1423712,1424584],"length":1,"stats":{"Line":1}},{"line":80,"address":[1423768],"length":1,"stats":{"Line":3}},{"line":83,"address":[1315790,1315838],"length":1,"stats":{"Line":4}},{"line":84,"address":[2545322,2545213],"length":1,"stats":{"Line":2}},{"line":85,"address":[1316143],"length":1,"stats":{"Line":1}},{"line":86,"address":[2545572],"length":1,"stats":{"Line":1}},{"line":87,"address":[2545526],"length":1,"stats":{"Line":1}},{"line":88,"address":[1424354],"length":1,"stats":{"Line":1}},{"line":94,"address":[1316571,1316686],"length":1,"stats":{"Line":6}},{"line":95,"address":[1424814,1424853],"length":1,"stats":{"Line":6}},{"line":96,"address":[2546177],"length":1,"stats":{"Line":3}},{"line":97,"address":[1424934],"length":1,"stats":{"Line":3}},{"line":98,"address":[1424946],"length":1,"stats":{"Line":3}},{"line":104,"address":[2546023],"length":1,"stats":{"Line":3}},{"line":109,"address":[2546432,2548024,2548084],"length":1,"stats":{"Line":1}},{"line":112,"address":[1425317],"length":1,"stats":{"Line":3}},{"line":113,"address":[1317258],"length":1,"stats":{"Line":1}},{"line":114,"address":[2546511],"length":1,"stats":{"Line":3}},{"line":115,"address":[1425335],"length":1,"stats":{"Line":1}},{"line":117,"address":[1425343,1425845,1425418],"length":1,"stats":{"Line":7}},{"line":118,"address":[1317789],"length":1,"stats":{"Line":1}},{"line":119,"address":[1426022],"length":1,"stats":{"Line":1}},{"line":120,"address":[2547241,2547338],"length":1,"stats":{"Line":2}},{"line":121,"address":[1318000,1318232],"length":1,"stats":{"Line":2}},{"line":122,"address":[1426482,1426106],"length":1,"stats":{"Line":0}},{"line":123,"address":[1318581,1318052],"length":1,"stats":{"Line":0}},{"line":128,"address":[2546698],"length":1,"stats":{"Line":3}},{"line":131,"address":[1428109,1426928,1428149],"length":1,"stats":{"Line":3}},{"line":136,"address":[2548171],"length":1,"stats":{"Line":1}},{"line":137,"address":[1427031],"length":1,"stats":{"Line":3}},{"line":140,"address":[2548319,2548247],"length":1,"stats":{"Line":4}},{"line":142,"address":[1533038,1533024],"length":1,"stats":{"Line":4}},{"line":143,"address":[2656691,2656656],"length":1,"stats":{"Line":4}},{"line":147,"address":[1319187,1319128],"length":1,"stats":{"Line":4}},{"line":149,"address":[1427503,1427471,1427293,1427770],"length":1,"stats":{"Line":6}},{"line":150,"address":[1427536],"length":1,"stats":{"Line":3}},{"line":153,"address":[1428075,1427779,1427477],"length":1,"stats":{"Line":6}},{"line":154,"address":[1427827],"length":1,"stats":{"Line":2}},{"line":158,"address":[1427321],"length":1,"stats":{"Line":1}},{"line":161,"address":[1429219,1428192,1429101],"length":1,"stats":{"Line":1}},{"line":162,"address":[1428234],"length":1,"stats":{"Line":3}},{"line":165,"address":[1428447],"length":1,"stats":{"Line":3}},{"line":166,"address":[1428481],"length":1,"stats":{"Line":3}},{"line":176,"address":[1428953],"length":1,"stats":{"Line":1}}],"covered":61,"coverable":67},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","command.rs"],"content":"use crate::contest::model::{Command, CommandContext, Contest};\nuse crate::contest::service::{ContestHandler, TestRunner};\nuse crate::config::Config;\nuse anyhow::Result;\nuse crate::message::contest;\n\npub struct Service {\n    contest_service: ContestHandler,\n    test_service: TestRunner,\n    config: Config,\n}\n\nimpl Service {\n    /// `CommandService`の新しいインスタンスを作成します\n    /// \n    /// # Errors\n    /// \n    /// - 設定ファイルの読み込みに失敗した場合\n    pub fn new(contest_service: ContestHandler, test_service: TestRunner) -\u003e Result\u003cSelf\u003e {\n        let config = Config::load()?;\n        Ok(Self {\n            contest_service,\n            test_service,\n            config,\n        })\n    }\n\n    /// コマンドを実行します。\n    /// \n    /// # Errors\n    /// - コマンドの実行に失敗した場合\n    /// - コンテストが選択されていない場合（必要な場合）\n    pub fn execute(\u0026self, context: CommandContext) -\u003e Result\u003c()\u003e {\n        match context.command {\n            Command::Login =\u003e {\n                println!(\"ログイン処理を実行します\");\n                // TODO: ログイン処理の実装\n                Ok(())\n            }\n            Command::Config { site, contest_id, problem_id, language: _ } =\u003e {\n                println!(\"問題を開きます: site={site:?}, contest={contest_id:?}, problem={problem_id:?}\");\n                site.map_or_else(\n                    || Err(anyhow::anyhow!(contest::error(\"invalid_command\", \"サイトが指定されていません\"))),\n                    |site_str| {\n                        // 設定からテンプレートディレクトリを取得\n                        let template_dir = self.config.contest_template_dir();\n                        let active_dir = self.config.active_contest_dir();\n                        \n                        self.contest_service.open_with_config(\n                            \u0026site_str,\n                            contest_id.as_ref().ok_or_else(|| anyhow::anyhow!(contest::error(\"invalid_command\", \"コンテストIDが指定されていません\")))?,\n                            problem_id.as_ref().ok_or_else(|| anyhow::anyhow!(contest::error(\"invalid_command\", \"問題IDが指定されていません\")))?,\n                            \u0026template_dir,\n                            \u0026active_dir,\n                        )\n                    }\n                )\n            }\n            Command::Open =\u003e {\n                println!(\"問題を開きます\");\n                Ok(())\n            }\n            Command::Test { test_number } =\u003e {\n                context.contest.map_or_else(\n                    || Err(anyhow::anyhow!(contest::error(\"invalid_command\", \"コンテストが選択されていません\"))),\n                    |contest| {\n                        println!(\"テストを実行します: test_number={test_number:?}\");\n                        // 設定からテストディレクトリを取得\n                        let test_dir = self.config.test_dir();\n                        let result = self.test_service.run_test_with_config(\u0026contest, test_number, \u0026test_dir)?;\n                        println!(\"{}\", result.summary());\n                        Ok(())\n                    }\n                )\n            }\n            Command::Submit =\u003e {\n                context.contest.map_or_else(\n                    || Err(anyhow::anyhow!(contest::error(\"invalid_command\", \"コンテストが選択されていません\"))),\n                    |contest| {\n                        println!(\"提出を行います\");\n                        self.contest_service.submit(\u0026contest)\n                    }\n                )\n            }\n        }\n    }\n\n    #[must_use = \"この関数は新しいCommandContextインスタンスを返します\"]\n    pub const fn with_contest(\u0026self, command: Command, contest: Contest) -\u003e CommandContext {\n        CommandContext::with_contest(command, contest)\n    }\n\n    #[must_use = \"この関数は新しいCommandContextインスタンスを返します\"]\n    pub const fn without_contest(\u0026self, command: Command) -\u003e CommandContext {\n        CommandContext::new(command)\n    }\n} ","traces":[{"line":19,"address":[1472368,1472788],"length":1,"stats":{"Line":0}},{"line":20,"address":[1472402,1472458,1472691],"length":1,"stats":{"Line":0}},{"line":21,"address":[1472569],"length":1,"stats":{"Line":0}},{"line":22,"address":[1472529],"length":1,"stats":{"Line":0}},{"line":23,"address":[1472551],"length":1,"stats":{"Line":0}},{"line":33,"address":[1472816,1474328,1474168],"length":1,"stats":{"Line":0}},{"line":34,"address":[1472841],"length":1,"stats":{"Line":0}},{"line":36,"address":[1473478,1472929],"length":1,"stats":{"Line":0}},{"line":38,"address":[1473494],"length":1,"stats":{"Line":0}},{"line":40,"address":[1472960],"length":1,"stats":{"Line":0}},{"line":41,"address":[1473820],"length":1,"stats":{"Line":0}},{"line":42,"address":[1474019,1473926],"length":1,"stats":{"Line":0}},{"line":43,"address":[1468583,1468576],"length":1,"stats":{"Line":0}},{"line":44,"address":[3266102,3264816,3266209],"length":1,"stats":{"Line":0}},{"line":46,"address":[2142188],"length":1,"stats":{"Line":0}},{"line":47,"address":[3264925],"length":1,"stats":{"Line":0}},{"line":49,"address":[3265011,3265867],"length":1,"stats":{"Line":0}},{"line":50,"address":[1469014],"length":1,"stats":{"Line":0}},{"line":51,"address":[1470075,1469118,1470192,1470196],"length":1,"stats":{"Line":0}},{"line":52,"address":[3266040,3266468,3266464,3265438],"length":1,"stats":{"Line":0}},{"line":53,"address":[2143079],"length":1,"stats":{"Line":0}},{"line":54,"address":[3265780],"length":1,"stats":{"Line":0}},{"line":60,"address":[1474196,1473206],"length":1,"stats":{"Line":0}},{"line":61,"address":[1474215],"length":1,"stats":{"Line":0}},{"line":63,"address":[1473240],"length":1,"stats":{"Line":0}},{"line":64,"address":[1473270,1474234],"length":1,"stats":{"Line":0}},{"line":65,"address":[2144048,2144055],"length":1,"stats":{"Line":0}},{"line":66,"address":[2145422,2144304,2145371],"length":1,"stats":{"Line":0}},{"line":67,"address":[2144326,2144460],"length":1,"stats":{"Line":0}},{"line":69,"address":[3267179],"length":1,"stats":{"Line":0}},{"line":70,"address":[1471526,1471122,1471260,1471928],"length":1,"stats":{"Line":0}},{"line":71,"address":[3267599,3267824],"length":1,"stats":{"Line":0}},{"line":72,"address":[2145300],"length":1,"stats":{"Line":0}},{"line":77,"address":[1474249,1473343],"length":1,"stats":{"Line":0}},{"line":78,"address":[2145447,2145440],"length":1,"stats":{"Line":0}},{"line":79,"address":[2145696,2145826],"length":1,"stats":{"Line":0}},{"line":80,"address":[2145765,2145710],"length":1,"stats":{"Line":0}},{"line":81,"address":[2145786],"length":1,"stats":{"Line":0}},{"line":89,"address":[1474432],"length":1,"stats":{"Line":0}},{"line":90,"address":[1474475],"length":1,"stats":{"Line":0}},{"line":94,"address":[1474496],"length":1,"stats":{"Line":0}},{"line":95,"address":[1474524],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":42},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","contest.rs"],"content":"use anyhow::{Result, anyhow};\nuse crate::config::Config;\nuse crate::contest::model::{Contest, TestCase};\nuse crate::fs::manager::Manager;\nuse crate::message::contest;\n\n#[derive(Clone)]\npub struct Service {\n    site: Option\u003cString\u003e,\n    contest_id: Option\u003cString\u003e,\n    problem_id: Option\u003cString\u003e,\n    language: Option\u003cString\u003e,\n    url: Option\u003cString\u003e,\n    file_manager: Option\u003cManager\u003e,\n    #[allow(dead_code)]\n    config: Config,\n}\n\n// 状態遷移を表現する型\n#[derive(Debug, Clone)]\npub enum ServiceTransition {\n    Site(String),\n    ContestId(String),\n    ProblemId(String),\n    TestCase(TestCase),\n    FileManager(Manager),\n}\n\nimpl Service {\n    /// 新しいサービスインスタンスを作成します\n    ///\n    /// # Arguments\n    /// * `config` - サービスの設定\n    ///\n    /// # Returns\n    /// * `Result\u003cSelf\u003e` - 作成されたサービスインスタンス\n    ///\n    /// # Errors\n    /// * 設定の読み込みに失敗した場合\n    pub fn new(config: \u0026Config) -\u003e Result\u003cSelf\u003e {\n        Ok(Self {\n            site: None,\n            contest_id: None,\n            problem_id: None,\n            language: None,\n            url: None,\n            file_manager: None,\n            config: config.clone(),\n        })\n    }\n\n    // アクセサメソッド\n    #[must_use]\n    pub fn site(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.site.as_deref()\n    }\n\n    #[must_use]\n    pub fn contest_id(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.contest_id.as_deref()\n    }\n\n    #[must_use]\n    pub fn problem_id(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.problem_id.as_deref()\n    }\n\n    #[must_use]\n    pub fn language(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.language.as_deref()\n    }\n\n    #[must_use]\n    pub fn url(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.url.as_deref()\n    }\n\n    // 状態遷移を適用するメソッド\n    #[must_use]\n    pub fn apply_transition(self, transition: ServiceTransition) -\u003e Self {\n        match transition {\n            ServiceTransition::Site(site) =\u003e self.with_site(site),\n            ServiceTransition::ContestId(id) =\u003e self.with_contest_id(id),\n            ServiceTransition::ProblemId(id) =\u003e self.with_problem_id(id),\n            ServiceTransition::TestCase(test_case) =\u003e self.with_test_case(test_case),\n            ServiceTransition::FileManager(manager) =\u003e self.with_file_manager(manager),\n        }\n    }\n\n    /// Validates site field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if site is not set\n    pub fn validate_site(\u0026self) -\u003e Result\u003c()\u003e {\n        self.site.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"サイトが指定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates language field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if language is not set\n    pub fn validate_language(\u0026self) -\u003e Result\u003c()\u003e {\n        self.language.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"言語が指定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates `contest_id` field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if `contest_id` is not set\n    pub fn validate_contest_id(\u0026self) -\u003e Result\u003c()\u003e {\n        self.contest_id.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"コンテストIDが指定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates `problem_id` field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if `problem_id` is not set\n    pub fn validate_problem_id(\u0026self) -\u003e Result\u003c()\u003e {\n        self.problem_id.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"問題IDが指定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates url field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if url is not set\n    pub fn validate_url(\u0026self) -\u003e Result\u003c()\u003e {\n        self.url.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"URLが指定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates `file_manager` field\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if `file_manager` is not set\n    pub fn validate_file_manager(\u0026self) -\u003e Result\u003c()\u003e {\n        self.file_manager.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"FileManagerが設定されていません\")))\n            .map(|_| ())\n    }\n\n    /// Validates all fields\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if any field validation fails\n    pub fn validate_all(\u0026self) -\u003e Result\u003c()\u003e {\n        self.validate_site()?;\n        self.validate_contest_id()?;\n        self.validate_problem_id()?;\n        self.validate_language()?;\n        self.validate_url()?;\n        self.validate_file_manager()?;\n        Ok(())\n    }\n\n    // イミュータブルなビルダーメソッド\n    #[must_use]\n    pub fn with_site\u003cT: Into\u003cString\u003e\u003e(self, site: T) -\u003e Self {\n        Self {\n            site: Some(site.into()),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_contest_id\u003cT: Into\u003cString\u003e\u003e(self, contest_id: T) -\u003e Self {\n        Self {\n            contest_id: Some(contest_id.into()),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_problem_id\u003cT: Into\u003cString\u003e\u003e(self, problem_id: T) -\u003e Self {\n        Self {\n            problem_id: Some(problem_id.into()),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_language\u003cT: Into\u003cString\u003e\u003e(self, language: T) -\u003e Self {\n        Self {\n            language: Some(language.into()),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_url\u003cT: Into\u003cString\u003e\u003e(self, url: T) -\u003e Self {\n        Self {\n            url: Some(url.into()),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_file_manager(self, file_manager: Manager) -\u003e Self {\n        Self {\n            file_manager: Some(file_manager),\n            ..self\n        }\n    }\n\n    #[must_use]\n    pub fn with_test_case(self, _test_case: TestCase) -\u003e Self {\n        // テストケースは状態に影響を与えないため、そのまま返す\n        self\n    }\n\n    /// Builds a Contest instance and returns it with the `FileManager`\n    /// \n    /// # Errors\n    /// \n    /// Returns an error if:\n    /// - Any field validation fails\n    /// - Workspace creation fails\n    #[must_use = \"この関数はContestインスタンスとManagerを返します\"]\n    pub fn build(self) -\u003e Result\u003c(Contest, Manager)\u003e {\n        self.validate_all()?;\n        \n        let site = self.site.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"サイトが設定されていません\")))?;\n        let contest_id = self.contest_id.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"コンテストIDが設定されていません\")))?;\n        let problem_id = self.problem_id.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"問題IDが設定されていません\")))?;\n        let language = self.language.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"言語が設定されていません\")))?;\n        let url = self.url.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"URLが設定されていません\")))?;\n        let file_manager = self.file_manager.ok_or_else(|| anyhow!(contest::error(\"resource_not_found\", \"FileManagerが設定されていません\")))?;\n\n        let contest = Contest::new(\n            site,\n            contest_id,\n            problem_id,\n            language,\n            url,\n        );\n\n        Ok((contest, file_manager))\n    }\n\n    /// コンテストを開きます。\n    /// \n    /// # Arguments\n    /// * `site` - サイト名\n    /// * `contest_id` - コンテストID（オプション）\n    /// * `problem_id` - 問題ID（オプション）\n    /// \n    /// # Errors\n    /// - サイトが無効な場合\n    /// - コンテストIDが無効な場合\n    /// - 問題IDが無効な場合\n    pub fn open(\u0026self, site: \u0026str, contest_id: \u0026Option\u003cString\u003e, problem_id: \u0026Option\u003cString\u003e) -\u003e Result\u003c()\u003e {\n        // TODO: 実装\n        println!(\"問題を開きます: site={site}, contest={contest_id:?}, problem={problem_id:?}\");\n        Ok(())\n    }\n\n    /// Submits a solution for the contest\n    /// \n    /// # Errors\n    /// \n    /// Currently this function cannot fail, but returns Result for consistency\n    pub fn submit(\u0026self, contest: \u0026Contest) -\u003e Result\u003c()\u003e {\n        println!(\"{}\", contest::hint(\"optimize_code\", format!(\"提出を行います: contest={contest:?}\")));\n        Ok(())\n    }\n\n    /// 設定を使用してコンテストを開きます\n    /// \n    /// # Arguments\n    /// \n    /// * `site` - サイト名\n    /// * `contest_id` - コンテストID\n    /// * `problem_id` - 問題ID\n    /// * `template_dir` - テンプレートディレクトリ\n    /// * `active_dir` - アクティブディレクトリ\n    /// \n    /// # Errors\n    /// \n    /// - ディレクトリの作成に失敗した場合\n    /// - ファイルのコピーに失敗した場合\n    /// - 問題情報のダウンロードに失敗した場合\n    pub fn open_with_config(\n        \u0026self,\n        site: \u0026str,\n        contest_id: \u0026str,\n        problem_id: \u0026str,\n        template_dir: \u0026str,\n        active_dir: \u0026str,\n    ) -\u003e Result\u003c()\u003e {\n        // アクティブディレクトリのパスを構築\n        let contest_path = format!(\"{active_dir}/{site}/{contest_id}\");\n        let problem_path = format!(\"{contest_path}/{problem_id}\");\n\n        // ファイルマネージャーを作成\n        let mut manager = Manager::new(\u0026problem_path);\n\n        // ディレクトリが存在しない場合は作成\n        if !manager.exists(\"\")? {\n            manager = manager.create_dir(\"\")?;\n        }\n\n        // テンプレートファイルをコピー\n        let template_path = format!(\"{template_dir}/main.rs\");\n        let template_content = std::fs::read_to_string(template_path)\n            .map_err(|e| anyhow::anyhow!(\"テンプレートファイルの読み込みに失敗しました: {e}\"))?;\n\n        // ファイルを書き込み\n        manager.write_file(\"main.rs\", template_content)?;\n\n        // TODO: 問題情報のダウンロード\n        // self.download_problem_info(site, contest_id, problem_id)?;\n\n        Ok(())\n    }\n} ","traces":[{"line":40,"address":[969688,969792,969216],"length":1,"stats":{"Line":0}},{"line":41,"address":[3234519],"length":1,"stats":{"Line":0}},{"line":42,"address":[2111746],"length":1,"stats":{"Line":0}},{"line":43,"address":[3234410],"length":1,"stats":{"Line":0}},{"line":44,"address":[3234418],"length":1,"stats":{"Line":0}},{"line":45,"address":[2111770],"length":1,"stats":{"Line":0}},{"line":46,"address":[969282],"length":1,"stats":{"Line":0}},{"line":47,"address":[2111796],"length":1,"stats":{"Line":0}},{"line":48,"address":[2111812],"length":1,"stats":{"Line":0}},{"line":54,"address":[2112320],"length":1,"stats":{"Line":0}},{"line":55,"address":[2112325],"length":1,"stats":{"Line":0}},{"line":59,"address":[3235008],"length":1,"stats":{"Line":0}},{"line":60,"address":[3235013],"length":1,"stats":{"Line":0}},{"line":64,"address":[2112384],"length":1,"stats":{"Line":0}},{"line":65,"address":[2112389],"length":1,"stats":{"Line":0}},{"line":69,"address":[969904],"length":1,"stats":{"Line":0}},{"line":70,"address":[969909],"length":1,"stats":{"Line":0}},{"line":74,"address":[969936],"length":1,"stats":{"Line":0}},{"line":75,"address":[2112453],"length":1,"stats":{"Line":0}},{"line":80,"address":[3235136],"length":1,"stats":{"Line":0}},{"line":81,"address":[969994],"length":1,"stats":{"Line":0}},{"line":82,"address":[3235236],"length":1,"stats":{"Line":0}},{"line":83,"address":[3235293],"length":1,"stats":{"Line":0}},{"line":84,"address":[3235350],"length":1,"stats":{"Line":0}},{"line":85,"address":[2112738],"length":1,"stats":{"Line":0}},{"line":86,"address":[3235436],"length":1,"stats":{"Line":0}},{"line":95,"address":[2112848],"length":1,"stats":{"Line":0}},{"line":96,"address":[3235509],"length":1,"stats":{"Line":0}},{"line":97,"address":[1788320,1788324],"length":1,"stats":{"Line":0}},{"line":98,"address":[1788544,1788549],"length":1,"stats":{"Line":0}},{"line":106,"address":[3235552],"length":1,"stats":{"Line":0}},{"line":107,"address":[3235557],"length":1,"stats":{"Line":0}},{"line":108,"address":[1788560,1788564],"length":1,"stats":{"Line":0}},{"line":109,"address":[1788789,1788784],"length":1,"stats":{"Line":0}},{"line":117,"address":[3235600],"length":1,"stats":{"Line":0}},{"line":118,"address":[2112949],"length":1,"stats":{"Line":0}},{"line":119,"address":[1880628,1880624],"length":1,"stats":{"Line":0}},{"line":120,"address":[1880869,1880864],"length":1,"stats":{"Line":0}},{"line":128,"address":[3235648],"length":1,"stats":{"Line":0}},{"line":129,"address":[970485],"length":1,"stats":{"Line":0}},{"line":130,"address":[1880880,1880884],"length":1,"stats":{"Line":0}},{"line":131,"address":[1789264,1789269],"length":1,"stats":{"Line":0}},{"line":139,"address":[3235696],"length":1,"stats":{"Line":0}},{"line":140,"address":[2113045],"length":1,"stats":{"Line":0}},{"line":141,"address":[1789284,1789280],"length":1,"stats":{"Line":0}},{"line":142,"address":[1881381,1881376],"length":1,"stats":{"Line":0}},{"line":150,"address":[3235744],"length":1,"stats":{"Line":0}},{"line":151,"address":[970581],"length":1,"stats":{"Line":0}},{"line":152,"address":[1789520,1789524],"length":1,"stats":{"Line":0}},{"line":153,"address":[3005221,3005216],"length":1,"stats":{"Line":0}},{"line":161,"address":[2113136],"length":1,"stats":{"Line":0}},{"line":162,"address":[2113252,2113153],"length":1,"stats":{"Line":0}},{"line":163,"address":[3235997,3235860],"length":1,"stats":{"Line":0}},{"line":164,"address":[970776,970905],"length":1,"stats":{"Line":0}},{"line":165,"address":[970859,970988],"length":1,"stats":{"Line":0}},{"line":166,"address":[2113465,2113596],"length":1,"stats":{"Line":0}},{"line":167,"address":[3236204,3236293],"length":1,"stats":{"Line":0}},{"line":168,"address":[971097],"length":1,"stats":{"Line":0}},{"line":173,"address":[1790158,1789760],"length":1,"stats":{"Line":0}},{"line":175,"address":[1881680,1881748],"length":1,"stats":{"Line":0}},{"line":181,"address":[3005664,3006070],"length":1,"stats":{"Line":0}},{"line":183,"address":[1882180,1882112],"length":1,"stats":{"Line":0}},{"line":189,"address":[3006502,3006096],"length":1,"stats":{"Line":0}},{"line":191,"address":[1882544,1882612],"length":1,"stats":{"Line":0}},{"line":197,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":207,"address":[],"length":0,"stats":{"Line":0}},{"line":213,"address":[3236336],"length":1,"stats":{"Line":0}},{"line":215,"address":[971184],"length":1,"stats":{"Line":0}},{"line":221,"address":[2114032],"length":1,"stats":{"Line":0}},{"line":223,"address":[3236705],"length":1,"stats":{"Line":0}},{"line":234,"address":[973942,974778,971536],"length":1,"stats":{"Line":0}},{"line":235,"address":[2114430,2114110,2114308,2116855],"length":1,"stats":{"Line":0}},{"line":237,"address":[3237120,3237019,3239497,3237312],"length":1,"stats":{"Line":0}},{"line":238,"address":[1791284,1791280],"length":1,"stats":{"Line":0}},{"line":239,"address":[972639,974121,972294,972450],"length":1,"stats":{"Line":0}},{"line":240,"address":[974070,972573,972729,972918],"length":1,"stats":{"Line":0}},{"line":241,"address":[1791952,1791956],"length":1,"stats":{"Line":0}},{"line":242,"address":[1884144,1884148],"length":1,"stats":{"Line":0}},{"line":245,"address":[973444],"length":1,"stats":{"Line":0}},{"line":246,"address":[2116106],"length":1,"stats":{"Line":0}},{"line":247,"address":[3238802],"length":1,"stats":{"Line":0}},{"line":248,"address":[3238842],"length":1,"stats":{"Line":0}},{"line":249,"address":[3238882],"length":1,"stats":{"Line":0}},{"line":252,"address":[3239067],"length":1,"stats":{"Line":0}},{"line":266,"address":[975008],"length":1,"stats":{"Line":0}},{"line":268,"address":[975339],"length":1,"stats":{"Line":0}},{"line":269,"address":[2118110],"length":1,"stats":{"Line":0}},{"line":277,"address":[3241297,3240800],"length":1,"stats":{"Line":0}},{"line":278,"address":[2118258,2118388,2118516],"length":1,"stats":{"Line":0}},{"line":279,"address":[3241275],"length":1,"stats":{"Line":0}},{"line":297,"address":[3243887,3241328,3244010],"length":1,"stats":{"Line":0}},{"line":306,"address":[2118792,2119111],"length":1,"stats":{"Line":0}},{"line":307,"address":[2119562],"length":1,"stats":{"Line":0}},{"line":310,"address":[977110,977059],"length":1,"stats":{"Line":0}},{"line":313,"address":[977143,977608,977204,978545],"length":1,"stats":{"Line":0}},{"line":314,"address":[977296,977613,977506],"length":1,"stats":{"Line":0}},{"line":318,"address":[3243013],"length":1,"stats":{"Line":0}},{"line":319,"address":[3243485,3243901,3243134],"length":1,"stats":{"Line":0}},{"line":320,"address":[1884384,1884493],"length":1,"stats":{"Line":0}},{"line":323,"address":[2120670,2120896,2121191],"length":1,"stats":{"Line":0}},{"line":328,"address":[2121112],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":103},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","mod.rs"],"content":"mod contest;\nmod path;\nmod test;\nmod url;\nmod command;\n\npub use contest::Service as ContestHandler;\npub use path::Service as PathHandler;\npub use test::Service as TestRunner;\npub use url::Service as UrlHandler;\npub use command::Service as CommandProcessor; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","path.rs"],"content":"use std::path::{Path, PathBuf};\nuse anyhow::{Result, anyhow};\nuse crate::message::contest;\n\n/// パスの種類を表す列挙型\n#[derive(Debug, Clone, Copy)]\npub enum Type {\n    Contest,\n    Problem,\n    Source,\n    Test,\n}\n\nimpl Type {\n    /// パスの種類を文字列として取得します\n    const fn as_str(self) -\u003e \u0026'static str {\n        match self {\n            Self::Contest =\u003e \"コンテスト\",\n            Self::Problem =\u003e \"問題\",\n            Self::Source =\u003e \"ソース\",\n            Self::Test =\u003e \"テスト\",\n        }\n    }\n}\n\n/// パス管理サービスを提供する構造体\n#[derive(Debug)]\npub struct Service {\n    #[allow(dead_code)]\n    base_dir: PathBuf,\n}\n\nimpl Service {\n    /// 新しいパス管理サービスを作成します\n    ///\n    /// # Arguments\n    /// * `base_dir` - ベースディレクトリ\n    ///\n    /// # Returns\n    /// * `Self` - 新しいパス管理サービスインスタンス\n    #[must_use = \"この関数は新しいPathServiceインスタンスを返します\"]\n    pub fn new(base_dir: impl AsRef\u003cPath\u003e) -\u003e Self {\n        Self {\n            base_dir: base_dir.as_ref().to_path_buf(),\n        }\n    }\n\n    /// パスの存在を検証します\n    ///\n    /// # Arguments\n    /// * `path` - 検証するパス\n    /// * `path_type` - パスの種類\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 検証結果\n    ///\n    /// # Errors\n    /// * パスが存在しない場合\n    pub fn validate_path_exists(path: impl AsRef\u003cPath\u003e, path_type: Type) -\u003e Result\u003c()\u003e {\n        let path = path.as_ref();\n        if !path.exists() {\n            return Err(anyhow!(contest::error(\n                \"path_error\",\n                format!(\"{}ディレクトリが存在しません: {}\", path_type.as_str(), path.display())\n            )));\n        }\n        Ok(())\n    }\n\n    /// ディレクトリを作成します\n    ///\n    /// # Arguments\n    /// * `path` - 作成するディレクトリのパス\n    /// * `path_type` - パスの種類\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 作成結果\n    ///\n    /// # Errors\n    /// * ディレクトリの作成に失敗した場合\n    pub fn create_directory(path: impl AsRef\u003cPath\u003e, path_type: Type) -\u003e Result\u003c()\u003e {\n        let path = path.as_ref();\n        if !path.exists() {\n            std::fs::create_dir_all(path)\n                .map_err(|e| anyhow!(contest::error(\n                    \"path_error\",\n                    format!(\"{}ディレクトリの作成に失敗: {}: {}\", path_type.as_str(), path.display(), e)\n                )))?;\n        }\n        Ok(())\n    }\n}","traces":[{"line":16,"address":[1826736],"length":1,"stats":{"Line":0}},{"line":17,"address":[1826743],"length":1,"stats":{"Line":0}},{"line":18,"address":[1826776],"length":1,"stats":{"Line":0}},{"line":19,"address":[1826799],"length":1,"stats":{"Line":0}},{"line":20,"address":[1826822],"length":1,"stats":{"Line":0}},{"line":21,"address":[1826845],"length":1,"stats":{"Line":0}},{"line":42,"address":[],"length":0,"stats":{"Line":0}},{"line":44,"address":[],"length":0,"stats":{"Line":0}},{"line":59,"address":[],"length":0,"stats":{"Line":0}},{"line":60,"address":[],"length":0,"stats":{"Line":0}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":62,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":0}},{"line":64,"address":[],"length":0,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":81,"address":[],"length":0,"stats":{"Line":0}},{"line":82,"address":[],"length":0,"stats":{"Line":0}},{"line":83,"address":[],"length":0,"stats":{"Line":0}},{"line":84,"address":[],"length":0,"stats":{"Line":0}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":86,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":23},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","test.rs"],"content":"use std::path::{Path, PathBuf};\nuse anyhow::{Result as AnyhowResult, anyhow};\nuse crate::config::Config;\nuse crate::contest::model::Contest;\nuse crate::message::contest;\nuse crate::docker::execution::Runtime;\n\n/// テスト結果の状態を表す列挙型\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum Status {\n    Success,\n    Failure,\n    Error,\n}\n\n/// テストケースの結果を表す構造体\n#[derive(Debug)]\npub struct CaseResult {\n    pub case_number: usize,\n    pub status: Status,\n    pub execution_time: std::time::Duration,\n    pub stdout: String,\n    pub stderr: String,\n    pub expected: String,\n    pub actual: String,\n}\n\n/// テスト実行の結果を表す構造体\n#[derive(Debug)]\n#[allow(clippy::module_name_repetitions)]\npub struct TestResults {\n    pub total_cases: usize,\n    pub successful_cases: usize,\n    pub failed_cases: usize,\n    pub error_cases: usize,\n    pub total_time: std::time::Duration,\n    pub case_results: Vec\u003cCaseResult\u003e,\n}\n\nimpl TestResults {\n    /// テスト結果の概要を文字列として取得します\n    #[must_use]\n    pub fn summary(\u0026self) -\u003e String {\n        format!(\n            \"テスト結果: {} テスト中 {} 成功, {} 失敗, {} エラー (合計時間: {:.2}秒)\",\n            self.total_cases,\n            self.successful_cases,\n            self.failed_cases,\n            self.error_cases,\n            self.total_time.as_secs_f64()\n        )\n    }\n}\n\n/// テスト実行サービスを提供する構造体\n#[derive(Debug)]\npub struct Service {\n    #[allow(dead_code)]\n    config: Config,\n    #[allow(dead_code)]\n    runtime: Runtime,\n}\n\nimpl Service {\n    /// 新しいテストサービスを作成します\n    /// \n    /// # Arguments\n    /// * `config` - 設定情報\n    /// \n    /// # Returns\n    /// * `AnyhowResult\u003cSelf\u003e` - 新しいテストサービスインスタンス\n    /// \n    /// # Errors\n    /// - 設定の読み込みに失敗した場合\n    #[must_use = \"この関数は新しいTestServiceインスタンスを返します\"]\n    pub fn new(config: \u0026Config) -\u003e AnyhowResult\u003cSelf\u003e {\n        Ok(Self {\n            config: config.clone(),\n            runtime: Runtime::new(),\n        })\n    }\n\n    /// テストを実行します\n    /// \n    /// # Arguments\n    /// * `contest` - コンテスト情報\n    /// * `test_number` - 実行するテストケース番号（Noneの場合は全テストを実行）\n    /// \n    /// # Returns\n    /// * `AnyhowResult\u003cTestResults\u003e` - テスト実行結果\n    /// \n    /// # Errors\n    /// - テストの実行に失敗した場合\n    pub fn run_test(\u0026self, contest: \u0026Contest, test_number: Option\u003cusize\u003e) -\u003e AnyhowResult\u003cTestResults\u003e {\n        let test_dir = contest.get_test_dir()?;\n        let source_file = contest.get_source_file()?;\n\n        // テストケースの一覧を取得\n        let test_cases = Self::get_test_cases(\u0026test_dir, test_number)?;\n        if test_cases.is_empty() {\n            return Err(anyhow!(contest::error(\"test_failed\", \"テストケースが見つかりません\")));\n        }\n\n        let start_time = std::time::Instant::now();\n        let mut results = Vec::new();\n        let mut successful_cases = 0;\n        let mut failed_cases = 0;\n        let mut error_cases = 0;\n        let total_cases = test_cases.len();\n\n        // 各テストケースを実行\n        for (case_number, (input_file, expected_file)) in test_cases {\n            match Self::run_test_case(case_number, \u0026source_file, \u0026input_file, \u0026expected_file) {\n                Ok(result) =\u003e {\n                    match result.status {\n                        Status::Success =\u003e successful_cases += 1,\n                        Status::Failure =\u003e failed_cases += 1,\n                        Status::Error =\u003e error_cases += 1,\n                    }\n                    results.push(result);\n                }\n                Err(e) =\u003e {\n                    error_cases += 1;\n                    results.push(CaseResult {\n                        case_number,\n                        status: Status::Error,\n                        execution_time: std::time::Duration::from_secs(0),\n                        stdout: String::new(),\n                        stderr: e.to_string(),\n                        expected: String::new(),\n                        actual: String::new(),\n                    });\n                }\n            }\n        }\n\n        Ok(TestResults {\n            total_cases,\n            successful_cases,\n            failed_cases,\n            error_cases,\n            total_time: start_time.elapsed(),\n            case_results: results,\n        })\n    }\n\n    /// テストケースの一覧を取得します\n    /// \n    /// # Arguments\n    /// * `test_dir` - テストディレクトリ\n    /// * `test_number` - 取得するテストケース番号（Noneの場合は全テスト）\n    /// \n    /// # Returns\n    /// * `AnyhowResult\u003cVec\u003c(usize, (PathBuf, PathBuf))\u003e\u003e` - テストケース番号とテストファイルのペアのリスト\n    /// \n    /// # Errors\n    /// - テストケースの読み取りに失敗した場合\n    fn get_test_cases(\n        test_dir: \u0026Path,\n        test_number: Option\u003cusize\u003e,\n    ) -\u003e AnyhowResult\u003cVec\u003c(usize, (PathBuf, PathBuf))\u003e\u003e {\n        let mut cases = Vec::new();\n        \n        if let Some(n) = test_number {\n            let input = test_dir.join(format!(\"{n}.in\"));\n            let expected = test_dir.join(format!(\"{n}.out\"));\n            if input.exists() \u0026\u0026 expected.exists() {\n                cases.push((n, (input, expected)));\n            }\n        } else {\n            for entry in std::fs::read_dir(test_dir)? {\n                let entry = entry?;\n                let path = entry.path();\n                if let Some(ext) = path.extension() {\n                    if ext == \"in\" {\n                        if let Some(stem) = path.file_stem() {\n                            if let Ok(n) = stem.to_string_lossy().parse::\u003cusize\u003e() {\n                                let expected = test_dir.join(format!(\"{n}.out\"));\n                                if expected.exists() {\n                                    cases.push((n, (path, expected)));\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n            cases.sort_by_key(|(n, _)| *n);\n        }\n\n        Ok(cases)\n    }\n\n    /// 単一のテストケースを実行します\n    /// \n    /// # Arguments\n    /// * `case_number` - テストケース番号\n    /// * `source_file` - ソースファイル\n    /// * `input_file` - 入力ファイル\n    /// * `expected_file` - 期待される出力ファイル\n    /// \n    /// # Returns\n    /// * `AnyhowResult\u003cCaseResult\u003e` - テストケースの実実行結果\n    /// \n    /// # Errors\n    /// - テストケースの実行に失敗した場合\n    fn run_test_case(\n        case_number: usize,\n        source_file: \u0026Path,\n        input_file: \u0026Path,\n        expected_file: \u0026Path,\n    ) -\u003e AnyhowResult\u003cCaseResult\u003e {\n        let start_time = std::time::Instant::now();\n\n        // コンテナを作成して実行\n        let mut runtime = Runtime::new().with_auto_remove(true);\n        runtime.create(\"rust:latest\", \u0026[])?;\n        let (stdout, stderr) = runtime.execute_command(\u0026[\n            \"exec\",\n            source_file.to_string_lossy().as_ref(),\n            \"\u003c\",\n            input_file.to_string_lossy().as_ref(),\n        ])?;\n\n        // 期待される出力を読み込み\n        let expected = std::fs::read_to_string(expected_file)?;\n        let actual = stdout.trim().to_string();\n\n        // 結果を比較\n        let status = if stderr.is_empty() \u0026\u0026 actual == expected.trim() {\n            Status::Success\n        } else if !stderr.is_empty() {\n            Status::Error\n        } else {\n            Status::Failure\n        };\n\n        Ok(CaseResult {\n            case_number,\n            status,\n            execution_time: start_time.elapsed(),\n            stdout,\n            stderr,\n            expected,\n            actual,\n        })\n    }\n\n    /// 設定を使用してテストを実行します\n    /// \n    /// # Arguments\n    /// \n    /// * `contest` - コンテスト情報\n    /// * `test_number` - テスト番号（Noneの場合は全てのテストを実行）\n    /// * `test_dir` - テストディレクトリ\n    /// \n    /// # Errors\n    /// \n    /// - テストの実行に失敗した場合\n    pub fn run_test_with_config(\n        \u0026self,\n        _contest: \u0026Contest,\n        _test_number: Option\u003cusize\u003e,\n        test_dir: \u0026str,\n    ) -\u003e AnyhowResult\u003cTestResults\u003e {\n        // TODO: 実装\n        println!(\"テストディレクトリ: {test_dir}\");\n        Ok(TestResults {\n            total_cases: 0,\n            successful_cases: 0,\n            failed_cases: 0,\n            error_cases: 0,\n            total_time: std::time::Duration::from_secs(0),\n            case_results: Vec::new(),\n        })\n    }\n} ","traces":[{"line":43,"address":[3113664],"length":1,"stats":{"Line":0}},{"line":44,"address":[1991068,1991288,1991508,1989974,1990848,1990253,1990067,1990160,1991740,1990474],"length":1,"stats":{"Line":0}},{"line":50,"address":[1990346],"length":1,"stats":{"Line":0}},{"line":76,"address":[1992219,1992000],"length":1,"stats":{"Line":0}},{"line":77,"address":[1992100],"length":1,"stats":{"Line":0}},{"line":78,"address":[3115760],"length":1,"stats":{"Line":0}},{"line":79,"address":[1771629],"length":1,"stats":{"Line":0}},{"line":94,"address":[1992256,1996085,1995104],"length":1,"stats":{"Line":0}},{"line":95,"address":[1992346,1992540],"length":1,"stats":{"Line":0}},{"line":96,"address":[1772087,1772340,1772195,1775560],"length":1,"stats":{"Line":0}},{"line":99,"address":[3116807,3116632,3116480,3119790],"length":1,"stats":{"Line":0}},{"line":100,"address":[3116773,3116892],"length":1,"stats":{"Line":0}},{"line":101,"address":[3119457,3116924,3119746],"length":1,"stats":{"Line":0}},{"line":104,"address":[1993170,1993258],"length":1,"stats":{"Line":0}},{"line":105,"address":[1993273],"length":1,"stats":{"Line":0}},{"line":106,"address":[1993292],"length":1,"stats":{"Line":0}},{"line":107,"address":[1772837],"length":1,"stats":{"Line":0}},{"line":108,"address":[3117044],"length":1,"stats":{"Line":0}},{"line":109,"address":[1993328,1993407],"length":1,"stats":{"Line":0}},{"line":112,"address":[3117143,3117345,3117399],"length":1,"stats":{"Line":0}},{"line":113,"address":[3117495,3117969],"length":1,"stats":{"Line":0}},{"line":114,"address":[1994429],"length":1,"stats":{"Line":0}},{"line":115,"address":[1774074],"length":1,"stats":{"Line":0}},{"line":116,"address":[1994649,1994740],"length":1,"stats":{"Line":0}},{"line":117,"address":[1994979,1994673],"length":1,"stats":{"Line":0}},{"line":118,"address":[1995018,1994704],"length":1,"stats":{"Line":0}},{"line":120,"address":[3118539],"length":1,"stats":{"Line":0}},{"line":122,"address":[1994600],"length":1,"stats":{"Line":0}},{"line":123,"address":[1774655,1774125,1774619],"length":1,"stats":{"Line":0}},{"line":124,"address":[3119177],"length":1,"stats":{"Line":0}},{"line":126,"address":[3118854],"length":1,"stats":{"Line":0}},{"line":127,"address":[1995138],"length":1,"stats":{"Line":0}},{"line":128,"address":[1774746],"length":1,"stats":{"Line":0}},{"line":129,"address":[1995252],"length":1,"stats":{"Line":0}},{"line":130,"address":[1995328],"length":1,"stats":{"Line":0}},{"line":131,"address":[1774881],"length":1,"stats":{"Line":0}},{"line":137,"address":[1993962],"length":1,"stats":{"Line":0}},{"line":139,"address":[1993793],"length":1,"stats":{"Line":0}},{"line":140,"address":[1773318],"length":1,"stats":{"Line":0}},{"line":141,"address":[3117553],"length":1,"stats":{"Line":0}},{"line":142,"address":[3117569],"length":1,"stats":{"Line":0}},{"line":143,"address":[3117658],"length":1,"stats":{"Line":0}},{"line":158,"address":[3121313,3119840,3123409],"length":1,"stats":{"Line":0}},{"line":162,"address":[1775655],"length":1,"stats":{"Line":0}},{"line":164,"address":[1775700,1776897],"length":1,"stats":{"Line":0}},{"line":165,"address":[1996454,1996591],"length":1,"stats":{"Line":0}},{"line":166,"address":[1776238,1776391],"length":1,"stats":{"Line":0}},{"line":167,"address":[1996959,1997039,1997093],"length":1,"stats":{"Line":0}},{"line":168,"address":[3120887],"length":1,"stats":{"Line":0}},{"line":171,"address":[1999679,1996388,1997911,1997881,1997616],"length":1,"stats":{"Line":0}},{"line":172,"address":[1998063,1997959,1998223],"length":1,"stats":{"Line":0}},{"line":173,"address":[3121916,3122032],"length":1,"stats":{"Line":0}},{"line":174,"address":[1998385,1998320],"length":1,"stats":{"Line":0}},{"line":175,"address":[3122274,3122221],"length":1,"stats":{"Line":0}},{"line":176,"address":[3122288],"length":1,"stats":{"Line":0}},{"line":177,"address":[3122435,3122525,3123252],"length":1,"stats":{"Line":0}},{"line":178,"address":[3122716,3122853],"length":1,"stats":{"Line":0}},{"line":179,"address":[3122964,3122896],"length":1,"stats":{"Line":0}},{"line":180,"address":[1999276],"length":1,"stats":{"Line":0}},{"line":187,"address":[1777429],"length":1,"stats":{"Line":0}},{"line":190,"address":[3121203],"length":1,"stats":{"Line":0}},{"line":206,"address":[2002164,1999696,2002017],"length":1,"stats":{"Line":0}},{"line":212,"address":[1999880],"length":1,"stats":{"Line":0}},{"line":215,"address":[3123632],"length":1,"stats":{"Line":0}},{"line":216,"address":[2000068,2000171,1999975,2002162],"length":1,"stats":{"Line":0}},{"line":217,"address":[3124512,3124165],"length":1,"stats":{"Line":0}},{"line":219,"address":[2000156,2000208],"length":1,"stats":{"Line":0}},{"line":221,"address":[2000337],"length":1,"stats":{"Line":0}},{"line":225,"address":[2001103,2000925],"length":1,"stats":{"Line":0}},{"line":226,"address":[2001078,2001194],"length":1,"stats":{"Line":0}},{"line":229,"address":[2001244,2001339,2001303,2001457],"length":1,"stats":{"Line":0}},{"line":230,"address":[2001449],"length":1,"stats":{"Line":0}},{"line":231,"address":[3125191,3125205,3125045],"length":1,"stats":{"Line":0}},{"line":232,"address":[1780833],"length":1,"stats":{"Line":0}},{"line":234,"address":[3125207],"length":1,"stats":{"Line":0}},{"line":237,"address":[3125475],"length":1,"stats":{"Line":0}},{"line":239,"address":[2001487],"length":1,"stats":{"Line":0}},{"line":240,"address":[3125226],"length":1,"stats":{"Line":0}},{"line":241,"address":[2001555],"length":1,"stats":{"Line":0}},{"line":242,"address":[3125331],"length":1,"stats":{"Line":0}},{"line":243,"address":[2001651],"length":1,"stats":{"Line":0}},{"line":244,"address":[2001699],"length":1,"stats":{"Line":0}},{"line":259,"address":[2002192],"length":1,"stats":{"Line":0}},{"line":266,"address":[2002354],"length":1,"stats":{"Line":0}},{"line":267,"address":[2002452],"length":1,"stats":{"Line":0}},{"line":272,"address":[2002408],"length":1,"stats":{"Line":0}},{"line":273,"address":[2002425],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":87},{"path":["/","home","cphelper-dev","project-cph","src","contest","service","url.rs"],"content":"use anyhow::{Result, anyhow};\nuse crate::message::contest;\n\n/// URL生成を担当するトレイト\npub trait Generator: std::fmt::Debug {\n    /// コンテストのURLを生成します\n    fn contest_url(\u0026self, contest_id: \u0026str) -\u003e String;\n\n    /// 問題のURLを生成します\n    fn problem_url(\u0026self, contest_id: \u0026str, problem_id: \u0026str) -\u003e String;\n}\n\n/// `AtCoder`のURL生成を担当する構造体\n#[derive(Debug)]\npub struct AtCoderGenerator;\n\nimpl Generator for AtCoderGenerator {\n    fn contest_url(\u0026self, contest_id: \u0026str) -\u003e String {\n        format!(\"https://atcoder.jp/contests/{contest_id}\")\n    }\n\n    fn problem_url(\u0026self, contest_id: \u0026str, problem_id: \u0026str) -\u003e String {\n        format!(\"https://atcoder.jp/contests/{contest_id}/tasks/{problem_id}\")\n    }\n}\n\n/// URL管理サービスを提供する構造体\n#[derive(Debug)]\npub struct Service {\n    site: Option\u003cBox\u003cdyn Generator\u003e\u003e,\n    contest_id: Option\u003cString\u003e,\n    problem_id: Option\u003cString\u003e,\n}\n\nimpl Default for Service {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Service {\n    /// 新しいURL管理サービスを作成します\n    ///\n    /// # Returns\n    /// * `Self` - 新しいURL管理サービスインスタンス\n    #[must_use = \"この関数は新しいURLServiceインスタンスを返します\"]\n    pub const fn new() -\u003e Self {\n        Self {\n            site: None,\n            contest_id: None,\n            problem_id: None,\n        }\n    }\n\n    /// サイトを設定します\n    ///\n    /// # Arguments\n    /// * `site` - URL生成を担当する構造体\n    ///\n    /// # Returns\n    /// * `Self` - 設定を変更したURL管理サービスインスタンス\n    #[must_use = \"この関数は新しいURLServiceインスタンスを返します\"]\n    pub fn with_site(mut self, site: Box\u003cdyn Generator\u003e) -\u003e Self {\n        self.site = Some(site);\n        self\n    }\n\n    /// コンテストIDを設定します\n    ///\n    /// # Arguments\n    /// * `contest_id` - コンテストID\n    ///\n    /// # Returns\n    /// * `Self` - 設定を変更したURL管理サービスインスタンス\n    #[must_use = \"この関数は新しいURLServiceインスタンスを返します\"]\n    pub fn with_contest_id(mut self, contest_id: impl Into\u003cString\u003e) -\u003e Self {\n        self.contest_id = Some(contest_id.into());\n        self\n    }\n\n    /// 問題IDを設定します\n    ///\n    /// # Arguments\n    /// * `problem_id` - 問題ID\n    ///\n    /// # Returns\n    /// * `Self` - 設定を変更したURL管理サービスインスタンス\n    #[must_use = \"この関数は新しいURLServiceインスタンスを返します\"]\n    pub fn with_problem_id(mut self, problem_id: impl Into\u003cString\u003e) -\u003e Self {\n        self.problem_id = Some(problem_id.into());\n        self\n    }\n\n    /// コンテストのURLを取得します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - コンテストのURL\n    ///\n    /// # Errors\n    /// * サイトが設定されていない場合\n    /// * コンテストIDが設定されていない場合\n    /// * 内部状態が不整合な場合（`validate_site`が成功したのに`site`が`None`の場合など）\n    pub fn get_contest_url(\u0026self) -\u003e Result\u003cString\u003e {\n        self.validate_site()?;\n        self.validate_contest_id()?;\n\n        let site = self.site.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"url_error\", \"サイトが設定されていません\")))?;\n        let contest_id = self.contest_id.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"url_error\", \"コンテストIDが設定されていません\")))?;\n\n        Ok(site.contest_url(contest_id))\n    }\n\n    /// 問題のURLを取得します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - 問題のURL\n    ///\n    /// # Errors\n    /// * サイトが設定されていない場合\n    /// * コンテストIDが設定されていない場合\n    /// * 問題IDが設定されていない場合\n    /// * 内部状態が不整合な場合（`validate_site`が成功したのに`site`が`None`の場合など）\n    pub fn get_problem_url(\u0026self) -\u003e Result\u003cString\u003e {\n        self.validate_site()?;\n        self.validate_contest_id()?;\n        self.validate_problem_id()?;\n\n        let site = self.site.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"url_error\", \"サイトが設定されていません\")))?;\n        let contest_id = self.contest_id.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"url_error\", \"コンテストIDが設定されていません\")))?;\n        let problem_id = self.problem_id.as_ref()\n            .ok_or_else(|| anyhow!(contest::error(\"url_error\", \"問題IDが設定されていません\")))?;\n\n        Ok(site.problem_url(contest_id, problem_id))\n    }\n\n    /// サイトの設定を検証します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 検証結果\n    ///\n    /// # Errors\n    /// * サイトが設定されていない場合\n    fn validate_site(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.site.is_none() {\n            return Err(anyhow!(contest::error(\"url_error\", \"サイトが設定されていません\")));\n        }\n        Ok(())\n    }\n\n    /// コンテストIDの設定を検証します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 検証結果\n    ///\n    /// # Errors\n    /// * コンテストIDが設定されていない場合\n    fn validate_contest_id(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.contest_id.is_none() {\n            return Err(anyhow!(contest::error(\"url_error\", \"コンテストIDが設定されていません\")));\n        }\n        Ok(())\n    }\n\n    /// 問題IDの設定を検証します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 検証結果\n    ///\n    /// # Errors\n    /// * 問題IDが設定されていない場合\n    fn validate_problem_id(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.problem_id.is_none() {\n            return Err(anyhow!(contest::error(\"url_error\", \"問題IDが設定されていません\")));\n        }\n        Ok(())\n    }\n} ","traces":[{"line":18,"address":[1830096],"length":1,"stats":{"Line":0}},{"line":19,"address":[1830228],"length":1,"stats":{"Line":0}},{"line":22,"address":[1830336],"length":1,"stats":{"Line":0}},{"line":23,"address":[1830583],"length":1,"stats":{"Line":0}},{"line":36,"address":[1830736],"length":1,"stats":{"Line":0}},{"line":37,"address":[1830744],"length":1,"stats":{"Line":0}},{"line":47,"address":[1830768],"length":1,"stats":{"Line":0}},{"line":63,"address":[1831044,1830896],"length":1,"stats":{"Line":0}},{"line":64,"address":[1830931,1831006],"length":1,"stats":{"Line":0}},{"line":65,"address":[1831024],"length":1,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[],"length":0,"stats":{"Line":0}},{"line":78,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[1831072],"length":1,"stats":{"Line":0}},{"line":104,"address":[1831210,1831110],"length":1,"stats":{"Line":0}},{"line":105,"address":[1831298,1831159],"length":1,"stats":{"Line":0}},{"line":107,"address":[1831416,1831333,1831245],"length":1,"stats":{"Line":0}},{"line":108,"address":[2130208,2130212],"length":1,"stats":{"Line":0}},{"line":109,"address":[1831561,1831351,1831438],"length":1,"stats":{"Line":0}},{"line":110,"address":[2130452,2130448],"length":1,"stats":{"Line":0}},{"line":112,"address":[1831451],"length":1,"stats":{"Line":0}},{"line":125,"address":[1831600],"length":1,"stats":{"Line":0}},{"line":126,"address":[1831638,1831738],"length":1,"stats":{"Line":0}},{"line":127,"address":[1831687,1831824],"length":1,"stats":{"Line":0}},{"line":128,"address":[1831912,1831773],"length":1,"stats":{"Line":0}},{"line":130,"address":[1831947,1831859,1832030],"length":1,"stats":{"Line":0}},{"line":131,"address":[2130692,2130688],"length":1,"stats":{"Line":0}},{"line":132,"address":[1832052,1832154,1831965],"length":1,"stats":{"Line":0}},{"line":133,"address":[2130928,2130932],"length":1,"stats":{"Line":0}},{"line":134,"address":[1832181,1832342,1832073],"length":1,"stats":{"Line":0}},{"line":135,"address":[2131172,2131168],"length":1,"stats":{"Line":0}},{"line":137,"address":[1832201],"length":1,"stats":{"Line":0}},{"line":147,"address":[1832607,1832636,1832368],"length":1,"stats":{"Line":0}},{"line":148,"address":[1832380],"length":1,"stats":{"Line":0}},{"line":149,"address":[1832504,1832409,1832620],"length":1,"stats":{"Line":0}},{"line":151,"address":[1832398],"length":1,"stats":{"Line":0}},{"line":161,"address":[1832920,1832656,1832891],"length":1,"stats":{"Line":0}},{"line":162,"address":[1832668],"length":1,"stats":{"Line":0}},{"line":163,"address":[1832904,1832693,1832788],"length":1,"stats":{"Line":0}},{"line":165,"address":[1832682],"length":1,"stats":{"Line":0}},{"line":175,"address":[1833212,1833183,1832944],"length":1,"stats":{"Line":0}},{"line":176,"address":[1832956],"length":1,"stats":{"Line":0}},{"line":177,"address":[1833196,1833080,1832985],"length":1,"stats":{"Line":0}},{"line":179,"address":[1832974],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":47},{"path":["/","home","cphelper-dev","project-cph","src","docker","config.rs"],"content":"use std::path::PathBuf;\n\n/// Dockerコンテナの実行設定\n#[derive(Debug, Clone)]\npub struct Config {\n    /// コンテナのイメージ名\n    pub image: String,\n    /// コンテナ内で実行するコマンド\n    pub command: Vec\u003cString\u003e,\n    /// コンテナ内の作業ディレクトリ\n    pub working_dir: PathBuf,\n    /// コンテナ内の環境変数\n    pub env_vars: Vec\u003cString\u003e,\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","execution","command.rs"],"content":"use std::process::{Command, Output};\nuse std::borrow::Cow;\nuse anyhow::{Result, anyhow, Context};\nuse crate::message::docker;\n\n/// Dockerコマンドの実行結果を表す構造体\n#[derive(Debug)]\npub struct ExecutionResult {\n    pub stdout: String,\n    pub stderr: String,\n    pub exit_code: i32,\n}\n\n/// Dockerコマンドの実行を担当する構造体\n///\n/// # Fields\n/// * `name` - 実行するDockerコマンド名\n/// * `args` - コマンドの引数リスト\n/// * `capture_stderr` - 標準エラー出力をキャプチャするかどうか\n#[derive(Clone)]\npub struct Executor {\n    name: String,\n    args: Vec\u003cString\u003e,\n    capture_stderr: bool,\n}\n\nimpl Executor {\n    /// 新しいExecutorインスタンスを作成します\n    ///\n    /// # Arguments\n    /// * `name` - 実行するDockerコマンド名\n    ///\n    /// # Returns\n    /// * `Self` - 新しいExecutorインスタンス\n    #[must_use = \"この関数は新しいExecutorインスタンスを返します\"]\n    pub fn new(name: impl Into\u003cString\u003e) -\u003e Self {\n        Self {\n            name: name.into(),\n            args: Vec::new(),\n            capture_stderr: false,\n        }\n    }\n\n    /// 標準エラー出力のキャプチャを設定します\n    ///\n    /// # Arguments\n    /// * `capture` - キャプチャするかどうか\n    ///\n    /// # Returns\n    /// * `Self` - 新しいExecutorインスタンス\n    #[must_use = \"この関数は新しいExecutorインスタンスを返します\"]\n    pub fn capture_stderr(self, capture: bool) -\u003e Self {\n        Self {\n            capture_stderr: capture,\n            ..self\n        }\n    }\n\n    /// コマンドに単一の引数を追加します\n    ///\n    /// # Arguments\n    /// * `arg` - 追加する引数\n    ///\n    /// # Returns\n    /// * `Self` - 新しいExecutorインスタンス\n    #[must_use = \"この関数は新しいExecutorインスタンスを返します\"]\n    pub fn arg\u003c'a, S: Into\u003cCow\u003c'a, str\u003e\u003e\u003e(self, arg: S) -\u003e Self {\n        let mut args = self.args;\n        args.push(arg.into().into_owned());\n        Self {\n            name: self.name,\n            args,\n            capture_stderr: self.capture_stderr,\n        }\n    }\n\n    /// コマンドに複数の引数を追加します\n    ///\n    /// # Arguments\n    /// * `args` - 追加する引数のイテレータ\n    ///\n    /// # Returns\n    /// * `Self` - 新しいExecutorインスタンス\n    #[must_use = \"この関数は新しいExecutorインスタンスを返します\"]\n    pub fn args\u003cI, S\u003e(self, args: I) -\u003e Self\n    where\n        I: IntoIterator\u003cItem = S\u003e,\n        S: AsRef\u003cstr\u003e,\n    {\n        let mut new_args = self.args;\n        new_args.extend(args.into_iter().map(|s| s.as_ref().to_owned()));\n        Self {\n            name: self.name,\n            args: new_args,\n            capture_stderr: self.capture_stderr,\n        }\n    }\n\n    /// コマンドを実行し、生の出力を返します\n    ///\n    /// # Returns\n    /// * `Result\u003cOutput\u003e` - コマンドの実行結果\n    ///\n    /// # Errors\n    /// * コマンドの実行に失敗した場合\n    fn execute_raw(\u0026self) -\u003e Result\u003cOutput\u003e {\n        Command::new(\"docker\")\n            .arg(\u0026self.name)\n            .args(\u0026self.args)\n            .output()\n            .with_context(|| docker::error(\"command_failed\", \"コマンドの実行に失敗しました\"))\n    }\n\n    /// コマンドを実行し、結果を返します\n    ///\n    /// # Returns\n    /// * `Result\u003cExecutionResult\u003e` - コマンドの実行結果\n    ///\n    /// # Errors\n    /// * コマンドの実行に失敗した場合\n    /// * 出力の文字列変換に失敗した場合\n    pub fn execute(self) -\u003e Result\u003cExecutionResult\u003e {\n        let output = self.execute_raw()?;\n\n        let stdout = String::from_utf8(output.stdout)\n            .with_context(|| docker::error(\"command_failed\", \"標準出力の解析に失敗しました\"))?;\n        let stderr = String::from_utf8(output.stderr)\n            .with_context(|| docker::error(\"command_failed\", \"標準エラー出力の解析に失敗しました\"))?;\n\n        if !output.status.success() {\n            if self.capture_stderr {\n                return Ok(ExecutionResult {\n                    stdout,\n                    stderr,\n                    exit_code: output.status.code().unwrap_or(-1),\n                });\n            }\n            return Err(anyhow!(docker::error(\"command_failed\", stderr)));\n        }\n\n        Ok(ExecutionResult {\n            stdout,\n            stderr,\n            exit_code: 0,\n        })\n    }\n\n    /// コマンドを実行し、標準出力のみを返します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - コマンドの標準出力\n    ///\n    /// # Errors\n    /// * コマンドの実行に失敗した場合\n    /// * 出力の文字列変換に失敗した場合\n    pub fn execute_output(self) -\u003e Result\u003cString\u003e {\n        self.execute().map(|result| result.stdout)\n    }\n} ","traces":[{"line":36,"address":[],"length":0,"stats":{"Line":0}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":39,"address":[],"length":0,"stats":{"Line":0}},{"line":52,"address":[2097680],"length":1,"stats":{"Line":0}},{"line":67,"address":[],"length":0,"stats":{"Line":0}},{"line":68,"address":[],"length":0,"stats":{"Line":0}},{"line":69,"address":[],"length":0,"stats":{"Line":0}},{"line":71,"address":[],"length":0,"stats":{"Line":0}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":90,"address":[],"length":0,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":93,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":106,"address":[2097760,2097981],"length":1,"stats":{"Line":0}},{"line":107,"address":[3220555,3220446],"length":1,"stats":{"Line":0}},{"line":109,"address":[2097895],"length":1,"stats":{"Line":0}},{"line":111,"address":[1684924,1684912],"length":1,"stats":{"Line":0}},{"line":122,"address":[3222484,3222925,3220672],"length":1,"stats":{"Line":0}},{"line":123,"address":[1028582,1028690,1030761,1028930],"length":1,"stats":{"Line":0}},{"line":125,"address":[2098472,2100167,2098715,2098332],"length":1,"stats":{"Line":0}},{"line":126,"address":[1555056,1555068],"length":1,"stats":{"Line":0}},{"line":127,"address":[3221293,3221433,3222757,3221631],"length":1,"stats":{"Line":0}},{"line":128,"address":[1029471],"length":1,"stats":{"Line":0}},{"line":130,"address":[2098938,2099041],"length":1,"stats":{"Line":0}},{"line":131,"address":[2099052],"length":1,"stats":{"Line":0}},{"line":132,"address":[2099918],"length":1,"stats":{"Line":0}},{"line":133,"address":[2099436],"length":1,"stats":{"Line":0}},{"line":134,"address":[2099476],"length":1,"stats":{"Line":0}},{"line":135,"address":[3222172,3222545],"length":1,"stats":{"Line":0}},{"line":138,"address":[2099539,2099357,2099806],"length":1,"stats":{"Line":0}},{"line":141,"address":[3221840],"length":1,"stats":{"Line":0}},{"line":142,"address":[2099072],"length":1,"stats":{"Line":0}},{"line":143,"address":[2099128],"length":1,"stats":{"Line":0}},{"line":156,"address":[2100288],"length":1,"stats":{"Line":0}},{"line":157,"address":[1555207,1555184],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":35},{"path":["/","home","cphelper-dev","project-cph","src","docker","execution","compilation.rs"],"content":"use std::process::Command;\nuse anyhow::{Result, anyhow};\nuse crate::message::docker;\n\n/// コンパイル処理を管理する構造体\n///\n/// # Fields\n/// * `container_id` - コンパイル用コンテナのID（オプション）\n#[derive(Debug, Default)]\npub struct Compiler {\n    container_id: Option\u003cString\u003e,\n}\n\nimpl Compiler {\n    /// 新しいCompilerインスタンスを作成します\n    ///\n    /// # Returns\n    /// * `Self` - 新しいCompilerインスタンス\n    #[must_use = \"この関数は新しいCompilerインスタンスを返します\"]\n    pub const fn new() -\u003e Self {\n        Self {\n            container_id: None,\n        }\n    }\n\n    /// コマンドを実行してコンパイルを行います\n    ///\n    /// # Arguments\n    /// * `command` - コンパイルコマンドとその引数\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - コンパイル結果\n    ///\n    /// # Errors\n    /// * コンパイルが既に実行されている場合\n    /// * コンパイルの実行に失敗した場合\n    #[must_use = \"この関数はコンパイルの結果を返します\"]\n    pub fn compile(\u0026mut self, command: \u0026[String]) -\u003e Result\u003c()\u003e {\n        if self.container_id.is_some() {\n            return Err(anyhow!(docker::error(\"build_error\", \"コンパイルは既に実行されています\")));\n        }\n\n        let output = Command::new(\u0026command[0])\n            .args(\u0026command[1..])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"build_error\", format!(\"{e}。コマンド: {command:?}\"))))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            let stdout = String::from_utf8_lossy(\u0026output.stdout);\n            return Err(anyhow!(docker::error(\"build_error\", \n                format!(\"標準エラー出力: {stderr}\\n標準出力: {stdout}\\n終了コード: {:?}\", output.status.code()))));\n        }\n\n        Ok(())\n    }\n\n    /// コンテナIDを取得します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - コンテナID\n    ///\n    /// # Errors\n    /// * コンテナIDが設定されていない場合\n    #[must_use = \"この関数はコンテナIDを返します\"]\n    pub fn get_container_id(\u0026self) -\u003e Result\u003cString\u003e {\n        self.container_id\n            .clone()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナIDが取得できません\")))\n    }\n\n    /// コンパイル出力を取得します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - コンパイル出力\n    ///\n    /// # Errors\n    /// * コンパイルが実行されていない場合\n    /// * コンパイル出力の取得に失敗した場合\n    #[must_use = \"この関数はコンパイル出力を返します\"]\n    pub fn get_output(\u0026self) -\u003e Result\u003cString\u003e {\n        let container_id = self.container_id\n            .as_ref()\n            .ok_or_else(|| anyhow!(docker::error(\"build_error\", \"コンパイルが実行されていません\")))?;\n\n        let output = Command::new(\"docker\")\n            .args([\"logs\", container_id])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"build_error\", \n                format!(\"出力の取得に失敗: {e}。コンテナID: {container_id}\"))))?;\n\n        String::from_utf8(output.stdout)\n            .map_err(|e| anyhow!(docker::error(\"build_error\", format!(\"出力の解析に失敗: {e}\"))))\n    }\n} ","traces":[{"line":20,"address":[1833488],"length":1,"stats":{"Line":0}},{"line":38,"address":[1835375,1833536],"length":1,"stats":{"Line":0}},{"line":39,"address":[1833561],"length":1,"stats":{"Line":0}},{"line":40,"address":[1833608,1835426],"length":1,"stats":{"Line":0}},{"line":43,"address":[1833894,1835402,1833812,1834183,1833586,1833720],"length":1,"stats":{"Line":0}},{"line":44,"address":[1833738],"length":1,"stats":{"Line":0}},{"line":46,"address":[1676673,1676784,1676656,1676916,1677026],"length":1,"stats":{"Line":0}},{"line":48,"address":[1834245],"length":1,"stats":{"Line":0}},{"line":49,"address":[1834343,1834274],"length":1,"stats":{"Line":0}},{"line":50,"address":[1834445,1834362],"length":1,"stats":{"Line":0}},{"line":51,"address":[1835033,1835353],"length":1,"stats":{"Line":0}},{"line":52,"address":[1834880,1834464,1834786,1834536,1834692],"length":1,"stats":{"Line":0}},{"line":55,"address":[1834303],"length":1,"stats":{"Line":0}},{"line":66,"address":[1835584],"length":1,"stats":{"Line":0}},{"line":67,"address":[1835603],"length":1,"stats":{"Line":0}},{"line":69,"address":[1897284,1897280],"length":1,"stats":{"Line":0}},{"line":81,"address":[1835648,1836455],"length":1,"stats":{"Line":0}},{"line":82,"address":[1835831,1835686],"length":1,"stats":{"Line":0}},{"line":84,"address":[1897520,1897524],"length":1,"stats":{"Line":0}},{"line":86,"address":[1835961,1835756,1836252],"length":1,"stats":{"Line":0}},{"line":87,"address":[1835902,1835781],"length":1,"stats":{"Line":0}},{"line":89,"address":[1897777,1898130,1897888,1897760,1898394],"length":1,"stats":{"Line":0}},{"line":90,"address":[1898386,1898020,1897929],"length":1,"stats":{"Line":0}},{"line":92,"address":[1836310],"length":1,"stats":{"Line":0}},{"line":93,"address":[1898448,1898691,1898460,1898561],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":25},{"path":["/","home","cphelper-dev","project-cph","src","docker","execution","container.rs"],"content":"use std::process::Command;\nuse anyhow::{Result, anyhow};\nuse crate::message::docker;\n\n/// Dockerコンテナのランタイム管理を担当する構造体\n///\n/// # Fields\n/// * `container_id` - 管理対象のコンテナID（オプション）\n/// * `auto_remove` - コンテナを自動的に削除するかどうか\n#[derive(Debug)]\npub struct Runtime {\n    container_id: Option\u003cString\u003e,\n    auto_remove: bool,\n}\n\nimpl Default for Runtime {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Runtime {\n    /// 新しいRuntimeインスタンスを作成します\n    ///\n    /// # Returns\n    /// * `Self` - 新しいRuntimeインスタンス\n    #[must_use = \"この関数は新しいRuntimeインスタンスを返します\"]\n    pub const fn new() -\u003e Self {\n        Self {\n            container_id: None,\n            auto_remove: true,\n        }\n    }\n\n    /// 自動削除の設定を変更します\n    ///\n    /// # Arguments\n    /// * `auto_remove` - コンテナを自動的に削除するかどうか\n    ///\n    /// # Returns\n    /// * `Self` - 設定を変更したRuntimeインスタンス\n    #[must_use = \"この関数は新しいRuntimeインスタンスを返します\"]\n    pub const fn with_auto_remove(mut self, auto_remove: bool) -\u003e Self {\n        self.auto_remove = auto_remove;\n        self\n    }\n\n    /// コンテナを作成します\n    ///\n    /// # Arguments\n    /// * `image` - 使用するDockerイメージ名\n    /// * `options` - 追加のDockerオプション\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 作成結果\n    ///\n    /// # Errors\n    /// * コンテナが既に作成されている場合\n    /// * コンテナの作成に失敗した場合\n    pub fn create(\u0026mut self, image: \u0026str, options: \u0026[\u0026str]) -\u003e Result\u003c()\u003e {\n        if self.container_id.is_some() {\n            return Err(anyhow!(docker::error(\"container_error\", \"コンテナは既に作成されています\")));\n        }\n\n        let mut args = vec![\"create\"];\n        if self.auto_remove {\n            args.push(\"--rm\");\n        }\n        args.extend(options);\n        args.push(image);\n\n        let output = Command::new(\"docker\")\n            .args(\u0026args)\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", e)))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            return Err(anyhow!(docker::error(\"container_error\", stderr)));\n        }\n\n        let container_id = String::from_utf8(output.stdout)\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"コンテナIDの解析に失敗: {e}\"))))?\n            .trim()\n            .to_string();\n\n        self.container_id = Some(container_id);\n        Ok(())\n    }\n\n    /// コンテナを起動します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 起動結果\n    ///\n    /// # Errors\n    /// * コンテナが作成されていない場合\n    /// * コンテナの起動に失敗した場合\n    #[must_use = \"この関数はコンテナの起動結果を返します\"]\n    pub fn start(\u0026mut self) -\u003e Result\u003c()\u003e {\n        let container_id = self.container_id\n            .as_ref()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナが作成されていません\")))?;\n\n        let output = Command::new(\"docker\")\n            .args([\"start\", container_id])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", e)))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            return Err(anyhow!(docker::error(\"container_error\", stderr)));\n        }\n\n        Ok(())\n    }\n\n    /// コンテナを停止します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 停止結果\n    ///\n    /// # Errors\n    /// * コンテナが作成されていない場合\n    /// * コンテナの停止に失敗した場合\n    #[must_use = \"この関数はコンテナの停止結果を返します\"]\n    pub fn stop(\u0026mut self) -\u003e Result\u003c()\u003e {\n        let container_id = self.container_id\n            .as_ref()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナが作成されていません\")))?;\n\n        let output = Command::new(\"docker\")\n            .args([\"stop\", container_id])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", e)))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            return Err(anyhow!(docker::error(\"container_error\", stderr)));\n        }\n\n        Ok(())\n    }\n\n    /// コンテナの終了を待機し、終了コードを返します\n    ///\n    /// # Returns\n    /// * `Result\u003ci32\u003e` - 終了コード\n    ///\n    /// # Errors\n    /// * コンテナが作成されていない場合\n    /// * 終了コードの取得に失敗した場合\n    #[must_use = \"この関数はコンテナの終了コードを返します\"]\n    pub fn wait(\u0026mut self) -\u003e Result\u003ci32\u003e {\n        let container_id = self.container_id\n            .as_ref()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナが作成されていません\")))?;\n\n        let output = Command::new(\"docker\")\n            .args([\"wait\", container_id])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"終了コードの取得に失敗: {e}\"))))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            return Err(anyhow!(docker::error(\"container_error\", format!(\"終了コードの取得に失敗: {stderr}\"))));\n        }\n\n        let exit_code = String::from_utf8(output.stdout)\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"終了コードの解析に失敗: {e}\"))))?\n            .trim()\n            .parse()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"終了コードの解析に失敗: {e}\"))))?;\n\n        Ok(exit_code)\n    }\n\n    /// イメージの存在を確認し、必要に応じてプルします\n    ///\n    /// # Arguments\n    /// * `image` - 確認するDockerイメージ名\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 確認結果\n    ///\n    /// # Errors\n    /// * イメージの確認に失敗した場合\n    /// * イメージのプルに失敗したた場合\n    #[must_use = \"この関数はイメージの確認結果を返します\"]\n    pub fn ensure_image(\u0026self, image: \u0026str) -\u003e Result\u003c()\u003e {\n        let output = Command::new(\"docker\")\n            .args([\"images\", \"-q\", image])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"イメージの確認に失敗: {e}\"))))?;\n\n        if output.stdout.is_empty() {\n            let output = Command::new(\"docker\")\n                .args([\"pull\", image])\n                .output()\n                .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"イメージの取得に失敗: {e}\"))))?;\n\n            if !output.status.success() {\n                let stderr = String::from_utf8_lossy(\u0026output.stderr);\n                return Err(anyhow!(docker::error(\"container_error\", format!(\"イメージの取得に失敗: {stderr}\"))));\n            }\n        }\n\n        Ok(())\n    }\n\n    /// コンテナを削除します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 削除結果\n    ///\n    /// # Errors\n    /// * コンテナが作成されていない場合\n    /// * コンテナの削除に失敗した場合\n    pub fn remove(\u0026mut self) -\u003e Result\u003c()\u003e {\n        let container_id = self.container_id.take()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナが作成されていません\")))?;\n\n        let output = Command::new(\"docker\")\n            .args([\"rm\", \"-f\", \u0026container_id])\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", e)))?;\n\n        if !output.status.success() {\n            let stderr = String::from_utf8_lossy(\u0026output.stderr);\n            return Err(anyhow!(docker::error(\"container_error\", stderr)));\n        }\n\n        Ok(())\n    }\n\n    /// コンテナIDを取得します\n    ///\n    /// # Returns\n    /// * `Option\u003c\u0026str\u003e` - コンテナID\n    #[must_use]\n    pub fn container_id(\u0026self) -\u003e Option\u003c\u0026str\u003e {\n        self.container_id.as_deref()\n    }\n\n    /// コンテナ内でコマンドを実行します\n    ///\n    /// # Arguments\n    /// * `command` - 実行するコマンドとその引数\n    ///\n    /// # Returns\n    /// * `Result\u003c(String, String)\u003e` - 標準出力と標準エラー出力のタプル\n    ///\n    /// # Errors\n    /// * コンテナが作成されていない場合\n    /// * コマンドの実行に失敗した場合\n    pub fn execute_command(\u0026self, command: \u0026[\u0026str]) -\u003e Result\u003c(String, String)\u003e {\n        let container_id = self.container_id\n            .as_ref()\n            .ok_or_else(|| anyhow!(docker::error(\"container_error\", \"コンテナが作成されていません\")))?;\n\n        let mut args = vec![\"exec\", container_id];\n        args.extend(command);\n\n        let output = Command::new(\"docker\")\n            .args(\u0026args)\n            .output()\n            .map_err(|e| anyhow!(docker::error(\"container_error\", e)))?;\n\n        let stdout = String::from_utf8(output.stdout)\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"標準出力の解析に失敗: {e}\"))))?;\n        let stderr = String::from_utf8(output.stderr)\n            .map_err(|e| anyhow!(docker::error(\"container_error\", format!(\"標準エラー出力の解析に失敗: {e}\"))))?;\n\n        Ok((stdout, stderr))\n    }\n}\n\nimpl Drop for Runtime {\n    fn drop(\u0026mut self) {\n        if self.auto_remove {\n            if let Some(container_id) = \u0026self.container_id {\n                let _ = Command::new(\"docker\")\n                    .args([\"rm\", \"-f\", container_id])\n                    .output();\n            }\n        }\n    }\n} ","traces":[{"line":17,"address":[1641152],"length":1,"stats":{"Line":0}},{"line":18,"address":[2003608],"length":1,"stats":{"Line":0}},{"line":28,"address":[2003632],"length":1,"stats":{"Line":0}},{"line":43,"address":[2003696],"length":1,"stats":{"Line":0}},{"line":44,"address":[3127438],"length":1,"stats":{"Line":0}},{"line":45,"address":[3127444],"length":1,"stats":{"Line":0}},{"line":60,"address":[2006073,2005190,2003760],"length":1,"stats":{"Line":0}},{"line":61,"address":[1641396],"length":1,"stats":{"Line":0}},{"line":62,"address":[3129814,3127649],"length":1,"stats":{"Line":0}},{"line":65,"address":[2004046,2004101,2003886],"length":1,"stats":{"Line":0}},{"line":66,"address":[1641630],"length":1,"stats":{"Line":0}},{"line":67,"address":[2004157,2004232],"length":1,"stats":{"Line":0}},{"line":69,"address":[1641688],"length":1,"stats":{"Line":0}},{"line":70,"address":[3127978],"length":1,"stats":{"Line":0}},{"line":72,"address":[3129774,3128392,3128109,3127997],"length":1,"stats":{"Line":0}},{"line":75,"address":[3070864,3070879],"length":1,"stats":{"Line":0}},{"line":77,"address":[3128459],"length":1,"stats":{"Line":0}},{"line":78,"address":[3128593,3128488],"length":1,"stats":{"Line":0}},{"line":79,"address":[1642666,1642394],"length":1,"stats":{"Line":0}},{"line":82,"address":[3128517,3129598,3128927,3129121,3129201],"length":1,"stats":{"Line":0}},{"line":83,"address":[3071104,3071116,3071347,3071217],"length":1,"stats":{"Line":0}},{"line":87,"address":[1643074],"length":1,"stats":{"Line":0}},{"line":88,"address":[2005766],"length":1,"stats":{"Line":0}},{"line":100,"address":[1644752,1643728],"length":1,"stats":{"Line":0}},{"line":101,"address":[3130134,3129999],"length":1,"stats":{"Line":0}},{"line":103,"address":[1129700,1129696],"length":1,"stats":{"Line":0}},{"line":105,"address":[1643811,1644006,1644779,1644287],"length":1,"stats":{"Line":0}},{"line":106,"address":[1643947,1643841],"length":1,"stats":{"Line":0}},{"line":108,"address":[2007354,2006800,2006429],"length":1,"stats":{"Line":0}},{"line":110,"address":[3130630],"length":1,"stats":{"Line":0}},{"line":111,"address":[2006931,2006995],"length":1,"stats":{"Line":0}},{"line":112,"address":[3130742,3131028],"length":1,"stats":{"Line":0}},{"line":115,"address":[3130688],"length":1,"stats":{"Line":0}},{"line":127,"address":[2007376,2008442],"length":1,"stats":{"Line":0}},{"line":128,"address":[2007391,2007526],"length":1,"stats":{"Line":0}},{"line":130,"address":[3131241],"length":1,"stats":{"Line":0}},{"line":132,"address":[3131683,3132197,3131374,3131190],"length":1,"stats":{"Line":0}},{"line":133,"address":[2007496,2007603],"length":1,"stats":{"Line":0}},{"line":135,"address":[2008474,2007549,2007920],"length":1,"stats":{"Line":0}},{"line":137,"address":[3131750],"length":1,"stats":{"Line":0}},{"line":138,"address":[3131843,3131779],"length":1,"stats":{"Line":0}},{"line":139,"address":[3132148,3131862],"length":1,"stats":{"Line":0}},{"line":142,"address":[2008080],"length":1,"stats":{"Line":0}},{"line":154,"address":[1647995,1645872,1647316],"length":1,"stats":{"Line":0}},{"line":155,"address":[3132268,3132434],"length":1,"stats":{"Line":0}},{"line":157,"address":[1130592,1130596],"length":1,"stats":{"Line":0}},{"line":159,"address":[3132877,3132359,3132549],"length":1,"stats":{"Line":0}},{"line":160,"address":[2008778,2008665],"length":1,"stats":{"Line":0}},{"line":162,"address":[1646462,1646092,1648046],"length":1,"stats":{"Line":0}},{"line":164,"address":[2009211],"length":1,"stats":{"Line":0}},{"line":165,"address":[1646697,1646592],"length":1,"stats":{"Line":0}},{"line":166,"address":[2009954,2009520,2009641],"length":1,"stats":{"Line":0}},{"line":169,"address":[2010478,2010581,2009269,2010187,2009985,2010262],"length":1,"stats":{"Line":0}},{"line":170,"address":[3133899],"length":1,"stats":{"Line":0}},{"line":173,"address":[2010559,2010435,2010208],"length":1,"stats":{"Line":0}},{"line":175,"address":[2010508],"length":1,"stats":{"Line":0}},{"line":190,"address":[3136344,3136395,3134480],"length":1,"stats":{"Line":0}},{"line":191,"address":[2010920,2011265,2010793,2012685,2010993],"length":1,"stats":{"Line":0}},{"line":192,"address":[2010850],"length":1,"stats":{"Line":0}},{"line":194,"address":[1950994,1950859,1950736,1950748],"length":1,"stats":{"Line":0}},{"line":196,"address":[2011332],"length":1,"stats":{"Line":0}},{"line":197,"address":[3135199,3135280,3135555,3136371,3135115],"length":1,"stats":{"Line":0}},{"line":198,"address":[2011428],"length":1,"stats":{"Line":0}},{"line":200,"address":[3135231,3136376,3135520],"length":1,"stats":{"Line":0}},{"line":202,"address":[2011897],"length":1,"stats":{"Line":0}},{"line":203,"address":[2011987,2011926],"length":1,"stats":{"Line":0}},{"line":204,"address":[2012283,2012594,2012162],"length":1,"stats":{"Line":0}},{"line":208,"address":[2011362],"length":1,"stats":{"Line":0}},{"line":219,"address":[3137740,3137678,3136448],"length":1,"stats":{"Line":0}},{"line":220,"address":[3136466,3136657],"length":1,"stats":{"Line":0}},{"line":221,"address":[1650141],"length":1,"stats":{"Line":0}},{"line":223,"address":[2013448,2013988,2012885,2013136],"length":1,"stats":{"Line":0}},{"line":224,"address":[1650222,1650290],"length":1,"stats":{"Line":0}},{"line":226,"address":[1952128,1952143],"length":1,"stats":{"Line":0}},{"line":228,"address":[3137246],"length":1,"stats":{"Line":0}},{"line":229,"address":[1650751,1650817],"length":1,"stats":{"Line":0}},{"line":230,"address":[1650836,1651112],"length":1,"stats":{"Line":0}},{"line":233,"address":[3137304],"length":1,"stats":{"Line":0}},{"line":241,"address":[3137760],"length":1,"stats":{"Line":0}},{"line":242,"address":[3137765],"length":1,"stats":{"Line":0}},{"line":256,"address":[2014048,2015888,2015754],"length":1,"stats":{"Line":0}},{"line":257,"address":[1651296,1651435],"length":1,"stats":{"Line":0}},{"line":259,"address":[3137969],"length":1,"stats":{"Line":0}},{"line":261,"address":[1651611,1651460,1651382],"length":1,"stats":{"Line":0}},{"line":262,"address":[2014427],"length":1,"stats":{"Line":0}},{"line":264,"address":[3138339,3138233,3138635],"length":1,"stats":{"Line":0}},{"line":267,"address":[3076336,3076351],"length":1,"stats":{"Line":0}},{"line":269,"address":[2015763,2014969,2015269],"length":1,"stats":{"Line":0}},{"line":270,"address":[2015253],"length":1,"stats":{"Line":0}},{"line":271,"address":[2015692,2015185,2015334],"length":1,"stats":{"Line":0}},{"line":272,"address":[1652804],"length":1,"stats":{"Line":0}},{"line":274,"address":[3139208],"length":1,"stats":{"Line":0}},{"line":279,"address":[2519104,2519435],"length":1,"stats":{"Line":0}},{"line":280,"address":[1397940],"length":1,"stats":{"Line":0}},{"line":281,"address":[1397959],"length":1,"stats":{"Line":0}},{"line":282,"address":[1398002,1398171],"length":1,"stats":{"Line":0}},{"line":283,"address":[1398101,1398033],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":97},{"path":["/","home","cphelper-dev","project-cph","src","docker","execution","mod.rs"],"content":"pub mod command;\npub mod compilation;\npub mod container;\n\npub use compilation::Compiler;\npub use container::Runtime;\n\nuse anyhow::Result;\n\n#[derive(Debug)]\npub struct CommandOutput {\n    pub stdout: String,\n    pub stderr: String,\n    pub exit_code: i32,\n}\n\nimpl CommandOutput {\n    #[must_use = \"この関数は新しいCommandOutputインスタンスを返します\"]\n    pub const fn new(stdout: String, stderr: String, exit_code: i32) -\u003e Self {\n        Self {\n            stdout,\n            stderr,\n            exit_code,\n        }\n    }\n}\n\n#[async_trait::async_trait]\npub trait Executor {\n    async fn execute(\u0026self, command: command::Executor) -\u003e Result\u003cCommandOutput\u003e;\n} ","traces":[{"line":19,"address":[1119472],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":1},{"path":["/","home","cphelper-dev","project-cph","src","docker","fs.rs"],"content":"use std::path::Path;\nuse anyhow::Result;\n\n\n/// コンテナにファイルをコピー�す\n///\n/// # Arguments\n/// * `container_id` - コンテナID\n/// * `source` - コピー元のパス\n/// * `target` - コピー先のパス\n///\n/// # Errors\n/// * コピー操作に失敗した場合\npub fn copy_to_container(_container_id: \u0026str, _source: impl AsRef\u003cPath\u003e, _target: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    // TODO: 実装\n    unimplemented!()\n}\n\n/// コンテナからファイルをコピーします\n///\n/// # Arguments\n/// * `container_id` - コンテナID\n/// * `source` - コピー元のパス\n/// * `target` - コピー先のパス\n///\n/// # Errors\n/// * コピー操作に失敗した場合\npub fn copy_from_container(_container_id: \u0026str, _source: impl AsRef\u003cPath\u003e, _target: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    // TODO: 実装\n    unimplemented!()\n} ","traces":[{"line":14,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[],"length":0,"stats":{"Line":0}}],"covered":0,"coverable":2},{"path":["/","home","cphelper-dev","project-cph","src","docker","mod.rs"],"content":"pub mod config;\npub mod execution;\npub mod fs;\npub mod state;\npub mod test_helpers;\npub mod traits;\n\npub use execution::container::Runtime; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","state","container_state.rs"],"content":"use std::fmt;\n\n/// コンテ�の状態を表す列挙型\n///\n/// # Variants\n/// * `Running` - コンテナが実行中\n/// * `Executing` - コンテナでコマンドを実行中（コマンド文字列を保持）\n/// * `Stopped` - コンテナが停止済み\n/// * `Failed` - コンテナが失敗（エラーメッセージを保持）\n#[derive(Debug, Clone, PartialEq, Eq)]\npub enum Type {\n    Running,\n    Executing(String),\n    Stopped,\n    Failed(String),\n}\n\n/// コンテナの状態情報を保持する構造体\n///\n/// # Fields\n/// * `container_id` - コンテナのID\n/// * `state_type` - コンテナの状態\n#[derive(Debug, Clone, PartialEq, Eq)]\npub struct Info {\n    pub container_id: String,\n    pub state_type: Type,\n}\n\nimpl Info {\n    /// 新しい状態情報インスタンスを作成します\n    ///\n    /// # Arguments\n    /// * `container_id` - コンテナのID\n    /// * `state_type` - コンテナの状態\n    ///\n    /// # Returns\n    /// * `Self` - 新しい状態情報インスタンス\n    #[must_use = \"この関数は新しい状態情報インスタンスを返します\"]\n    pub const fn new(container_id: String, state_type: Type) -\u003e Self {\n        Self {\n            container_id,\n            state_type,\n        }\n    }\n}\n\nimpl fmt::Display for Info {\n    /// 状態情報を文字列として整形します\n    ///\n    /// # Arguments\n    /// * `f` - フォーマッタ\n    ///\n    /// # Returns\n    /// * `fmt::Result` - 文字列フォーマット結果\n    fn fmt(\u0026self, f: \u0026mut fmt::Formatter\u003c'_\u003e) -\u003e fmt::Result {\n        match \u0026self.state_type {\n            Type::Running =\u003e {\n                write!(f, \"実行中(ID: {container_id})\", container_id = self.container_id)\n            }\n            Type::Executing(command) =\u003e {\n                write!(f, \"コマンド実行中(ID: {container_id}, コマンド: {command})\", container_id = self.container_id)\n            }\n            Type::Stopped =\u003e {\n                write!(f, \"停止済み(ID: {container_id})\", container_id = self.container_id)\n            }\n            Type::Failed(error) =\u003e {\n                write!(f, \"失敗(ID: {container_id}, エラー: {error})\", container_id = self.container_id)\n            }\n        }\n    }\n} ","traces":[{"line":39,"address":[2131472],"length":1,"stats":{"Line":0}},{"line":55,"address":[2131536],"length":1,"stats":{"Line":0}},{"line":56,"address":[2131569],"length":1,"stats":{"Line":0}},{"line":58,"address":[2131689,2131605],"length":1,"stats":{"Line":0}},{"line":60,"address":[2131763],"length":1,"stats":{"Line":0}},{"line":61,"address":[2131966,2131775],"length":1,"stats":{"Line":0}},{"line":64,"address":[2132093,2132183],"length":1,"stats":{"Line":0}},{"line":66,"address":[2132278],"length":1,"stats":{"Line":0}},{"line":67,"address":[2132493,2132293],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":9},{"path":["/","home","cphelper-dev","project-cph","src","docker","state","manager.rs"],"content":"use std::sync::Arc;\nuse tokio::sync::RwLock;\nuse anyhow::Result;\n\nuse super::container_state::Info;\n\n/// Dockerコンテナの状態を管理する構造体\n///\n/// # Fields\n/// * `state` - コンテナの状態情報\n#[derive(Debug, Default)]\npub struct Manager {\n    state: Arc\u003cRwLock\u003cOption\u003cInfo\u003e\u003e\u003e,\n}\n\nimpl Manager {\n    /// 新しい状態管理インスタンスを作成します\n    ///\n    /// # Returns\n    /// * `Self` - 新しい状態管理インスタンス\n    #[must_use = \"この関数は新しい状態管理インスタンスを返します\"]\n    pub fn new() -\u003e Self {\n        Self {\n            state: Arc::new(RwLock::new(None)),\n        }\n    }\n\n    /// 現在のコンテナの状態を取得します\n    ///\n    /// # Returns\n    /// * `Option\u003cInfo\u003e` - コンテナの状態情報（存在する場合）\n    pub async fn get_state(\u0026self) -\u003e Option\u003cInfo\u003e {\n        self.state.read().await.clone()\n    }\n\n    /// コンテナの状態を設定します\n    ///\n    /// # Arguments\n    /// * `state` - 設定する状態\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 設定結果\n    ///\n    /// # Errors\n    /// * 状態の設定に失敗した場合（ロックの取得に失敗など）\n    pub async fn set_state(\u0026self, state: Info) -\u003e Result\u003c()\u003e {\n        *self.state.write().await = Some(state);\n        Ok(())\n    }\n\n    /// コンテナの状態をクリアします\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - クリア結果\n    ///\n    /// # Errors\n    /// * 状態のクリアに失敗した場合（ロックの取得に失敗など）\n    pub async fn clear_state(\u0026self) -\u003e Result\u003c()\u003e {\n        *self.state.write().await = None;\n        Ok(())\n    }\n} ","traces":[{"line":22,"address":[1827168],"length":1,"stats":{"Line":0}},{"line":24,"address":[1827175],"length":1,"stats":{"Line":0}},{"line":32,"address":[1827232,1827240],"length":1,"stats":{"Line":0}},{"line":46,"address":[1827248,1827283],"length":1,"stats":{"Line":0}},{"line":58,"address":[1827336,1827328],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":5},{"path":["/","home","cphelper-dev","project-cph","src","docker","state","mod.rs"],"content":"mod container_state;\npub use container_state::{Info, Type};\nmod manager;\n\npub use manager::Manager as ContainerStateManager; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","test_helpers","mod.rs"],"content":"#![allow(clippy::ref_option_ref)]\n\nuse crate::docker::execution::{command, CommandOutput};\nuse mockall::automock;\nuse async_trait::async_trait;\nuse anyhow::Result;\n\n/// テスト用のモックを生成するためのトレイト\n#[async_trait]\n#[automock]\npub trait Executor {\n    async fn execute(\u0026self, command: command::Executor) -\u003e Result\u003cCommandOutput\u003e;\n}\n\n#[automock]\n#[async_trait]\npub trait TestContainerManager: Send + Sync {\n    async fn create_container(\u0026mut self, image: \u0026str, cmd: Vec\u003cString\u003e, working_dir: \u0026str) -\u003e Result\u003c()\u003e;\n    async fn start_container(\u0026mut self) -\u003e Result\u003c()\u003e;\n    async fn stop_container(\u0026mut self) -\u003e Result\u003c()\u003e;\n    async fn get_container_id(\u0026self) -\u003e Result\u003cString\u003e;\n    async fn get_exit_code(\u0026self) -\u003e Result\u003ci32\u003e;\n    async fn check_image(\u0026self, image: \u0026str) -\u003e Result\u003cbool\u003e;\n    async fn pull_image(\u0026self, image: \u0026str) -\u003e Result\u003c()\u003e;\n}\n\n#[automock]\n#[async_trait]\npub trait TestCompilationManager: Send + Sync {\n    async fn compile\u003c'a\u003e(\u0026mut self, source_code: \u0026str, compile_cmd: Option\u003c\u0026'a [String]\u003e, env_vars: \u0026[String]) -\u003e Result\u003c()\u003e;\n    async fn get_compilation_output(\u0026self) -\u003e Result\u003c(String, String)\u003e;\n}\n\n#[automock]\npub trait TestHelper {\n    fn get_test_case(\u0026self) -\u003e Option\u003cString\u003e;\n    fn get_expected_output(\u0026self) -\u003e Option\u003cString\u003e;\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","traits","compilation.rs"],"content":"use async_trait::async_trait;\nuse anyhow::Result;\n\n/// コンパイル操作を提供するトレイト\n///\n/// このトレイトは、ソースコードのコンパイルに関連する\n/// 基本的な操作を定義します。\n#[async_trait]\npub trait CompilerOperations: Send + Sync {\n    /// ソースコードをコンパイルします\n    ///\n    /// # Arguments\n    /// * `source_code` - コンパイル対象のソースコード\n    /// * `compile_cmd` - コンパイルコマンドとその引数（オプション）\n    /// * `env_vars` - コンパイル時に設定する環境変数\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - コンパイル結果\n    ///\n    /// # Errors\n    /// * コンパイルに失敗した場合\n    /// * コンパイラの実行に失敗した場合\n    async fn compile(\n        \u0026mut self,\n        source_code: \u0026str,\n        compile_cmd: Option\u003cVec\u003cString\u003e\u003e,\n        env_vars: Vec\u003cString\u003e,\n    ) -\u003e Result\u003c()\u003e;\n\n    /// コンパイル結果を取得します\n    ///\n    /// # Returns\n    /// * `Result\u003c(String, String)\u003e` - (標準出力, 標準エラー出力)\n    ///\n    /// # Errors\n    /// * コンパイル結果の取得に失敗した場合\n    async fn get_compilation_output(\u0026self) -\u003e Result\u003c(String, String)\u003e;\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","traits","container.rs"],"content":"use async_trait::async_trait;\nuse anyhow::Result;\n\n/// Dockerコンテナのランタイム管理を行うトレイト\n///\n/// このトレイトは、Dockerコンテナのライフサイクル管理に必要な\n/// 基本的な操作を定義します。\n#[async_trait]\npub trait RuntimeManager: Send + Sync {\n    /// コンテナを作成します\n    ///\n    /// # Arguments\n    /// * `image` - 使用するDockerイメージ名\n    /// * `cmd` - コンテナで実行するコマンドとその引数\n    /// * `working_dir` - コンテナ内の作業ディレクトリ\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 作成結果\n    ///\n    /// # Errors\n    /// * コンテナの作成に失敗した場合\n    async fn create_container(\u0026mut self, image: \u0026str, cmd: Vec\u003cString\u003e, working_dir: \u0026str) -\u003e Result\u003c()\u003e;\n    \n    /// コンテナを起動します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 起動結果\n    ///\n    /// # Errors\n    /// * コンテナの起動に失敗した場合\n    async fn start_container(\u0026mut self) -\u003e Result\u003c()\u003e;\n    \n    /// コンテナを停止します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 停止結果\n    ///\n    /// # Errors\n    /// * コンテナの停止に失敗した場合\n    async fn stop_container(\u0026mut self) -\u003e Result\u003c()\u003e;\n    \n    /// コンテナIDを取得します\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - コンテナID\n    ///\n    /// # Errors\n    /// * コンテナIDの取得に失敗した場合\n    async fn get_container_id(\u0026self) -\u003e Result\u003cString\u003e;\n    \n    /// コンテナの終了コードを取得します\n    ///\n    /// # Returns\n    /// * `Result\u003ci32\u003e` - 終了コード\n    ///\n    /// # Errors\n    /// * 終了コードの取得に失敗した場合\n    async fn get_exit_code(\u0026self) -\u003e Result\u003ci32\u003e;\n    \n    /// イメージの存在を確認します\n    ///\n    /// # Arguments\n    /// * `image` - 確認するDockerイメージ名\n    ///\n    /// # Returns\n    /// * `Result\u003cbool\u003e` - イメージが存在する場合はtrue\n    ///\n    /// # Errors\n    /// * イメージの確認に失敗した場合\n    async fn check_image(\u0026self, image: \u0026str) -\u003e Result\u003cbool\u003e;\n    \n    /// イメージをプルします\n    ///\n    /// # Arguments\n    /// * `image` - プルするDockerイメージ名\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - プル結果\n    ///\n    /// # Errors\n    /// * イメージのプルに失敗した場合\n    async fn pull_image(\u0026self, image: \u0026str) -\u003e Result\u003c()\u003e;\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","traits","mod.rs"],"content":"pub mod container;\npub mod operations;\npub mod compilation;\n\npub use container::RuntimeManager;\npub use operations::Operations;\npub use compilation::CompilerOperations; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","docker","traits","operations.rs"],"content":"use async_trait::async_trait;\nuse std::time::Duration;\nuse anyhow::Result;\nuse crate::docker::config::Config;\n\n/// Dockerコンテナの実行操作を提供するトレイト\n///\n/// このトレイトは、Dockerコンテナの実行に関連する\n/// 基本的な操作を定義します。\n#[async_trait]\npub trait Operations: Send + Sync {\n    /// コンテナを作成し、初期化します\n    ///\n    /// # Arguments\n    /// * `config` - コンテナの実行設定\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 初期化結果\n    ///\n    /// # Errors\n    /// * コンテナの作成または初期化に失敗した場合\n    async fn initialize(\u0026mut self, config: Config) -\u003e Result\u003c()\u003e;\n\n    /// コンテナを起動します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 起動結果\n    ///\n    /// # Errors\n    /// * コンテナの起動に失敗した場合\n    async fn start(\u0026mut self) -\u003e Result\u003c()\u003e;\n\n    /// コンテナを停止します\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 停止結果\n    ///\n    /// # Errors\n    /// * コンテナの停止に失敗した場合\n    async fn stop(\u0026mut self) -\u003e Result\u003c()\u003e;\n\n    /// コンテナでコマンドを実行します\n    ///\n    /// # Arguments\n    /// * `command` - 実行するコマンド\n    ///\n    /// # Returns\n    /// * `Result\u003c(String, String)\u003e` - (標準出力, 標準エラー出力)\n    ///\n    /// # Errors\n    /// * コマンドの実行に失敗した場合\n    async fn execute(\u0026mut self, command: \u0026str) -\u003e Result\u003c(String, String)\u003e;\n\n    /// コンテナの標準入力にデータを書き込みます\n    ///\n    /// # Arguments\n    /// * `input` - 書き込むデータ\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 書き込み結果\n    ///\n    /// # Errors\n    /// * データの書き込みに失敗した場合\n    async fn write(\u0026mut self, input: \u0026str) -\u003e Result\u003c()\u003e;\n\n    /// コンテナの標準出力からデータを読み取ります\n    ///\n    /// # Arguments\n    /// * `timeout` - 読み取りのタイムアウト時間\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - 読み取ったデータ\n    ///\n    /// # Errors\n    /// * データの読み取りに失敗した場合\n    /// * タイムアウトが発生した場合\n    async fn read_stdout(\u0026mut self, timeout: Duration) -\u003e Result\u003cString\u003e;\n\n    /// コンテナの標準エラー出力からデータを読み取ります\n    ///\n    /// # Arguments\n    /// * `timeout` - 読み取りのタイムアウト時間\n    ///\n    /// # Returns\n    /// * `Result\u003cString\u003e` - 読み取ったデータ\n    ///\n    /// # Errors\n    /// * データの読み取りに失敗した場合\n    /// * タイムアウトが発生した場合\n    async fn read_stderr(\u0026mut self, timeout: Duration) -\u003e Result\u003cString\u003e;\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","fs","backup.rs"],"content":"use std::path::{Path, PathBuf};\nuse anyhow::{Result, anyhow};\nuse chrono::Local;\nuse tokio::fs;\nuse crate::message::fs as fs_message;\n\n/// バックアップファイルの管理を行う構造体\n#[derive(Debug)]\npub struct Manager {\n    /// バックアップディレクトリのパス\n    backup_dir: PathBuf,\n}\n\nimpl Manager {\n    /// 新しいバックアップマネージャを作成します\n    ///\n    /// # Arguments\n    /// * `backup_dir` - バックアップディレクトリのパス\n    ///\n    /// # Returns\n    /// * `Result\u003cSelf\u003e` - バックアップマネージャのインスタンス\n    ///\n    /// # Errors\n    /// * バックアップディレクトリの作成に失敗した場合\n    pub async fn new\u003cP: AsRef\u003cPath\u003e + Send\u003e(backup_dir: P) -\u003e Result\u003cSelf\u003e {\n        let backup_dir = backup_dir.as_ref().to_path_buf();\n        if !backup_dir.exists() {\n            fs::create_dir_all(\u0026backup_dir).await\n                .map_err(|e| anyhow!(fs_message::error(\"backup_dir_create_error\", e)))?;\n        }\n        Ok(Self { backup_dir })\n    }\n\n    /// ファイルをバックアップします\n    ///\n    /// # Arguments\n    /// * `file_path` - バックアップするファイルのパス\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - バックアップの結果\n    ///\n    /// # Errors\n    /// * バックアップファイルの作成に失敗した場合\n    /// * ファイルのコピーに失敗した場合\n    pub async fn backup\u003cP: AsRef\u003cPath\u003e + Send\u003e(\u0026self, file_path: P) -\u003e Result\u003c()\u003e {\n        let file_path = file_path.as_ref();\n        if !file_path.exists() {\n            return Ok(());\n        }\n\n        let file_name = file_path.file_name()\n            .ok_or_else(|| anyhow!(fs_message::error(\"filename_get_error\", \"\")))?\n            .to_str()\n            .ok_or_else(|| anyhow!(fs_message::error(\"filename_convert_error\", \"\")))?;\n\n        let timestamp = Local::now().format(\"%Y%m%d_%H%M%S\");\n        let backup_file_name = format!(\"{file_name}.{timestamp}.bak\");\n        let backup_path = self.backup_dir.join(backup_file_name);\n\n        fs::copy(file_path, \u0026backup_path).await\n            .map_err(|e| anyhow!(fs_message::error(\"backup_error\", e)))?;\n\n        Ok(())\n    }\n\n    /// バックアップファイルを復元します\n    ///\n    /// # Arguments\n    /// * `file_path` - 復元先のファイルパス\n    /// * `backup_file_name` - バックアップファイル名\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 復元の結果\n    ///\n    /// # Errors\n    /// * バックアップファイルが存在しない場合\n    /// * ファイルの復元に失敗した場合\n    pub async fn restore\u003cP: AsRef\u003cPath\u003e + Send\u003e(\u0026self, file_path: P, backup_file_name: \u0026str) -\u003e Result\u003c()\u003e {\n        let backup_path = self.backup_dir.join(backup_file_name);\n        if !backup_path.exists() {\n            return Err(anyhow!(fs_message::error(\"backup_not_found\", backup_file_name)));\n        }\n\n        fs::copy(\u0026backup_path, file_path.as_ref()).await\n            .map_err(|e| anyhow!(fs_message::error(\"restore_error\", e)))?;\n\n        Ok(())\n    }\n\n    /// バックアップファイルの一覧を取得します\n    ///\n    /// # Arguments\n    /// * `file_name` - 元のファイル名\n    ///\n    /// # Returns\n    /// * `Result\u003cVec\u003cString\u003e\u003e` - バックアップファイル名のリスト\n    ///\n    /// # Errors\n    /// * バックアップディレクトリの読み取りに失敗した場合\n    pub async fn list_backups(\u0026self, file_name: \u0026str) -\u003e Result\u003cVec\u003cString\u003e\u003e {\n        let mut entries = fs::read_dir(\u0026self.backup_dir).await\n            .map_err(|e| anyhow!(fs_message::error(\"backup_dir_read_error\", e)))?;\n\n        let mut backups = Vec::new();\n        while let Some(entry) = entries.next_entry().await\n            .map_err(|e| anyhow!(fs_message::error(\"backup_dir_read_error\", e)))? {\n            if let Some(name) = entry.file_name().to_str() {\n                if name.starts_with(file_name) \u0026\u0026 \n                    std::path::Path::new(name)\n                        .extension()\n                        .map_or(false, |ext| ext.eq_ignore_ascii_case(\"bak\")) {\n                    backups.push(name.to_string());\n                }\n            }\n        }\n\n        Ok(backups)\n    }\n} ","traces":[{"line":25,"address":[],"length":0,"stats":{"Line":10}},{"line":26,"address":[1264618,1264728],"length":1,"stats":{"Line":8}},{"line":27,"address":[],"length":0,"stats":{"Line":9}},{"line":28,"address":[],"length":0,"stats":{"Line":9}},{"line":29,"address":[1265584,1265599,1265422],"length":1,"stats":{"Line":0}},{"line":31,"address":[1264886],"length":1,"stats":{"Line":2}},{"line":45,"address":[],"length":0,"stats":{"Line":4}},{"line":46,"address":[],"length":0,"stats":{"Line":2}},{"line":47,"address":[],"length":0,"stats":{"Line":1}},{"line":48,"address":[1266223],"length":1,"stats":{"Line":1}},{"line":51,"address":[],"length":0,"stats":{"Line":2}},{"line":52,"address":[1266420,1268160,1268164],"length":1,"stats":{"Line":0}},{"line":54,"address":[],"length":0,"stats":{"Line":0}},{"line":56,"address":[],"length":0,"stats":{"Line":2}},{"line":57,"address":[],"length":0,"stats":{"Line":4}},{"line":58,"address":[],"length":0,"stats":{"Line":2}},{"line":60,"address":[],"length":0,"stats":{"Line":3}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[],"length":0,"stats":{"Line":1}},{"line":78,"address":[],"length":0,"stats":{"Line":4}},{"line":79,"address":[],"length":0,"stats":{"Line":2}},{"line":80,"address":[1269362,1269263],"length":1,"stats":{"Line":2}},{"line":81,"address":[],"length":0,"stats":{"Line":2}},{"line":84,"address":[],"length":0,"stats":{"Line":3}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[],"length":0,"stats":{"Line":1}},{"line":100,"address":[1261908,1262035,1262729,1261680,1261727,1261847],"length":1,"stats":{"Line":4}},{"line":101,"address":[1262656,1262067,1261971,1261877,1262550,1261840],"length":1,"stats":{"Line":3}},{"line":102,"address":[1264208,1264223,1262534],"length":1,"stats":{"Line":0}},{"line":104,"address":[1262511,1262620],"length":1,"stats":{"Line":2}},{"line":105,"address":[1403950],"length":1,"stats":{"Line":4}},{"line":106,"address":[1263158,1263983,1263968],"length":1,"stats":{"Line":0}},{"line":107,"address":[1263312,1263215,1263380],"length":1,"stats":{"Line":3}},{"line":108,"address":[1263551,1263494],"length":1,"stats":{"Line":2}},{"line":109,"address":[1263567],"length":1,"stats":{"Line":1}},{"line":111,"address":[1264448,1264462],"length":1,"stats":{"Line":2}},{"line":112,"address":[1263662],"length":1,"stats":{"Line":1}},{"line":117,"address":[1263826],"length":1,"stats":{"Line":1}}],"covered":31,"coverable":38},{"path":["/","home","cphelper-dev","project-cph","src","fs","manager.rs"],"content":"use std::path::{Path, PathBuf};\nuse std::sync::Arc;\nuse anyhow::{Result, anyhow};\nuse crate::fs::path::normalize;\nuse crate::fs::{FileOperation, Transaction, CreateFileOperation, DeleteFileOperation};\n\n/// ファイル管理の状態を表現する型\n#[derive(Debug, Clone)]\npub enum State {\n    /// アイドル状態\n    Idle,\n    /// トランザクション実行中\n    InTransaction(Transaction),\n}\n\n/// 状態遷移を表現する型\n#[derive(Debug, Clone)]\npub enum Transition {\n    /// トランザクションの開始\n    BeginTransaction,\n    /// 操作の追加\n    AddOperation(Arc\u003cdyn FileOperation\u003e),\n    /// トランザクションのコミット\n    Commit,\n    /// トランザクションのロールバック\n    Rollback,\n}\n\n/// ファイル管理を行う構造体\n#[derive(Debug, Clone)]\npub struct Manager {\n    root: Arc\u003cPathBuf\u003e,\n    state: State,\n}\n\nimpl Manager {\n    /// 新しいファイルシステムインスタンスを作成します。\n    /// \n    /// # Arguments\n    /// * `root` - ルートディレクトリのパス\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn new(root: impl Into\u003cPathBuf\u003e) -\u003e Self {\n        Self {\n            root: Arc::new(root.into()),\n            state: State::Idle,\n        }\n    }\n\n    /// 状態遷移を適用します。\n    /// \n    /// # Arguments\n    /// * `transition` - 適用する状態遷移\n    /// \n    /// # Errors\n    /// - 無効な状態遷移が指定された場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    fn apply_transition(self, transition: Transition) -\u003e Result\u003cSelf\u003e {\n        match (self.state, transition) {\n            (State::Idle, Transition::BeginTransaction) =\u003e {\n                Ok(Self {\n                    root: self.root,\n                    state: State::InTransaction(Transaction::new()),\n                })\n            },\n            (State::InTransaction(transaction), Transition::AddOperation(operation)) =\u003e {\n                let new_transaction = transaction.with_operation(operation)?;\n                Ok(Self {\n                    root: self.root,\n                    state: State::InTransaction(new_transaction),\n                })\n            },\n            (State::InTransaction(transaction), Transition::Commit) =\u003e {\n                let _ = transaction.execute()?;\n                Ok(Self {\n                    root: self.root,\n                    state: State::Idle,\n                })\n            },\n            (State::InTransaction(_), Transition::Rollback) =\u003e {\n                Ok(Self {\n                    root: self.root,\n                    state: State::Idle,\n                })\n            },\n            (state, transition) =\u003e {\n                Err(anyhow!(\"無効な状態遷移です: {state:?} -\u003e {transition:?}\"))\n            }\n        }\n    }\n\n    /// トランザクションを開始します。\n    /// \n    /// # Errors\n    /// - トランザクションの開始に失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn begin_transaction(self) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::BeginTransaction)\n    }\n\n    /// トランザクションをコミットします。\n    /// \n    /// # Errors\n    /// - トランザクションのコミットに失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn commit(self) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::Commit)\n    }\n\n    /// トランザクションをロールバックします。\n    /// \n    /// # Errors\n    /// - トランザクションのロールバックに失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn rollback(self) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::Rollback)\n    }\n\n    /// ファイルの内容を読み込みます。\n    /// \n    /// # Arguments\n    /// * `path` - 読み込むファイルのパス\n    /// \n    /// # Errors\n    /// - パスの正規化に失敗した場合\n    /// - ファイルが存在しない場合\n    /// - ファイルの読み込みに失敗した場合\n    #[must_use = \"この関数はファイルの内容を返します\"]\n    pub fn read_file(\u0026self, path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cString\u003e {\n        let path = normalize(\u0026*self.root, path)?;\n        if !path.exists() {\n            return Err(anyhow!(\"ファイルが見つかりません: {}\", path.display()));\n        }\n        std::fs::read_to_string(\u0026path)\n            .map_err(|e| anyhow!(\"ファイルの読み込みに失敗しました: {e}\"))\n    }\n\n    /// ファイルに内容を書き込みます。\n    /// \n    /// # Arguments\n    /// * `path` - 書き込み先のファイルパス\n    /// * `content` - 書き込む内容\n    /// \n    /// # Errors\n    /// - パスの正規化に失敗した場合\n    /// - トランザクションの操作に失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn write_file(self, path: impl AsRef\u003cPath\u003e, content: impl AsRef\u003cstr\u003e) -\u003e Result\u003cSelf\u003e {\n        let path = normalize(\u0026*self.root, path)?;\n        let operation = Arc::new(CreateFileOperation::new(path, content.as_ref().to_string()));\n        \n        match self.state {\n            State::InTransaction(_) =\u003e {\n                self.apply_transition(Transition::AddOperation(operation))\n            },\n            State::Idle =\u003e {\n                self.begin_transaction()?\n                    .apply_transition(Transition::AddOperation(operation))?\n                    .commit()\n            }\n        }\n    }\n\n    /// ファイルを削除します。\n    /// \n    /// # Arguments\n    /// * `path` - 削除するファイルのパス\n    /// \n    /// # Errors\n    /// - パスの正規化に失敗した場合\n    /// - トランザクションの操作に失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn delete_file(self, path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cSelf\u003e {\n        let path = normalize(\u0026*self.root, path)?;\n        let operation = Arc::new(DeleteFileOperation::new(path)?);\n        \n        match self.state {\n            State::InTransaction(_) =\u003e {\n                self.apply_transition(Transition::AddOperation(operation))\n            },\n            State::Idle =\u003e {\n                self.begin_transaction()?\n                    .apply_transition(Transition::AddOperation(operation))?\n                    .commit()\n            }\n        }\n    }\n\n    /// ディレクトリを作成します。\n    /// \n    /// # Arguments\n    /// * `path` - 作成するディレクトリのパス\n    /// \n    /// # Errors\n    /// - パスの正規化に失敗した場合\n    /// - ディレクトリの作成に失敗した場合\n    /// - トランザクションの操作に失敗した場合\n    #[must_use = \"この関数は新しいManagerインスタンスを返します\"]\n    pub fn create_dir(self, path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cSelf\u003e {\n        let path = normalize(\u0026*self.root, path)?;\n        match self.state {\n            State::InTransaction(_) =\u003e {\n                let operation = Arc::new(CreateFileOperation::new(path, String::new()));\n                self.apply_transition(Transition::AddOperation(operation))\n            },\n            State::Idle =\u003e {\n                std::fs::create_dir_all(\u0026path)\n                    .map_err(|e| anyhow!(\"ディレクトリの作成に失敗しました: {e}\"))?;\n                Ok(self)\n            }\n        }\n    }\n\n    /// パスが存在するかどうかを確認します。\n    /// \n    /// # Arguments\n    /// * `path` - 確認するパス\n    /// \n    /// # Errors\n    /// - パスの正規化に失敗した場合\n    #[must_use = \"この関数はパスの存在を示すブール値を返します\"]\n    pub fn exists(\u0026self, path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cbool\u003e {\n        let path = normalize(\u0026*self.root, path)?;\n        Ok(path.exists())\n    }\n\n    /// ルートディレクトリのパスを取得します。\n    #[must_use = \"この関数はルートディレクトリのパスを返します\"]\n    pub fn root_path(\u0026self) -\u003e \u0026Path {\n        self.root.as_ref()\n    }\n} ","traces":[{"line":42,"address":[1106192],"length":1,"stats":{"Line":1}},{"line":44,"address":[1217608],"length":1,"stats":{"Line":1}},{"line":57,"address":[1751101,1749040,1749654],"length":1,"stats":{"Line":1}},{"line":58,"address":[2872651],"length":1,"stats":{"Line":1}},{"line":60,"address":[2873154],"length":1,"stats":{"Line":2}},{"line":61,"address":[2872849],"length":1,"stats":{"Line":1}},{"line":62,"address":[2873128,2872869],"length":1,"stats":{"Line":2}},{"line":65,"address":[2873268],"length":1,"stats":{"Line":2}},{"line":66,"address":[1592101,1592322,1592514],"length":1,"stats":{"Line":4}},{"line":67,"address":[1750131],"length":1,"stats":{"Line":1}},{"line":68,"address":[2873667],"length":1,"stats":{"Line":1}},{"line":69,"address":[1592416],"length":1,"stats":{"Line":1}},{"line":72,"address":[1749787],"length":1,"stats":{"Line":1}},{"line":73,"address":[2874175,2873862,2873418],"length":1,"stats":{"Line":3}},{"line":74,"address":[1750529],"length":1,"stats":{"Line":2}},{"line":75,"address":[1592798],"length":1,"stats":{"Line":2}},{"line":76,"address":[1592810],"length":1,"stats":{"Line":1}},{"line":80,"address":[2873483],"length":1,"stats":{"Line":1}},{"line":81,"address":[1592189],"length":1,"stats":{"Line":1}},{"line":82,"address":[1749881],"length":1,"stats":{"Line":1}},{"line":85,"address":[2872891],"length":1,"stats":{"Line":0}},{"line":86,"address":[1593058],"length":1,"stats":{"Line":0}},{"line":96,"address":[1593408],"length":1,"stats":{"Line":1}},{"line":97,"address":[2874732],"length":1,"stats":{"Line":1}},{"line":105,"address":[1751184],"length":1,"stats":{"Line":1}},{"line":106,"address":[1751196],"length":1,"stats":{"Line":1}},{"line":114,"address":[1593504],"length":1,"stats":{"Line":1}},{"line":115,"address":[1751244],"length":1,"stats":{"Line":1}},{"line":128,"address":[],"length":0,"stats":{"Line":1}},{"line":129,"address":[],"length":0,"stats":{"Line":4}},{"line":130,"address":[1218007,1218117],"length":1,"stats":{"Line":2}},{"line":131,"address":[1218143,1218471,1218197,1218350],"length":1,"stats":{"Line":4}},{"line":133,"address":[1218160,1218562],"length":1,"stats":{"Line":4}},{"line":134,"address":[],"length":0,"stats":{"Line":0}},{"line":147,"address":[2636288,2639321,2637872,2637740,2641003,2637839,2641095,2639420,2639456],"length":1,"stats":{"Line":1}},{"line":148,"address":[2638265,2636686,2639877,2636454,2638033,2639371,2639649,2637790,2639517,2636341,2637920,2641053],"length":1,"stats":{"Line":4}},{"line":149,"address":[1513554,1517652,1515135,1514942,1513253,1515970,1516745,1516453,1516554,1513363,1514389,1514832],"length":1,"stats":{"Line":2}},{"line":151,"address":[1215084],"length":1,"stats":{"Line":1}},{"line":152,"address":[],"length":0,"stats":{"Line":0}},{"line":153,"address":[1107697,1110137,1109243,1108620,1107043,1110760],"length":1,"stats":{"Line":2}},{"line":155,"address":[],"length":0,"stats":{"Line":0}},{"line":156,"address":[1215367,1215816,1215764,1215532,1215802,1215119],"length":1,"stats":{"Line":3}},{"line":157,"address":[2640518,2637594,2638908,2639175,2640785,2637327],"length":1,"stats":{"Line":1}},{"line":172,"address":[1517776,1519265,1519186],"length":1,"stats":{"Line":1}},{"line":173,"address":[1216212,1216088,1216415,1217512],"length":1,"stats":{"Line":2}},{"line":174,"address":[1518075,1518216,1519195],"length":1,"stats":{"Line":2}},{"line":176,"address":[2641746],"length":1,"stats":{"Line":1}},{"line":177,"address":[],"length":0,"stats":{"Line":0}},{"line":178,"address":[2642509,2641864],"length":1,"stats":{"Line":0}},{"line":180,"address":[],"length":0,"stats":{"Line":0}},{"line":181,"address":[1217394,1217380,1216945,1217342,1217110,1216697],"length":1,"stats":{"Line":5}},{"line":182,"address":[2642410,2642143],"length":1,"stats":{"Line":2}},{"line":198,"address":[1522790,1522837,1521696,1519296,1521601,1521662,1520453,1520496,1520406],"length":1,"stats":{"Line":1}},{"line":199,"address":[1520531,1519352,1519476,1520434,1520895,1521739,1520650,1522079,1521629,1519697,1522818,1521858],"length":1,"stats":{"Line":2}},{"line":200,"address":[1522042,1520858,1519660],"length":1,"stats":{"Line":1}},{"line":201,"address":[],"length":0,"stats":{"Line":0}},{"line":202,"address":[1521579,1520950,1520094,1521289,1522137,1522476,1520384,1522768,1519755],"length":1,"stats":{"Line":0}},{"line":203,"address":[2645979,2644790,2643595],"length":1,"stats":{"Line":0}},{"line":205,"address":[],"length":0,"stats":{"Line":0}},{"line":206,"address":[2643221,2645476,2644572,2645603,2645759,2643094,2644416,2643377,2644289],"length":1,"stats":{"Line":2}},{"line":207,"address":[1116368,1115933,1115824,1115347,1116096,1114213,1116477,1113056,1116205],"length":1,"stats":{"Line":0}},{"line":208,"address":[2644500,2645687,2643305],"length":1,"stats":{"Line":1}},{"line":221,"address":[1524168,1523696,1524157],"length":1,"stats":{"Line":1}},{"line":222,"address":[1524017,1524166,1523852,1523760],"length":1,"stats":{"Line":2}},{"line":223,"address":[1523995,1524099],"length":1,"stats":{"Line":2}},{"line":228,"address":[1751280],"length":1,"stats":{"Line":1}},{"line":229,"address":[1751285],"length":1,"stats":{"Line":1}}],"covered":54,"coverable":67},{"path":["/","home","cphelper-dev","project-cph","src","fs","mod.rs"],"content":"pub mod operations;\npub mod path;\npub mod backup;\npub mod manager;\npub mod transaction;\n\n// Re-export commonly used operations\npub use operations::{\n    check_exists as exists,\n    check_is_file as is_file,\n    check_is_directory as is_directory,\n    validate::parent_exists as check_permissions,\n};\n\n// Re-export path operations\npub use path::{\n    Validator as PathValidator,\n    ValidationLevel as PathValidationLevel,\n    normalize as normalize_path,\n    validate as validate_path,\n    ensure_path_exists,\n};\n\n// Re-export commonly used types and traits\npub use anyhow::{Result, Context};\npub use std::path::{Path, PathBuf};\n\n// Re-export specific types\npub use transaction::{\n    FileOperation,\n    Transaction,\n    State as TransactionState,\n    Transition as TransactionTransition,\n    CreateFileOperation,\n    DeleteFileOperation,\n};\n\npub use backup::Manager as BackupManager;\npub use manager::Manager; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","check.rs"],"content":"use std::path::Path;\nuse std::fs::metadata;\nuse anyhow::{Result, anyhow};\nuse crate::message::fs;\n\n/// パスが存在するかどうかを確認します\n#[must_use = \"この関数はパスの存在を示すブール値を返します\"]\npub fn exists\u003cP: AsRef\u003cPath\u003e\u003e(path: P) -\u003e bool {\n    path.as_ref().exists()\n}\n\n/// パスがファイルかどうかを確認します\n#[must_use = \"この関数はパスがファイルであることを示すブール値を返します\"]\npub fn is_file\u003cP: AsRef\u003cPath\u003e\u003e(path: P) -\u003e bool {\n    path.as_ref().is_file()\n}\n\n/// パスがディレクトリかどうかを確認します\n#[must_use = \"この関数はパスがディレクトリであることを示すブール値を返します\"]\npub fn is_directory\u003cP: AsRef\u003cPath\u003e\u003e(path: P) -\u003e bool {\n    path.as_ref().is_dir()\n}\n\n/// パスの権限を確認します。\n/// \n/// # Arguments\n/// * `path` - 確認するパス\n/// * `write_required` - 書き込み権限が必要かどうか\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - メタデータの取得に失敗した場合\n/// - 書き込み権限が必要なのに書き込み権限がない場合\npub fn verify_basic_permissions\u003cP: AsRef\u003cPath\u003e\u003e(path: P, write_required: bool) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    let metadata = metadata(path)?;\n    \n    if !metadata.permissions().readonly() \u0026\u0026 write_required {\n        return Err(anyhow!(fs::error(\"permission_error\", path.display())));\n    }\n    Ok(())\n}\n\n/// パスのパーミッションを確認します。\n/// \n/// # Arguments\n/// * `path` - 確認するパス\n/// * `write_required` - 書き込み権限が必要かどうか\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - 読み取り権限がない場合\n/// - 書き込み権限が必要なのに書き込み権限がない場合\npub fn verify_permissions\u003cP: AsRef\u003cPath\u003e\u003e(path: P, write_required: bool) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    if !path.exists() {\n        return Err(anyhow!(fs::error(\"file_not_found\", path.display())));\n    }\n\n    let metadata = path.metadata()\n        .map_err(|e| anyhow!(fs::error(\"metadata_error\", e)))?;\n\n    let permissions = metadata.permissions();\n\n    #[cfg(unix)]\n    {\n        use std::os::unix::fs::PermissionsExt;\n        let mode = permissions.mode();\n        let can_read = mode \u0026 0o444 != 0;\n        let can_write = mode \u0026 0o222 != 0;\n\n        if !can_read {\n            return Err(anyhow!(fs::error(\"permission_error\", path.display())));\n        }\n\n        if write_required \u0026\u0026 !can_write {\n            return Err(anyhow!(fs::error(\"permission_error\", path.display())));\n        }\n    }\n\n    Ok(())\n} ","traces":[{"line":8,"address":[1387936,1387971],"length":1,"stats":{"Line":1}},{"line":9,"address":[],"length":0,"stats":{"Line":2}},{"line":14,"address":[],"length":0,"stats":{"Line":2}},{"line":15,"address":[],"length":0,"stats":{"Line":4}},{"line":20,"address":[1385129,1385187,1385152,1385024],"length":1,"stats":{"Line":2}},{"line":21,"address":[],"length":0,"stats":{"Line":4}},{"line":34,"address":[],"length":0,"stats":{"Line":1}},{"line":35,"address":[],"length":0,"stats":{"Line":2}},{"line":36,"address":[],"length":0,"stats":{"Line":3}},{"line":38,"address":[],"length":0,"stats":{"Line":2}},{"line":39,"address":[],"length":0,"stats":{"Line":1}},{"line":41,"address":[],"length":0,"stats":{"Line":1}},{"line":54,"address":[],"length":0,"stats":{"Line":1}},{"line":55,"address":[],"length":0,"stats":{"Line":4}},{"line":56,"address":[],"length":0,"stats":{"Line":2}},{"line":57,"address":[],"length":0,"stats":{"Line":2}},{"line":60,"address":[],"length":0,"stats":{"Line":2}},{"line":61,"address":[],"length":0,"stats":{"Line":0}},{"line":63,"address":[1386019,1386076],"length":1,"stats":{"Line":2}},{"line":68,"address":[],"length":0,"stats":{"Line":1}},{"line":69,"address":[],"length":0,"stats":{"Line":1}},{"line":70,"address":[],"length":0,"stats":{"Line":1}},{"line":72,"address":[],"length":0,"stats":{"Line":1}},{"line":73,"address":[],"length":0,"stats":{"Line":2}},{"line":76,"address":[],"length":0,"stats":{"Line":2}},{"line":77,"address":[],"length":0,"stats":{"Line":1}},{"line":81,"address":[],"length":0,"stats":{"Line":1}}],"covered":26,"coverable":27},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","delete.rs"],"content":"use std::path::Path;\nuse anyhow::{Result, anyhow};\nuse crate::message::fs;\nuse super::validate::{is_file, is_dir};\n\n/// ファイルを削除します。\n/// \n/// # Arguments\n/// * `path` - 削除するファイルのパス\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがファイルでない場合\n/// - ファイルの削除に失敗した場合\npub fn remove_file(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    is_file(path)?;\n    std::fs::remove_file(path)\n        .map_err(|e| anyhow!(fs::error(\"delete_error\", e)))\n}\n\n/// ディレクトリを削除します。\n/// \n/// # Arguments\n/// * `path` - 削除するディレクトリのパス\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがディレクトリでない場合\n/// - ディレクトリの削除に失敗した場合\npub fn remove_dir(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    is_dir(path)?;\n    std::fs::remove_dir_all(path)\n        .map_err(|e| anyhow!(fs::error(\"delete_error\", e)))\n} ","traces":[{"line":15,"address":[],"length":0,"stats":{"Line":1}},{"line":16,"address":[],"length":0,"stats":{"Line":2}},{"line":17,"address":[],"length":0,"stats":{"Line":3}},{"line":18,"address":[],"length":0,"stats":{"Line":2}},{"line":19,"address":[],"length":0,"stats":{"Line":0}},{"line":31,"address":[],"length":0,"stats":{"Line":1}},{"line":32,"address":[],"length":0,"stats":{"Line":2}},{"line":33,"address":[],"length":0,"stats":{"Line":3}},{"line":34,"address":[],"length":0,"stats":{"Line":2}},{"line":35,"address":[],"length":0,"stats":{"Line":0}}],"covered":8,"coverable":10},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","mod.rs"],"content":"pub mod check;\npub mod delete;\npub mod read;\npub mod write;\npub mod validate;\n\npub use check::{exists as check_exists, is_file as check_is_file, is_directory as check_is_directory};\npub use delete::*;\npub use read::*;\npub use write::*;\npub use validate::*;\n\n// Re-export commonly used types from std\npub use std::path::PathBuf;\npub use std::fs::{Metadata as FileMetadata, Permissions as FilePermissions};\n\npub use anyhow::{Result, Context}; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","read.rs"],"content":"use std::path::Path;\nuse anyhow::{Result, anyhow};\nuse crate::message::fs;\nuse super::validate::is_file;\n\n/// ファイルの内容を文字列として読み込みます。\n/// \n/// # Arguments\n/// * `path` - 読み込むファイルのパス\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがファイルでない場合\n/// - ファイルの読み込みに失敗した場合\n/// - ファイルの内容がUTF-8でない場合\n#[must_use = \"この関数はファイルの内容を返します\"]\npub fn load_file_as_string(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cString\u003e {\n    let path = path.as_ref();\n    is_file(path)?;\n    std::fs::read_to_string(path)\n        .map_err(|e| anyhow!(fs::error(\"read_error\", e)))\n}\n\n/// ファイルの内容をバイト列として読み込みます。\n/// \n/// # Arguments\n/// * `path` - 読み込むファイルのパス\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがファイルでない場合\n/// - ファイルの読み込みに失敗した場合\n#[must_use = \"この関数はファイルの内容をバイト列として返します\"]\npub fn load_file_as_bytes(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cVec\u003cu8\u003e\u003e {\n    let path = path.as_ref();\n    is_file(path)?;\n    std::fs::read(path)\n        .map_err(|e| anyhow!(fs::error(\"read_error\", e)))\n}\n\n/// ファイルのメタデータを取得します。\n/// \n/// # Arguments\n/// * `path` - メタデータを取得するファイルのパス\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - メタデータの取得に失敗した場合\n#[must_use = \"この関数はファイルのメタデータを返します\"]\npub fn get_metadata(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003cstd::fs::Metadata\u003e {\n    let path = path.as_ref();\n    is_file(path)?;\n    path.metadata()\n        .map_err(|e| anyhow!(fs::error(\"metadata_error\", e)))\n} ","traces":[{"line":17,"address":[1384288,1384240],"length":1,"stats":{"Line":1}},{"line":18,"address":[],"length":0,"stats":{"Line":2}},{"line":19,"address":[],"length":0,"stats":{"Line":2}},{"line":20,"address":[],"length":0,"stats":{"Line":2}},{"line":21,"address":[],"length":0,"stats":{"Line":2}},{"line":34,"address":[],"length":0,"stats":{"Line":1}},{"line":35,"address":[],"length":0,"stats":{"Line":2}},{"line":36,"address":[],"length":0,"stats":{"Line":2}},{"line":37,"address":[],"length":0,"stats":{"Line":2}},{"line":38,"address":[],"length":0,"stats":{"Line":0}},{"line":50,"address":[],"length":0,"stats":{"Line":1}},{"line":51,"address":[],"length":0,"stats":{"Line":2}},{"line":52,"address":[],"length":0,"stats":{"Line":2}},{"line":53,"address":[],"length":0,"stats":{"Line":2}},{"line":54,"address":[],"length":0,"stats":{"Line":0}}],"covered":13,"coverable":15},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","validate.rs"],"content":"use std::path::Path;\nuse anyhow::{Result, anyhow};\nuse crate::message::fs;\n\n/// パスの存在を検証します。\n/// \n/// # Errors\n/// - パスが存在しない場合\npub fn exists(path: \u0026Path) -\u003e Result\u003c()\u003e {\n    if !path.exists() {\n        return Err(anyhow!(fs::error(\"file_not_found\", path.display())));\n    }\n    Ok(())\n}\n\n/// パスがファイルであることを検証します。\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがファイルでない場合\npub fn is_file(path: \u0026Path) -\u003e Result\u003c()\u003e {\n    exists(path)?;\n    if !path.is_file() {\n        return Err(anyhow!(fs::error(\"invalid_path\", path.display())));\n    }\n    Ok(())\n}\n\n/// パスがディレクトリであることを検証します。\n/// \n/// # Errors\n/// - パスが存在しない場合\n/// - パスがディレクトリでない場合\npub fn is_dir(path: \u0026Path) -\u003e Result\u003c()\u003e {\n    exists(path)?;\n    if !path.is_dir() {\n        return Err(anyhow!(fs::error(\"invalid_path\", path.display())));\n    }\n    Ok(())\n}\n\n/// パスの親ディレクトリが存在することを検証します。\n/// \n/// # Errors\n/// - 親ディレクトリが存在しない場合\npub fn parent_exists(path: \u0026Path) -\u003e Result\u003c()\u003e {\n    if let Some(parent) = path.parent() {\n        exists(parent)?;\n    }\n    Ok(())\n} ","traces":[{"line":9,"address":[980739,980448,980710],"length":1,"stats":{"Line":1}},{"line":10,"address":[2602433],"length":1,"stats":{"Line":2}},{"line":11,"address":[2602457,2602556,2602687],"length":1,"stats":{"Line":1}},{"line":13,"address":[2602545],"length":1,"stats":{"Line":1}},{"line":21,"address":[2603091,2602720,2603120],"length":1,"stats":{"Line":1}},{"line":22,"address":[2602753,2602830],"length":1,"stats":{"Line":2}},{"line":23,"address":[2602814],"length":1,"stats":{"Line":1}},{"line":24,"address":[2603104,2602876,2602975],"length":1,"stats":{"Line":1}},{"line":26,"address":[2602964],"length":1,"stats":{"Line":1}},{"line":34,"address":[2603507,2603136,2603536],"length":1,"stats":{"Line":1}},{"line":35,"address":[2603169,2603246],"length":1,"stats":{"Line":2}},{"line":36,"address":[2603230],"length":1,"stats":{"Line":1}},{"line":37,"address":[2603391,2603520,2603292],"length":1,"stats":{"Line":1}},{"line":39,"address":[2603380],"length":1,"stats":{"Line":1}},{"line":46,"address":[2603552],"length":1,"stats":{"Line":1}},{"line":47,"address":[2603566],"length":1,"stats":{"Line":1}},{"line":48,"address":[2603685,2603628],"length":1,"stats":{"Line":2}},{"line":50,"address":[2603674],"length":1,"stats":{"Line":1}}],"covered":18,"coverable":18},{"path":["/","home","cphelper-dev","project-cph","src","fs","operations","write.rs"],"content":"use std::path::Path;\nuse anyhow::{Result, anyhow};\nuse crate::message::fs;\nuse super::validate::parent_exists;\n\n/// ディレクトリが存在することを確認し、存在しない場合は作成します。\n/// \n/// # Arguments\n/// * `path` - 確認または作成するディレクトリのパス\n/// \n/// # Errors\n/// - ディレクトリの作成に失敗した場合\npub fn ensure_directory(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    if !path.exists() {\n        std::fs::create_dir_all(path)\n            .map_err(|e| anyhow!(fs::error(\"write_error\", e)))?;\n    }\n    Ok(())\n}\n\n/// ファイルが存在することを確認し、存在しない場合は作成します。\n/// \n/// # Arguments\n/// * `path` - 確認または作成するファイルのパス\n/// \n/// # Errors\n/// - ファイルの作成に失敗した場合\n/// - パスの親ディレクトリの作成に失敗した場合\npub fn ensure_file(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    if !path.exists() {\n        parent_exists(path)?;\n        std::fs::File::create(path)\n            .map_err(|e| anyhow!(fs::error(\"write_error\", e)))?;\n    }\n    Ok(())\n}\n\n/// ファイルに内容を書き込みます。\n/// \n/// # Arguments\n/// * `path` - 書き込み先のファイルパス\n/// * `content` - 書き込む内容\n/// \n/// # Errors\n/// - ファイルの作成に失敗した場合\n/// - ファイルの書き込みに失敗した場合\npub fn save_to_file(path: impl AsRef\u003cPath\u003e, content: impl AsRef\u003c[u8]\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    if let Some(parent) = path.parent() {\n        ensure_directory(parent)?;\n    }\n    std::fs::write(path, content)\n        .map_err(|e| anyhow!(fs::error(\"write_error\", e)))\n} ","traces":[{"line":13,"address":[1473888,1473931,1474230,1474192],"length":1,"stats":{"Line":2}},{"line":14,"address":[],"length":0,"stats":{"Line":4}},{"line":15,"address":[],"length":0,"stats":{"Line":2}},{"line":16,"address":[],"length":0,"stats":{"Line":4}},{"line":17,"address":[],"length":0,"stats":{"Line":0}},{"line":19,"address":[],"length":0,"stats":{"Line":2}},{"line":30,"address":[],"length":0,"stats":{"Line":1}},{"line":31,"address":[],"length":0,"stats":{"Line":2}},{"line":32,"address":[],"length":0,"stats":{"Line":1}},{"line":33,"address":[],"length":0,"stats":{"Line":2}},{"line":34,"address":[1472067,1472148,1472011],"length":1,"stats":{"Line":2}},{"line":35,"address":[],"length":0,"stats":{"Line":1}},{"line":37,"address":[],"length":0,"stats":{"Line":1}},{"line":49,"address":[],"length":0,"stats":{"Line":2}},{"line":50,"address":[],"length":0,"stats":{"Line":4}},{"line":51,"address":[],"length":0,"stats":{"Line":2}},{"line":52,"address":[],"length":0,"stats":{"Line":4}},{"line":54,"address":[],"length":0,"stats":{"Line":4}},{"line":55,"address":[],"length":0,"stats":{"Line":0}}],"covered":17,"coverable":19},{"path":["/","home","cphelper-dev","project-cph","src","fs","path.rs"],"content":"use std::path::{Path, PathBuf};\nuse anyhow::{Result, anyhow};\nuse crate::message::fs as fs_message;\n\n/// パスの検証レベルを定義する列挙型\n#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum ValidationLevel {\n    /// 基本的な検証のみ（絶対パスとパストラバーサルのチェック）\n    Basic,\n    /// 厳格な検証（Basic + 特殊文字、非ASCII文字、長さ制限など）\n    Strict,\n}\n\n/// パス操作に関する共通機能を提供する構造体\n#[derive(Debug)]\n#[allow(dead_code)]\npub struct Validator {\n    /// パスの検証レベル\n    validation_level: ValidationLevel,\n    /// パス長の最大値（バイト単位）\n    max_path_length: usize,\n    /// ファイル名の最大長（バイト単位）\n    max_filename_length: usize,\n}\n\nimpl Default for Validator {\n    #[must_use = \"この関数は新しいValidatorインスタンスを返します\"]\n    fn default() -\u003e Self {\n        Self {\n            validation_level: ValidationLevel::Basic,\n            max_path_length: 4096,\n            max_filename_length: 255,\n        }\n    }\n}\n\nimpl Validator {\n    /// 新しいValidatorインスタンスを作成します\n    ///\n    /// # Arguments\n    /// * `validation_level` - パスの検証レベル\n    /// * `max_path_length` - パス長の最大値（バイト単位）\n    /// * `max_filename_length` - ファイル名の最大長（バイト単位）\n    #[must_use = \"この関数は新しいValidatorインスタンスを返します\"]\n    pub const fn new(\n        validation_level: ValidationLevel,\n        max_path_length: usize,\n        max_filename_length: usize,\n    ) -\u003e Self {\n        Self {\n            validation_level,\n            max_path_length,\n            max_filename_length,\n        }\n    }\n\n    /// パスを検証します\n    ///\n    /// # Arguments\n    /// * `path` - 検証するパス\n    ///\n    /// # Returns\n    /// * `Result\u003c()\u003e` - 検証結果\n    ///\n    /// # Errors\n    /// * パスが無効な場合\n    pub fn validate\u003cP: AsRef\u003cPath\u003e\u003e(\u0026self, path: P) -\u003e Result\u003c()\u003e {\n        let path = path.as_ref();\n\n        // パスコンポーネントの検証\n        for component in path.components() {\n            match component {\n                std::path::Component::ParentDir =\u003e {\n                    return Err(anyhow!(fs_message::error(\"path_traversal_error\", \"\")));\n                }\n                std::path::Component::RootDir =\u003e {\n                    return Err(anyhow!(fs_message::error(\"absolute_path_error\", \"\")));\n                }\n                std::path::Component::Normal(name) =\u003e {\n                    let name_str = name.to_string_lossy();\n                    if name_str.len() \u003e self.max_filename_length {\n                        return Err(anyhow!(fs_message::error(\"filename_too_long\", self.max_filename_length)));\n                    }\n                }\n                _ =\u003e {}\n            }\n        }\n\n        Ok(())\n    }\n\n    /// パスを正規化します\n    /// \n    /// # Arguments\n    /// * `root` - ルートディレクトリのパス\n    /// * `path` - 正規化するパス\n    /// \n    /// # Returns\n    /// * `Result\u003cPathBuf\u003e` - 正規化されたパス\n    /// \n    /// # Errors\n    /// * パスの検証に失敗した場合\n    /// * パスの正規化に失敗した場合\n    #[must_use = \"この関数は正規化されたパスを返します\"]\n    pub fn normalize\u003cP1: AsRef\u003cPath\u003e, P2: AsRef\u003cPath\u003e\u003e(\u0026self, root: P1, path: P2) -\u003e Result\u003cPathBuf\u003e {\n        // パスの検証\n        self.validate(path.as_ref())?;\n\n        // パスの正規化\n        let normalized = path.as_ref().strip_prefix(\".\").unwrap_or_else(|_| path.as_ref());\n        Ok(root.as_ref().join(normalized))\n    }\n}\n\n/// パスを正規化します\n/// \n/// # Arguments\n/// * `root` - ルートディレクトリのパス\n/// * `path` - 正規化するパス\n/// \n/// # Returns\n/// * `Result\u003cPathBuf\u003e` - 正規化されたパス\n/// \n/// # Errors\n/// * パスの検証に失敗した場合\n/// * パスの正規化に失敗した場合\npub fn normalize\u003cP1: AsRef\u003cPath\u003e, P2: AsRef\u003cPath\u003e\u003e(root: P1, path: P2) -\u003e Result\u003cPathBuf\u003e {\n    Validator::default().normalize(root, path)\n}\n\n/// パスを検証します\n/// \n/// # Arguments\n/// * `path` - 検証するパス\n/// \n/// # Returns\n/// * `Result\u003c()\u003e` - 検証結果\n/// \n/// # Errors\n/// * パスが無効な場合\npub fn validate\u003cP: AsRef\u003cPath\u003e\u003e(path: P) -\u003e Result\u003c()\u003e {\n    Validator::default().validate(path)\n}\n\n/// パスが存在することを確認し、存在しない場合はディレクトリを作成します。\n/// \n/// # Arguments\n/// * `path` - 確認または作成するパス\n/// \n/// # Errors\n/// - ディレクトリの作成に失敗した場合\npub fn ensure_path_exists(path: impl AsRef\u003cPath\u003e) -\u003e Result\u003c()\u003e {\n    let path = path.as_ref();\n    if !path.exists() {\n        std::fs::create_dir_all(path)\n            .map_err(|e| anyhow!(\"ディレクトリの作成に失敗しました: {e}\"))?;\n    }\n    Ok(())\n} ","traces":[{"line":28,"address":[1154800],"length":1,"stats":{"Line":1}},{"line":45,"address":[1912048],"length":1,"stats":{"Line":1}},{"line":67,"address":[1527459,1526640,1526720],"length":1,"stats":{"Line":3}},{"line":68,"address":[2650254,2650349],"length":1,"stats":{"Line":6}},{"line":71,"address":[2650365,2650506],"length":1,"stats":{"Line":7}},{"line":72,"address":[2650570],"length":1,"stats":{"Line":4}},{"line":73,"address":[],"length":0,"stats":{"Line":0}},{"line":74,"address":[1527468,1527112],"length":1,"stats":{"Line":6}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":77,"address":[1527437,1527206,1527071],"length":1,"stats":{"Line":4}},{"line":79,"address":[1527156],"length":1,"stats":{"Line":5}},{"line":80,"address":[1527196],"length":1,"stats":{"Line":6}},{"line":81,"address":[2651305,2651388],"length":1,"stats":{"Line":12}},{"line":82,"address":[1527859,1528142],"length":1,"stats":{"Line":2}},{"line":85,"address":[],"length":0,"stats":{"Line":0}},{"line":89,"address":[1526905],"length":1,"stats":{"Line":4}},{"line":105,"address":[1215266,1215360,1215337,1215888,1215865,1214768,1216401],"length":1,"stats":{"Line":2}},{"line":107,"address":[1528915,1528315,1529473,1529028,1529586,1528230,1528838,1529390,1528421],"length":1,"stats":{"Line":6}},{"line":110,"address":[1529968,1529904,1528468,1528399,1529945,1528994,1529633,1529936,1529075,1529552,1529977,1529913],"length":1,"stats":{"Line":12}},{"line":111,"address":[2652779,2652170,2653338],"length":1,"stats":{"Line":3}},{"line":127,"address":[2653808,2653965,2654156,2653772,2653984,2653584],"length":1,"stats":{"Line":2}},{"line":128,"address":[1530105,1530525,1530258,1530334,1530444,1530029],"length":1,"stats":{"Line":4}},{"line":141,"address":[],"length":0,"stats":{"Line":1}},{"line":142,"address":[1228453,1228392],"length":1,"stats":{"Line":2}},{"line":152,"address":[2654176,2654219],"length":1,"stats":{"Line":2}},{"line":153,"address":[1227804,1227866],"length":1,"stats":{"Line":4}},{"line":154,"address":[2654287],"length":1,"stats":{"Line":2}},{"line":155,"address":[1228043,1227929,1227961],"length":1,"stats":{"Line":4}},{"line":156,"address":[1530896,1530839,1531005],"length":1,"stats":{"Line":0}},{"line":158,"address":[1530750],"length":1,"stats":{"Line":2}}],"covered":26,"coverable":30},{"path":["/","home","cphelper-dev","project-cph","src","fs","transaction.rs"],"content":"use std::path::PathBuf;\nuse std::sync::Arc;\nuse std::time::{SystemTime, UNIX_EPOCH};\nuse anyhow::{Result, anyhow};\nuse crate::fs::ensure_path_exists;\n\n/// ファイル操作のトレイト\npub trait FileOperation: Send + Sync + std::fmt::Debug {\n    /// ファイル操作を実行します\n    /// # Errors\n    /// - ファイル操作に失敗した場合\n    fn execute(\u0026self) -\u003e Result\u003c()\u003e;\n\n    /// ファイル操作をロールバックします\n    /// # Errors\n    /// - ロールバックに失敗した場合\n    fn rollback(\u0026self) -\u003e Result\u003c()\u003e;\n\n    /// ファイル操作の説明を取得します\n    #[must_use = \"この関数の戻り値は操作の説明を含むため、使用する必要があります\"]\n    fn description(\u0026self) -\u003e String;\n\n    /// ファイル操作の検証を行います\n    /// # Errors\n    /// - 検証に失敗した場合\n    fn validate(\u0026self) -\u003e Result\u003c()\u003e;\n}\n\n/// トランザクションの状態を表す列挙型\n#[derive(Debug, Clone)]\npub enum State {\n    /// 初期状態\n    Pending {\n        /// 作成時のタイムスタンプ\n        created_at: u64,\n    },\n    /// 実行済み\n    Executed {\n        /// 実行時のタイムスタンプ\n        executed_at: u64,\n    },\n    /// ロールバック済み\n    RolledBack {\n        /// ロールバック時のタイムスタンプ\n        rolled_back_at: u64,\n    },\n    /// 失敗\n    Failed {\n        /// エラー情報\n        error: String,\n        /// 失敗時のタイムスタンプ\n        failed_at: u64,\n    },\n}\n\nimpl State {\n    /// 現在のUNIXタイムスタンプを取得\n    fn now() -\u003e u64 {\n        SystemTime::now()\n            .duration_since(UNIX_EPOCH)\n            .map_or(0, |duration| duration.as_secs())\n    }\n\n    /// 状態の説明を取得\n    #[must_use = \"状態の説明は重要な情報を含むため、使用する必要があります\"]\n    fn description(\u0026self) -\u003e String {\n        match self {\n            Self::Pending { created_at } =\u003e {\n                format!(\"保留中 (作成: {created_at})\")\n            }\n            Self::Executed { executed_at } =\u003e {\n                format!(\"実行済み (実行: {executed_at})\")\n            }\n            Self::RolledBack { rolled_back_at } =\u003e {\n                format!(\"ロールバック済み (ロールバック: {rolled_back_at})\")\n            }\n            Self::Failed { error, failed_at } =\u003e {\n                format!(\"失敗 (時刻: {failed_at}): {error}\")\n            }\n        }\n    }\n}\n\n/// トランザクションの遷移を表す列挙型\n#[derive(Debug, Clone)]\npub enum Transition {\n    /// 操作の追加\n    AddOperation(Arc\u003cdyn FileOperation\u003e),\n    /// トランザクションの実行\n    Execute,\n    /// トランザクションのロールバック\n    Rollback,\n}\n\n/// ファイルトランザクションを表す構造体\n#[derive(Debug, Clone)]\npub struct Transaction {\n    /// ファイル操作のリスト\n    operations: Arc\u003cVec\u003cArc\u003cdyn FileOperation\u003e\u003e\u003e,\n    /// トランザクションの状態\n    state: State,\n}\n\nimpl Default for Transaction {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\nimpl Transaction {\n    /// 新しいトランザクションを作成します\n    #[must_use = \"新しいトランザクションインスタンスは使用する必要があります\"]\n    pub fn new() -\u003e Self {\n        Self {\n            operations: Arc::new(Vec::new()),\n            state: State::Pending {\n                created_at: State::now(),\n            },\n        }\n    }\n\n    /// 操作を追加\n    #[must_use]\n    #[allow(dead_code)]\n    fn with_operations(\u0026self, operations: Vec\u003cArc\u003cdyn FileOperation\u003e\u003e) -\u003e Self {\n        Self {\n            operations: Arc::new(operations),\n            state: self.state.clone(),\n        }\n    }\n\n    /// 状態を更新\n    #[must_use]\n    fn with_state(\u0026self, state: State) -\u003e Self {\n        Self {\n            operations: Arc::clone(\u0026self.operations),\n            state,\n        }\n    }\n\n    /// 状態遷移を適用します\n    /// # Errors\n    /// - 無効な状態遷移の場合\n    /// - 操作の実行に失敗した場合\n    /// - ロールバックに失敗した場合\n    #[must_use = \"状態遷移の結果は新しいトランザクションインスタンスとして返されます\"]\n    pub fn apply_transition(self, transition: Transition) -\u003e Result\u003cSelf\u003e {\n        match (\u0026self.state, transition) {\n            (State::Pending { .. }, Transition::AddOperation(operation)) =\u003e {\n                // 操作の検証\n                if let Err(e) = operation.validate() {\n                    return Err(anyhow!(\"操作の検証に失敗: {}\", e));\n                }\n\n                let mut operations = (*self.operations).clone();\n                operations.push(operation);\n\n                Ok(Self {\n                    operations: Arc::new(operations),\n                    state: self.state,\n                })\n            }\n            (State::Pending { .. }, Transition::Execute) =\u003e {\n                // 全ての操作を実行\n                for op in self.operations.iter() {\n                    // 検証を実行\n                    if let Err(e) = op.validate() {\n                        return Ok(self.with_state(State::Failed {\n                            error: e.to_string(),\n                            failed_at: State::now(),\n                        }));\n                    }\n                }\n\n                // 全ての操作を実行\n                for op in self.operations.iter() {\n                    if let Err(e) = op.execute() {\n                        // エラーが発生した場合、実行済みの操作をロールバック\n                        for prev_op in self.operations.iter().rev() {\n                            if let Err(rollback_err) = prev_op.rollback() {\n                                return Err(anyhow!(\n                                    \"ロールバックに失敗: {}（元のエラー: {}）\",\n                                    rollback_err, e\n                                ));\n                            }\n                        }\n                        return Ok(self.with_state(State::Failed {\n                            error: e.to_string(),\n                            failed_at: State::now(),\n                        }));\n                    }\n                }\n\n                Ok(self.with_state(State::Executed {\n                    executed_at: State::now(),\n                }))\n            }\n            (State::Pending { .. }, Transition::Rollback) =\u003e {\n                // 全ての操作をロールバック\n                for op in self.operations.iter().rev() {\n                    if let Err(e) = op.rollback() {\n                        return Err(anyhow!(\"ロールバックに失敗: {}\", e));\n                    }\n                }\n\n                Ok(self.with_state(State::RolledBack {\n                    rolled_back_at: State::now(),\n                }))\n            }\n            (state, transition) =\u003e {\n                Err(anyhow!(\n                    \"無効な状態遷移です: {:?} -\u003e {:?}\",\n                    state, transition\n                ))\n            }\n        }\n    }\n\n    /// トランザクションの状態を取得します\n    #[must_use = \"トランザクションの状態は重要な情報を含むため、使用する必要があります\"]\n    pub const fn state(\u0026self) -\u003e \u0026State {\n        \u0026self.state\n    }\n\n    /// トランザクションの説明を取得します\n    #[must_use = \"トランザクションの説明は重要な情報を含むため、使用する必要があります\"]\n    pub fn description(\u0026self) -\u003e String {\n        format!(\n            \"トランザクション（{}）:\\n{}\",\n            self.state.description(),\n            self.operations\n                .iter()\n                .enumerate()\n                .map(|(i, op)| format!(\"  {}: {}\", i + 1, op.description()))\n                .collect::\u003cVec\u003c_\u003e\u003e()\n                .join(\"\\n\")\n        )\n    }\n\n    /// 操作を追加します\n    /// # Errors\n    /// - 操作の検証に失敗した場合\n    #[must_use = \"操作を追加した結果は新しいトランザクションインスタンスとして返されます\"]\n    pub fn with_operation(self, operation: Arc\u003cdyn FileOperation\u003e) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::AddOperation(operation))\n    }\n\n    /// トランザクションを実行します\n    /// # Errors\n    /// - 操作の実行に失敗した場合\n    /// - ロールバックに失敗した場合\n    #[must_use = \"トランザクションの実行結果は新しいトランザクションインスタンスとして返されます\"]\n    pub fn execute(self) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::Execute)\n    }\n\n    /// トランザクションをロールバックします\n    /// # Errors\n    /// - ロールバックに失敗した場合\n    #[must_use = \"トランザクションのロールバック結果は新しいトランザクションインスタンスとして返されます\"]\n    pub fn rollback(self) -\u003e Result\u003cSelf\u003e {\n        self.apply_transition(Transition::Rollback)\n    }\n\n    /// トランザクションの操作一覧を取得します\n    #[must_use = \"トランザクションの操作一覧は重要な情報を含むため、使用する必要があります\"]\n    pub fn operations(\u0026self) -\u003e \u0026[Arc\u003cdyn FileOperation\u003e] {\n        \u0026self.operations\n    }\n\n    /// トランザクションを結合します\n    /// # Errors\n    /// - いずれかのトランザクションが保留状態でない場合\n    #[must_use = \"トランザクションの結合結果は新しいトランザクションインスタンスとして返されます\"]\n    pub fn combine(self, other: \u0026Self) -\u003e Result\u003cSelf\u003e {\n        match (\u0026self.state, \u0026other.state) {\n            (State::Pending { .. }, State::Pending { .. }) =\u003e {\n                let mut operations = (*self.operations).clone();\n                operations.extend(other.operations.iter().cloned());\n                Ok(Self {\n                    operations: Arc::new(operations),\n                    state: State::Pending {\n                        created_at: State::now(),\n                    },\n                })\n            }\n            _ =\u003e {\n                Err(anyhow!(\"トランザクションの結合は保留状態でのみ可能です\"))\n            }\n        }\n    }\n}\n\n// イミュータブルな操作を実装するための具体的な型\n#[derive(Debug)]\npub struct CreateFileOperation {\n    path: Arc\u003cPathBuf\u003e,\n    content: Arc\u003cString\u003e,\n}\n\nimpl CreateFileOperation {\n    /// 新しいファイル作成操作を作成します\n    #[must_use = \"新しいファイル作成操作インスタンスは使用する必要があります\"]\n    pub fn new(path: PathBuf, content: String) -\u003e Self {\n        Self {\n            path: Arc::new(path),\n            content: Arc::new(content),\n        }\n    }\n}\n\nimpl FileOperation for CreateFileOperation {\n    fn execute(\u0026self) -\u003e Result\u003c()\u003e {\n        if let Some(parent) = self.path.parent() {\n            ensure_path_exists(parent)?;\n        }\n        std::fs::write(\u0026*self.path, \u0026*self.content)\n            .map_err(|e| anyhow!(\"ファイルの書き込みに失敗: {}: {}\", self.path.display(), e))\n    }\n\n    fn rollback(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.path.exists() {\n            std::fs::remove_file(\u0026*self.path)\n                .map_err(|e| anyhow!(\"ファイルの削除に失敗: {}: {}\", self.path.display(), e))?;\n        }\n        Ok(())\n    }\n\n    fn description(\u0026self) -\u003e String {\n        format!(\"ファイル作成: {}\", self.path.display())\n    }\n\n    fn validate(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.path.as_os_str().is_empty() {\n            return Err(anyhow!(\"パスが空です\"));\n        }\n        if self.path.exists() {\n            return Err(anyhow!(\"ファイルが既に存在します: {}\", self.path.display()));\n        }\n        Ok(())\n    }\n}\n\n#[derive(Debug)]\npub struct DeleteFileOperation {\n    path: Arc\u003cPathBuf\u003e,\n    original_content: Option\u003cArc\u003cString\u003e\u003e,\n}\n\nimpl DeleteFileOperation {\n    /// 新しいファイル削除操作を作成します\n    /// # Errors\n    /// - ァイルの読み込みに失敗した場合\n    #[must_use = \"新しいファイル削除操作インスタンスは使用する必要があります\"]\n    pub fn new(path: PathBuf) -\u003e Result\u003cSelf\u003e {\n        let original_content = if path.exists() {\n            Some(Arc::new(std::fs::read_to_string(\u0026path)\n                .map_err(|e| anyhow!(\"ファイルの読み込みに失敗: {}: {}\", path.display(), e))?))\n        } else {\n            None\n        };\n\n        Ok(Self {\n            path: Arc::new(path),\n            original_content,\n        })\n    }\n}\n\nimpl FileOperation for DeleteFileOperation {\n    fn execute(\u0026self) -\u003e Result\u003c()\u003e {\n        if self.path.exists() {\n            std::fs::remove_file(\u0026*self.path)\n                .map_err(|e| anyhow!(\"ファイルの削除に失敗: {}: {}\", self.path.display(), e))?;\n        }\n        Ok(())\n    }\n\n    fn rollback(\u0026self) -\u003e Result\u003c()\u003e {\n        if let Some(content) = \u0026self.original_content {\n            if let Some(parent) = self.path.parent() {\n                ensure_path_exists(parent)?;\n            }\n            std::fs::write(\u0026*self.path, \u0026**content)\n                .map_err(|e| anyhow!(\"ファイルの復元に失敗: {}: {}\", self.path.display(), e))?;\n        }\n        Ok(())\n    }\n\n    fn description(\u0026self) -\u003e String {\n        format!(\"ファイル削除: {}\", self.path.display())\n    }\n\n    fn validate(\u0026self) -\u003e Result\u003c()\u003e {\n        if !self.path.exists() {\n            return Err(anyhow!(\"ファイルが存在しません: {}\", self.path.display()));\n        }\n        Ok(())\n    }\n} \n","traces":[{"line":58,"address":[2825264],"length":1,"stats":{"Line":1}},{"line":59,"address":[2825268],"length":1,"stats":{"Line":1}},{"line":61,"address":[2674848,2674860],"length":1,"stats":{"Line":2}},{"line":66,"address":[1701744],"length":1,"stats":{"Line":1}},{"line":67,"address":[1701773],"length":1,"stats":{"Line":1}},{"line":68,"address":[1011677],"length":1,"stats":{"Line":1}},{"line":69,"address":[2825626,2825531],"length":1,"stats":{"Line":2}},{"line":71,"address":[2825635],"length":1,"stats":{"Line":0}},{"line":72,"address":[1012135,1012013],"length":1,"stats":{"Line":0}},{"line":74,"address":[1702304],"length":1,"stats":{"Line":0}},{"line":75,"address":[2826132,2826010],"length":1,"stats":{"Line":0}},{"line":77,"address":[2826141],"length":1,"stats":{"Line":0}},{"line":78,"address":[1012637],"length":1,"stats":{"Line":0}},{"line":105,"address":[2826560],"length":1,"stats":{"Line":0}},{"line":106,"address":[1702984],"length":1,"stats":{"Line":0}},{"line":113,"address":[2826592,2826772],"length":1,"stats":{"Line":1}},{"line":115,"address":[1703022],"length":1,"stats":{"Line":1}},{"line":116,"address":[2826703],"length":1,"stats":{"Line":1}},{"line":125,"address":[1703375,1703216],"length":1,"stats":{"Line":0}},{"line":127,"address":[1703253],"length":1,"stats":{"Line":0}},{"line":128,"address":[1703277],"length":1,"stats":{"Line":0}},{"line":134,"address":[1013396,1013216],"length":1,"stats":{"Line":1}},{"line":136,"address":[1013253],"length":1,"stats":{"Line":2}},{"line":147,"address":[1018512,1014534,1013424],"length":1,"stats":{"Line":1}},{"line":148,"address":[1013455],"length":1,"stats":{"Line":2}},{"line":149,"address":[2827582],"length":1,"stats":{"Line":1}},{"line":151,"address":[1013854,1013994],"length":1,"stats":{"Line":3}},{"line":152,"address":[1704578,1704457],"length":1,"stats":{"Line":2}},{"line":155,"address":[1704768],"length":1,"stats":{"Line":1}},{"line":156,"address":[2828410],"length":1,"stats":{"Line":1}},{"line":158,"address":[1705056],"length":1,"stats":{"Line":1}},{"line":159,"address":[2828494],"length":1,"stats":{"Line":1}},{"line":160,"address":[2828585],"length":1,"stats":{"Line":1}},{"line":165,"address":[2829072,2827665,2828824],"length":1,"stats":{"Line":3}},{"line":167,"address":[2830834,2829088],"length":1,"stats":{"Line":2}},{"line":168,"address":[1707492],"length":1,"stats":{"Line":0}},{"line":169,"address":[1707327],"length":1,"stats":{"Line":0}},{"line":170,"address":[2831004],"length":1,"stats":{"Line":0}},{"line":176,"address":[1015273,1015204,1015489],"length":1,"stats":{"Line":3}},{"line":177,"address":[1705790,1705929],"length":1,"stats":{"Line":2}},{"line":179,"address":[1706111,1706014,1706398],"length":1,"stats":{"Line":0}},{"line":180,"address":[1706414,1706646],"length":1,"stats":{"Line":0}},{"line":181,"address":[1707015,1707152],"length":1,"stats":{"Line":0}},{"line":187,"address":[1706519],"length":1,"stats":{"Line":0}},{"line":188,"address":[1706371],"length":1,"stats":{"Line":0}},{"line":189,"address":[2830028],"length":1,"stats":{"Line":0}},{"line":194,"address":[2829417],"length":1,"stats":{"Line":1}},{"line":195,"address":[1015474],"length":1,"stats":{"Line":1}},{"line":200,"address":[1013915,1017489,1017291],"length":1,"stats":{"Line":3}},{"line":201,"address":[1017505,1017625],"length":1,"stats":{"Line":2}},{"line":202,"address":[1708360,1708239],"length":1,"stats":{"Line":0}},{"line":206,"address":[1017535],"length":1,"stats":{"Line":1}},{"line":207,"address":[1017477],"length":1,"stats":{"Line":1}},{"line":210,"address":[1703817],"length":1,"stats":{"Line":0}},{"line":211,"address":[1708606,1708743],"length":1,"stats":{"Line":0}},{"line":221,"address":[1018576],"length":1,"stats":{"Line":1}},{"line":227,"address":[1019538,1018592],"length":1,"stats":{"Line":1}},{"line":228,"address":[1018960,1019157,1018747],"length":1,"stats":{"Line":0}},{"line":230,"address":[1709006],"length":1,"stats":{"Line":1}},{"line":231,"address":[1709421,1709180],"length":1,"stats":{"Line":2}},{"line":234,"address":[2678185,2677629,2677922,2677584,2677790],"length":1,"stats":{"Line":4}},{"line":244,"address":[1709968],"length":1,"stats":{"Line":1}},{"line":245,"address":[2833574],"length":1,"stats":{"Line":2}},{"line":253,"address":[1019632],"length":1,"stats":{"Line":1}},{"line":254,"address":[2833628],"length":1,"stats":{"Line":1}},{"line":261,"address":[1019680],"length":1,"stats":{"Line":1}},{"line":262,"address":[2833676],"length":1,"stats":{"Line":1}},{"line":267,"address":[1710128],"length":1,"stats":{"Line":1}},{"line":268,"address":[2833717],"length":1,"stats":{"Line":1}},{"line":275,"address":[1020476,1020577,1019760],"length":1,"stats":{"Line":0}},{"line":276,"address":[1710198],"length":1,"stats":{"Line":0}},{"line":278,"address":[1710342,1710408],"length":1,"stats":{"Line":0}},{"line":279,"address":[2834024,2834087],"length":1,"stats":{"Line":0}},{"line":280,"address":[1710784],"length":1,"stats":{"Line":0}},{"line":281,"address":[2834199],"length":1,"stats":{"Line":0}},{"line":282,"address":[2834342],"length":1,"stats":{"Line":0}},{"line":283,"address":[2834276],"length":1,"stats":{"Line":0}},{"line":288,"address":[2833892,2834540],"length":1,"stats":{"Line":0}},{"line":304,"address":[1711210,1711040],"length":1,"stats":{"Line":1}},{"line":306,"address":[1711049,1711117],"length":1,"stats":{"Line":2}},{"line":307,"address":[2834706],"length":1,"stats":{"Line":1}},{"line":313,"address":[1711248],"length":1,"stats":{"Line":1}},{"line":314,"address":[1020798],"length":1,"stats":{"Line":1}},{"line":315,"address":[2835038,2834928],"length":1,"stats":{"Line":1}},{"line":317,"address":[1711395],"length":1,"stats":{"Line":1}},{"line":318,"address":[1551661,1551313,1551771,1551296],"length":1,"stats":{"Line":0}},{"line":321,"address":[2835088],"length":1,"stats":{"Line":1}},{"line":322,"address":[1021038],"length":1,"stats":{"Line":1}},{"line":323,"address":[1021157,1021082],"length":1,"stats":{"Line":0}},{"line":324,"address":[2675424,2675789,2675441,2675899],"length":1,"stats":{"Line":0}},{"line":326,"address":[1711547],"length":1,"stats":{"Line":1}},{"line":329,"address":[1021184],"length":1,"stats":{"Line":1}},{"line":330,"address":[1021222,1021369],"length":1,"stats":{"Line":2}},{"line":333,"address":[2835568],"length":1,"stats":{"Line":1}},{"line":334,"address":[2835587],"length":1,"stats":{"Line":1}},{"line":335,"address":[1021580],"length":1,"stats":{"Line":0}},{"line":337,"address":[2835631],"length":1,"stats":{"Line":1}},{"line":338,"address":[2835988,2835885,2835734],"length":1,"stats":{"Line":3}},{"line":340,"address":[2835716],"length":1,"stats":{"Line":1}},{"line":355,"address":[2836538,2836032,2836516],"length":1,"stats":{"Line":1}},{"line":356,"address":[2836435,2836146,2836062,2836176],"length":1,"stats":{"Line":4}},{"line":357,"address":[2836267,2836183,2836408],"length":1,"stats":{"Line":2}},{"line":358,"address":[1552838,1552401,1552728,1552384],"length":1,"stats":{"Line":0}},{"line":360,"address":[1022071],"length":1,"stats":{"Line":1}},{"line":363,"address":[1022372],"length":1,"stats":{"Line":1}},{"line":364,"address":[1022104],"length":1,"stats":{"Line":1}},{"line":365,"address":[2836491],"length":1,"stats":{"Line":1}},{"line":371,"address":[1022448],"length":1,"stats":{"Line":1}},{"line":372,"address":[1713006],"length":1,"stats":{"Line":1}},{"line":373,"address":[2836714,2836635],"length":1,"stats":{"Line":1}},{"line":374,"address":[1553277,1552929,1552912,1553387],"length":1,"stats":{"Line":0}},{"line":376,"address":[1713035],"length":1,"stats":{"Line":1}},{"line":379,"address":[1022608],"length":1,"stats":{"Line":0}},{"line":380,"address":[1022622],"length":1,"stats":{"Line":0}},{"line":381,"address":[1713234,1713312],"length":1,"stats":{"Line":0}},{"line":382,"address":[2837061,2836916],"length":1,"stats":{"Line":0}},{"line":384,"address":[1713525,1713383],"length":1,"stats":{"Line":0}},{"line":385,"address":[1808417,1808871,1808400,1808761],"length":1,"stats":{"Line":0}},{"line":387,"address":[1713298],"length":1,"stats":{"Line":0}},{"line":390,"address":[1713552],"length":1,"stats":{"Line":0}},{"line":391,"address":[1713738,1713590],"length":1,"stats":{"Line":0}},{"line":394,"address":[1713856],"length":1,"stats":{"Line":1}},{"line":395,"address":[1713876],"length":1,"stats":{"Line":1}},{"line":396,"address":[1714065,1714162,1713914],"length":1,"stats":{"Line":3}},{"line":398,"address":[1714180],"length":1,"stats":{"Line":1}}],"covered":77,"coverable":125},{"path":["/","home","cphelper-dev","project-cph","src","lib.rs"],"content":"pub mod config;\npub mod contest;\npub mod docker;\npub mod message;\npub mod fs;\n\npub use contest::{Command, Contest, Handler, TestCase, TestRunner};\npub use docker::Runtime;\npub use message::{Type, messages};\npub use anyhow::{anyhow, Context, Error, Result};\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","main.rs"],"content":"use clap::Parser;\nuse cph::cli::Cli;\n\n#[tokio::main]\nasync fn main() -\u003e cph::error::Result\u003c()\u003e {\n    let cli = Cli::parse();\n    cli.execute().await\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","message","messages.rs"],"content":"use serde::Deserialize;\nuse std::collections::HashMap;\nuse once_cell::sync::Lazy;\nuse super::Type;\n\n#[derive(Debug, Deserialize)]\nstruct MessageCategory {\n    error: HashMap\u003cString, String\u003e,\n    warning: HashMap\u003cString, String\u003e,\n    hint: HashMap\u003cString, String\u003e,\n}\n\n#[derive(Debug, Deserialize)]\nstruct Messages {\n    messages: HashMap\u003cString, MessageCategory\u003e,\n}\n\nstatic MESSAGES: Lazy\u003cMessages\u003e = Lazy::new(|| {\n    let yaml = include_str!(\"messages.yaml\");\n    serde_yaml::from_str(yaml).expect(\"メッセージ定義の読み込みに失敗しました\")\n});\n\n/// メッセージを取得します。\n/// \n/// # Arguments\n/// * `category` - メッセージのカテゴリ（\"fs\", \"docker\", \"contest\", \"common\"）\n/// * `msg_type` - メッセージの種類（Error, Warning, Hint）\n/// * `key` - メッセージのキー\n/// \n/// # Returns\n/// * `Option\u003c\u0026'static str\u003e` - メッセージのテンプレート\n#[must_use]\npub fn get(category: \u0026str, msg_type: Type, key: \u0026str) -\u003e Option\u003c\u0026'static str\u003e {\n    MESSAGES.messages.get(category).and_then(|cat| {\n        match msg_type {\n            Type::Error =\u003e cat.error.get(key),\n            Type::Warning =\u003e cat.warning.get(key),\n            Type::Hint =\u003e cat.hint.get(key),\n        }\n    }).map(String::as_str)\n}\n\n/// メッセージをフォーマットします。\n/// \n/// # Arguments\n/// * `category` - メッセージのカテゴリ\n/// * `msg_type` - メッセージの種類\n/// * `key` - メッセージのキー\n/// * `args` - フォーマット引数\n/// \n/// # Returns\n/// * `String` - フォーマットされたメッセージ\n/// \n/// # Panics\n/// * メッセージが見つからない場合\npub fn format\u003cD: std::fmt::Display\u003e(\n    category: \u0026str,\n    msg_type: Type,\n    key: \u0026str,\n    args: D,\n) -\u003e String {\n    let template = get(category, msg_type, key)\n        .unwrap_or_else(|| panic!(\"メッセージが見つかりません: {category}/{msg_type:?}/{key}\"));\n    template.replace(\"{}\", \u0026args.to_string())\n}\n\n// 利便性のために各カテゴリのモジュールを提供\npub mod fs {\n    use super::{Type, format};\n\n    pub fn error\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"fs\", Type::Error, key, args)\n    }\n\n    pub fn warning\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"fs\", Type::Warning, key, args)\n    }\n\n    pub fn hint\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"fs\", Type::Hint, key, args)\n    }\n}\n\npub mod docker {\n    use super::{Type, format};\n\n    pub fn error\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"docker\", Type::Error, key, args)\n    }\n\n    pub fn warning\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"docker\", Type::Warning, key, args)\n    }\n\n    pub fn hint\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"docker\", Type::Hint, key, args)\n    }\n}\n\npub mod contest {\n    use super::{Type, format};\n\n    pub fn error\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"contest\", Type::Error, key, args)\n    }\n\n    pub fn warning\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"contest\", Type::Warning, key, args)\n    }\n\n    pub fn hint\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"contest\", Type::Hint, key, args)\n    }\n}\n\npub mod common {\n    use super::{Type, format};\n\n    pub fn error\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"common\", Type::Error, key, args)\n    }\n\n    pub fn warning\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"common\", Type::Warning, key, args)\n    }\n\n    pub fn hint\u003cD: std::fmt::Display\u003e(key: \u0026str, args: D) -\u003e String {\n        format(\"common\", Type::Hint, key, args)\n    }\n} ","traces":[{"line":18,"address":[1686576],"length":1,"stats":{"Line":1}},{"line":19,"address":[2018738],"length":1,"stats":{"Line":1}},{"line":20,"address":[2018759],"length":1,"stats":{"Line":1}},{"line":33,"address":[2101440],"length":1,"stats":{"Line":1}},{"line":34,"address":[2101490],"length":1,"stats":{"Line":2}},{"line":35,"address":[3142578],"length":1,"stats":{"Line":1}},{"line":36,"address":[3142622],"length":1,"stats":{"Line":1}},{"line":37,"address":[2018924],"length":1,"stats":{"Line":0}},{"line":38,"address":[3142686],"length":1,"stats":{"Line":0}},{"line":40,"address":[3142709],"length":1,"stats":{"Line":1}},{"line":56,"address":[3144272,3145232,3142720,3143728,3145199,3144260,3144720,3144375,3145703,3143381,3143216,3143183,3143909,3144736,3143744],"length":1,"stats":{"Line":6}},{"line":62,"address":[3142918,3145428,3144934,3143854,3144326,3144459,3143999,3142779,3145286,3144795,3143326,3143471],"length":1,"stats":{"Line":14}},{"line":63,"address":[2022007,2022583,2022576,2022646,2022425,2022773,2021172,2022871,2023440,2022197,2020231,2023222,2023289,2022358,2022485,2022137,2022070,2020697,2019703,2022288,2022295,2022864,2023447,2019156,2023637,2021666,2023510,2023577,2023349,2023061,2022713,2023152,2022934,2022000,2023159,2023001],"length":1,"stats":{"Line":7}},{"line":64,"address":[3145126,3144658,3143666,3143009,3145025,3145627,3144537,3144198,3144077,3143110,3145506,3143565],"length":1,"stats":{"Line":14}},{"line":71,"address":[1740144,1740240,1740320],"length":1,"stats":{"Line":6}},{"line":72,"address":[1225060],"length":1,"stats":{"Line":6}},{"line":75,"address":[],"length":0,"stats":{"Line":0}},{"line":76,"address":[],"length":0,"stats":{"Line":0}},{"line":79,"address":[],"length":0,"stats":{"Line":0}},{"line":80,"address":[],"length":0,"stats":{"Line":0}},{"line":87,"address":[2868528,2868448,2868704,2868608],"length":1,"stats":{"Line":0}},{"line":88,"address":[1744895,1745156,1744975,1745068],"length":1,"stats":{"Line":0}},{"line":91,"address":[],"length":0,"stats":{"Line":0}},{"line":92,"address":[],"length":0,"stats":{"Line":0}},{"line":95,"address":[],"length":0,"stats":{"Line":0}},{"line":96,"address":[],"length":0,"stats":{"Line":0}},{"line":103,"address":[3230672],"length":1,"stats":{"Line":0}},{"line":104,"address":[2108060],"length":1,"stats":{"Line":0}},{"line":107,"address":[],"length":0,"stats":{"Line":0}},{"line":108,"address":[],"length":0,"stats":{"Line":0}},{"line":111,"address":[2108112],"length":1,"stats":{"Line":0}},{"line":112,"address":[2108143],"length":1,"stats":{"Line":0}},{"line":119,"address":[],"length":0,"stats":{"Line":0}},{"line":120,"address":[],"length":0,"stats":{"Line":0}},{"line":123,"address":[],"length":0,"stats":{"Line":0}},{"line":124,"address":[],"length":0,"stats":{"Line":0}},{"line":127,"address":[],"length":0,"stats":{"Line":0}},{"line":128,"address":[],"length":0,"stats":{"Line":0}}],"covered":14,"coverable":38},{"path":["/","home","cphelper-dev","project-cph","src","message","mod.rs"],"content":"pub mod messages;\n\n/// メッセージの種類\n#[derive(Debug, Clone, Copy)]\npub enum Type {\n    Error,\n    Warning,\n    Hint,\n}\n\npub use messages::{get, format};\npub use messages::{fs, docker, contest, common}; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","src","oj","mod.rs"],"content":"use crate::error::Result;\nuse std::path::PathBuf;\nuse colored::*;\nuse std::process::Command;\nuse std::env;\nuse users;\nuse std::os::unix::fs::PermissionsExt;\nuse dirs;\nuse crate::config::Config;\n\nconst COOKIE_DIR: \u0026str = \".local/share/online-judge-tools\";\nconst COOKIE_FILE: \u0026str = \"cookie.jar\";\nconst DOCKERFILE_PATH: \u0026str = \"src/oj/Dockerfile\";\nconst DOCKER_IMAGE_NAME: \u0026str = \"oj-container\";\n\n// エラーメッセージ\nconst ERROR_DOCKER_IMAGE_NOT_FOUND: \u0026str = \"Dockerイメージが見つかりません。'cargo run -- atcoder login'を実行してログインしてください。\";\nconst ERROR_DOCKERFILE_NOT_FOUND: \u0026str = \"Dockerfile not found\";\n\npub fn open_in_cursor(url: \u0026str, source_path: Option\u003c\u0026PathBuf\u003e) -\u003e Result\u003c()\u003e {\n    // 問題ページを開く\n    if let Ok(browser) = env::var(\"BROWSER\") {\n        Command::new(\u0026browser)\n            .arg(url)\n            .output()?;\n    } else {\n        println!(\"{}\", format!(\"Note: To automatically open URLs, please set the $BROWSER environment variable.\").yellow());\n    }\n    \n    if let Some(path) = source_path {\n        if let Err(e) = Command::new(\"code\").arg(path.display().to_string()).output() {\n            println!(\"Note: Failed to open in VSCode: {}\", e);\n        }\n\n        if let Err(e) = Command::new(\"cursor\").arg(path.display().to_string()).output() {\n            println!(\"Note: Failed to open in Cursor: {}\", e);\n        }\n    }\n\n    Ok(())\n}\n\n#[derive(Debug, Clone)]\npub struct ProblemInfo {\n    pub url: String,\n    pub source_path: PathBuf,\n    pub problem_id: String,\n}\n\npub struct OJContainer {\n    workspace_path: PathBuf,\n    site_name: String,\n    config: Config,\n}\n\nimpl OJContainer {\n    pub fn new(workspace_path: PathBuf, site_name: String) -\u003e Result\u003cSelf\u003e {\n        let config = Config::load()\n            .map_err(|e| format!(\"設定の読み込みに失敗しました: {}\", e))?;\n        Ok(Self { workspace_path, site_name, config })\n    }\n\n    fn get_dockerfile_path() -\u003e PathBuf {\n        PathBuf::from(DOCKERFILE_PATH)\n    }\n\n    fn check_dockerfile_exists() -\u003e Result\u003c()\u003e {\n        if !Self::get_dockerfile_path().exists() {\n            println!(\"{}\", \"Error: Dockerfile not found\".red());\n            return Err(ERROR_DOCKERFILE_NOT_FOUND.into());\n        }\n        Ok(())\n    }\n\n    fn get_cookie_paths() -\u003e Result\u003c(PathBuf, PathBuf)\u003e {\n        let home_dir = dirs::home_dir().ok_or(\"Failed to get home directory\")?;\n        let cookie_dir = home_dir.join(COOKIE_DIR);\n        let cookie_path = cookie_dir.join(COOKIE_FILE);\n        Ok((cookie_dir, cookie_path))\n    }\n\n    fn setup_cookie_file(cookie_dir: \u0026PathBuf, cookie_path: \u0026PathBuf) -\u003e Result\u003c()\u003e {\n        std::fs::create_dir_all(cookie_dir)?;\n        std::fs::write(cookie_path, \"#LWP-Cookies-2.0\\n\")?;\n        std::fs::set_permissions(cookie_path, std::fs::Permissions::from_mode(0o600))?;\n        Ok(())\n    }\n\n    async fn run_oj_command(\u0026self, args: \u0026[\u0026str], mount_workspace: bool) -\u003e Result\u003c()\u003e {\n        let (_cookie_dir, cookie_path) = Self::get_cookie_paths()?;\n        let mut command = Command::new(\"docker\");\n\n        // 基本的なdockerコマンドを構築\n        let is_login = args.get(0).map_or(false, |\u0026cmd| cmd == \"login\");\n        if is_login {\n            command.args([\"run\", \"--rm\", \"-it\"]);\n        } else {\n            command.args([\"run\", \"--rm\"]);\n        }\n        \n        // ユーザーIDとグループIDを設定\n        let uid = users::get_current_uid();\n        let gid = users::get_current_gid();\n        command.args([\"-u\", \u0026format!(\"{}:{}\", uid, gid)]);\n\n        // 環境変数を設定\n        command.args([\"-e\", \u0026format!(\"HOME=/home/oj-user\")]);\n\n        // cookieファイルをコンテナ内の期待されるパスにマウント\n        command.args([\"-v\", \u0026format!(\"{}:/home/oj-user/{}/{}\", cookie_path.display(), COOKIE_DIR, COOKIE_FILE)]);\n\n        // ワークスペースのマウントが必要な場合\n        if mount_workspace {\n            let workspace_mount = format!(\"{}:/workspace\", self.workspace_path.display());\n            command.args([\"-v\", \u0026workspace_mount, \"-w\", \"/workspace\"]);\n        }\n\n        // OJコマンドを実行\n        let status = command\n            .args([DOCKER_IMAGE_NAME, \"oj\"])\n            .args(args)\n            .status()?;\n\n        if !status.success() {\n            return Err(format!(\"Command failed with status: {}\", status).into());\n        }\n\n        Ok(())\n    }\n\n    async fn check_image_exists(\u0026self) -\u003e Result\u003c()\u003e {\n        let output = Command::new(\"docker\")\n            .args([\"images\", \"-q\", DOCKER_IMAGE_NAME])\n            .output()?;\n\n        if output.stdout.is_empty() {\n            return Err(ERROR_DOCKER_IMAGE_NOT_FOUND.into());\n        }\n\n        Ok(())\n    }\n\n    pub async fn ensure_image(\u0026self) -\u003e Result\u003c()\u003e {\n        Self::check_dockerfile_exists()?;\n        println!(\"{}\", \"Building OJ container image...\".cyan());\n\n        let status = Command::new(\"docker\")\n            .args([\"build\", \"-t\", DOCKER_IMAGE_NAME, \"-f\", DOCKERFILE_PATH, \"src/oj\"])\n            .status()?;\n\n        if !status.success() {\n            return Err(\"Failed to build docker image\".into());\n        }\n\n        Ok(())\n    }\n\n    pub async fn login(\u0026self) -\u003e Result\u003c()\u003e {\n        // サイトのURLを取得\n        let url = self.config.get::\u003cString\u003e(\u0026format!(\"sites.{}.url\", self.site_name))?;\n        let name = self.config.get::\u003cString\u003e(\u0026format!(\"sites.{}.name\", self.site_name))?;\n\n        println!(\"{}\", format!(\"Logging in to {}...\", name).cyan());\n\n        // cookieファイルをリセット\n        println!(\"{}\", \"Resetting cookie file...\".cyan());\n        let (cookie_dir, cookie_path) = Self::get_cookie_paths()?;\n\n        // cookieファイルが存在する場合は削除\n        if cookie_path.exists() {\n            std::fs::remove_file(\u0026cookie_path)?;\n        }\n\n        // cookieファイルを作成\n        Self::setup_cookie_file(\u0026cookie_dir, \u0026cookie_path)?;\n\n        // Dockerイメージを再ビルド\n        println!(\"{}\", \"Rebuilding Docker image...\".cyan());\n        Self::check_dockerfile_exists()?;\n\n        let status = Command::new(\"docker\")\n            .args([\"build\", \"--no-cache\", \"-t\", DOCKER_IMAGE_NAME, \"-f\", DOCKERFILE_PATH, \"src/oj\"])\n            .status()?;\n\n        if !status.success() {\n            return Err(\"Failed to build docker image\".into());\n        }\n\n        // ログインを実行\n        self.run_oj_command(\u0026[\"login\", \u0026url], false).await?;\n\n        println!(\"{}\", format!(\"Successfully logged in to {}\", name).green());\n        Ok(())\n    }\n\n    pub async fn open(\u0026self, problem: ProblemInfo) -\u003e Result\u003c()\u003e {\n        println!(\"{}\", format!(\"Opening problem URL: {}\", problem.url).cyan());\n\n        // ブラウザ設定を確認\n        let browser = self.config.get::\u003cString\u003e(\"system.browser\")\n            .or_else(|_| env::var(\"BROWSER\"))\n            .unwrap_or_else(|_| {\n                println!(\"{}\", format!(\"Note: To automatically open URLs, please set the $BROWSER environment variable or configure system.browser in config.yaml\").yellow());\n                String::new()\n            });\n\n        if !browser.is_empty() {\n            if let Err(e) = Command::new(\u0026browser).arg(\u0026problem.url).output() {\n                println!(\"Note: Failed to open in browser: {}\", e);\n            }\n        }\n\n        // エディタ設定を取得\n        let editors = self.config.get::\u003cVec\u003cString\u003e\u003e(\"system.editors\")\n            .unwrap_or_else(|_| vec![\"code\".to_string(), \"cursor\".to_string()]);\n\n        // 各エディタで開く\n        for editor in editors {\n            if let Some(source_path) = problem.source_path.to_str() {\n                if let Err(e) = Command::new(\u0026editor).arg(source_path).output() {\n                    println!(\"Note: Failed to open in {}: {}\", editor, e);\n                }\n            }\n        }\n\n        // Dockerイメージの存在確認\n        self.check_image_exists().await?;\n\n        // 問題ディレクトリのパスを取得\n        let problem_dir = problem.source_path.parent()\n            .ok_or_else(|| \"Invalid problem path\".to_string())?;\n\n        // 問題ディレクトリを基準にコマンドを実行\n        let relative_problem_dir = problem_dir.strip_prefix(\u0026self.workspace_path)\n            .map_err(|_| \"Failed to get relative problem path\")?;\n\n        // テストディレクトリを設定から取得\n        let test_dir = self.config.get::\u003cString\u003e(\"system.test.directory\")\n            .unwrap_or_else(|_| \"test\".to_string());\n\n        self.run_oj_command(\u0026[\n            \"download\",\n            \"-d\", \u0026format!(\"{}/{}\", relative_problem_dir.display(), test_dir),\n            \u0026problem.url,\n        ], true).await?;\n\n        println!(\"{}\", \"Problem setup completed\".green());\n        Ok(())\n    }\n\n    pub async fn submit(\u0026self, problem: \u0026ProblemInfo, language_id: \u0026str) -\u003e Result\u003c()\u003e {\n        // Dockerイメージの存在確認\n        self.check_image_exists().await?;\n\n        // 提出コマンドを実行\n        println!(\"{}\", format!(\"Submitting solution for problem {}...\", problem.problem_id).cyan());\n\n        self.run_oj_command(\u0026[\n            \"submit\",\n            \"-l\", language_id,\n            \"-y\",  // 確認をスキップ\n            \u0026problem.url,\n            \u0026problem.source_path.to_string_lossy(),\n        ], true).await?;\n\n        println!(\"{}\", \"Solution submitted successfully\".green());\n        Ok(())\n    }\n}\n\npub fn has_test_cases(dir: \u0026PathBuf) -\u003e Result\u003cbool\u003e {\n    if !dir.exists() {\n        return Ok(false);\n    }\n\n    let entries = std::fs::read_dir(dir)?;\n    let mut has_input = false;\n    let mut has_output = false;\n\n    for entry in entries {\n        let entry = entry?;\n        let path = entry.path();\n        if let Some(extension) = path.extension() {\n            if extension == \"in\" {\n                has_input = true;\n            } else if extension == \"out\" {\n                has_output = true;\n            }\n        }\n    }\n\n    Ok(has_input \u0026\u0026 has_output)\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","contest","mod.rs"],"content":"#[cfg(test)]\nmod parse; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","contest","parse","config.rs"],"content":"use anyhow::Result;\nuse cph::contest::parse::Config;\n\n#[test]\nfn test_config_loading() -\u003e Result\u003c()\u003e {\n    let config = Config::from_file(\"tests/contest/parse/test_commands.yaml\")?;\n    \n    // サイトのエイリアス解決をテスト\n    assert_eq!(\n        config.resolve_alias(\"at\"),\n        Some((\"site\".to_string(), \"atcoder\".to_string()))\n    );\n\n    // 言語のエイリアス解決をテスト\n    assert_eq!(\n        config.resolve_alias(\"rs\"),\n        Some((\"language\".to_string(), \"rust\".to_string()))\n    );\n\n    // 存在しないエイリアスのテスト\n    assert_eq!(config.resolve_alias(\"nonexistent\"), None);\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","contest","parse","mod.rs"],"content":"#[cfg(test)]\nmod config;\n#[cfg(test)]\nmod parser; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","contest","parse","parser.rs"],"content":"use anyhow::Result;\nuse cph::contest::model::Command;\nuse cph::contest::parse::{Parser, Config};\n\nfn create_test_parser() -\u003e Parser {\n    let config = Config::from_file(\"tests/contest/parse/test_commands.yaml\").unwrap();\n    Parser::with_config(config)\n}\n\n#[test]\nfn test_basic_parsing() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n    \n    // 基本的なパースのテスト\n    let context = parser.parse(\"abc123 a\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: None,\n        }\n    );\n\n    // サイトとproblem_idのテスト\n    let context = parser.parse(\"atcoder abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    // 全パラメータのテスト\n    let context = parser.parse(\"atcoder abc123 a rust\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_alias_resolution() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n    \n    // サイトのエイリアス解決\n    let context = parser.parse(\"at abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    // 言語のエイリアス解決\n    let context = parser.parse(\"abc123 a rs\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_complex_patterns() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // 複数の問題ID候補がある場合\n    let context = parser.parse(\"abc123 a b c\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),  // 最初の値を問題IDとして解釈\n            language: None,\n        }\n    );\n\n    // 順序が異なる場合\n    let context = parser.parse(\"rs abc123 atcoder a\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_edge_cases() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // 最小限の入力\n    let context = parser.parse(\"abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    // サイトのみの入力\n    let context = parser.parse(\"atcoder\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: None,\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_error_cases() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n    \n    // 空入力のテスト\n    assert!(parser.parse(\"\").is_err());\n    assert!(parser.parse(\"   \").is_err());\n\n    // 余分な空白を含む入力\n    let context = parser.parse(\"  abc123   a  \")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_priority_handling() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // サイトと1つのトークン\n    let context = parser.parse(\"atcoder abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_invalid_config() -\u003e Result\u003c()\u003e {\n    // 無効な設定ファイルの読み込み\n    let config = Config::from_file(\"tests/contest/parse/invalid_commands.yaml\")?;\n    \n    // 空白を含むエイリアスが無視されていることを確認\n    assert!(!config.resolve_alias(\"at test\").is_some());\n    assert!(!config.resolve_alias(\"at coder\").is_some());\n    assert!(!config.resolve_alias(\"cf test\").is_some());\n    assert!(!config.resolve_alias(\"code forces\").is_some());\n    assert!(!config.resolve_alias(\"rust 2021\").is_some());\n    assert!(!config.resolve_alias(\"rs test\").is_some());\n\n    // 存在しない設定ファイル\n    let result = Config::from_file(\"nonexistent.yaml\");\n    assert!(result.is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_special_characters() -\u003e Result\u003c()\u003e {\n    let config = Config::from_file(\"tests/contest/parse/special_commands.yaml\")?;\n    let parser = Parser::with_config(config);\n\n    // ハイフンを含むエイリアス\n    let context = parser.parse(\"at-test abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder-test\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    // 空白を含むエイリアス\n    let context = parser.parse(\"at test abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"at\".to_string()),\n            problem_id: Some(\"test\".to_string()),\n            language: None,\n        }\n    );\n\n    // Unicode文字\n    let context = parser.parse(\"ユ abc123\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"ユーコーダー\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_performance() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n    \n    // 長い入力のテスト\n    let long_input = \"atcoder abc123 a rust \".repeat(100);\n    let context = parser.parse(\u0026long_input)?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    // 多数のトークンを含む入力\n    let many_tokens = \"abc123 a b c d e f g h i j k l m n o p\".to_string();\n    let context = parser.parse(\u0026many_tokens)?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_whitespace_handling() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // タブを含む入力\n    let context = parser.parse(\"atcoder\\tabc123\\ta\\trust\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    // 複数の連続した空白\n    let context = parser.parse(\"atcoder    abc123  a    rust\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    // 前後の空白\n    let context = parser.parse(\"   atcoder abc123 a rust   \")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"abc123\".to_string()),\n            problem_id: Some(\"a\".to_string()),\n            language: Some(\"rust\".to_string()),\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_problem_id_priority() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // 一のトークンはcontest_idとして解釈\n    let context = parser.parse(\"at a\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: Some(\"atcoder\".to_string()),\n            contest_id: Some(\"a\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    Ok(())\n}\n\n#[test]\nfn test_token_interpretation() -\u003e Result\u003c()\u003e {\n    let parser = create_test_parser();\n\n    // 単一のトークンはcontest_idとして解釈\n    let context = parser.parse(\"aaa\")?;\n    assert_eq!(\n        context.command,\n        Command::Config {\n            site: None,\n            contest_id: Some(\"aaa\".to_string()),\n            problem_id: None,\n            language: None,\n        }\n    );\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","backup","mod.rs"],"content":"use std::fs::File;\nuse std::io::{Write, Read};\nuse tempfile::TempDir;\nuse anyhow::Result;\nuse tokio;\n\nuse cph::fs::backup::Manager;\n\n#[tokio::test]\nasync fn test_backup_manager_new() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let backup_dir = temp_dir.path().join(\"backup\");\n\n    // バックアップディレクトリが存在しない場合\n    assert!(!backup_dir.exists());\n    let _manager = Manager::new(\u0026backup_dir).await?;\n    assert!(backup_dir.exists());\n\n    // バックアップディレクトリが既に存在する場合\n    let _manager = Manager::new(\u0026backup_dir).await?;\n    assert!(backup_dir.exists());\n\n    Ok(())\n}\n\n#[tokio::test]\nasync fn test_backup_and_restore() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let backup_dir = temp_dir.path().join(\"backup\");\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // バックアップマネージャを作成\n    let manager = Manager::new(\u0026backup_dir).await?;\n\n    // テストファイルを作成\n    {\n        let mut file = File::create(\u0026test_file)?;\n        write!(file, \"{}\", test_content)?;\n    }\n\n    // バックアップを作成\n    manager.backup(\u0026test_file).await?;\n\n    // バックアップファイルの一覧を取得\n    let backups = manager.list_backups(\"test.txt\").await?;\n    assert_eq!(backups.len(), 1);\n\n    // 元のファイルを変更\n    {\n        let mut file = File::create(\u0026test_file)?;\n        write!(file, \"Modified content\")?;\n    }\n\n    // バックアップから復元\n    manager.restore(\u0026test_file, \u0026backups[0]).await?;\n\n    // 復元されたファイルの内容を確認\n    let mut content = String::new();\n    File::open(\u0026test_file)?.read_to_string(\u0026mut content)?;\n    assert_eq!(content, test_content);\n\n    Ok(())\n}\n\n#[tokio::test]\nasync fn test_multiple_backups() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let backup_dir = temp_dir.path().join(\"backup\");\n    let test_file = temp_dir.path().join(\"test.txt\");\n\n    // バックアップマネージャを作成\n    let manager = Manager::new(\u0026backup_dir).await?;\n\n    // 複数のバックアップを作成\n    for i in 1..=3 {\n        {\n            let mut file = File::create(\u0026test_file)?;\n            write!(file, \"Content {}\", i)?;\n        }\n        tokio::time::sleep(tokio::time::Duration::from_secs(1)).await;\n        manager.backup(\u0026test_file).await?;\n    }\n\n    // バックアップファイルの一覧を取得\n    let mut backups = manager.list_backups(\"test.txt\").await?;\n    assert_eq!(backups.len(), 3);\n\n    // バックアップファイルを時系列順にソート\n    backups.sort();\n\n    // 最新のバックアップから復元\n    manager.restore(\u0026test_file, \u0026backups[2]).await?;\n\n    // 復元されたファイルの内容を確認\n    let mut content = String::new();\n    File::open(\u0026test_file)?.read_to_string(\u0026mut content)?;\n    assert_eq!(content, \"Content 3\");\n\n    Ok(())\n}\n\n#[tokio::test]\nasync fn test_backup_error_cases() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let backup_dir = temp_dir.path().join(\"backup\");\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let non_existent_file = temp_dir.path().join(\"non_existent.txt\");\n\n    // バックアップマネージャを作成\n    let manager = Manager::new(\u0026backup_dir).await?;\n\n    // 存在しないファイルのバックアップ\n    assert!(manager.backup(\u0026non_existent_file).await.is_ok());\n\n    // 存在しないバックアップファイルからの復元\n    assert!(manager.restore(\u0026test_file, \"non_existent.bak\").await.is_err());\n\n    // 存在しないファイルのバックアップ一覧\n    let backups = manager.list_backups(\"non_existent.txt\").await?;\n    assert!(backups.is_empty());\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","manager.rs"],"content":"use tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::Manager;\n\n#[test]\nfn test_manager_new() {\n    let temp_dir = TempDir::new().unwrap();\n    let manager = Manager::new(temp_dir.path());\n    assert_eq!(manager.root_path(), temp_dir.path());\n}\n\n#[test]\nfn test_file_operations() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let manager = Manager::new(temp_dir.path());\n\n    // ファイルの存在確認（存在しない場合）\n    assert!(!manager.exists(\"test.txt\")?);\n\n    // ファイルの書き込み\n    let content = \"Hello, World!\";\n    let manager = manager.write_file(\"test.txt\", content)?;\n    assert!(manager.exists(\"test.txt\")?);\n\n    // ファイルの読み込み\n    assert_eq!(manager.read_file(\"test.txt\")?, content);\n\n    // ファイルの削除\n    let manager = manager.delete_file(\"test.txt\")?;\n    assert!(!manager.exists(\"test.txt\")?);\n\n    Ok(())\n}\n\n#[test]\nfn test_directory_operations() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let manager = Manager::new(temp_dir.path());\n\n    // ディレクトリの存在確認（存在しない場合）\n    assert!(!manager.exists(\"test_dir\")?);\n\n    // ディレクトリの作成\n    let manager = manager.create_dir(\"test_dir\")?;\n    assert!(manager.exists(\"test_dir\")?);\n\n    // ネストしたディレクトリの作成\n    let manager = manager.create_dir(\"test_dir/nested/deep\")?;\n    assert!(manager.exists(\"test_dir/nested/deep\")?);\n\n    Ok(())\n}\n\n#[test]\nfn test_transaction_operations() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let manager = Manager::new(temp_dir.path());\n\n    // トランザクション内でのファイル操作\n    let manager = manager\n        .begin_transaction()?\n        .write_file(\"test1.txt\", \"Content 1\")?\n        .write_file(\"test2.txt\", \"Content 2\")?\n        .commit()?;\n\n    assert!(manager.exists(\"test1.txt\")?);\n    assert!(manager.exists(\"test2.txt\")?);\n    assert_eq!(manager.read_file(\"test1.txt\")?, \"Content 1\");\n    assert_eq!(manager.read_file(\"test2.txt\")?, \"Content 2\");\n\n    // トランザクションのロールバック\n    let manager = manager\n        .begin_transaction()?\n        .write_file(\"test3.txt\", \"Content 3\")?\n        .rollback()?;\n\n    assert!(!manager.exists(\"test3.txt\")?);\n\n    Ok(())\n}\n\n#[test]\nfn test_error_cases() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let manager = Manager::new(temp_dir.path());\n\n    // 存在しないファイルの読み込み\n    assert!(manager.clone().read_file(\"non_existent.txt\").is_err());\n\n    // 存在しないファイルの削除\n    assert!(manager.clone().delete_file(\"non_existent.txt\").is_err());\n\n    // パストラバーサルの試行\n    assert!(manager.clone().read_file(\"../test.txt\").is_err());\n    assert!(manager.clone().write_file(\"../test.txt\", \"content\").is_err());\n\n    // 絶対パスの試行\n    assert!(manager.clone().read_file(\"/test.txt\").is_err());\n    assert!(manager.write_file(\"/test.txt\", \"content\").is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_path_normalization() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let manager = Manager::new(temp_dir.path());\n\n    // 通常のパス\n    let manager = manager.write_file(\"test.txt\", \"content\")?;\n    assert!(manager.exists(\"test.txt\")?);\n\n    // カレントディレクトリを含むパス\n    let manager = manager.write_file(\"./test2.txt\", \"content\")?;\n    assert!(manager.exists(\"test2.txt\")?);\n\n    // 重複したスラッシュを含むパス\n    let manager = manager.write_file(\"dir//test3.txt\", \"content\")?;\n    assert!(manager.exists(\"dir/test3.txt\")?);\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","mod.rs"],"content":"pub mod backup;\npub mod operations;\npub mod manager;\npub mod path;\npub mod transaction; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","check.rs"],"content":"use std::fs::{self, File};\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::operations::check;\n\n#[test]\nfn test_exists() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n\n    // ファイルが存在しない場合\n    assert!(!check::exists(\u0026test_file));\n\n    // ファイルを作成\n    File::create(\u0026test_file)?;\n    assert!(check::exists(\u0026test_file));\n\n    // ディレクトリを作成\n    fs::create_dir(\u0026test_dir)?;\n    assert!(check::exists(\u0026test_dir));\n\n    Ok(())\n}\n\n#[test]\nfn test_is_file() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n\n    // ファイルを作成\n    File::create(\u0026test_file)?;\n    fs::create_dir(\u0026test_dir)?;\n\n    assert!(check::is_file(\u0026test_file));\n    assert!(!check::is_file(\u0026test_dir));\n    assert!(!check::is_file(temp_dir.path().join(\"non_existent.txt\")));\n\n    Ok(())\n}\n\n#[test]\nfn test_is_directory() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n\n    // ファイルとディレクトリを作成\n    File::create(\u0026test_file)?;\n    fs::create_dir(\u0026test_dir)?;\n\n    assert!(check::is_directory(\u0026test_dir));\n    assert!(!check::is_directory(\u0026test_file));\n    assert!(!check::is_directory(temp_dir.path().join(\"non_existent_dir\")));\n\n    Ok(())\n}\n\n#[test]\nfn test_verify_basic_permissions() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n\n    // ファイルが存在しない場合\n    assert!(check::verify_basic_permissions(\u0026test_file, false).is_err());\n\n    // ファイルを作成\n    File::create(\u0026test_file)?;\n\n    // 読み取り権限のみの確認\n    assert!(check::verify_basic_permissions(\u0026test_file, false).is_ok());\n\n    // 書き込み権限の確認（読み取り専用でない場合はエラー）\n    {\n        let metadata = fs::metadata(\u0026test_file)?;\n        let mut perms = metadata.permissions();\n        perms.set_readonly(true);\n        fs::set_permissions(\u0026test_file, perms)?;\n        assert!(check::verify_basic_permissions(\u0026test_file, true).is_ok());\n    }\n\n    {\n        let metadata = fs::metadata(\u0026test_file)?;\n        let mut perms = metadata.permissions();\n        perms.set_readonly(false);\n        fs::set_permissions(\u0026test_file, perms)?;\n        assert!(check::verify_basic_permissions(\u0026test_file, true).is_err());\n    }\n\n    Ok(())\n}\n\n#[test]\nfn test_verify_permissions() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n\n    // ファイルが存在しない場合\n    assert!(check::verify_permissions(\u0026test_file, false).is_err());\n\n    // ファイルを作成\n    File::create(\u0026test_file)?;\n\n    // 読み取り権限のみの確認\n    assert!(check::verify_permissions(\u0026test_file, false).is_ok());\n\n    // 書き込み権限の確認\n    assert!(check::verify_permissions(\u0026test_file, true).is_ok());\n\n    Ok(())\n}\n\n#[cfg(unix)]\nmod unix_tests {\n    use super::*;\n    use std::os::unix::fs::PermissionsExt;\n\n    #[test]\n    fn test_unix_permissions() -\u003e Result\u003c()\u003e {\n        let temp_dir = TempDir::new()?;\n        let test_file = temp_dir.path().join(\"test.txt\");\n\n        // ファイルを作成\n        File::create(\u0026test_file)?;\n\n        // 読み取り権限を削除\n        let metadata = fs::metadata(\u0026test_file)?;\n        let mut perms = metadata.permissions();\n        perms.set_mode(0o222); // 書き込みのみ\n        fs::set_permissions(\u0026test_file, perms)?;\n\n        assert!(check::verify_permissions(\u0026test_file, false).is_err());\n\n        // 書き込み権限を削除\n        let metadata = fs::metadata(\u0026test_file)?;\n        let mut perms = metadata.permissions();\n        perms.set_mode(0o444); // 読み取りのみ\n        fs::set_permissions(\u0026test_file, perms)?;\n\n        assert!(check::verify_permissions(\u0026test_file, true).is_err());\n\n        Ok(())\n    }\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","delete.rs"],"content":"use std::fs::{self, File};\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::operations::{delete, check_exists};\n\n#[test]\nfn test_remove_file() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n\n    // ファイルが存在しない場合\n    assert!(delete::remove_file(\u0026test_file).is_err());\n\n    // ファイルを作成して削除\n    File::create(\u0026test_file)?;\n    assert!(check_exists(\u0026test_file));\n    assert!(delete::remove_file(\u0026test_file).is_ok());\n    assert!(!check_exists(\u0026test_file));\n\n    // ディレクトリを削除しようとした場合\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    fs::create_dir(\u0026test_dir)?;\n    assert!(delete::remove_file(\u0026test_dir).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_remove_dir() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    let nested_dir = test_dir.join(\"nested\");\n    let nested_file = nested_dir.join(\"test.txt\");\n\n    // ディレクトリが存在しない場合\n    assert!(delete::remove_dir(\u0026test_dir).is_err());\n\n    // 空のディレクトリを作成して削除\n    fs::create_dir(\u0026test_dir)?;\n    assert!(check_exists(\u0026test_dir));\n    assert!(delete::remove_dir(\u0026test_dir).is_ok());\n    assert!(!check_exists(\u0026test_dir));\n\n    // ネストしたディレクトリとファイルを含むディレクトリを削除\n    fs::create_dir_all(\u0026nested_dir)?;\n    File::create(\u0026nested_file)?;\n    assert!(check_exists(\u0026nested_file));\n    assert!(delete::remove_dir(\u0026test_dir).is_ok());\n    assert!(!check_exists(\u0026test_dir));\n    assert!(!check_exists(\u0026nested_dir));\n    assert!(!check_exists(\u0026nested_file));\n\n    // ファイルを削除しようとした場合\n    let test_file = temp_dir.path().join(\"test.txt\");\n    File::create(\u0026test_file)?;\n    assert!(delete::remove_dir(\u0026test_file).is_err());\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","mod.rs"],"content":"mod check;\nmod delete;\nmod read;\nmod write;\nmod validate; ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","read.rs"],"content":"use std::fs::{self, File};\nuse std::io::Write;\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::operations::read;\n\n#[test]\nfn test_load_file_as_string() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // ファイルが存在しない場合\n    assert!(read::load_file_as_string(\u0026test_file).is_err());\n\n    // 通常のテキストファイル\n    {\n        let mut file = File::create(\u0026test_file)?;\n        write!(file, \"{}\", test_content)?;\n    }\n    let content = read::load_file_as_string(\u0026test_file)?;\n    assert_eq!(content, test_content);\n\n    // ディレクトリを読み込もうとした場合\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    fs::create_dir(\u0026test_dir)?;\n    assert!(read::load_file_as_string(\u0026test_dir).is_err());\n\n    // 非UTF-8文字列を含むファイル\n    {\n        let mut file = File::create(\u0026test_file)?;\n        file.write_all(\u0026[0xFF, 0xFF, 0xFF])?;\n    }\n    assert!(read::load_file_as_string(\u0026test_file).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_load_file_as_bytes() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.bin\");\n    let test_bytes = vec![1, 2, 3, 4, 5];\n\n    // ファイルが存在しない場合\n    assert!(read::load_file_as_bytes(\u0026test_file).is_err());\n\n    // バイナリファイル\n    {\n        let mut file = File::create(\u0026test_file)?;\n        file.write_all(\u0026test_bytes)?;\n    }\n    let content = read::load_file_as_bytes(\u0026test_file)?;\n    assert_eq!(content, test_bytes);\n\n    // ディレクトリを読み込もうとした場合\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    fs::create_dir(\u0026test_dir)?;\n    assert!(read::load_file_as_bytes(\u0026test_dir).is_err());\n\n    // 大きなファイル\n    {\n        let mut file = File::create(\u0026test_file)?;\n        let large_bytes = vec![0; 1024 * 1024]; // 1MB\n        file.write_all(\u0026large_bytes)?;\n    }\n    let content = read::load_file_as_bytes(\u0026test_file)?;\n    assert_eq!(content.len(), 1024 * 1024);\n\n    Ok(())\n}\n\n#[test]\nfn test_get_metadata() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // ファイルが存在しない場合\n    assert!(read::get_metadata(\u0026test_file).is_err());\n\n    // ファイルのメタデータを取得\n    {\n        let mut file = File::create(\u0026test_file)?;\n        write!(file, \"{}\", test_content)?;\n    }\n    let metadata = read::get_metadata(\u0026test_file)?;\n    assert!(metadata.is_file());\n    assert_eq!(metadata.len(), test_content.len() as u64);\n\n    // ディレクトリのメタデータを取得しようとした場合\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    fs::create_dir(\u0026test_dir)?;\n    assert!(read::get_metadata(\u0026test_dir).is_err());\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","validate.rs"],"content":"use std::fs::{self, File};\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::operations::validate;\n\n#[test]\nfn test_exists() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    let non_existent = temp_dir.path().join(\"non_existent\");\n\n    // 存在しないパス\n    assert!(validate::exists(\u0026non_existent).is_err());\n\n    // ファイルを作成して検証\n    File::create(\u0026test_file)?;\n    assert!(validate::exists(\u0026test_file).is_ok());\n\n    // ディレクトリを作成して検証\n    fs::create_dir(\u0026test_dir)?;\n    assert!(validate::exists(\u0026test_dir).is_ok());\n\n    Ok(())\n}\n\n#[test]\nfn test_is_file() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    let non_existent = temp_dir.path().join(\"non_existent\");\n\n    // 存在しないパス\n    assert!(validate::is_file(\u0026non_existent).is_err());\n\n    // ファイルを作成して検証\n    File::create(\u0026test_file)?;\n    assert!(validate::is_file(\u0026test_file).is_ok());\n\n    // ディレクトリに対して検証\n    fs::create_dir(\u0026test_dir)?;\n    assert!(validate::is_file(\u0026test_dir).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_is_dir() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    let non_existent = temp_dir.path().join(\"non_existent\");\n\n    // 存在しないパス\n    assert!(validate::is_dir(\u0026non_existent).is_err());\n\n    // ディレクトリを作成して検証\n    fs::create_dir(\u0026test_dir)?;\n    assert!(validate::is_dir(\u0026test_dir).is_ok());\n\n    // ファイルに対して検証\n    File::create(\u0026test_file)?;\n    assert!(validate::is_dir(\u0026test_file).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_parent_exists() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let nested_file = temp_dir.path().join(\"nested/test.txt\");\n    let nested_dir = temp_dir.path().join(\"nested\");\n\n    // 親ディレクトリが存在する場合\n    assert!(validate::parent_exists(\u0026test_file).is_ok());\n\n    // 親ディレクトリが存在しない場合\n    assert!(validate::parent_exists(\u0026nested_file).is_err());\n\n    // 親ディレクトリを作成\n    fs::create_dir(\u0026nested_dir)?;\n    assert!(validate::parent_exists(\u0026nested_file).is_ok());\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","operations","write.rs"],"content":"use std::fs::File;\nuse std::io::Read;\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::operations::{write, check_exists, check_is_file, check_is_directory};\n\n#[test]\nfn test_ensure_directory() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    let nested_dir = test_dir.join(\"nested/deep/path\");\n\n    // ディレクトリが存在しない場合\n    assert!(!check_exists(\u0026test_dir));\n    write::ensure_directory(\u0026test_dir)?;\n    assert!(check_exists(\u0026test_dir));\n    assert!(check_is_directory(\u0026test_dir));\n\n    // ネストしたディレクトリの作成\n    assert!(!check_exists(\u0026nested_dir));\n    write::ensure_directory(\u0026nested_dir)?;\n    assert!(check_exists(\u0026nested_dir));\n    assert!(check_is_directory(\u0026nested_dir));\n\n    // 既に存在するディレクトリ\n    write::ensure_directory(\u0026test_dir)?;\n    assert!(check_exists(\u0026test_dir));\n    assert!(check_is_directory(\u0026test_dir));\n\n    Ok(())\n}\n\n#[test]\nfn test_ensure_file() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let nested_dir = temp_dir.path().join(\"nested/dir\");\n    let nested_file = nested_dir.join(\"test.txt\");\n\n    // ファイルが存在しない場合\n    assert!(!check_exists(\u0026test_file));\n    write::ensure_file(\u0026test_file)?;\n    assert!(check_exists(\u0026test_file));\n    assert!(check_is_file(\u0026test_file));\n\n    // 親ディレクトリを作成してからファイルを作成\n    write::ensure_directory(\u0026nested_dir)?;\n    assert!(!check_exists(\u0026nested_file));\n    write::ensure_file(\u0026nested_file)?;\n    assert!(check_exists(\u0026nested_file));\n    assert!(check_is_file(\u0026nested_file));\n\n    // 既に存在するファイル\n    write::ensure_file(\u0026test_file)?;\n    assert!(check_exists(\u0026test_file));\n    assert!(check_is_file(\u0026test_file));\n\n    Ok(())\n}\n\n#[test]\nfn test_save_to_file() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let nested_file = temp_dir.path().join(\"nested/dir/test.txt\");\n    let test_content = \"Hello, World!\";\n    let binary_content = vec![1, 2, 3, 4, 5];\n\n    // テキストファイルの書き込み\n    write::save_to_file(\u0026test_file, test_content)?;\n    assert!(check_exists(\u0026test_file));\n    let mut content = String::new();\n    File::open(\u0026test_file)?.read_to_string(\u0026mut content)?;\n    assert_eq!(content, test_content);\n\n    // 親ディレクトリが存在しないファイルへの書き込み\n    write::save_to_file(\u0026nested_file, test_content)?;\n    assert!(check_exists(\u0026nested_file));\n    let mut content = String::new();\n    File::open(\u0026nested_file)?.read_to_string(\u0026mut content)?;\n    assert_eq!(content, test_content);\n\n    // バイナリデータの書き込み\n    write::save_to_file(\u0026test_file, \u0026binary_content)?;\n    let mut content = Vec::new();\n    File::open(\u0026test_file)?.read_to_end(\u0026mut content)?;\n    assert_eq!(content, binary_content);\n\n    // 既存ファイルの上書き\n    let new_content = \"New content\";\n    write::save_to_file(\u0026test_file, new_content)?;\n    let mut content = String::new();\n    File::open(\u0026test_file)?.read_to_string(\u0026mut content)?;\n    assert_eq!(content, new_content);\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","path","mod.rs"],"content":"use tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::path::{self, ValidationLevel, Validator};\n\n#[test]\nfn test_validator_default() {\n    let validator = Validator::default();\n    assert!(validator.validate(\"test.txt\").is_ok());\n    assert!(validator.validate(\"a\".repeat(256)).is_err());\n}\n\n#[test]\nfn test_validator_new() {\n    let validator = Validator::new(ValidationLevel::Strict, 1024, 128);\n    assert!(validator.validate(\"test.txt\").is_ok());\n    assert!(validator.validate(\"a\".repeat(129)).is_err());\n}\n\n#[test]\nfn test_validate() -\u003e Result\u003c()\u003e {\n    let validator = Validator::default();\n\n    // 有効なパス\n    assert!(validator.validate(\"test.txt\").is_ok());\n    assert!(validator.validate(\"dir/test.txt\").is_ok());\n    assert!(validator.validate(\"dir/subdir/test.txt\").is_ok());\n\n    // 無効なパス（パストラバーサル）\n    assert!(validator.validate(\"../test.txt\").is_err());\n    assert!(validator.validate(\"dir/../test.txt\").is_err());\n    assert!(validator.validate(\"dir/../../test.txt\").is_err());\n\n    // 無効なパス（絶対パス）\n    assert!(validator.validate(\"/test.txt\").is_err());\n    assert!(validator.validate(\"/dir/test.txt\").is_err());\n\n    // 無効なパス（ファイル名が長すぎる）\n    let long_filename = \"a\".repeat(256);\n    assert!(validator.validate(long_filename).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_normalize() -\u003e Result\u003c()\u003e {\n    let validator = Validator::default();\n    let temp_dir = TempDir::new()?;\n    let root = temp_dir.path();\n\n    // 通常のパス\n    let path = \"test.txt\";\n    let normalized = validator.normalize(root, path)?;\n    assert_eq!(normalized, root.join(path));\n\n    // ディレクトリを含むパス\n    let path = \"dir/test.txt\";\n    let normalized = validator.normalize(root, path)?;\n    assert_eq!(normalized, root.join(path));\n\n    // カレントディレクトリを含むパス\n    let path = \"./test.txt\";\n    let normalized = validator.normalize(root, path)?;\n    assert_eq!(normalized, root.join(\"test.txt\"));\n\n    // 無効なパス\n    let path = \"../test.txt\";\n    assert!(validator.normalize(root, path).is_err());\n\n    Ok(())\n}\n\n#[test]\nfn test_path_functions() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let root = temp_dir.path();\n\n    // normalize関数のテスト\n    let path = \"test.txt\";\n    let normalized = path::normalize(root, path)?;\n    assert_eq!(normalized, root.join(path));\n\n    // validate関数のテスト\n    assert!(path::validate(\"test.txt\").is_ok());\n    assert!(path::validate(\"../test.txt\").is_err());\n\n    // ensure_path_exists関数のテスト\n    let test_dir = temp_dir.path().join(\"test_dir\");\n    assert!(!test_dir.exists());\n    path::ensure_path_exists(\u0026test_dir)?;\n    assert!(test_dir.exists());\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","fs","transaction.rs"],"content":"use std::sync::Arc;\nuse tempfile::TempDir;\nuse anyhow::Result;\n\nuse cph::fs::transaction::{Transaction, State, CreateFileOperation, DeleteFileOperation};\n\n#[test]\nfn test_transaction_new() {\n    let transaction = Transaction::new();\n    assert!(matches!(transaction.state(), State::Pending { .. }));\n    assert!(transaction.operations().is_empty());\n}\n\n#[test]\nfn test_create_file_operation() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    let operation = CreateFileOperation::new(test_file.clone(), test_content.to_string());\n    let transaction = Transaction::new()\n        .with_operation(Arc::new(operation))?\n        .execute()?;\n\n    assert!(matches!(transaction.state(), State::Executed { .. }));\n    assert!(test_file.exists());\n    assert_eq!(std::fs::read_to_string(\u0026test_file)?, test_content);\n\n    Ok(())\n}\n\n#[test]\nfn test_delete_file_operation() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // ファイルを作成\n    std::fs::write(\u0026test_file, test_content)?;\n    assert!(test_file.exists());\n\n    // ファイルを削除\n    let operation = DeleteFileOperation::new(test_file.clone())?;\n    let transaction = Transaction::new()\n        .with_operation(Arc::new(operation))?\n        .execute()?;\n\n    assert!(matches!(transaction.state(), State::Executed { .. }));\n    assert!(!test_file.exists());\n\n    Ok(())\n}\n\n#[test]\nfn test_transaction_rollback() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // ファイルを作成するトランザクション\n    let operation = CreateFileOperation::new(test_file.clone(), test_content.to_string());\n    let transaction = Transaction::new()\n        .with_operation(Arc::new(operation))?;\n\n    // ロールバック\n    let transaction = transaction.rollback()?;\n    assert!(matches!(transaction.state(), State::RolledBack { .. }));\n    assert!(!test_file.exists());\n\n    Ok(())\n}\n\n#[test]\nfn test_multiple_operations() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file1 = temp_dir.path().join(\"test1.txt\");\n    let test_file2 = temp_dir.path().join(\"test2.txt\");\n    let test_content = \"Hello, World!\";\n\n    // 2つのファイルを作成するトランザクション\n    let operation1 = CreateFileOperation::new(test_file1.clone(), test_content.to_string());\n    let operation2 = CreateFileOperation::new(test_file2.clone(), test_content.to_string());\n\n    let transaction = Transaction::new()\n        .with_operation(Arc::new(operation1))?\n        .with_operation(Arc::new(operation2))?\n        .execute()?;\n\n    assert!(matches!(transaction.state(), State::Executed { .. }));\n    assert!(test_file1.exists());\n    assert!(test_file2.exists());\n    assert_eq!(std::fs::read_to_string(\u0026test_file1)?, test_content);\n    assert_eq!(std::fs::read_to_string(\u0026test_file2)?, test_content);\n\n    Ok(())\n}\n\n#[test]\nfn test_transaction_error() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    // 先にファイルを作成\n    std::fs::write(\u0026test_file, test_content)?;\n\n    // 既に存在するファイルを作成しようとする\n    let operation = CreateFileOperation::new(test_file.clone(), test_content.to_string());\n    let result = Transaction::new()\n        .with_operation(Arc::new(operation));\n\n    // 検証エラーが発生することを確認\n    assert!(result.is_err());\n    assert!(result.unwrap_err().to_string().contains(\"ファイルが既に存在します\"));\n    \n    Ok(())\n}\n\n#[test]\nfn test_transaction_description() -\u003e Result\u003c()\u003e {\n    let temp_dir = TempDir::new()?;\n    let test_file = temp_dir.path().join(\"test.txt\");\n    let test_content = \"Hello, World!\";\n\n    let operation = CreateFileOperation::new(test_file.clone(), test_content.to_string());\n    let transaction = Transaction::new()\n        .with_operation(Arc::new(operation))?;\n\n    let description = transaction.description();\n    assert!(description.contains(\"トランザクション\"));\n    assert!(description.contains(\"保留中\"));\n    assert!(description.contains(\"test.txt\"));\n\n    Ok(())\n} ","traces":[],"covered":0,"coverable":0},{"path":["/","home","cphelper-dev","project-cph","tests","lib.rs"],"content":"mod contest;\nmod fs; ","traces":[],"covered":0,"coverable":0}]};
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, e('a', null, pathToString(file.path))),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('pre', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('code', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>