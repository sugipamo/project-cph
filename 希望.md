  1. KPIの対象範囲について

  - src_checkで測定したい品質指標の範囲はどこまでですか？
    - コード品質
      - コード行数
      - 不適切なtry: except:
      - 不適切なデフォルト値

    - アーキテクチャ品質
      - 依存性の注入

    - テスト品質
      - テスト容易性
      - テストカバレッジ
      - 結合テスト網羅度

  2. 点数化の方式について

  - 各指標をどのような基準で点数化したいですか？
    - 品質指標各項目のそれぞれの点数

  - 総合スコアの算出方法は？
    - 重み付き平均で実装しておき最初は実質単純平均の挙動をしてもらう

  3. 測定対象について

  - 主に測定したいのは：
    - プロジェクト全体の品質
    - ファイル/モジュール単位の品質
    - 時系列での品質変化
      - 変更が繰り返されたときに、ほぼ同じ状況に帰ってきているのであれば、検知できるようにしたい

  4. 具体的な指標について

  - 重視したい品質指標は何ですか？
    - テスト容易性
    - 依存複雑性
    - コードの重複

  5. 活用方法について

  - このKPIをどのように活用したいですか？
    - 技術的負債の可視化
    - worktreeを使用して並列開発、ビームサーチ的に品質改善


追加の質問

  1. 点数化の詳細について

  - 各品質指標の点数は何点満点にしますか？（例：100点満点）
  - 減点方式。加点だとコード規模を上げると点数が上がることになりかねない。ただ減点方式のデメリットも確認しておきたい

  2. テスト容易性の評価基準

  「テスト容易性」を具体的にどう測定しますか？
  - 関数の引数の数
  - 副作用の有無
  - モックの必要性
  - 依存性注入の実装度

  3. 依存複雑性の評価基準

  「依存複雑性」の具体的な測定方法は？
  - インポート数
  - 循環依存の有無
  - レイヤー違反の数
  - 依存の深さ

  4. 時系列変化の検知

  「ほぼ同じ状況に帰ってきている」を検知するための：
  - 類似度の閾値は？（例：90%以上で類似と判定）
  - 比較対象の期間 -> DBに特徴を保存しておいてマッチできるようにしたい。ASTの形状、関数名など

  5. 結果の出力形式

  KPIの結果をどのような形式で出力したいですか？
  - Markdown形式レポートとjsonレポート
  　- Markdownには詳細レポート、jsonには点数のみ
    - DB使えるならそこで管理したい


減点方式について

  50スタートにして加点減点両方採用から様子をみましょう

  時系列変化の検知について

  AST形状や関数名での類似度検知について：
  1. 検知したいパターン：
    - リファクタリング後に元に戻った
    - 削除したコードが復活した
    - 同じアンチパターンが再発した

  2. DBスキーマについて：
    - どの程度の粒度で保存 -> 関数単位
    - 保存期間 -> 全履歴　重くなったら考えます

  worktreeとビームサーチについて

  「worktreeを使用して並列開発、ビームサーチ的に品質改善」について：
  - 複数のworktreeで異なる改善案を試す想定 -> はい
  - KPIスコアが最も高い改善案を採用 -> はい
  - claude -p --dangerously-skip-permissionsで3エージェントを生成、それぞれでそれぞれのワークスペース作業をしてもらう　最後に統率者が選択しマージする。

  重み付けについて

  「最初は実質単純平均」とのことですが：
  - 将来的に調整したい重みの例は -> どうしても副作用が必要な場所があった時に重みを下げるなど
  - 重み設定は設定ファイルで管理 -> はい
  - プロジェクトごとに異なる重みを設定可能 -> このプロジェクト専用でよい




1. スコアリングの詳細

  50点スタートの加点減点方式について：
  - スコア範囲: 0〜100点の範囲でよろしいですか？
  - 警告閾値: 何点以下を「要改善」としますか？（例：30点以下）
  - 優秀閾値: 何点以上を「優秀」としますか？（例：80点以上）
  上の方針で、30-80を維持したい。

  2. エージェント連携について

  3エージェント＋統率者の構成について：
  - エージェントの役割分担は自動で決める？それとも事前定義？
    - 例：エージェント1=テスト改善、エージェント2=リファクタリング、エージェント3=依存関係改善
  - 統率者の判断基準：KPIスコアのみ？それとも他の要素も考慮？
  
  分担は今プロジェクトに必要なものの比率を反映、例えばアーキテクチャが乱れているのであればそれを多めにする
  KPIスコアを参考に、今後役に立つ実装があれば加点評価してよい。

  3. 初期の指標と重み

  最初は単純平均とのことですが、初期値として：
  コード品質: 1.0
  アーキテクチャ品質: 1.0
  テスト品質: 1.0
  この3カテゴリを均等（各33.3%）でよろしいですか？

  はい

  4. DB設計について

  関数単位での履歴保存について：
  - ハッシュ化: 関数のAST形状をどのようにハッシュ化しますか？
  - 類似度計算: コサイン類似度？レーベンシュタイン距離？

  類似度はコサイン類似度を採用。ハイブリッドができるのであればそのほうが良い