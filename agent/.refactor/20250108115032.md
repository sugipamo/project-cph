# リファクタリング計画 2025/01/08 11:50:32

## 現状の課題

1. コードの複雑性
   - `src/docker/execution`と`src/contest/service`のモジュールが比較的複雑
   - ファイル分割の方針が一貫していない

2. エラー処理
   - `anyhow::Error`の一貫した使用を確認

3. ファイル構造
   - 禁止されているファイル名（utils.rs, helpers.rs等）の使用がないか確認
   - モジュール間の依存関係の整理

## 改善計画

### Phase 1: コード品質の向上
1. `clippy.toml`の規約に基づくコードチェック
   - 複雑性の制限（too-many-lines-threshold = 300）
   - 引数の数の制限（too-many-arguments-threshold = 6）
   - 認知的複雑性の制限（cognitive-complexity-threshold = 25）

2. エラー処理の統一
   - すべてのエラーを`anyhow::Error`に統一
   - カスタムエラー型の見直し

### Phase 2: モジュール構造の改善
1. `src/docker/execution`の整理
   - コマンド実行部分の責務の明確化
   - コンテナ管理の抽象化レベルの見直し

2. `src/contest/service`の改善
   - URL処理とパス処理の分離
   - テスト実行部分の責務の明確化

### Phase 3: テストとドキュメント
1. ユニットテストの追加
   - 新しい構造に対応するテストの作成
   - エッジケースのカバレッジ向上

2. ドキュメントの更新
   - モジュール構造の変更を反映
   - 新しいエラー処理パターンの説明追加

## 実装手順

1. 静的解析
   - `cargo check`の実行
   - `cargo clippy`の実行と警告の修正

2. リファクタリング実施
   - Phase 1から順次実装
   - 各フェーズ完了後にテストを実行

3. レビュー
   - コード品質の確認
   - パフォーマンスへの影響確認 