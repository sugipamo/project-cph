# src/dockerディレクトリのリファクタリング計画

## 現状の構造
```
src/docker/
├── mod.rs
├── traits/
├── state/
├── error.rs
├── executor/
├── runner/
├── testing/
├── config.rs
└── fs.rs
```

## 問題点
1. `runner/`と`executor/`の責務の重複
2. エラー処理の一貫性が不足
3. 状態管理の複雑さ
4. テストヘルパーの配置が不適切

## 改善計画

### 1. モジュール構造の整理
- `runner/`と`executor/`を統合し、`execution/`として再構成
- `testing/`を`test_helpers/`にリネームし、各モジュール配下に移動

### 2. エラー処理の改善
- `error.rs`にエラー型を集約
- より具体的なエラーメッセージの実装
- エラー変換トレイトの導入

### 3. 状態管理の簡素化
- `state/`モジュールの責務を明確化
- 状態遷移のバリデーション強化
- イミュータブルな状態管理の導入

### 4. インターフェースの整理
- `traits/`モジュールの整理
- 共通インターフェースの抽象化レベル見直し
- 不要な依存関係の削除

### 5. ファイルシステム操作の改善
- `fs.rs`の責務を分割
- より堅牢なエラーハンドリングの実装
- テスト容易性の向上

## 実装手順
1. 新しいディレクトリ構造の作成
2. モジュールの移動と依存関係の更新
3. エラー処理の改善
4. 状態管理の簡素化
5. インターフェースの整理
6. テストの更新と追加

## 期待される効果
- コードの保守性向上
- エラー処理の一貫性確保
- テストの容易性向上
- 依存関係の明確化 