# composite_request.md

## 役割・概要

- **CompositeRequest** は、複数の操作リクエスト（OperationRequest）をまとめて管理・実行するためのクラスです。
- ワークフローやバッチ処理など「複数の操作を一連の流れとして実行したい」ケースに対応します。

## 主な機能

- **一括実行**
  - 登録された複数のリクエストを順次または並列で実行し、全ての結果を集約します。
- **並列実行**
  - スレッドプール等を用いて、複数リクエストを同時に実行する機能を持ちます（`execute_parallel`）。
- **実行結果の集約**
  - 各リクエストの実行結果（OperationResult）をリストとしてまとめて返却します。
- **失敗時の制御**
  - 各リクエストの失敗時にどう振る舞うか（例：即時中断、継続実行、エラー集約など）を制御できます。
- **デバッグ情報の付与**
  - 実行時のデバッグ情報（どのリクエストがどこで生成されたか等）を保持します。

## 設計上の工夫・注意点

- **単一リクエスト時の最適化**
  - リクエストが1件だけの場合は、CompositeRequestでラップせずそのまま返す設計になっています（`make_composite_request`）。
- **再帰的な構造**
  - CompositeRequestの中にさらにCompositeRequestを含めることができ、階層的なバッチ処理も可能です。
- **実行順序の保証**
  - デフォルトでは登録順に実行されますが、並列実行時は順序が保証されない場合があります。
- **拡張性**
  - 新しい実行制御（例：条件付き実行、リトライ、サーキットブレーカー等）を追加しやすい構造です。

## 利用例

- ワークフローエンジンで、依存関係を解決した一連の操作をまとめて実行する。
- テストやCI/CDパイプラインで、複数のビルド・テスト・デプロイ操作を一括管理する。 