# ファイル移動の根拠と整理

## 概要
src_check/main.pyによる自動ファイル整理により、以下のファイル移動が実行されました。
移動の根拠と整理結果をまとめます。

## 移動実行日時
2025年6月25日 11:14頃

## 移動されたファイル

### 1. src/configuration/ → src/config/
**移動理由**: 設定関連ファイルの統合と命名規則の統一

#### 移動されたファイル
- `src/configuration/config_node/config_node.py` → `src/config/config_node.py`
- `src/configuration/config_node/config_resolver.py` → `src/config/config_resolver.py`
- `src/configuration/config_node/protocols.py` → `src/config/protocols.py`

#### 根拠
1. **命名規則の統一**: `configuration`より`config`の方が簡潔で一般的
2. **ディレクトリ構造の簡素化**: 不要な中間ディレクトリ`config_node/`を削除
3. **設定関連の統合**: 分散していた設定ファイルを一箇所に集約

### 2. src/configuration/config_node/config_node_logic.py → src/services/node/config_node_logic.py
**移動理由**: 責務の分離とサービス層への配置

#### 根拠
1. **責務の分離**: 設定データ構造（config）とビジネスロジック（services）の分離
2. **Clean Architecture準拠**: ビジネスロジックをサービス層に配置
3. **依存関係の整理**: protocolsインターフェースを介した疎結合の実現

## 移動後の構造

### 設定関連 (src/config/)
```
src/config/
├── __init__.py
├── config_node.py        # 設定ノードのデータ構造定義
├── config_resolver.py    # 設定値の解決機能
└── protocols.py          # インターフェース定義
```

### サービス層 (src/services/)
```
src/services/
└── node/
    ├── __init__.py
    └── config_node_logic.py  # ノード操作のビジネスロジック
```

## インポート関係の修正

### 修正が必要だった箇所

#### 1. 実際のコードでの修正
- `src/config/config_node.py:3`
  ```python
  # 修正前
  from .config_node_logic import add_edge, find_nearest_key_node, next_nodes_with_key, path
  
  # 修正後
  from src.services.node.config_node_logic import add_edge, find_nearest_key_node, next_nodes_with_key, path
  ```

- `src/services/node/config_node_logic.py:4`
  ```python
  # 修正前
  from .protocols import ConfigNodeProtocol
  
  # 修正後
  from src.config.protocols import ConfigNodeProtocol
  ```

#### 2. ドキュメント・例文での修正
- `src_check/src_processors/rules/none_default_checker.py:84`
  ```python
  # fix_example内の文字列を修正
  from src.configuration.config_manager import ConfigManager
  →
  from src.config.config_manager import ConfigManager
  ```

- `src_check/src_processors/rules/dict_get_checker.py:68,69`
  ```python
  # fix_policy内の文字列を修正
  src/configuration/readme.md → src/config/readme.md
  
  # fix_example内の文字列を修正
  from src.configuration.config_manager import ConfigManager
  →
  from src.config.config_manager import ConfigManager
  ```

#### 3. ツール設定での修正
- `src_check/src_processors/auto_correct/file_organizers/structure_organizer.py`
  ```python
  # ディレクトリ名マッピングを修正
  'configuration': 'configuration' → 'config': 'config'
  
  # 判定ロジックを修正
  return 'configuration' → return 'config'
  
  # メッセージを修正
  'configurationに移動' → 'configに移動'
  ```

## 移動による効果

### ✅ **改善された点**
1. **命名の一貫性**: `config`で統一された
2. **構造の簡素化**: 不要な階層が削除された
3. **責務の明確化**: データ構造とロジックが分離された
4. **保守性の向上**: 関連ファイルが適切にグルーピングされた

### ⚠️ **注意が必要な点**
1. **循環依存の回避**: `config`と`services`間の依存関係に注意
2. **インターフェース活用**: `protocols.py`を介した疎結合の維持
3. **今後の拡張**: 新しい設定関連機能は`src/config/`に配置

## 自動修正機能の改良

この移動で明らかになった課題：
1. **文字列内インポートの未対応**: fix_example等の文字列内参照が自動更新されなかった
2. **相対インポートの処理**: ファイル移動時の相対インポート自動修正が不完全だった

### 対応済み改良
- `logical_file_organizer.py`で文字列リテラル内のインポート参照も更新するように改良
- 今後のファイル移動では、より完全な自動修正が実行される

## 結論

今回のファイル移動は以下の原則に基づいて実行されました：

1. **Clean Architecture**: 層の責務を明確に分離
2. **命名規則の統一**: 簡潔で理解しやすい名前を採用
3. **保守性の向上**: 関連機能の適切なグルーピング
4. **依存関係の整理**: インターフェースを介した疎結合の実現

手動修正が必要だった箇所はありましたが、全体として構造の改善に寄与する適切な移動でした。