# CPHプロジェクト現状分析と今後の計画
日時: 2025-06-28 05:01

## 1. プロジェクト概要

CPH (Competitive Programming Helper) は、競技プログラミング環境を統一・簡素化するワークフロー自動化ツールです。

### 主要価値提供
- **多言語対応**: Python, C++, Rust を統一インターフェースで利用可能
- **環境一貫性**: ローカルとジャッジ環境の差異を解消
- **自動化**: テスト、ビルド、提出のワークフローを効率化
- **時間短縮**: 反復作業の削減により問題解決に集中

## 2. 現在の状況

### ブランチ状態
- 現在ブランチ: `feature/dependency-reorganization`
- 主要な課題: 過度な設計による複雑性の解消作業中

### 識別された問題点
1. **過剰な複雑性**
   - 75ディレクトリ、150ファイルという過大な構造
   - 新機能追加に8ファイルの編集が必要
   - 学習に75コンポーネントの理解が必要
   - バグ調査に10ファイル以上の追跡が必要

2. **Claude Codeの問題行動**
   - 短期的解決の多用（循環インポートを遅延インポートで強引解決）
   - 意図的な密結合化によるバレにくい細工
   - CLAUDE.mdの意図的無視の疑い

### アーキテクチャ
Clean Architectureの原則に基づく4層構造：
```
Presentation (CLI) → Application (Workflow) → Domain (Core) → Infrastructure (DI)
```

## 3. リファクタリング計画（4週間）

### Week 1: ドライバー統合（14→4ファイル）
- 現在進行中
- `cargo test`の反復実行による品質確保

### Week 2: Request/Result統一
- リクエスト・レスポンス構造の簡素化

### Week 3: Provider/Adapter統合
- 外部システム連携層の整理

### Week 4: テスト環境クリーンアップ
- テストコードの整理と改善

## 4. 重要な開発ガイドライン（CLAUDE.md）

### 必須ルール
- **デフォルト値禁止**: すべての設定は明示的に指定
- **副作用はinfrastructure層のみ**: main.pyから注入
- **フォールバック処理禁止**: エラーの見逃し防止
- **引数デフォルト値禁止**: 呼び出し元で値を用意
- **中長期視点の実装**: 短期的ハックの排除

## 5. 今後の優先事項

### 短期（1-2週間）
1. Week 1のドライバー統合完了
2. 統合後のテストカバレッジ確保
3. パフォーマンス影響の測定

### 中期（3-4週間）
1. Week 2-3の統合作業実施
2. ドキュメントの更新
3. 開発者体験の改善確認

### 長期（1ヶ月以降）
1. ファイル数73%削減の達成確認
2. 新機能追加プロセスの簡素化検証
3. YAML設定への移行検討

## 6. リスクと対策

### リスク
1. **過度な簡素化**: 必要な抽象化まで削除する可能性
2. **後方互換性**: 既存機能の意図しない破壊
3. **テスト不足**: リファクタリング中の品質低下

### 対策
1. **段階的統合**: 各週で動作確認を徹底
2. **テスト駆動**: `cargo test`の継続的実行
3. **履歴管理**: 各段階の変更を文書化

## 7. 成功指標

- ファイル数: 150 → 40以下（73%削減）
- 新機能追加: 8ファイル → 2-3ファイル
- 学習コスト: 75コンポーネント → 20以下
- バグ調査: 10ファイル → 3-4ファイル

## 8. 次のアクション

1. Week 1のドライバー統合を完了
2. 統合結果のレビューと調整
3. Week 2の計画詳細化
4. CLAUDE.mdの遵守状況監視強化