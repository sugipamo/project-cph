# CPHプロジェクト統合計画 - 202506280124

## 現状分析

### プロジェクト概要
- **プロジェクト名**: CPH (Competitive Programming Helper)
- **目的**: 競技プログラミング環境の統一管理ツール
- **アーキテクチャ**: Clean Architecture
- **現在のブランチ**: feature/dependency-reorganization

### 現在の課題
「プロジェクト再生宣言」から判明した主要課題：
- **過度な抽象化**: 75個のディレクトリ、150個のファイル
- **開発効率の低下**: 新機能追加に8ファイルの編集が必要
- **学習コストの高さ**: 75個のコンポーネントの理解が必要
- **保守困難性**: バグ調査で10回のファイル移動

### プロジェクトの価値
要件定義から判明した価値：
- **言語横断対応**: Python、C++、Rust等の最適言語選択
- **環境差異解消**: ローカル/ジャッジ環境の差異を吸収
- **作業自動化**: テスト実行、結果確認、提出準備の一元化
- **学習効率向上**: 段階的な学習設計による習得支援

## 統合計画の方針

### 基本原則（CLAUDE.mdより）
1. **中長期を見据えた実装**
2. **副作用はinfrastructureのみに限定**
3. **デフォルト値の使用禁止**
4. **フォールバック処理の禁止**
5. **責務の配置の適切性確認**

### 統合方針
1. **既存資産の保護**: 18,129行のロジック、96個のテストを維持
2. **段階的統合**: 4週間で73%のファイル削減目標
3. **実用性重視**: 理論より開発者体験を優先
4. **機能維持**: 100%の機能保持を前提

## 実行計画

### Week 1: Driver系統統合（現在進行中）
**目標**: 14個のDriver関連ディレクトリを4個に統合

#### 現状構造
```
src/infrastructure/drivers/
├── docker/
│   ├── docker_command_utils.py
│   └── docker_driver.py
├── file/
│   └── integrated_file_driver.py
├── generic/
│   ├── base_driver.py
│   ├── persistence_driver.py
│   └── unified_driver.py
└── shell_python_driver.py
```

#### 統合後の目標構造
```
src/infrastructure/drivers/
├── docker_driver.py      # Docker関連を統合
├── file_driver.py        # ファイル操作を統合
├── execution_driver.py   # Shell/Python実行を統合
└── base_driver.py        # 共通基底クラス
```

#### 実施内容
1. 各ドライバーの責務と依存関係の整理
2. 重複コードの特定と削除
3. インターフェースの統一と簡素化
4. テストの移行と動作確認

### Week 2: Request/Result統合
**目標**: 分散したRequest/Result型を統一

#### 対象ファイル
- `src/operations/requests/` 配下の各リクエストクラス
- `src/operations/results/` 配下の各結果クラス

#### 統合計画
1. 共通インターフェースの抽出
2. ジェネリック型を活用した型安全な統合
3. ファクトリーパターンの簡素化

### Week 3: Provider/Adapter統合
**目標**: 極小ファイルを統合し、学習コストを削減

#### 対象
- 50行未満の47個のファイル
- TimeAdapter、RegexProvider等の薄いラッパー

#### 統合方針
1. 機能別にグループ化
2. 1ファイルに複数の小クラスを集約
3. 名前空間の整理

### Week 4: テスト環境整理とモック統合
**目標**: テスト環境の最適化と保守性向上

#### 実施内容
1. Mock系統の統合（6個→1個）
2. テストカバレッジの維持・向上
3. CI/CDパイプラインの調整

## リスク管理

### 想定リスク
1. **機能損失リスク**: 統合時の見落としによる機能欠落
2. **パフォーマンス劣化**: 統合による実行速度の低下
3. **テスト漏れ**: カバレッジ低下による品質問題

### 対策
1. **段階的実行**: 各週での動作確認とロールバック準備
2. **パフォーマンス測定**: 統合前後での実行時間比較
3. **テスト網羅性**: 統合前のテスト実行結果を基準として維持

## 成功指標

### 定量的指標
- ファイル数: 150個 → 40-50個（73%削減）
- 新機能追加時の編集ファイル数: 8個 → 2-3個
- バグ調査時のファイル移動: 10回 → 3-4回
- 設定解決速度: 現状維持（キャッシュヒット時 < 10μs）

### 定性的指標
- 新規参加者の学習時間: 70%短縮
- 開発者体験の向上: ナビゲーション50%改善
- コードの可読性: レビュー時間の短縮

## 次のアクション

### 即時実施項目
1. 現在のテストを実行し、基準値を記録
2. Driver統合の詳細設計を確認
3. 依存関係グラフの更新と影響分析

### 継続的実施項目
1. 日次での進捗確認
2. 週次でのリスク評価
3. ステークホルダーへの進捗報告

## まとめ

本計画は、CPHプロジェクトの「過度な抽象化」問題を解決し、実用的かつ保守性の高いツールへと再生させることを目的としています。Clean Architectureの利点を維持しながら、開発者体験を大幅に改善し、競技プログラミングコミュニティに真に価値のあるツールを提供することを目指します。

計画実行期間: 2025年6月25日〜2025年7月23日（4週間）