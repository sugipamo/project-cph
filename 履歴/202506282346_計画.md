# 202506282346 実行計画

## 現状分析

### プロジェクト状況
- **ブランチ**: feature/dependency-reorganization
- **プロジェクト目標**: CPH（Competitive Programming Helper）- 競技プログラミング環境統一ツール
- **再生計画**: 4週間でファイル数73%削減（150→40-50ファイル）、開発者体験70%向上を目指す
- **現在フェーズ**: Week 1 - Driver系統統合段階

### 前回作業（202506281813）からの状況
- **テストカバレッジ**: 64%（目標: 70-80%）
- **テスト状況**: 920件中914件成功、6件スキップ
- **主な残課題**:
  - Driver統合の継続（プロジェクト再生計画Week 1の最重要タスク）
  - CLAUDE.md違反の修正（デフォルト値・フォールバック処理）
  - テストカバレッジ向上

### 深夜作業としての制約
- **作業時間**: 1日（深夜作業なので実質4-5時間程度）
- **優先度**: 安定性を保ちながら最も効果的な改善を選択

## 実行計画（1日でできる範囲）

### 1. Driver統合の分析と準備（優先度: 最高）- 1.5時間

プロジェクト再生計画のWeek 1目標達成に向けた具体的な準備を行います。

#### 1.1 Driver使用状況の詳細分析
- 現在のDriver構造の完全把握
- 各Driverの依存関係マッピング
- 統合による影響範囲の特定

#### 1.2 統合設計案の作成
- generic/配下の3ドライバー（base, execution, persistence）の統合方針
- docker/, file/ドライバーの統合方針
- インターフェース互換性の確保方法

### 2. 小規模なDriver統合の実施（優先度: 高）- 2時間

安全に実施できる範囲での統合を行います。

#### 2.1 generic配下の統合準備
- base_driver.pyを中心とした統合
- execution_driverとpersistence_driverの共通部分抽出
- unified_driver.pyの活用検討

#### 2.2 テストの整備
- 統合前の動作確認
- 統合後のテスト修正
- 回帰テストの実施

### 3. CLAUDE.md違反の部分的修正（優先度: 中）- 1時間

最も影響の大きい違反を優先的に修正します。

#### 3.1 優先修正対象
- execution_driver.pyのデフォルト引数（6箇所）
- di_config.pyのフォールバック処理
- 設定ファイルからの適切な値取得への変更

### 4. テストカバレッジの戦略的向上（優先度: 中）- 30分

投資対効果の高いテストを追加します。

#### 4.1 対象選定
- operation_repository.py（35%→50%目標）
- session_repository.py（35%→50%目標）
- 実装に合わせた現実的なテストの追加

## 作業順序と時間配分

### フェーズ1（23:46-01:16）: Driver分析と設計
1. Driver関連ファイルの詳細調査（30分）
2. 依存関係の可視化（30分）
3. 統合設計ドキュメントの作成（30分）

### フェーズ2（01:16-03:16）: 部分的なDriver統合
1. generic配下の統合準備（45分）
2. 最小限の統合実施（45分）
3. テスト実行と動作確認（30分）

### フェーズ3（03:16-04:16）: CLAUDE.md違反修正
1. 優先度の高い違反の修正（45分）
2. テスト実行（15分）

### フェーズ4（04:16-04:46）: カバレッジ向上とまとめ
1. 重要なテストの追加（20分）
2. 全体テスト実行と結果記録（10分）

## 成功基準（1日で達成可能な範囲）

1. **Driver統合準備**
   - Driver統合の完全な設計書作成
   - 少なくとも1つのDriverグループの統合完了
   - 統合による問題の早期発見

2. **品質向上**
   - CLAUDE.md違反の30%以上を解消
   - テストカバレッジ65%以上（1%向上）
   - 全テストの成功維持

3. **ドキュメント化**
   - Driver統合の詳細な手順書作成
   - 残作業の明確な引き継ぎ文書

## リスクと対策

### リスク1: Driver統合による予期しない破損
- **対策**: 
  - 小規模な統合から開始
  - 各ステップでのテスト実行
  - ロールバック手順の準備

### リスク2: 深夜作業による判断ミス
- **対策**:
  - 複雑な変更は設計のみに留める
  - 自動テストに依存した検証
  - 詳細なログの記録

### リスク3: 時間不足
- **対策**:
  - 最重要タスク（Driver分析）を最初に実施
  - 各フェーズで中間成果物を作成
  - 未完了項目の明確な文書化

## 技術的注意事項

1. **Driver統合時**
   - バックアップの作成
   - git commitの細かい実施
   - インターフェースの後方互換性維持

2. **CLAUDE.md違反修正時**
   - 設定ファイルの事前確認
   - エラーメッセージの改善
   - 既存の動作を変更しない

3. **テスト追加時**
   - 実装コードの理解を優先
   - 過度に複雑なモックを避ける
   - 実用的なテストケースの選定

## 備考

- 深夜作業のため、安全性と確実性を最優先とする
- Driver統合は分析と設計を重視し、実装は慎重に進める
- 完了できなかった項目は次回作業のために詳細に文書化する
- 定期的なgit commitで作業の安全性を確保する