# CPH - CLAUDE.md違反修正計画 (2025-06-29 04:05)

## 本日の目標
CLAUDE.mdの主要違反を修正し、コードベースの品質を向上させる。特に影響が大きいフォールバック処理の修正を優先する。

## 現状分析
### 検出された違反サマリー
- **総違反数**: 178件
- **フォールバック処理**: 75件（最重要）
- **デフォルト値の使用**: 50件
- **不適切な副作用**: 46件
- **遅延インポート**: 7件

### テスト実行状況
- pytest実行可能（1575テスト）
- 全体的なテストカバレッジは低い（14%）
- 一部モジュールは100%カバレッジ達成

## 本日の作業計画

### 1. フォールバック処理の修正（優先度：高）
**対象ファイル（最も違反が多い3つ）**:
- `src/application/contest_manager.py` (13件)
- `src/operations/error_converter.py` (7件)
- `src/application/execution_requests.py` (6件)

**修正方針**:
- try-except Exceptionの広範囲キャッチを除去
- Result型を使用した明示的なエラーハンドリングに変更
- エラーは具体的な型でキャッチし、適切に処理

### 2. デフォルト値違反の修正（優先度：中）
**対象ファイル**:
- `src/infrastructure/drivers/file/file_driver.py` (6件)
- `src/infrastructure/drivers/docker/docker_driver.py` (7件)

**修正方針**:
- 関数定義からデフォルト値を除去
- 呼び出し元で明示的に値を渡す
- 設定値はconfig/*.jsonから取得

### 3. テスト実行と修正
- 各修正後にテストを実行
- 失敗したテストを修正
- 新規テストの追加（時間があれば）

## 成功基準
1. フォールバック処理違反を少なくとも20件削減
2. デフォルト値違反を少なくとも10件削減
3. すべてのテストが通過する状態を維持
4. 修正によってCLAUDE.mdの理念に沿った設計改善を実現

## 作業時間見積もり
- フォールバック処理修正: 4時間
- デフォルト値修正: 2時間
- テスト実行・修正: 2時間
- 結果まとめ: 30分

合計: 約8.5時間（1日で実施可能な範囲）

## リスクと対策
- **リスク**: Result型への移行で既存のインターフェースが変わる可能性
- **対策**: 互換性維持のためのアダプター層を必要に応じて追加

## 備考
- 修正は段階的に実施し、各ステップでテストを実行
- CLAUDE.mdの「中長期を見据えた実装」原則に従い、短期的な回避策は使用しない
- 循環インポート問題は今回のスコープ外とし、将来的な設計見直しに委ねる