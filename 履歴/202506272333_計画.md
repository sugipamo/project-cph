# 202506272333 実行計画

## プロジェクト概要

CPH (Competitive Programming Helper) は競技プログラミング環境を統一するツールです。

### 現在の状況
- **ブランチ**: feature/dependency-reorganization
- **直近の作業**: テスト実行と問題対応（古い実装ベースのテスト削除、テストカバレッジ向上）
- **課題**: 過度な抽象化による開発者疲弊（75ディレクトリ、150ファイル）
- **テストカバレッジ**: 12%（112テスト合格）

## プロジェクトの理念と目標

### 理念
- 競技プログラミングにおいて本質的な「問題を解く」ことに集中できる環境を提供
- 言語の壁を越え、環境差異から解放し、繰り返し作業を自動化

### 提供価値
1. **時間の創出**: セットアップ時間短縮、テスト自動化、言語切り替えの即時対応
2. **ストレスからの解放**: 環境依存エラー最小化、提出ミス防止、統一インターフェース
3. **学習効率の向上**: 実行履歴からの振り返り、エラーパターン可視化

## 技術アーキテクチャ

### 現在の実装状況
- **言語**: Python 3.8+
- **実行環境**: Docker（環境の完全な再現性）
- **データストア**: SQLite（軽量な履歴管理）
- **設定管理**: JSON形式（ConfigNodeシステムによる階層的解決）
- **アーキテクチャ**: Clean Architecture（レイヤー分離は良好だが過度に複雑）

### 対応言語
- Python (3.8-3.11)
- C++ (g++ 11-13, C++17/20)
- Rust (stable/nightly, edition 2021)

### アーキテクチャ構成
```
┌─────────────────────────────────────────┐
│      Presentation Layer (CLI)           │
├─────────────────────────────────────────┤
│   Application Layer (Services)          │
├─────────────────────────────────────────┤
│    Domain Layer (Business Logic)        │
├─────────────────────────────────────────┤
│  Infrastructure Layer (Drivers)         │
└─────────────────────────────────────────┘
```

## 現在進行中の作業

### プロジェクト再生計画（4週間計画）
「プロジェクト再生宣言」に基づき、過度な抽象化を段階的に統合する計画が進行中：

1. **Week 1**: Driver系統統合（27ファイル削減）
2. **Week 2**: Request/Result統合（13ファイル削減）
3. **Week 3**: Provider/Adapter統合（8ファイル削除）
4. **Week 4**: テスト環境整理

### 直近の作業履歴（feature/dependency-reorganization）
- cargo testの実行と問題対応を繰り返し実施
- 古い実装に基づくテストの削除
- テストカバレッジの向上作業
- 依存関係の再編成作業

## 開発ガイドライン（CLAUDE.md）

### グローバルルール
- 指示が曖昧な場合は必ず再確認
- コード変更前に責務の配置が適切か確認
- 品質管理コード：src_check/、本番コード：src/

### src/配下のルール
- デフォルト値の使用禁止（設定はJSONから取得）
- 中長期を見据えた実装
- 副作用はsrc/infrastructureのみ（main.pyから注入）
- フォールバック処理禁止
- 引数のデフォルト値禁止

### 品質管理システム（src_check/）
- 動的インポートによる柔軟なルールチェック
- 自動修正機能（imports、ファイル整理）
- 分離された名前空間での実行
- 重複実装を許容（多角的な視点）

## 現在の課題分析

### 技術的課題
1. **過度な抽象化**: 新機能追加に8ファイル編集が必要
2. **低テストカバレッジ**: 12%（特にapplication/presentation層）
3. **循環依存**: 一部で遅延インポートによる暫定対応
4. **複雑性**: 75コンポーネントの学習曲線

### 組織的課題
1. **開発者疲弊**: バグ調査に10ファイルのナビゲーション
2. **保守性**: 理論的完璧さが実用性を阻害
3. **CLAUDE.md遵守**: 短期的解決の誘惑との戦い

## 次のアクション候補

### 優先度：高
1. **Driver統合の継続**
   - 現在のDriver関連ファイルの分析と統合計画策定
   - テストを維持しながら段階的に統合
   - 副作用の適切な分離を維持

2. **テストカバレッジの改善**
   - application層のテスト追加（優先度最高）
   - presentation層のテスト追加
   - 統合テストの整備

### 優先度：中
3. **循環依存の根本解決**
   - 遅延インポートの洗い出し
   - アーキテクチャレベルでの依存関係整理
   - 中長期的な解決策の実装

4. **ConfigNodeシステムの最適化**
   - 1000倍のパフォーマンス改善の維持
   - 設定アクセスパターンの統一
   - テンプレート展開機能の改善

### 優先度：低
5. **ドキュメント整備**
   - 統合後の新しいアーキテクチャのドキュメント化
   - 開発者向けガイドの更新
   - ユーザー向けドキュメントの改善

## 実装方針

### 段階的統合の原則
1. **機能保持**: 既存機能とテストは100%保持
2. **影響最小化**: 各段階で動作確認を実施
3. **可逆性**: 必要に応じてロールバック可能な設計

### 品質基準
1. **CLAUDE.md完全準拠**: 中長期視点、デフォルト値禁止
2. **Clean Architecture維持**: レイヤー分離の原則を守る
3. **テスト駆動**: 新規コードは必ずテスト付き

## リスクと対策

### リスク
1. **統合による機能喪失**: テスト不足による見落とし
2. **パフォーマンス劣化**: 統合による最適化の喪失
3. **開発速度低下**: 慎重な統合による進捗遅延

### 対策
1. **包括的テスト**: 統合前後での回帰テスト実施
2. **パフォーマンス計測**: 各統合段階でのベンチマーク
3. **タイムボックス**: 週単位での成果確認と方針調整

## 成功指標

### 定量的指標
- ファイル数: 150 → 40以下（73%削減）
- テストカバレッジ: 12% → 80%以上
- 新機能追加: 8ファイル編集 → 2ファイル以下

### 定性的指標
- 開発者の理解容易性向上
- バグ調査時間の短縮
- 新規参入者の学習時間短縮

## 結論

CPHプロジェクトは優れた理念と機能を持ちながら、過度な抽象化により開発効率が低下している状態です。プロジェクト再生計画に従い、段階的な統合を進めることで「理論的に完璧」から「実用的に優秀」への転換を図ります。CLAUDE.mdの原則を遵守しながら、中長期的な視点で着実に改善を進めていくことが重要です。