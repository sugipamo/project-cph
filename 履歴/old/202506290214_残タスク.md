# CLAUDE.md違反検出・修正タスク (2025-06-29 02:14)

## 検出された違反サマリー
- **総違反数**: 178件
- **デフォルト値の使用**: 50件
- **不適切な副作用**: 46件  
- **フォールバック処理**: 75件
- **遅延インポート**: 7件

## 主要な違反ファイル

### 1. フォールバック処理（75件）
最も多い違反。try-except Exceptionの広範囲キャッチが主な原因。

**優先度高**:
- `src/application/contest_manager.py`: 13件
- `src/application/execution_requests.py`: 6件
- `src/operations/error_converter.py`: 7件

**対応方針**:
- Result型を使用した明示的なエラーハンドリングに変更
- infrastructure層でErrorConverterを使用してResult型に変換
- ビジネスロジック層ではis_failure()でエラーチェック

### 2. デフォルト値の使用（50件）
関数の引数にデフォルト値が設定されている。

**既に修正済み**:
- `src/domain/dependency.py`
- `src/domain/step_runner.py`
- `src/domain/workflow_logger_adapter.py`
- `src/infrastructure/ast_analyzer.py`
- `src/infrastructure/persistence_exceptions.py`

**未修正**:
- `src/infrastructure/drivers/file/file_driver.py`: 6件
- `src/infrastructure/drivers/docker/docker_driver.py`: 7件
- `src/application/execution_requests.py`: 3件

**対応方針**:
- 呼び出し元で明示的に値を渡すように修正
- 設定値はconfig/*.jsonから取得

### 3. 不適切な副作用（46件）
infrastructure以外での副作用（ファイルI/O、ネットワーク通信など）。

**主な違反**:
- `src/configuration/di_config.py`: 8件（ファイル読み込み）
- `src/presentation/module_parser.py`: 1件（ファイル読み込み）
- `src/presentation/user_input_parser.py`: 2件

**対応方針**:
- 副作用を持つ処理をinfrastructure層に移動
- main.pyから依存性注入で提供
- ビジネスロジックは純粋関数として実装

### 4. 遅延インポート（7件）
関数内でのインポート。循環インポートを回避するための短期的解決。

**主な違反**:
- `src/configuration/di_config.py`: 4件
- `src/presentation/user_input_parser.py`: 1件

**対応方針**:
- モジュール構造の見直し
- 共通インターフェースの抽出
- 依存関係の逆転

## 実装優先順位

1. **フォールバック処理の修正**（影響大）
   - error_converterパターンの全面適用
   - Result型への統一

2. **副作用の分離**（アーキテクチャ改善）
   - infrastructure層への集約
   - 依存性注入の強化

3. **デフォルト値の除去**（簡単だが件数多）
   - 機械的な修正が可能
   - テストの追加が必要

4. **遅延インポートの解消**（設計見直し必要）
   - 循環依存の根本解決
   - モジュール再編成

## チェックツール

作成済みの包括的チェッカー:
- `/home/cphelper/project-cph/src_check/processors/rules/claude_md_comprehensive_checker.py`

実行コマンド:
```bash
PYTHONPATH=/home/cphelper/project-cph/src_check python3 src_check/processors/rules/claude_md_comprehensive_checker.py
```

## 備考
- 修正時は必ずテストを実行して動作確認
- 大規模な変更は段階的に実施
- 互換性維持のコメントを適切に追加