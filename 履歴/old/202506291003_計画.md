# CPH プロジェクト 1日作業計画
日付: 2025-06-29
開始時刻: 10:03

## 目標
CLAUDE.md違反の修正とテストカバレッジの向上を通じて、コード品質の改善を行う。

## 作業範囲
1日で実施可能な範囲に絞り、確実に完了できるタスクを優先する。

## 実行計画

### フェーズ1: CLAUDE.md違反の修正 (3時間)

#### 1.1 デフォルトパラメータの除去 (優先度: 最高)
以下のファイルのデフォルトパラメータを全て除去し、呼び出し元で明示的に値を渡すよう修正:
- [ ] workflow_execution_service.py (line 244): `use_parallel=False, max_workers=4`
- [ ] cli_app.py (line 247): `main()` のデフォルト引数
- [ ] docker_image_repository.py (line 173): `find_unused_images(days=30)`
- [ ] sqlite_state_repository.py (line 34): `get_execution_history(limit=10)`

#### 1.2 フォールバック処理の除去 (優先度: 高)
- [ ] system_config_repository.py: JSON decodeのフォールバック処理を除去
- [ ] runtime_config_overlay.py: デフォルト値返却の除去

### フェーズ2: テストの追加と修正 (2時間)

#### 2.1 修正したコードのテスト更新
- [ ] デフォルトパラメータ除去に伴うテストケースの更新
- [ ] フォールバック処理除去に伴うエラーケースのテスト追加

#### 2.2 低カバレッジファイルのテスト追加
優先順位（ビジネスロジックの重要性順）:
- [ ] workflow_execution_service.py (75% → 85%以上)
- [ ] domain/workflow.py (72% → 85%以上)
- [ ] domain/step.py (74% → 85%以上)

### フェーズ3: 品質確認 (1時間)

#### 3.1 自動チェックの実行
- [ ] src_check/ディレクトリのチェックツール実行
- [ ] CLAUDE.md違反チェック
- [ ] 循環インポートチェック

#### 3.2 テストスイート全体の実行
- [ ] pytest実行（全1866テストがパスすることを確認）
- [ ] カバレッジレポートの確認

### フェーズ4: ドキュメント化 (30分)

#### 4.1 作業結果の記録
- [ ] 202506291003_結果.mdに詳細な作業内容を記録
- [ ] 残タスクがある場合は202506291003_残タスク.mdに記録

## 成功基準

1. **CLAUDE.md違反の削減**
   - デフォルトパラメータ違反: 15件 → 0件
   - フォールバック処理違反: 8件 → 0件

2. **テストカバレッジの向上**
   - 全体カバレッジ: 90%以上を維持
   - 重要ビジネスロジックファイル: 85%以上

3. **テストスイートの健全性**
   - 全1866テストがパス
   - 新規追加テストも全てパス

## 注意事項

- CLAUDE.mdの指示に厳密に従う
- 短期的な解決策は避け、中長期的な視点で実装
- 互換性を壊す変更には必ず互換性維持のコメントを追加
- 設定ファイルの編集は行わない（ユーザーから明示的な指示がないため）

## 予想される課題

1. デフォルトパラメータ除去により多数の呼び出し元の修正が必要
2. フォールバック処理除去によりエラーハンドリングの再設計が必要
3. テスト追加により実行時間が増加する可能性

## タイムライン

- 10:00-13:00: フェーズ1（CLAUDE.md違反修正）
- 13:00-15:00: フェーズ2（テスト追加・修正）
- 15:00-16:00: フェーズ3（品質確認）
- 16:00-16:30: フェーズ4（ドキュメント化）

合計作業時間: 約6.5時間