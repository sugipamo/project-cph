# 202506281728 実行計画

## 現状分析

### プロジェクト概要
- **CPH (Competitive Programming Helper)**: 競技プログラミング用統一環境提供ツール
- **対応言語**: Python、C++、Rust
- **目的**: 環境差異の解消と作業自動化

### 前回作業（202506281706）の成果
1. 違反調査レポートの作成完了
2. 最優先違反（workflow_logger_adapter.py）の修正完了
3. workflow_logger_adapterのテスト追加（カバレッジ100%達成）

### 主要課題
1. **アーキテクチャ違反**
   - 循環依存: 4ファイル
   - クリーンアーキテクチャ違反: アプリケーション層8件

2. **CLAUDE.md規約違反**
   - デフォルト値使用: 27ファイル
   - フォールバック処理: 多数のファイル
   - 引数のデフォルト値: 多数のファイル

3. **テストカバレッジ**
   - 全体: 60%（低い）
   - 0%カバレッジモジュール多数
   - 12個のテストがスキップ状態

## 実行計画

### フェーズ1: 高優先度違反の修正（1時間）

#### 1.1 step_runner.pyのフォールバック処理除去（30分）
- フォールバック処理の削除
- 設定ベースの明示的デフォルト値実装
- .get()メソッドの使用除去
- 関連テストの更新

#### 1.2 アプリケーション層インフラ依存の修正開始（30分）
- config_manager.pyの修正（最優先）
  - インフラ層への依存を除去
  - 依存性注入パターンへの変更
- 関連テストの更新

### フェーズ2: テストカバレッジ改善（30分）

#### 2.1 プレゼンテーション層テスト追加
- cli_app.pyのテスト作成
- main.pyのテスト作成（基本的なケースのみ）

#### 2.2 低カバレッジモジュールのテスト追加
- path_operations.pyのテスト
- retry_decorator.pyのテスト

### フェーズ3: 残作業の整理（15分）

#### 3.1 テスト実行と問題対応
- 全テストの実行
- 失敗テストの修正
- スキップされているテストの削除判断

#### 3.2 残タスクの記録
- 未完了のアーキテクチャ違反修正
- 未達成のテストカバレッジ目標
- Driver統合に向けた準備事項

## 優先順位と判断基準

1. **最優先**: CLAUDE.md違反の修正（特にフォールバック処理）
   - 理由: プロジェクトの基本方針に直結

2. **高優先**: クリーンアーキテクチャ違反の修正
   - 理由: 長期的な保守性に影響

3. **中優先**: テストカバレッジの改善
   - 理由: 品質保証と今後の変更の安全性

## 成功指標

1. step_runner.pyのフォールバック処理が完全に除去される
2. config_manager.pyのインフラ依存が解消される
3. 全体のテストカバレッジが65%以上に向上する
4. 全テストが正常に実行される（スキップテストは削除）

## リスクと対策

1. **リスク**: 設定ファイルの不整合
   - **対策**: 変更前に既存設定の確認と必要に応じた追加

2. **リスク**: テスト修正による互換性の破壊
   - **対策**: 段階的な修正と都度の動作確認

3. **リスク**: 時間不足による未完了
   - **対策**: 優先順位に従い、完了分を確実に記録