# CPH プロジェクト実行計画
## 作成日時: 2025-06-28 15:25

## 1. 現状分析サマリー

### プロジェクト概要
- **プロジェクト名**: CPH (Competitive Programming Helper)
- **目的**: 競技プログラミング環境の統一と自動化
- **アーキテクチャ**: Clean Architecture
- **対応言語**: Python, C++, Rust
- **現在のブランチ**: feature/dependency-reorganization

### 技術スタック
- Python 3.8+
- Docker (実行環境の分離)
- SQLite (実行履歴管理)
- pytest (テスト)
- Ruff (リンター)
- mypy (型チェック)

### 現状の課題
1. **テストカバレッジ**: 全体57% (改善が必要)
2. **テストの失敗**: 41件のテストが失敗中
   - UnifiedLogger: 26件
   - SystemConfigRepository: 15件
3. **アーキテクチャの複雑性**:
   - ドライバー層の冗長性
   - 深い依存関係階層
   - リポジトリインターフェースの不整合
4. **CLAUDE.md準拠の問題**:
   - デフォルト値の使用
   - 副作用の配置
   - 短期的解決の存在

## 2. 実行計画

### フェーズ1: テストの修正と安定化 (優先度: 高)

#### 1.1 UnifiedLoggerのテスト修正
- 26件の失敗テストを調査・修正
- ログ出力の実装確認
- モックの適切な設定

#### 1.2 SystemConfigRepositoryのテスト修正
- 15件の失敗テストを調査・修正
- 設定ファイルの読み込み処理確認
- パスの解決ロジック修正

#### 1.3 その他の失敗テストの対応
- 残りの失敗テストを特定・修正
- 古い実装に基づくテストの削除

### フェーズ2: テストカバレッジの改善 (優先度: 高)

#### 2.1 低カバレッジモジュールの特定
- 現在のカバレッジレポート生成
- 優先順位付け (ビジネスクリティカルなモジュール優先)

#### 2.2 重要モジュールのテスト追加
- `fast_sqlite_manager.py` (23%)
- `configuration_repository.py` (24%)
- `unified_logger.py` (25%)
- その他の低カバレッジモジュール

### フェーズ3: アーキテクチャの改善 (優先度: 中)

#### 3.1 ドライバー層の整理
- UnifiedDriverとPersistenceDriverの統合検討
- インターフェースの簡素化
- 依存関係の整理

#### 3.2 CLAUDE.md準拠の確認
- デフォルト値の除去
- 副作用のinfrastructure層への移動
- 長期的視点での実装改善

### フェーズ4: 機能実装の検証 (優先度: 中)

#### 4.1 CLIコマンドの実装状況確認
- `cph new`, `cph test`, `cph run`, `cph submit`の動作確認
- 不足機能の特定

#### 4.2 ユーザー体験の改善
- エラーメッセージの改善
- ヘルプドキュメントの整備

## 3. 実行順序と時間配分

1. **即座に実行**: テストの修正 (フェーズ1)
   - UnifiedLoggerとSystemConfigRepositoryのテスト修正を優先
   - 全テストがパスする状態を目指す

2. **次に実行**: テストカバレッジ改善 (フェーズ2)
   - ビジネスクリティカルなモジュールから順次対応
   - 目標: 70%以上のカバレッジ

3. **並行して実行**: アーキテクチャ改善 (フェーズ3)
   - CLAUDE.md準拠の確認と修正
   - 長期的な保守性向上

4. **最後に実行**: 機能検証 (フェーズ4)
   - 安定したコードベース上で機能確認

## 4. 成功基準

- [ ] 全テストがパスする
- [ ] テストカバレッジ70%以上
- [ ] CLAUDE.mdの主要な指摘事項への対応
- [ ] 主要なCLIコマンドの動作確認

## 5. リスクと対策

### リスク1: テスト修正による既存機能への影響
- **対策**: 修正前後で動作確認を実施

### リスク2: アーキテクチャ変更の影響範囲
- **対策**: 小さな変更から段階的に実施

### リスク3: 時間制約
- **対策**: 優先度に基づいて実行、完了できない項目は残タスクとして記録