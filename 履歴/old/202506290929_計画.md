# 実行計画 (2025/06/29 09:29)

## 本日の作業目標
CLAUDE.md違反の修正とテストカバレッジの向上を通じて、コード品質を改善する。

## 作業範囲（1日で完了可能な範囲）

### 1. CLAUDE.md違反の優先修正（午前）
最も影響の大きい違反から順に修正する：

#### Phase 1: デフォルト引数の削除（2時間）
1. **src/application/execution_requests.py**
   - ShellRequest.__init__のデフォルト引数を削除
   - PythonRequest.__init__のデフォルト引数を削除
   - 呼び出し元で明示的に値を渡すよう修正

2. **src/infrastructure/ast_analyzer.py**
   - filename引数のデフォルト値を削除
   - 呼び出し元の修正

#### Phase 2: フォールバック処理の削除（2時間）
1. **src/domain/step_runner.py**
   - ハードコードされたfallback_defaultsを削除
   - .get()メソッドの使用を直接アクセスに変更
   - 設定ファイルから値を取得するよう修正

2. **src/configuration/di_config.py**
   - .get()のチェーンを削除
   - 設定ファイルから直接値を取得

### 2. テストカバレッジの向上（午後）
最もカバレッジの低いファイルから優先的に対応：

#### Phase 3: 重要モジュールのテスト追加（3時間）
1. **src/infrastructure/os_provider.py (62%)** 
   - ファイル操作メソッドのテストケース追加
   - プロパティゲッターのテスト追加
   - 目標: 80%以上

2. **src/presentation/docker_command_builder.py (62%)**
   - 各種Dockerコマンドオプションの組み合わせテスト
   - エッジケースのテスト追加
   - 目標: 80%以上

3. **src/operations/requests/request_factory.py (66%)**
   - 各リクエストタイプのファクトリーメソッドテスト
   - 異常系のテストケース追加
   - 目標: 80%以上

### 3. 検証とドキュメント化（夕方）

#### Phase 4: 最終確認（1時間）
1. すべてのテストが成功することを確認
2. mypy --strict での型チェック
3. 修正箇所の動作確認

## 成功基準
1. CLAUDE.md違反の主要な箇所（特にデフォルト引数とフォールバック）が修正されている
2. 最低3つの低カバレッジモジュールが80%以上に改善されている
3. 既存のテストがすべて成功している
4. 新規テストが追加され、全体のカバレッジが向上している

## リスクと対策
- **リスク**: CLAUDE.md違反修正により既存コードが動かなくなる可能性
  - **対策**: 修正は小さな単位で行い、都度テストを実行
- **リスク**: テスト追加により予期しない問題が発見される可能性
  - **対策**: 問題が見つかった場合は残タスクとして記録し、優先度を判断

## 作業順序
1. CLAUDE.md違反の修正（影響範囲が大きいため最優先）
2. テストカバレッジの向上（品質向上のため）
3. 全体の動作確認とドキュメント化

## 備考
- 作業中に発見した新たな問題は「履歴/202506290929_残タスク.md」に記録
- 各フェーズ完了時にコミットを作成し、ロールバック可能にする
- 時間配分は目安であり、問題の複雑さに応じて調整する