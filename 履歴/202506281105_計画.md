# CPH プロジェクト計画書
作成日時: 2025-06-28 11:05

## プロジェクト概要

### プロジェクト名
CPH (Competitive Programming Helper) - 競技プログラミング支援ツール

### 目的
競技プログラマーが以下に集中できる環境を提供する：
- アルゴリズム設計への専念
- 環境構築からの解放
- 複数言語間のシームレスな切り替え
- ローカルテストとジャッジ環境の一致性確保

### 現在の状況
- **ファイル数**: 150ファイル、75ディレクトリ
- **アーキテクチャ**: クリーンアーキテクチャ採用
- **対応言語**: Python, C++, Rust, PyPy
- **実行環境**: Docker/ローカル両対応
- **ブランチ**: feature/dependency-reorganization

## 主要機能

1. **多言語対応実行環境**
   - Python, C++, Rust, PyPyの統一管理
   - 言語切り替えの自動化

2. **実行環境管理**
   - Dockerコンテナ化実行
   - ローカル実行
   - 環境の一貫性保証

3. **自動テスト・ビルドシステム**
   - テスト、ビルド、実行の統合管理
   - ワークフローの自動化

4. **型安全な設定管理**
   - パフォーマンス最適化
   - 明示的な型指定

5. **実行履歴追跡**
   - SQLiteベースの履歴管理
   - パフォーマンス分析支援

## アーキテクチャ構成

```
src/
├── presentation/      # CLI インターフェース層
├── application/       # ワークフローサービス層
├── domain/           # ビジネスロジック層
└── infrastructure/   # 外部システム連携層

src_check/            # 品質管理コード
workspace/            # Rustテンプレート
```

## 課題と改善計画

### 現在の課題
1. **過度な設計複雑性**
   - 75ディレクトリ構成による開発者疲労
   - 新機能追加時に8ファイルの編集が必要
   
2. **高い学習コスト**
   - 新規開発者は75コンポーネントの理解が必要
   - バグ調査に10ファイル以上の追跡が必要

3. **メンテナンス性の低下**
   - 依存関係の複雑化
   - 変更影響範囲の予測困難

### 改善目標（4週間計画）
- ファイル数を73%削減（150→40-50ファイル）
- ドライバー、リクエスト/レスポンス、プロバイダー/アダプターの統合
- 開発者体験の向上
- 既存機能の100%維持

## 開発制約事項

1. **デフォルト値の使用禁止**
   - すべての値は明示的に提供
   - 設定はsrc/configuration/配下で管理

2. **副作用の制限**
   - 副作用はinfrastructure層のみ
   - main.pyからの依存性注入

3. **エラー処理**
   - フォールバック処理禁止
   - 明示的なエラーハンドリング

4. **品質管理**
   - src_check/と src/の明確な分離
   - 中長期を見据えた実装

## 直近のタスク

### 依存関係の再編成（現在のブランチ）
1. cargo testの実行と問題対応
2. 古い実装に基づくテストの削除
3. テストカバレッジの向上
4. 循環インポートの解消

### 技術的負債の解消
- 密結合の解消
- 遅延インポートの適切な使用
- CLAUDE.mdの指示への準拠

## 成功指標

1. **開発効率**
   - 新機能追加時の編集ファイル数: 8→3以下
   - バグ調査時の追跡ファイル数: 10→5以下

2. **コード品質**
   - テストカバレッジ: 現状維持以上
   - 循環依存: 0件

3. **保守性**
   - 新規開発者の理解時間: 50%削減
   - ドキュメント整備率: 100%

## リスクと対策

### リスク
1. リファクタリング中の機能劣化
2. 既存ユーザーへの影響
3. テストカバレッジの低下

### 対策
1. 段階的なリファクタリング実施
2. 後方互換性の維持
3. 継続的なテスト実行とカバレッジ監視

## 次のアクション

1. 現在のテスト失敗状況の確認
2. 循環インポートの特定と解消
3. 依存関係グラフの可視化
4. リファクタリング優先順位の決定