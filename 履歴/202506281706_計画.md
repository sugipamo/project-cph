# 実行計画 - 2025/06/28 17:06

## 現状分析

### プロジェクトの概要
CPH（Competition Programming Helper）は競技プログラミング環境を統一するツールで、以下の特徴を持つ：
- 複数言語対応（Python、C++、Rust）
- Docker による環境統一
- テスト実行・提出準備の自動化

### 確認された主要な問題

1. **アーキテクチャ違反**
   - 循環依存が4ファイルで遅延インポートにより回避されている
   - ドメイン層がインフラ層に依存（クリーンアーキテクチャ違反）
   - アプリケーション層も直接インフラをインポート

2. **CLAUDE.md 規約違反**
   - デフォルト値の使用が禁止されているが、多数のファイルで違反
   - フォールバック処理が明示的に実装されている
   - 短期的な解決を繰り返している形跡

3. **技術的負債**
   - 「互換性維持」コメントが散見され、一時的な対処が常態化
   - 設定システムは適切に設計されているが、実装が従っていない

4. **テストカバレッジ**
   - 前回作業で一部改善されたが、まだ低カバレッジのモジュールが多数存在
   - 特にドメイン層の重要モジュールのカバレッジが低い

## 実行計画

### フェーズ1: アーキテクチャ違反の調査と文書化（優先度: 高）

1. **循環依存の詳細調査**
   - 4つの遅延インポートファイルの依存関係を図式化
   - 根本原因の特定

2. **クリーンアーキテクチャ違反の調査**
   - ドメイン層→インフラ層の依存を全て洗い出し
   - アプリケーション層→インフラ層の依存を全て洗い出し

3. **CLAUDE.md 違反箇所の網羅的調査**
   - デフォルト値使用箇所の一覧化
   - フォールバック処理の一覧化

### フェーズ2: 段階的な修正計画立案（優先度: 高）

1. **依存関係の整理**
   - インターフェース定義による依存関係逆転
   - 適切な注入ポイントの設計

2. **設定システムの活用**
   - 既存の設定システムを使った適切な実装への移行計画

3. **テスト戦略**
   - 修正に伴うテストの追加計画

### フェーズ3: 優先順位付けと実装（優先度: 中）

1. **クリティカルパスの特定**
   - 最も影響の大きい違反から順に修正

2. **段階的な実装**
   - 一度に全てを修正せず、動作を確認しながら進める

## 今回の作業範囲

本日は以下を実施：

1. **詳細な違反調査レポートの作成**
   - 各違反の具体的な場所と内容
   - 修正の影響範囲
   - 推奨される修正方法

2. **修正優先順位の決定**
   - ビジネスインパクトと技術的複雑さのマトリクス作成

3. **最初の修正対象の選定と実装**
   - 最も単純で影響の少ない違反から開始

## 成功基準

- アーキテクチャ違反の全容が明確になること
- 修正の優先順位が決定されること
- 少なくとも1つの違反が修正されること
- テストが全て通過すること

## リスクと対策

- **リスク**: 修正により既存機能が壊れる可能性
- **対策**: 十分なテストカバレッジを確保してから修正

- **リスク**: 修正範囲が大きすぎて完了しない
- **対策**: 小さな単位で段階的に進める