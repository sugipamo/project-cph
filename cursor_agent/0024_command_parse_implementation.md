# コマンドパース機能の実装計画書

## 概要
コマンドラインからの入力を解析し、適切なコマンドとパラメータに分解する機能の実装。

## 主要コンポーネント

### 1. 名前解決システム
- `NameResolver`: 単一のパラメータタイプに対する名前解決を担当
  - エイリアスの登録と解決を管理
  - 完全一致のみをサポート（大文字小文字を区別）
- `NameResolvers`: 複数の`NameResolver`を統合管理
  - コマンド、サイト、言語の3種類のパラメータタイプをサポート
  - 優先順位付きの名前解決を実現

### 2. コマンドトークン化
- `CommandToken`: パース結果を表現する構造体
  - コマンド名
  - 引数マップ
  - パターン情報
- `TokenizeError`: パース時のエラー種別を定義
  - マッチなし
  - 複数マッチ
  - 不正なフォーマット
  - 設定エラー

### 3. パターンマッチング
- 順序固定パターン（ordered）
  - パターンと引数の長さが一致する必要あり
  - パラメータの位置が固定
- 順序不定パターン（unordered）
  - パターンと引数の長さが一致する必要あり
  - パラメータの位置は任意

## 実装の特徴

### 1. 設定ファイルとの統合
- コマンドパターンは`commands.yaml`で定義
- エイリアスは`config.yaml`で管理
- 設定は起動時に一度だけ読み込み（Lazy static）

### 2. エラー処理
- 詳細なエラーメッセージを日本語で提供
- エラーの種類に応じた適切な処理
- 複数マッチ時の候補表示

### 3. テスト機能
- 基本的なコマンドパース
- エイリアス解決
- エラーケース
- パターンマッチング
- 名前解決の優先順位

## 実装の制約

### 1. パフォーマンス
- 設定ファイルの読み込みは一度のみ
- 名前解決は完全一致のみ
- パターンマッチングは引数の長さで早期リターン

### 2. 安全性
- パラメータの型チェック
- 不正な入力の検出
- エラーの適切な伝播

### 3. 拡張性
- 新しいパラメータタイプの追加が容易
- パターンマッチングルールの拡張が可能
- テストケースの追加が容易

## 作業難易度

### 1. 基本実装: 中
- 名前解決システムの実装
- コマンドトークン化の実装
- 基本的なパターンマッチング

### 2. エラー処理: 低
- エラー型の定義
- エラーメッセージの実装
- エラー伝播の実装

### 3. テスト: 中
- テストケースの作成
- エッジケースの考慮
- テストヘルパー関数の実装

### 4. 設定ファイル統合: 低
- YAML設定ファイルの読み込み
- Lazy staticの実装
- 設定バリデーション

## 今後の課題

### 1. 機能拡張
- 大文字小文字を区別しない名前解決
- 正規表現によるパターンマッチング
- 動的なエイリアス追加

### 2. パフォーマンス最適化
- キャッシュの導入
- パターンマッチングの最適化
- メモリ使用量の削減

### 3. ユーザビリティ
- より詳細なエラーメッセージ
- コマンド候補の提案機能
- オートコンプリート機能 