# コンテストコマンド実装の調査報告書

## 1. 現状の確認

### 1.1 Contest構造体の責務
- コンテスト情報の管理（ID、言語、サイト）
- ファイルシステム操作（テンプレート、移動、コピー）
- URL生成（問題URL、提出URL）

### 1.2 実装方針
1. configs関連の変数変更時にファイル操作を実行
2. 不要ファイルはstorageフォルダに移動
3. configs関連操作完了後にexecutions関連操作を実行

## 2. 追加で必要な機能

### 2.1 コマンドのパース結果と`Contest`構造体の連携
- parse.rsからのコマンド解析結果の受け取り方の定義
- コマンドの種類に応じた処理の振り分け
- 引数の検証とエラーハンドリング

### 2.2 設定変更の検証機能
- 設定値のバリデーション
- 依存関係のチェック（yamlに記載）
- 変更前の状態保存（ロールバック用）

### 2.3 ファイル操作のログ機能
- 操作内容の記録
- エラー発生時のデバッグ情報
- 変更履歴の保持（クレート利用を検討）

### 2.4 エラーメッセージの統一
- エラー種別の定義
- ユーザーフレンドリーなメッセージ
- 多言語対応（必要に応じて）

## 3. 実装手順

1. ファイル変更履歴管理クレートの調査と選定
2. Contest構造体にコマンド実行メソッドを追加
3. 設定変更時のファイル操作フローの実装
4. エラーハンドリングとロールバック機能の実装
5. ログ機能の実装
6. テストケースの作成

## 4. 検討事項

### 4.1 ファイル変更履歴管理
- git2-rs: Gitライブラリ
- notify: ファイル変更監視
- fs_extra: ファイル操作の拡張機能

### 4.2 エラーハンドリング
```rust
// エラー種別の定義例
pub enum ContestError {
    ConfigError(String),
    FileOperationError(String),
    ValidationError(String),
    CommandError(String),
}

// Result型のエイリアス
type Result<T> = std::result::Result<T, ContestError>;
```

### 4.3 ログ機能
```rust
// ログ構造体の例
pub struct OperationLog {
    timestamp: DateTime<Utc>,
    operation_type: String,
    target: PathBuf,
    status: String,
    details: Option<String>,
}
```

## 5. 次のステップ

1. ファイル変更履歴管理クレートの選定
2. エラー型の定義
3. コマンド実行フローの実装
4. テストケースの作成

## 6. 懸念事項

1. ファイル操作の原子性の確保
2. エラー発生時のロールバック処理の信頼性
3. 設定変更とファイル操作の整合性維持 