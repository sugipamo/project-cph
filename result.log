============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.3.5, pluggy-1.5.0
rootdir: /home/cphelper/project-cph
configfile: pytest.ini
plugins: asyncio-0.26.0, cov-6.1.1
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 233 items

tests/e2e/test_cph_sh.py ssssssssss                                      [  4%]
tests/integration/test_container_client.py ...                           [  5%]
tests/integration/test_container_pool.py ..                              [  6%]
tests/integration/test_execution_manager.py ....                         [  8%]
tests/integration/test_file_operator.py ...........................      [ 19%]
tests/integration/test_integration_execution_manager_env.py .            [ 20%]
tests/integration/test_integration_manager.py .                          [ 20%]
tests/integration/test_local_client.py ...                               [ 21%]
tests/integration/test_local_file_operator.py ..                         [ 22%]
tests/integration/test_oj_build.py ...                                   [ 24%]
tests/test_command_executor.py ....                                      [ 25%]
tests/test_command_executor_formatter.py .....                           [ 27%]
tests/test_command_open.py ...                                           [ 29%]
tests/test_command_parser.py .......                                     [ 32%]
tests/test_command_submit.py ...........                                 [ 36%]
tests/test_command_test.py ........                                      [ 40%]
tests/test_common.py .                                                   [ 40%]
tests/test_config_json_manager.py .....                                  [ 42%]
tests/test_container_client.py .....................                     [ 51%]
tests/test_contest_env.py ...                                            [ 53%]
tests/test_contest_file_manager.py .................                     [ 60%]
tests/test_contest_file_manager_utils.py ......                          [ 63%]
tests/test_execution_env_config.py ..                                    [ 63%]
tests/test_execution_manager.py .....                                    [ 66%]
tests/test_execution_resource_manager.py .FFF

=================================== FAILURES ===================================
________________ test_docker_resource_manager_adjust_resources _________________

    def test_docker_resource_manager_adjust_resources():
        upm = make_upm()
        with patch(INFO_JSON_PATH) as MockInfo, \
             patch(POOL_PATH) as MockPool, \
             patch(LANG_ENVS_PATH, DUMMY_LANG_ENVS):
            mock_info = MockInfo.return_value
            mock_pool = MockPool.return_value
            mock_pool.adjust.return_value = [{'name': 'c1'}, {'name': 'c2'}]
>           mgr = DockerResourceManager(upm)

/home/cphelper/project-cph/tests/test_execution_resource_manager.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <src.execution_env.execution_resource_manager.DockerResourceManager object at 0x78740bf1c8c0>
upm = <MagicMock id='132439812104096'>

    def __init__(self, upm):
        from src.execution_env.info_json_manager import InfoJsonManager
        from src.execution_client.container.pool import ContainerPool
    
        self.upm = upm
        self.info_manager = InfoJsonManager(self.upm.info_json())
        # contest_env配下の全言語＋バージョンを動的に集約
        self.dockerfile_map = {
            (lang, ver): env_cls().dockerfile_path
>           for (lang, ver), env_cls in LANGUAGE_ENVS.items()
        }
E       ValueError: too many values to unpack (expected 2)

/home/cphelper/project-cph/src/execution_env/execution_resource_manager.py:41: ValueError
_______________ test_docker_resource_manager_get_test_containers _______________

    def test_docker_resource_manager_get_test_containers():
        upm = make_upm()
        with patch(INFO_JSON_PATH) as MockInfo, \
             patch(POOL_PATH), \
             patch(LANG_ENVS_PATH, DUMMY_LANG_ENVS):
            mock_info = MockInfo.return_value
            mock_info.get_containers.return_value = [{'name': 't1'}, {'name': 't2'}]
>           mgr = DockerResourceManager(upm)

/home/cphelper/project-cph/tests/test_execution_resource_manager.py:50: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <src.execution_env.execution_resource_manager.DockerResourceManager object at 0x78740bf35d90>
upm = <MagicMock id='132439811933584'>

    def __init__(self, upm):
        from src.execution_env.info_json_manager import InfoJsonManager
        from src.execution_client.container.pool import ContainerPool
    
        self.upm = upm
        self.info_manager = InfoJsonManager(self.upm.info_json())
        # contest_env配下の全言語＋バージョンを動的に集約
        self.dockerfile_map = {
            (lang, ver): env_cls().dockerfile_path
>           for (lang, ver), env_cls in LANGUAGE_ENVS.items()
        }
E       ValueError: too many values to unpack (expected 2)

/home/cphelper/project-cph/src/execution_env/execution_resource_manager.py:41: ValueError
______________ test_docker_resource_manager_get_ojtools_container ______________

    def test_docker_resource_manager_get_ojtools_container():
        upm = make_upm()
        with patch(INFO_JSON_PATH) as MockInfo, \
             patch(POOL_PATH), \
             patch(LANG_ENVS_PATH, DUMMY_LANG_ENVS):
            mock_info = MockInfo.return_value
            mock_info.get_containers.return_value = [{'name': 'oj1'}]
>           mgr = DockerResourceManager(upm)

/home/cphelper/project-cph/tests/test_execution_resource_manager.py:60: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <src.execution_env.execution_resource_manager.DockerResourceManager object at 0x7874110ec3e0>
upm = <MagicMock id='132439812035536'>

    def __init__(self, upm):
        from src.execution_env.info_json_manager import InfoJsonManager
        from src.execution_client.container.pool import ContainerPool
    
        self.upm = upm
        self.info_manager = InfoJsonManager(self.upm.info_json())
        # contest_env配下の全言語＋バージョンを動的に集約
        self.dockerfile_map = {
            (lang, ver): env_cls().dockerfile_path
>           for (lang, ver), env_cls in LANGUAGE_ENVS.items()
        }
E       ValueError: too many values to unpack (expected 2)

/home/cphelper/project-cph/src/execution_env/execution_resource_manager.py:41: ValueError
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Name                                                  Stmts   Miss  Cover
-------------------------------------------------------------------------
src/__init__.py                                           0      0   100%
src/command_executor.py                                  53      0   100%
src/command_parser.py                                    68      4    94%
src/commands/__init__.py                                  0      0   100%
src/commands/command_login.py                             6      2    67%
src/commands/command_open.py                             40      0   100%
src/commands/command_submit.py                          114     12    89%
src/commands/command_test.py                             62     11    82%
src/commands/common.py                                    9      0   100%
src/commands/opener.py                                   28     20    29%
src/commands/test_result_formatter.py                    62      0   100%
src/execution_client/__init__.py                          0      0   100%
src/execution_client/abstract_client.py                  22      6    73%
src/execution_client/client/container.py                279     85    70%
src/execution_client/client/local.py                     80     25    69%
src/execution_client/container/__init__.py                0      0   100%
src/execution_client/container/image_manager.py          73     49    33%
src/execution_client/container/naming_utils.py            7      0   100%
src/execution_client/container/oj_build.py               15      1    93%
src/execution_client/container/pool.py                   88     11    88%
src/execution_client/execution_manager.py                48      2    96%
src/execution_client/types.py                             7      0   100%
src/execution_client/utils.py                             2      1    50%
src/execution_env/__init__.py                             0      0   100%
src/execution_env/execution_env_config.py                10      0   100%
src/execution_env/execution_resource_manager.py          59     20    66%
src/execution_env/handlers.py                            21      3    86%
src/execution_env/info_json_manager.py                   43     19    56%
src/execution_env/language_config.py                      9      7    22%
src/execution_env/language_env_profile.py                20      4    80%
src/execution_env/run_test_execution_environment.py      73     48    34%
src/file/__init__.py                                      0      0   100%
src/file/config_json_manager.py                          42      3    93%
src/file/contest_file_manager.py                        212     49    77%
src/file/file_operator.py                               154     45    71%
src/file/moveignore_manager.py                           37      8    78%
src/file/testcase_file_operator.py                      129     89    31%
src/input_data_loader.py                                 18     15    17%
src/logger.py                                            10      3    70%
src/main.py                                              40     40     0%
src/path_manager/__init__.py                              0      0   100%
src/path_manager/common_paths.py                          8      0   100%
src/path_manager/project_path_manager.py                 39      5    87%
src/path_manager/unified_path_manager.py                102     52    49%
src/path_manager/volume_path_mapper.py                   47     32    32%
src/test_result_parser.py                                 7      4    43%
src/timer.py                                             17     11    35%
-------------------------------------------------------------------------
TOTAL                                                  2160    686    68%
=========================== short test summary info ============================
FAILED tests/test_execution_resource_manager.py::test_docker_resource_manager_adjust_resources
FAILED tests/test_execution_resource_manager.py::test_docker_resource_manager_get_test_containers
FAILED tests/test_execution_resource_manager.py::test_docker_resource_manager_get_ojtools_container
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 3 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
============= 3 failed, 145 passed, 10 skipped, 1 warning in 8.14s =============
